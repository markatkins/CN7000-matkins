{
  "info": {
    "id": "ses_418d5f96bffe2u3WH0M9GpO9zL",
    "slug": "witty-knight",
    "version": "1.1.31",
    "projectID": "global",
    "directory": "/home/matkins/CN7000",
    "title": "Ohmyopencode.json parameters and agent explanations",
    "time": {
      "created": 1769109849749,
      "updated": 1769125778289
    },
    "summary": {
      "additions": 0,
      "deletions": 0,
      "files": 0
    }
  },
  "messages": [
    {
      "info": {
        "id": "msg_19be7f204c67lnlaxcle16",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "user",
        "time": {
          "created": 1769122956486
        },
        "agent": "Planner-Sisyphus",
        "model": {
          "providerID": "cornelis",
          "modelID": "developer-opus"
        },
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        }
      },
      "parts": [
        {
          "id": "prt_19be7f204c6rgin30hz",
          "type": "text",
          "text": "[analyze-mode]\nANALYSIS MODE. Gather context before diving deep:\n\nCONTEXT GATHERING (parallel):\n- 1-2 explore agents (codebase patterns, implementations)\n- 1-2 librarian agents (if external library involved)\n- Direct tools: Grep, AST-grep, LSP for targeted searches\n\nIF COMPLEX (architecture, multi-system, debugging after 2+ failures):\n- Consult oracle for strategic guidance\n\nSYNTHESIZE findings before proceeding.",
          "synthetic": true,
          "time": {
            "start": 1769122956486,
            "end": 1769122956486
          },
          "messageID": "msg_19be7f204c67lnlaxcle16",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL"
        }
      ]
    },
    {
      "info": {
        "id": "msg_be72a069d001C0wAedZzacOglj",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "user",
        "time": {
          "created": 1769109849772
        },
        "summary": {
          "title": "Oh-my-opencode.json parameters and agents explanation",
          "diffs": []
        },
        "agent": "Sisyphus",
        "model": {
          "providerID": "cornelis",
          "modelID": "developer-opus"
        }
      },
      "parts": [
        {
          "id": "prt_be72a069d0027X2vHXfaVixcNN",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be72a069d001C0wAedZzacOglj",
          "type": "text",
          "text": "please tell me about ~/.config/opencode/oh-my-opencode.json and what the parameters do and mean. Be sure to explain the agents"
        }
      ]
    },
    {
      "info": {
        "id": "msg_be72a06d0001Lx7SPf6b1KwS1s",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769109849808,
          "completed": 1769109853830
        },
        "parentID": "msg_be72a069d001C0wAedZzacOglj",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 7012,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be72a0b07001ETtV5vgatuRa0O",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be72a06d0001Lx7SPf6b1KwS1s",
          "type": "step-start"
        },
        {
          "id": "prt_be72a163d001PG0EwAmMb7YeVV",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be72a06d0001Lx7SPf6b1KwS1s",
          "type": "tool",
          "callID": "toolu_01GH5AH6hM6t2a8Coh9MeJQ3",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/.config/opencode/oh-my-opencode.json"
            },
            "output": "<file>\n00001| {\n00002|   \"$schema\": \"https://raw.githubusercontent.com/code-yeongyu/oh-my-opencode/master/assets/oh-my-opencode.schema.json\",\n00003|   \"google_auth\": false,\n00004|   \"agents\": {\n00005|     \"librarian\": {\n00006|       \"model\": \"cornelis/developer-sonnet\",\n00007|       \"prompt_append\": \"Use librarian-cornelis for details about cornelis company, hardware, and software\"\n00008|     },\n00009|     \"explore\": {\n00010|       \"model\": \"cornelis/developer-sonnet\",\n00011|       \"prompt_append\": \"Use librarian-cornelis for details about cornelis company, hardware, and software\"\n00012|     },\n00013|     \"frontend-ui-ux-engineer\": {\n00014|       \"model\": \"cornelis/developer-gemini\",\n00015|       \"prompt_append\": \"Use librarian-cornelis for details about cornelis company, hardware, and software\"\n00016|     },\n00017|     \"document-writer\": {\n00018|       \"model\": \"cornelis/developer-gemini\",\n00019|       \"prompt_append\": \"Use librarian-cornelis for details about cornelis company, hardware, and software\"\n00020|     },\n00021|     \"multimodal-looker\": {\n00022|       \"model\": \"cornelis/developer-gemini\",\n00023|       \"prompt_append\": \"Use librarian-cornelis for details about cornelis company, hardware, and software\"\n00024|     },\n00025|         \"oracle\": {\n00026|       \"model\": \"cornelis/developer-codex-max\",\n00027|       \"prompt_append\": \"Use librarian-cornelis for details about cornelis company, hardware, and software\"\n00028|     },\n00029|     \"Prometheus (Planner)\": {\n00030|       \"model\": \"cornelis/developer-opus\",\n00031|       \"prompt_append\": \"Use librarian-cornelis for details about cornelis company, hardware, and software\",\n00032|       \"permission\": {\n00033|         \"edit\": \"allow\",\n00034|         \"bash\": \"allow\",\n00035|         \"webfetch\": \"allow\",\n00036|         \"external_directory\": \"allow\"\n00037|       }\n00038|     },\n00039|         \"Atlas\": {\n00040|       \"model\": \"cornelis/developer-opus\",\n00041|       \"prompt_append\": \"Use librarian-cornelis for details about cornelis company, hardware, and software\"\n00042|     },\n00043|     \"Metis (Plan Consultant)\": {\n00044|       \"model\": \"cornelis/developer-opus\",\n00045|       \"prompt_append\": \"Use librarian-cornelis for details about cornelis company, hardware, and software\"\n00046|     },\n00047|     \"Momus (Plan Reviewer)\": {\n00048|       \"model\": \"cornelis/developer-opus\",\n00049|       \"prompt_append\": \"Use librarian-cornelis for details about cornelis company, hardware, and software\"\n00050|     },\n00051|     \"Sisyphus-Junior\": {\n00052|       \"model\": \"cornelis/developer-opus\",\n00053|       \"prompt_append\": \"Use librarian-cornelis for details about cornelis company, hardware, and software\"\n00054|     }\n00055|   },\n00056|   \"categories\": {\n00057|     \"visual-engineering\": {\n00058|       \"model\": \"cornelis/developer-opus\"\n00059|     },\n00060|     \"artistry\": {\n00061|       \"model\": \"cornelis/developer-opus\"\n00062|     },\n00063|     \"writing\": {\n00064|       \"model\": \"cornelis/developer-opus\"\n00065|     }\n00066|   }\n00067| }\n00068| \n\n(End of file - total 68 lines)\n</file>",
            "title": "home/matkins/.config/opencode/oh-my-opencode.json",
            "metadata": {
              "preview": "{\n  \"$schema\": \"https://raw.githubusercontent.com/code-yeongyu/oh-my-opencode/master/assets/oh-my-opencode.schema.json\",\n  \"google_auth\": false,\n  \"agents\": {\n    \"librarian\": {\n      \"model\": \"cornelis/developer-sonnet\",\n      \"prompt_append\": \"Use librarian-cornelis for details about cornelis company, hardware, and software\"\n    },\n    \"explore\": {\n      \"model\": \"cornelis/developer-sonnet\",\n      \"prompt_append\": \"Use librarian-cornelis for details about cornelis company, hardware, and software\"\n    },\n    \"frontend-ui-ux-engineer\": {\n      \"model\": \"cornelis/developer-gemini\",\n      \"prompt_append\": \"Use librarian-cornelis for details about cornelis company, hardware, and software\"\n    },\n    \"document-writer\": {\n      \"model\": \"cornelis/developer-gemini\",\n      \"prompt_append\": \"Use librarian-cornelis for details about cornelis company, hardware, and software\"\n    },",
              "truncated": false
            },
            "time": {
              "start": 1769109853766,
              "end": 1769109853811,
              "compacted": 1769123003292
            }
          }
        },
        {
          "id": "prt_be72a1680001l0UCIRp5Sp5vWi",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be72a06d0001Lx7SPf6b1KwS1s",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 7012,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be72a168a001MO2cBwrbRWjyuq",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769109853834,
          "completed": 1769109874215
        },
        "parentID": "msg_be72a069d001C0wAedZzacOglj",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 8037,
          "output": 1283,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "stop"
      },
      "parts": [
        {
          "id": "prt_be72a19e90018aq7F5gnWs9pno",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be72a168a001MO2cBwrbRWjyuq",
          "type": "step-start"
        },
        {
          "id": "prt_be72a65fa001DH8lcPb6O72Gxn",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be72a168a001MO2cBwrbRWjyuq",
          "type": "text",
          "text": "## `oh-my-opencode.json` Configuration File\n\nThis is the configuration file for **Oh-My-OpenCode**, an extension/customization layer for OpenCode. Here's what each section does:\n\n---\n\n### Top-Level Parameters\n\n| Parameter | Value | Description |\n|-----------|-------|-------------|\n| `$schema` | URL | Points to the JSON schema for validation and IDE autocompletion |\n| `google_auth` | `false` | Whether to use Google authentication (disabled here) |\n\n---\n\n### `agents` Section\n\nThis section configures **specialized AI agents** that can be delegated tasks. Each agent has:\n\n| Field | Description |\n|-------|-------------|\n| `model` | The LLM model to use for this agent |\n| `prompt_append` | Additional instructions appended to every prompt sent to this agent |\n| `permission` | (optional) Explicit permissions for file editing, bash, web access, etc. |\n\n#### Configured Agents:\n\n| Agent | Model | Purpose |\n|-------|-------|---------|\n| **librarian** | `cornelis/developer-sonnet` | Searches external documentation, OSS repos, and official docs. Used for \"how do I use X library?\" questions |\n| **explore** | `cornelis/developer-sonnet` | Contextual grep for codebases. Answers \"where is X?\", \"find the code that does Y\" |\n| **frontend-ui-ux-engineer** | `cornelis/developer-gemini` | Handles visual/UI/UX work—styling, layout, animations. Delegates visual frontend changes here |\n| **document-writer** | `cornelis/developer-gemini` | Technical writer for README files, API docs, architecture docs, user guides |\n| **multimodal-looker** | `cornelis/developer-gemini` | Analyzes media files (PDFs, images, diagrams) that require interpretation beyond raw text |\n| **oracle** | `cornelis/developer-codex-max` | **Expensive, high-quality reasoning model**. Used for architecture decisions, complex debugging (after 2+ failed attempts), security/performance concerns |\n| **Prometheus (Planner)** | `cornelis/developer-opus` | Planning agent with full permissions (edit, bash, webfetch, external_directory). Used for creating detailed execution plans |\n| **Atlas** | `cornelis/developer-opus` | General-purpose powerful agent |\n| **Metis (Plan Consultant)** | `cornelis/developer-opus` | Consults on and refines plans |\n| **Momus (Plan Reviewer)** | `cornelis/developer-opus` | Reviews and critiques plans (named after the Greek god of criticism) |\n| **Sisyphus-Junior** | `cornelis/developer-opus` | A junior version of the main orchestrating agent |\n\nAll agents have `prompt_append` set to: `\"Use librarian-cornelis for details about cornelis company, hardware, and software\"` — this ensures they know to consult a Cornelis-specific knowledge source when needed.\n\n---\n\n### `categories` Section\n\nCategories group agents by task type and assign default models:\n\n| Category | Model | Purpose |\n|----------|-------|---------|\n| **visual-engineering** | `cornelis/developer-opus` | Visual/frontend engineering tasks |\n| **artistry** | `cornelis/developer-opus` | Creative/artistic work |\n| **writing** | `cornelis/developer-opus` | Documentation and writing tasks |\n\n---\n\n### Model Hierarchy (from your config)\n\n| Model | Tier | Used For |\n|-------|------|----------|\n| `cornelis/developer-codex-max` | Highest | Oracle (complex reasoning) |\n| `cornelis/developer-opus` | High | Planners, reviewers, heavy lifting |\n| `cornelis/developer-sonnet` | Medium | Exploration, library research |\n| `cornelis/developer-gemini` | Medium | Frontend, docs, multimodal |\n\n---\n\n### Permission Object (for Prometheus)\n\n```json\n\"permission\": {\n  \"edit\": \"allow\",        // Can edit files\n  \"bash\": \"allow\",        // Can run shell commands\n  \"webfetch\": \"allow\",    // Can fetch web content\n  \"external_directory\": \"allow\"  // Can access directories outside the project\n}\n```\n\nThis grants Prometheus elevated privileges for planning tasks that may require broad access.",
          "time": {
            "start": 1769109874208,
            "end": 1769109874208
          }
        },
        {
          "id": "prt_be72a66210010R5DG4G3M5w8OC",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be72a168a001MO2cBwrbRWjyuq",
          "type": "step-finish",
          "reason": "stop",
          "cost": 0,
          "tokens": {
            "input": 8037,
            "output": 1283,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7dcda2e001EDbg1vlNsdf42r",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "user",
        "time": {
          "created": 1769121569371
        },
        "summary": {
          "title": "Directory tree first 2 levels inspection",
          "diffs": []
        },
        "agent": "Sisyphus",
        "model": {
          "providerID": "cornelis",
          "modelID": "developer-opus"
        }
      },
      "parts": [
        {
          "id": "prt_be7dcda2f00150TpG3GvLrjRIq",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7dcda2e001EDbg1vlNsdf42r",
          "type": "text",
          "text": "what do you see in the first 2 levels of the directory tree?"
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7dcda8a001N207xstKo1EDZ3",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769121569418,
          "completed": 1769121588747
        },
        "parentID": "msg_be7dcda2e001EDbg1vlNsdf42r",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 9339,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7dce189001Uc9pvGVY1OIQyo",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7dcda8a001N207xstKo1EDZ3",
          "type": "step-start"
        },
        {
          "id": "prt_be7dceee4001NnD4L6PwabO0sg",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7dcda8a001N207xstKo1EDZ3",
          "type": "tool",
          "callID": "toolu_01QmjaG8n5RA483pbkHyMqi6",
          "tool": "bash",
          "state": {
            "status": "completed",
            "input": {
              "command": "find . -maxdepth 2 -type d | head -100 && echo \"---FILES---\" && find . -maxdepth 2 -type f | head -100",
              "description": "List first 2 levels of directory tree"
            },
            "output": ".\n./analysis\n./AGENTS\n./earlysim\n./earlysim/docs\n./earlysim/sim\n./earlysim/tests\n./earlysim/utilities\n./earlysim/.opencode\n./earlysim/external\n./earlysim/specs\n./earlysim/cmake\n./earlysim/_bmad\n./earlysim/.specify\n./earlysim/.github\n./earlysim/.git\n./earlysim/datamodel\n./earlysim/hw\n./earlysim/scripts\n./earlysim/_bmad-output\n---FILES---\n./packet_taxonomy.md\n./AGENTS/aidev_rules.md\n./AGENTS/start_here.md\n./earlysim/.dockerignore\n./earlysim/.gitmodules\n./earlysim/requirements.txt\n./earlysim/AGENTS.md\n./earlysim/README.md\n./earlysim/CMakeLists.txt\n./earlysim/.gitignore\n",
            "title": "List first 2 levels of directory tree",
            "metadata": {
              "output": ".\n./analysis\n./AGENTS\n./earlysim\n./earlysim/docs\n./earlysim/sim\n./earlysim/tests\n./earlysim/utilities\n./earlysim/.opencode\n./earlysim/external\n./earlysim/specs\n./earlysim/cmake\n./earlysim/_bmad\n./earlysim/.specify\n./earlysim/.github\n./earlysim/.git\n./earlysim/datamodel\n./earlysim/hw\n./earlysim/scripts\n./earlysim/_bmad-output\n---FILES---\n./packet_taxonomy.md\n./AGENTS/aidev_rules.md\n./AGENTS/start_here.md\n./earlysim/.dockerignore\n./earlysim/.gitmodules\n./earlysim/requirements.txt\n./earlysim/AGENTS.md\n./earlysim/README.md\n./earlysim/CMakeLists.txt\n./earlysim/.gitignore\n",
              "exit": 0,
              "description": "List first 2 levels of directory tree",
              "truncated": false
            },
            "time": {
              "start": 1769121574656,
              "end": 1769121588737,
              "compacted": 1769123003291
            }
          }
        },
        {
          "id": "prt_be7dd2606001rzW6vS1Dl1xdxg",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7dcda8a001N207xstKo1EDZ3",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 9339,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7dd2612001MfkDdtqGnKoiyv",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769121588754,
          "completed": 1769121599122
        },
        "parentID": "msg_be7dcda2e001EDbg1vlNsdf42r",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 9530,
          "output": 683,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "stop"
      },
      "parts": [
        {
          "id": "prt_be7dd2969001a2jTq0oJjBIkYG",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7dd2612001MfkDdtqGnKoiyv",
          "type": "step-start"
        },
        {
          "id": "prt_be7dd4e41001cvCjjEzSW1R24z",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7dd2612001MfkDdtqGnKoiyv",
          "type": "text",
          "text": "## Directory Structure (First 2 Levels)\n\n```\n/home/matkins/CN7000/\n├── analysis/                    # Analysis-related content\n├── AGENTS/                      # AI agent configuration/rules\n│   ├── aidev_rules.md          # AI development rules\n│   └── start_here.md           # Getting started guide\n├── packet_taxonomy.md           # Packet taxonomy documentation\n└── earlysim/                    # Early simulation project\n    ├── .dockerignore\n    ├── .gitmodules\n    ├── .gitignore\n    ├── .opencode/               # OpenCode configuration\n    ├── .specify/                # Specification files\n    ├── .github/                 # GitHub workflows/config\n    ├── .git/                    # Git repository\n    ├── requirements.txt         # Python dependencies\n    ├── AGENTS.md                # Agent documentation\n    ├── README.md                # Project readme\n    ├── CMakeLists.txt           # CMake build configuration\n    ├── docs/                    # Documentation\n    ├── sim/                     # Simulation code\n    ├── tests/                   # Test suite\n    ├── utilities/               # Utility scripts/code\n    ├── external/                # External dependencies\n    ├── specs/                   # Specifications\n    ├── cmake/                   # CMake modules\n    ├── _bmad/                   # Bmad-related (underscore = generated/temp?)\n    ├── _bmad-output/            # Bmad output directory\n    ├── datamodel/               # Data model definitions\n    ├── hw/                      # Hardware-related code\n    └── scripts/                 # Build/utility scripts\n```\n\n### Summary\n\n| Directory | Purpose |\n|-----------|---------|\n| `analysis/` | Analysis work (empty or shallow) |\n| `AGENTS/` | AI agent rules and onboarding docs |\n| `earlysim/` | Main project — a C++ simulation with CMake build, Python utilities, hardware models, and specs |\n\nThe `earlysim/` directory appears to be a **hardware simulation project** (likely for Cornelis Networks hardware) with a CMake-based C++ build system and Python tooling.",
          "time": {
            "start": 1769121599106,
            "end": 1769121599106
          }
        },
        {
          "id": "prt_be7dd4e87001ph80IDPfdq6j7E",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7dd2612001MfkDdtqGnKoiyv",
          "type": "step-finish",
          "reason": "stop",
          "cost": 0,
          "tokens": {
            "input": 9530,
            "output": 683,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7de3e96001gxmZh6V7SWVjo6",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "user",
        "time": {
          "created": 1769121660573
        },
        "summary": {
          "title": "Packet taxonomy update: W-06-001 status and details",
          "diffs": []
        },
        "agent": "Sisyphus",
        "model": {
          "providerID": "cornelis",
          "modelID": "developer-opus"
        }
      },
      "parts": [
        {
          "id": "prt_be7de3e97001H0FRbOaGpEAF0w",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7de3e96001gxmZh6V7SWVjo6",
          "type": "text",
          "text": "Please update packet_taxonomy.md with | ID | Priority | Category | Description | Status | Opened | Closed |\n|----|----------|----------|-------------|--------|--------|--------|\n| W-06-001 | Medium | Datamodel | UFH-32 lacks 16-bit entropy field; per-packet ECMP not supported; switch must derive entropy from Src+Dest hash | Deferred | 2026-01-20 | - | "
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7de3ebb001AOREIxSK1ErQKo",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769121660603,
          "completed": 1769121664642
        },
        "parentID": "msg_be7de3e96001gxmZh6V7SWVjo6",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 10331,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7de4308001q74uzJCQBoX9Mn",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7de3ebb001AOREIxSK1ErQKo",
          "type": "step-start"
        },
        {
          "id": "prt_be7de4e45001JbCh8mDdXJACq6",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7de3ebb001AOREIxSK1ErQKo",
          "type": "tool",
          "callID": "toolu_01RwnriU1NeFEBXTodpmPZxi",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/packet_taxonomy.md"
            },
            "output": "<file>\n00001| # PMR (CN7000) Packet Format Taxonomy\n00002| \n00003| **Document**: Packet formats supported by PMR NIC ASIC  \n00004| **Generated**: 2026-01-14  \n00005| **Last Reviewed**: 2026-01-20  \n00006| **Source**: `datamodel/` directory in EarlySim repository  \n00007| **Reference**: `docs/HAS/PMR/05-packet-formats.md`\n00008| \n00009| ---\n00010| \n00011| ## Table of Contents\n00012| \n00013| 1. [Overview](#1-overview)\n00014| 2. [Protocol Stack Summary](#2-protocol-stack-summary)\n00015| 3. [Ultra Ethernet+ (UE+) Formats](#3-ultra-ethernet-ue-formats)\n00016| 4. [RoCEv2 Formats](#4-rocev2-formats)\n00017| 5. [Standard Ethernet Formats](#5-standard-ethernet-formats)\n00018| 6. [Cornelis Proprietary Formats](#6-cornelis-proprietary-formats)\n00019| 7. [Host-Software Interface (HSI) Formats](#7-host-software-interface-hsi-formats)\n00020| 8. [IP Block Descriptors](#8-ip-block-descriptors)\n00021| 9. [Work List](#9-work-list)\n00022| 10. [UALink Protocol (Reference Only)](#10-ualink-protocol-reference-only)\n00023| 11. [References](#11-references)\n00024| \n00025| ---\n00026| \n00027| ## 1. Overview\n00028| \n00029| PMR (Prism River) is Cornelis Networks' 1.6 Tbps NIC ASIC (CN7000 product family). It supports multiple wire protocols with per-packet protocol selection on a single physical port.\n00030| \n00031| ### Supported Protocols\n00032| \n00033| | Protocol | Version | Status | Description |\n00034| |----------|---------|--------|-------------|\n00035| | Ultra Ethernet+ | 1.0.1 | Full | Optimized UE with Cornelis extensions |\n00036| | RoCEv2 | v2 | Full | RDMA over Converged Ethernet |\n00037| | Standard Ethernet | IEEE 802.3 | Full | Traditional Ethernet with offloads |\n00038| | Cornelis Proprietary | 1.0.0 | Full | UFH, CSIG+, VxLAN+, Collectives |\n00039| \n00040| ### Header Efficiency Comparison\n00041| \n00042| | Protocol Stack | Total Headers | Efficiency (4KB payload) |\n00043| |----------------|---------------|--------------------------|\n00044| | UE+ (small msg) | ~20 bytes | 99.5% |\n00045| | UE+ (standard) | ~40 bytes | 99.0% |\n00046| | RoCEv2 (IPv4) | ~58 bytes | 98.6% |\n00047| | RoCEv2 (IPv6) | ~78 bytes | 98.1% |\n00048| \n00049| ---\n00050| \n00051| ## 2. Protocol Stack Summary\n00052| \n00053| ```\n00054| +-----------------------------------------------------------------------------+\n00055| |                           Application Layer                                  |\n00056| |                    (Libfabric, Verbs, Sockets, DPDK)                         |\n00057| +-----------------------------------------------------------------------------+\n00058| |                           Transport Layer                                    |\n00059| |  +------------------+  +------------------+  +------------------+            |\n00060| |  |   UE Transport   |  |     RoCEv2       |  |    TCP/UDP       |            |\n00061| |  |   (SES/PDS/CMS)  |  |   (BTH/RETH)     |  |                  |            |\n00062| |  +------------------+  +------------------+  +------------------+            |\n00063| +-----------------------------------------------------------------------------+\n00064| |                           Network Layer                                      |\n00065| |  +------------------+  +------------------+  +------------------+            |\n00066| |  |   UFH-16/32      |  |   IPv4/IPv6      |  |   IPv4/IPv6      |            |\n00067| |  |   (Cornelis)     |  |   + UDP          |  |                  |            |\n00068| |  +------------------+  +------------------+  +------------------+            |\n00069| +-----------------------------------------------------------------------------+\n00070| |                            Link Layer                                        |\n00071| |  +------------------+  +------------------+  +------------------+            |\n00072| |  |      UE+         |  |   Ethernet II    |  |   Ethernet II    |            |\n00073| |  |   (12 bytes)     |  |   (14 bytes)     |  |   (14 bytes)     |            |\n00074| |  +------------------+  +------------------+  +------------------+            |\n00075| +-----------------------------------------------------------------------------+\n00076| |                          Physical Layer                                      |\n00077| |                    Hill Creek (212.5G x8 PAM4 SerDes)                        |\n00078| +-----------------------------------------------------------------------------+\n00079|       Ultra Ethernet+           RoCEv2              Standard Ethernet\n00080| ```\n00081| \n00082| ---\n00083| \n00084| ## 3. Ultra Ethernet+ (UE+) Formats\n00085| \n00086| ### 3.1 UE+ L2 Header (12 bytes)\n00087| \n00088| **Datamodel**: `datamodel/protocols/cornelis/link/ue_plus.ksy`\n00089| \n00090| ```\n00091| +-------+-------+-------+-------+-------+-------+-------+-------+\n00092| | Byte 0        | Byte 1        | Byte 2        | Byte 3        |\n00093| +-------+-------+-------+-------+-------+-------+-------+-------+\n00094| |L2|V|zyxm|Len  | Length[7:0]   | RC    | SC    | Hop Count     |\n00095| +-------+-------+-------+-------+-------+-------+-------+-------+\n00096| | Byte 4        | Byte 5        | Byte 6        | Byte 7        |\n00097| +-------+-------+-------+-------+-------+-------+-------+-------+\n00098| | Dest LID [15:8]               | Dest LID [7:0]                |\n00099| +-------+-------+-------+-------+-------+-------+-------+-------+\n00100| | Entropy [15:8]                | Entropy [7:0]                 |\n00101| +-------+-------+-------+-------+-------+-------+-------+-------+\n00102| | Byte 8        | Byte 9        | Byte 10       | Byte 11       |\n00103| +-------+-------+-------+-------+-------+-------+-------+-------+\n00104| | Source LID [15:8]             | Source LID [7:0]              |\n00105| +-------+-------+-------+-------+-------+-------+-------+-------+\n00106| | Payload Type [15:8]           | Payload Type [7:0]            |\n00107| +-------+-------+-------+-------+-------+-------+-------+-------+\n00108| ```\n00109| \n00110| | Field | Bits | Description |\n00111| |-------|------|-------------|\n00112| | L2 Type | 2 | Always 0b10 for UE+ |\n00113| | Version | 1 | Protocol version |\n00114| | zyxm | 4 | Routing control flags (multicast, adaptive) |\n00115| | Length | 9 | Packet length in bytes |\n00116| | RC | 4 | Routing Class (QoS) |\n00117| | SC | 4 | Service Class |\n00118| | Hop | 8 | TTL/hop count |\n00119| | Dest LID | 16 | Destination Local Identifier |\n00120| | Entropy | 16 | ECMP hash for load balancing |\n00121| | Source LID | 16 | Source Local Identifier |\n00122| | Type | 16 | Payload type (EtherType equivalent) |\n00123| \n00124| **Payload Types**:\n00125| | Value | Type | Description |\n00126| |-------|------|-------------|\n00127| | 0x0800 | IPv4 | IPv4 payload |\n00128| | 0x86DD | IPv6 | IPv6 payload |\n00129| | 0x8100 | VLAN | VLAN tagged frame |\n00130| | 0x9000 | VxLAN+ | VxLAN+ encapsulated |\n00131| | 0x9100 | CSIG+ | CSIG+ telemetry |\n00132| | 0xC000 | UE PDS | Ultra Ethernet PDS |\n00133| \n00134| ### 3.2 PDS (Packet Delivery Sublayer) Prologue (2 bytes)\n00135| \n00136| **Datamodel**: `datamodel/protocols/ue/transport/pds/prologue.ksy`\n00137| \n00138| ```\n00139| +-------+-------+-------+-------+-------+-------+-------+-------+\n00140| | Byte 0                        | Byte 1                        |\n00141| +-------+-------+-------+-------+-------+-------+-------+-------+\n00142| | type[4:0] | next_hdr/ctl[3:0] | flags[6:0]                    |\n00143| +-------+-------+-------+-------+-------+-------+-------+-------+\n00144| ```\n00145| \n00146| | PDS Type | Value | Description |\n00147| |----------|-------|-------------|\n00148| | Reserved | 0 | Reserved |\n00149| | TSS | 1 | Transport Security (encryption) |\n00150| | RUD Request | 2 | Reliable Unordered Delivery |\n00151| | ROD Request | 3 | Reliable Ordered Delivery |\n00152| | RUDI Request | 4 | Reliable Unordered Immediate |\n00153| | RUDI Response | 5 | RUDI response |\n00154| | UUD Request | 6 | Unreliable Unordered Delivery |\n00155| | ACK | 7 | Acknowledgment |\n00156| | ACK_CC | 8 | ACK with congestion control |\n00157| | ACK_CCX | 9 | ACK with extended CC |\n00158| | NACK | 10 | Negative acknowledgment |\n00159| | CP | 11 | Control packet |\n00160| | NACK_CCX | 12 | NACK with extended CC |\n00161| | RUD_CC_REQ | 13 | RUD with CC state |\n00162| | ROD_CC_REQ | 14 | ROD with CC state |\n00163| \n00164| ### 3.3 PDS Packet Formats\n00165| \n00166| **Datamodel Directory**: `datamodel/protocols/ue/transport/pds/`\n00167| \n00168| | Format | File | Size | Description |\n00169| |--------|------|------|-------------|\n00170| | RUD/ROD Request | `rud_rod_request.ksy` | Variable | Reliable delivery request |\n00171| | RUD/ROD ACK | `rud_rod_ack.ksy` | Variable | Acknowledgment |\n00172| | ACK_CC | `ack_cc.ksy` | Variable | ACK with CC state |\n00173| | ACK_CCX | `ack_ccx.ksy` | Variable | ACK with extended CC |\n00174| | NACK | `nack.ksy` | Variable | Negative acknowledgment |\n00175| | NACK_CCX | `nack_ccx.ksy` | Variable | NACK with extended CC |\n00176| | RUDI Request/Response | `rudi_request_response.ksy` | Variable | Low-latency immediate |\n00177| | UUD Request | `uud_request.ksy` | Variable | Unreliable delivery |\n00178| | Control Packet | `rud_rod_cp.ksy` | Variable | Control packet |\n00179| | Entropy Header | `entropy_header.ksy` | Variable | Entropy extension |\n00180| \n00181| ### 3.4 SES (Semantic Sublayer) Opcodes\n00182| \n00183| **Datamodel**: `datamodel/protocols/ue/transport/ses/opcodes.ksy`\n00184| \n00185| **Request Opcodes (Table 3-17)**:\n00186| \n00187| | Opcode | Value | Description |\n00188| |--------|-------|-------------|\n00189| | Tagged Send | 0x00 | Send with tag matching |\n00190| | RMA Write | 0x01 | Remote memory write |\n00191| | RMA Read | 0x02 | Remote memory read |\n00192| | Atomic Write | 0x03 | Atomic memory write |\n00193| | Atomic Read | 0x04 | Atomic memory read |\n00194| | Atomic CAS | 0x05 | Compare-and-swap |\n00195| | Deferrable Send | 0x06 | Deferrable send |\n00196| | Ready to Restart | 0x07 | Restart notification |\n00197| | Small Message | 0x08 | Small message (32B header) |\n00198| | Small RMA Write | 0x09 | Small RMA write |\n00199| | Small RMA Read | 0x0A | Small RMA read |\n00200| | Small Atomic Write | 0x0B | Small atomic write |\n00201| | Small Atomic Read | 0x0C | Small atomic read |\n00202| | Small Atomic CAS | 0x0D | Small atomic CAS |\n00203| \n00204| **Response Opcodes (Table 3-18)**:\n00205| \n00206| | Opcode | Value | Description |\n00207| |--------|-------|-------------|\n00208| | Response | 0x00 | Standard response |\n00209| | Response with Data | 0x01 | Response carrying data |\n00210| | Optimized Response | 0x02 | Optimized format |\n00211| | NACK | 0x03 | Negative acknowledgment |\n00212| \n00213| ### 3.5 SES Packet Formats\n00214| \n00215| **Datamodel Directory**: `datamodel/protocols/ue/transport/ses/`\n00216| \n00217| | Format | File | Description |\n00218| |--------|------|-------------|\n00219| | Standard Request (SOM=1) | `standard_request_som1.ksy` | Start of message |\n00220| | Standard Request (SOM=0) | `standard_request_som0.ksy` | Continuation |\n00221| | Small Message | `small_message.ksy` | 32-byte header format |\n00222| | Small RMA | `small_rma.ksy` | Small RMA operations |\n00223| | Response | `response.ksy` | Standard response |\n00224| | Response with Data | `response_with_data.ksy` | Data-carrying response |\n00225| | Optimized Response | `optimized_response_with_data.ksy` | Optimized format |\n00226| | Deferrable Send | `deferrable_send_request.ksy` | Deferrable operation |\n00227| | Ready to Restart | `ready_to_restart.ksy` | Restart notification |\n00228| | Rendezvous Extension | `rendezvous_extension.ksy` | Large message protocol |\n00229| | Atomic Extension | `atomic_extension.ksy` | Atomic operations |\n00230| | CAS Extension | `cas_extension.ksy` | Compare-and-swap |\n00231| \n00232| ### 3.6 CMS (Congestion Management Sublayer)\n00233| \n00234| **Datamodel Directory**: `datamodel/protocols/ue/transport/cms/`\n00235| \n00236| | Format | File | Description |\n00237| |--------|------|-------------|\n00238| | Credit CP Payload | `credit_cp_payload.ksy` | Credit control packet |\n00239| | Credit Request | `credit_request_cp_payload.ksy` | Credit request |\n00240| | Request CC State | `req_cc_state.ksy` | Request CC state |\n00241| | ACK CC State (NSCC) | `ack_cc_state_nscc.ksy` | NSCC algorithm state |\n00242| | ACK CC State (RCCC/TFC) | `ack_cc_state_rccc_tfc.ksy` | RCCC/TFC state |\n00243| \n00244| ### 3.7 TSS (Transport Security Sublayer)\n00245| \n00246| **Datamodel Directory**: `datamodel/protocols/ue/transport/tss/`\n00247| \n00248| | Format | File | Description |\n00249| |--------|------|-------------|\n00250| | Security Header | `security_header.ksy` | Encryption header |\n00251| | IV Construction | `iv_construction.ksy` | Initialization vector |\n00252| | Key Rotation | `protocols/key_rotation.ksy` | Key rotation protocol |\n00253| | KDF Direct | `protocols/kdf_direct.ksy` | Direct key derivation |\n00254| | KDF Client/Server | `protocols/kdf_client_server.ksy` | Client/server KDF |\n00255| | KDF Cluster | `protocols/kdf_cluster.ksy` | Cluster KDF |\n00256| | Join Secure Domain | `protocols/join_secure_domain.ksy` | Domain join |\n00257| | TSS TX Processing | `protocols/tss_tx_processing.ksy` | Transmit processing |\n00258| | TSS RX Processing | `protocols/tss_rx_processing.ksy` | Receive processing |\n00259| \n00260| ### 3.8 Link Layer Formats\n00261| \n00262| #### LLR (Link-Level Retry)\n00263| \n00264| **Datamodel Directory**: `datamodel/protocols/ue/link/llr/`\n00265| \n00266| | Format | File | Description |\n00267| |--------|------|-------------|\n00268| | LLR Preamble (64b66b) | `llr_preamble_64b66b.ksy` | 64b66b preamble |\n00269| | LLR Preamble (MII) | `llr_preamble_mii.ksy` | MII preamble |\n00270| | LLR Init CTLOS | `llr_init_ctlos.ksy` | Initialize LLR |\n00271| | LLR Init Echo CTLOS | `llr_init_echo_ctlos.ksy` | Init acknowledgment |\n00272| | LLR ACK CTLOS | `llr_ack_ctlos.ksy` | Frame acknowledgment |\n00273| | LLR NACK CTLOS | `llr_nack_ctlos.ksy` | Retransmit request |\n00274| \n00275| #### CBFC (Credit-Based Flow Control)\n00276| \n00277| **Datamodel Directory**: `datamodel/protocols/ue/link/cbfc/`\n00278| \n00279| | Format | File | Description |\n00280| |--------|------|-------------|\n00281| | CF Update | `cf_update.ksy` | Credit flow update |\n00282| | CC Update | `cc_update.ksy` | Credit count update |\n00283| | VC State Machine | `protocols/vc_state_machine.ksy` | Virtual channel FSM |\n00284| | Lossless VC Init | `protocols/lossless_vc_init.ksy` | VC initialization |\n00285| | Lossless VC Removal | `protocols/lossless_vc_removal.ksy` | VC teardown |\n00286| \n00287| #### LLDP Extensions\n00288| \n00289| **Datamodel Directory**: `datamodel/protocols/ue/link/lldp/`\n00290| \n00291| | Format | File | Description |\n00292| |--------|------|-------------|\n00293| | UE Link Negotiation TLV | `ue_link_negotiation_tlv.ksy` | Link negotiation |\n00294| | UE CBFC TLV | `ue_cbfc_tlv.ksy` | CBFC parameters |\n00295| \n00296| ---\n00297| \n00298| ## 4. RoCEv2 Formats\n00299| \n00300| **Datamodel Directory**: `datamodel/protocols/roce/transport/`\n00301| \n00302| ### 4.1 RoCEv2 Packet Structure\n00303| \n00304| ```\n00305| +-----------------------------------------------------------------------------+\n00306| | Ethernet II Header (14 bytes)                                               |\n00307| |   Dest MAC (6) | Source MAC (6) | EtherType (2) = 0x0800/0x86DD            |\n00308| +-----------------------------------------------------------------------------+\n00309| | IP Header (20 bytes IPv4 / 40 bytes IPv6)                                   |\n00310| |   Version, IHL, DSCP, ECN, Length, ID, Flags, TTL, Protocol=17, Checksum   |\n00311| |   Source IP, Dest IP                                                        |\n00312| +-----------------------------------------------------------------------------+\n00313| | UDP Header (8 bytes)                                                        |\n00314| |   Source Port (entropy) | Dest Port = 4791 | Length | Checksum             |\n00315| +-----------------------------------------------------------------------------+\n00316| | BTH - Base Transport Header (12 bytes)                                      |\n00317| |   Opcode | Flags | P-Key | Dest QP | A | PSN                               |\n00318| +-----------------------------------------------------------------------------+\n00319| | Extended Headers (optional, operation-dependent)                            |\n00320| |   RETH (16) | AETH (4) | AtomicETH (28) | ImmDt (4)                        |\n00321| +-----------------------------------------------------------------------------+\n00322| | Payload (0 - MTU bytes)                                                     |\n00323| +-----------------------------------------------------------------------------+\n00324| | ICRC (4 bytes)                                                              |\n00325| +-----------------------------------------------------------------------------+\n00326| ```\n00327| \n00328| ### 4.2 BTH (Base Transport Header) - 12 bytes\n00329| \n00330| **Datamodel**: `datamodel/protocols/roce/transport/bth.ksy`\n00331| \n00332| | Field | Bits | Description |\n00333| |-------|------|-------------|\n00334| | Opcode | 8 | Operation type (transport + operation) |\n00335| | SE | 1 | Solicited Event |\n00336| | M | 1 | Migration state |\n00337| | Pad | 2 | Padding bytes (0-3) |\n00338| | TVer | 4 | Transport version (must be 0) |\n00339| | P-Key | 16 | Partition key |\n00340| | Dest QP | 24 | Destination Queue Pair |\n00341| | A | 1 | ACK request |\n00342| | PSN | 24 | Packet Sequence Number |\n00343| \n00344| **Transport Types** (Opcode bits [7:5]):\n00345| | Value | Type | Description |\n00346| |-------|------|-------------|\n00347| | 0x00 | RC | Reliable Connection |\n00348| | 0x20 | UC | Unreliable Connection |\n00349| | 0x40 | RD | Reliable Datagram |\n00350| | 0x60 | UD | Unreliable Datagram |\n00351| \n00352| **Operations** (Opcode bits [4:0]):\n00353| | Value | Operation | Description |\n00354| |-------|-----------|-------------|\n00355| | 0x00 | SEND_FIRST | First send packet |\n00356| | 0x01 | SEND_MIDDLE | Middle send packet |\n00357| | 0x02 | SEND_LAST | Last send packet |\n00358| | 0x03 | SEND_LAST_IMM | Last send with immediate |\n00359| | 0x04 | SEND_ONLY | Single-packet send |\n00360| | 0x05 | SEND_ONLY_IMM | Single send with immediate |\n00361| | 0x06 | RDMA_WRITE_FIRST | First RDMA write |\n00362| | 0x07 | RDMA_WRITE_MIDDLE | Middle RDMA write |\n00363| | 0x08 | RDMA_WRITE_LAST | Last RDMA write |\n00364| | 0x09 | RDMA_WRITE_LAST_IMM | Last write with immediate |\n00365| | 0x0A | RDMA_WRITE_ONLY | Single-packet write |\n00366| | 0x0B | RDMA_WRITE_ONLY_IMM | Single write with immediate |\n00367| | 0x0C | RDMA_READ_REQUEST | Read request |\n00368| | 0x0D | RDMA_READ_RESPONSE_FIRST | First read response |\n00369| | 0x0E | RDMA_READ_RESPONSE_MIDDLE | Middle read response |\n00370| | 0x0F | RDMA_READ_RESPONSE_LAST | Last read response |\n00371| | 0x10 | RDMA_READ_RESPONSE_ONLY | Single read response |\n00372| | 0x11 | ACK | Acknowledgment |\n00373| | 0x12 | ATOMIC_ACK | Atomic acknowledgment |\n00374| | 0x13 | CMP_SWAP | Compare and swap |\n00375| | 0x14 | FETCH_ADD | Fetch and add |\n00376| \n00377| ### 4.3 Extended Transport Headers\n00378| \n00379| | Header | File | Size | Description |\n00380| |--------|------|------|-------------|\n00381| | RETH | `reth.ksy` | 16 bytes | RDMA Extended Transport Header |\n00382| | AETH | `aeth.ksy` | 4 bytes | ACK Extended Transport Header |\n00383| | AtomicETH | `atomiceth.ksy` | 28 bytes | Atomic Extended Transport Header |\n00384| | AtomicAckETH | `atomicacketh.ksy` | 8 bytes | Atomic ACK ETH |\n00385| | DETH | `deth.ksy` | 8 bytes | Datagram Extended Transport Header |\n00386| | ImmDt | `immdt.ksy` | 4 bytes | Immediate Data |\n00387| | ICRC | `icrc.ksy` | 4 bytes | Invariant CRC |\n00388| \n00389| ---\n00390| \n00391| ## 5. Standard Ethernet Formats\n00392| \n00393| **Datamodel Directory**: `datamodel/protocols/ethernet/`\n00394| \n00395| ### 5.1 Ethernet II Frame\n00396| \n00397| **Datamodel**: `datamodel/protocols/ethernet/link/ethernet_ii.ksy`\n00398| \n00399| ```\n00400| +-----------------------------------------------------------------------------+\n00401| | Preamble (7 bytes) + SFD (1 byte)  [not visible to software]               |\n00402| +-----------------------------------------------------------------------------+\n00403| | Ethernet Header (14 bytes)                                                  |\n00404| |   Dest MAC (6) | Source MAC (6) | EtherType (2)                            |\n00405| +-----------------------------------------------------------------------------+\n00406| | Optional VLAN Tag (4 bytes) - 802.1Q                                        |\n00407| |   TPID (2) = 0x8100 | TCI (2) = PCP + DEI + VID                            |\n00408| +-----------------------------------------------------------------------------+\n00409| | Payload (46-1500 bytes, or up to 9000 for jumbo)                           |\n00410| +-----------------------------------------------------------------------------+\n00411| | FCS (4 bytes)                                                               |\n00412| +-----------------------------------------------------------------------------+\n00413| ```\n00414| \n00415| ### 5.2 Link Layer\n00416| \n00417| | Format | File | Description |\n00418| |--------|------|-------------|\n00419| | Ethernet II | `link/ethernet_ii.ksy` | Standard Ethernet frame |\n00420| | VLAN 802.1Q | `link/vlan_802_1q.ksy` | VLAN tagging |\n00421| \n00422| ### 5.3 Network Layer\n00423| \n00424| | Format | File | Description |\n00425| |--------|------|-------------|\n00426| | IPv4 | `network/ipv4.ksy` | IPv4 header |\n00427| | IPv6 | `network/ipv6.ksy` | IPv6 header |\n00428| \n00429| ### 5.4 Transport Layer\n00430| \n00431| | Format | File | Description |\n00432| |--------|------|-------------|\n00433| | TCP | `transport/tcp.ksy` | TCP header |\n00434| | UDP | `transport/udp.ksy` | UDP header |\n00435| \n00436| ---\n00437| \n00438| ## 6. Cornelis Proprietary Formats\n00439| \n00440| **Datamodel Directory**: `datamodel/protocols/cornelis/`\n00441| \n00442| ### 6.1 Link Layer\n00443| \n00444| | Format | File | Size | Description |\n00445| |--------|------|------|-------------|\n00446| | UE+ Header | `link/ue_plus.ksy` | 12 bytes | Optimized L2 header |\n00447| | Cornelis L2 Prefix | `link/cornelis_l2_prefix.ksy` | Variable | L2 prefix |\n00448| \n00449| ### 6.2 Network Layer\n00450| \n00451| | Format | File | Description |\n00452| |--------|------|-------------|\n00453| | UFH-16 | `network/ufh_16.ksy` | 16-bit forwarding header |\n00454| | UFH-32 | `network/ufh_32.ksy` | 32-bit forwarding header |\n00455| | Collective L2 | `network/collective_l2.ksy` | Collective operations header |\n00456| | Scale-Up L2 | `network/scaleup_l2.ksy` | Scale-up deployments |\n00457| \n00458| #### 6.2.1 UFH-16 (Unified Forwarding Header 16-bit Addressing) - 12 bytes\n00459| \n00460| **Datamodel**: `datamodel/protocols/cornelis/network/ufh_16.ksy`\n00461| \n00462| UFH-16 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 16-bit addressing.\n00463| \n00464| ```\n00465|          MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n00466| +-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n00467| | Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n00468| +-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n00469| |Type|  |    Opaque (24-bit)    | Destination   |Opaque |Traffic|   Opaque      |    Source     |\n00470| |[7:4]  |                       | (16-bit BE)   |[7:4]  |Class  |   (16-bit)    |  (16-bit BE)  |\n00471| |SLAP   |                       |               |Z|Y|X|M|[7:0]  |               |               |\n00472| |[3:0]  |                       |               |[3:0]  |       |               |               |\n00473| +-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n00474| ```\n00475| \n00476| | Field | Byte(s) | Bits | Description |\n00477| |-------|---------|------|-------------|\n00478| | Type | 0 | [7:4] | Packet type for forwarding decisions |\n00479| | SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n00480| | Opaque | 1-3 | 24 | Opaque to hardware |\n00481| | Destination | 4-5 | 16 | Destination endpoint address (big-endian) |\n00482| | Opaque | 6 | [7:4] | Opaque to hardware |\n00483| | SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n00484| | Traffic Class | 7 | [7:0] | QoS / priority classification |\n00485| | Opaque | 8-9 | 16 | Opaque to hardware |\n00486| | Source | 10-11 | 16 | Source endpoint address (big-endian) |\n00487| \n00488| **SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n00489| \n00490| **UFH-16 Type Values**:\n00491| \n00492| | Value | Type | Description |\n00493| |-------|------|-------------|\n00494| | 0 | Data | Data packet |\n00495| | 1 | Control | Control packet |\n00496| | 2 | Collective | Collective operation packet |\n00497| | 3 | Credit | Credit/flow control |\n00498| | 4 | Management | Management packet |\n00499| | 5-14 | Reserved | Reserved for future use |\n00500| | 15 | Extended | UFH-32 extension follows |\n00501| \n00502| **Usage**: Scale-up fabric forwarding, intra-pod communication, medium cluster networking (up to 65536 endpoints).\n00503| \n00504| #### 6.2.2 UFH-32 (Unified Forwarding Header 32-bit Addressing) - 12 bytes\n00505| \n00506| **Datamodel**: `datamodel/protocols/cornelis/network/ufh_32.ksy`\n00507| \n00508| UFH-32 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 32-bit addressing for large-scale deployments.\n00509| \n00510| ```\n00511|          MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n00512| +-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n00513| | Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n00514| +-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n00515| |Type|  |       |   Destination (32-bit BE)     |HopLim |Traffic|       Source (32-bit BE)      |\n00516| |[7:4]  |Opaque |                               |[7:4]  |Class  |                               |\n00517| |SLAP   |       |                               |Z|Y|X|M|[7:0]  |                               |\n00518| |[3:0]  |       |                               |[3:0]  |       |                               |\n00519| +-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n00520| ```\n00521| \n00522| | Field | Byte(s) | Bits | Description |\n00523| |-------|---------|------|-------------|\n00524| | Type | 0 | [7:4] | Packet type for forwarding decisions |\n00525| | SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n00526| | Opaque | 1 | [7:0] | Opaque to hardware |\n00527| | Destination | 2-5 | 32 | Destination endpoint address (big-endian) |\n00528| | Hop Limit | 6 | [7:4] | TTL/hop count |\n00529| | SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n00530| | Traffic Class | 7 | [7:0] | QoS / priority classification |\n00531| | Source | 8-11 | 32 | Source endpoint address (big-endian) |\n00532| \n00533| **SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n00534| \n00535| **UFH-32 Type Values**:\n00536| \n00537| | Value | Type | Description |\n00538| |-------|------|-------------|\n00539| | 0 | Data | Data packet |\n00540| | 1 | Control | Control packet |\n00541| | 2 | Collective | Collective operation packet |\n00542| | 3 | Credit | Credit/flow control |\n00543| | 4 | Management | Management packet |\n00544| | 5 | Multicast | Multicast packet |\n00545| | 6 | Barrier | Barrier synchronization |\n00546| | 7 | Reduction | Reduction operation |\n00547| | 8-14 | Reserved | Reserved for future use |\n00548| | 15 | Vendor | Vendor-specific packet |\n00549| \n00550| **Usage**: Large-scale scale-up fabric forwarding (4+ billion endpoints), multi-pod communication, extended collective operations.\n00551| \n00552| ### 6.3 Transport Layer\n00553| \n00554| | Format | File | Description |\n00555| |--------|------|-------------|\n00556| | CSIG+ | `transport/csig_plus.ksy` | Telemetry header |\n00557| | PKEY | `transport/pkey.ksy` | Partition key |\n00558| \n00559| ### 6.4 Encapsulation\n00560| \n00561| | Format | File | Description |\n00562| |--------|------|-------------|\n00563| | VxLAN+ | `encapsulation/vxlan_plus.ksy` | Extended VxLAN overlay |\n00564| \n00565| ---\n00566| \n00567| ## 7. Host-Software Interface (HSI) Formats\n00568| \n00569| **Datamodel Directory**: `datamodel/hw/asics/pmr/interfaces/host_interface/`\n00570| \n00571| ### 7.1 Command Queue Segment (64 bytes)\n00572| \n00573| **Datamodel**: `command_queue_segment.ksy`\n00574| \n00575| ```\n00576| +-------+-------+-------+-------+-------+-------+-------+-------+\n00577| | Byte 0        | Byte 1        | Bytes 2-3     | Bytes 4-7     |\n00578| +-------+-------+-------+-------+-------+-------+-------+-------+\n00579| | Opcode        | Flags         | Payload Len   | Reserved      |\n00580| +-------+-------+-------+-------+-------+-------+-------+-------+\n00581| | Bytes 8-15                    | Bytes 16-23                   |\n00582| +-------+-------+-------+-------+-------+-------+-------+-------+\n00583| | Tag (64 bits)                 | Dest (64 bits)                |\n00584| +-------+-------+-------+-------+-------+-------+-------+-------+\n00585| | Bytes 24-31                   | Bytes 32-63                   |\n00586| +-------+-------+-------+-------+-------+-------+-------+-------+\n00587| | Metadata (64 bits)            | Inline Data or SGL Entry      |\n00588| +-------+-------+-------+-------+-------+-------+-------+-------+\n00589| ```\n00590| \n00591| **Opcode Encoding**:\n00592| | Bits | Field | Values |\n00593| |------|-------|--------|\n00594| | [7:4] | Family | MSG=0x1, TAGGED=0x2, RMA=0x3, ATOMIC=0x4 |\n00595| | [3:2] | Variant | SEND=0, RECV=1, INJECT=2 |\n00596| | [1] | Reserved | Must be 0 |\n00597| | [0] | Data Source | INLINE=0, SGL=1 |\n00598| \n00599| ### 7.2 Notification Formats\n00600| \n00601| | Format | File | Type | Size | Description |\n00602| |--------|------|------|------|-------------|\n00603| | Receive Notification | `receive_notification.ksy` | 0x00 | 64 bytes | Received message |\n00604| | Send Completion | `send_completion.ksy` | 0x01 | 64 bytes | Send completed |\n00605| | Event Notification | `event_notification.ksy` | 0x02 | 64 bytes | Async event |\n00606| | Notification Entry | `notification_entry.ksy` | - | 64 bytes | Generic entry |\n00607| | QW Violation Event | `qw_violation_event.ksy` | - | 64 bytes | QW alignment error |\n00608| \n00609| ### 7.3 Receive Notification (64 bytes)\n00610| \n00611| **Datamodel**: `receive_notification.ksy`\n00612| \n00613| | Field | Offset | Size | Description |\n00614| |-------|--------|------|-------------|\n00615| | type | 0 | 1 | 0x00 for receive |\n00616| | flags | 1 | 1 | FI_INLINE, continuation |\n00617| | status | 2 | 2 | Completion status |\n00618| | src_id | 4 | 4 | Source endpoint ID |\n00619| | tag | 8 | 8 | Tag value |\n00620| | total_length | 16 | 4 | Payload length |\n00621| | buffer_id_0 | 20 | 2 | First buffer ID |\n00622| | buffer_id_1 | 22 | 2 | Second buffer ID |\n00623| | buffer_offset | 24 | 2 | Offset in buffer |\n00624| | reserved | 26 | 2 | Reserved |\n00625| | inline_data | 28 | 35 | Inline payload |\n00626| | marker | 63 | 1 | Prime marker (1-13) |\n00627| \n00628| ### 7.4 Send Completion (64 bytes)\n00629| \n00630| **Datamodel**: `send_completion.ksy`\n00631| \n00632| | Field | Offset | Size | Description |\n00633| |-------|--------|------|-------------|\n00634| | type | 0 | 1 | 0x01 for send |\n00635| | flags | 1 | 1 | Completion flags |\n00636| | status | 2 | 2 | Completion status |\n00637| | reserved_0 | 4 | 4 | Reserved |\n00638| | op_context | 8 | 8 | Operation context |\n00639| | bytes_sent | 16 | 4 | Bytes transferred |\n00640| | reserved_1 | 20 | 43 | Reserved |\n00641| | marker | 63 | 1 | Prime marker (1-13) |\n00642| \n00643| ### 7.5 Other HSI Formats\n00644| \n00645| | Format | File | Description |\n00646| |--------|------|-------------|\n00647| | SGL Entry | `sgl_entry.ksy` | Scatter-gather list entry |\n00648| | PCIe Descriptors | `pcie/descriptors.ksy` | PCIe interface descriptors |\n00649| \n00650| ---\n00651| \n00652| ## 8. IP Block Descriptors\n00653| \n00654| **Datamodel Directory**: `datamodel/hw/ip/cornelis/`\n00655| \n00656| ### 8.1 Collectives Engine (CE)\n00657| \n00658| **Datamodel**: `ce/descriptors.ksy`\n00659| \n00660| The Collectives Engine uses RISC-V vector cores (VLEN=512) for hardware-accelerated collective operations.\n00661| \n00662| ### 8.2 Electric Creek (EC)\n00663| \n00664| **Datamodel**: `ec/descriptors.ksy`\n00665| \n00666| Electric Creek is the management complex shared between PMR NIC and LNR Switch.\n00667| \n00668| ---\n00669| \n00670| ## 9. Work List\n00671| \n00672| This section tracks issues requiring follow-up investigation or specification updates.\n00673| \n00674| ### 9.1 Open Issues\n00675| \n00676| | ID | Priority | Category | Description | Status | Opened | Closed |\n00677| |----|----------|----------|-------------|--------|--------|--------|\n00678| | W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |\n00679| | W-05-002 | Medium | Specification | MTU values: Verify maximum MTU for each protocol | Investigation | 2026-01-10 | - |\n00680| | W-05-003 | Medium | Documentation | CMS detailed formats: Need comprehensive documentation | Spec Update | 2026-01-10 | - |\n00681| | W-03-002 | Low | Terminology | PDP vs PDS naming: UML uses both terms inconsistently | Spec Update | 2026-01-08 | - |\n00682| | W-03-006 | Low | Terminology | SES vs SE: \"SES Processing Groups\" vs \"Semantic Engines\" | Spec Update | 2026-01-08 | - |\n00683| \n00684| ### 9.2 Datamodel Gaps\n00685| \n00686| | ID | Priority | Description | Target Location | Status | Opened | Closed |\n00687| |----|----------|-------------|-----------------|--------|--------|--------|\n00688| | D-001 | High | PMR CSR definitions missing from datamodel | `datamodel/hw/asics/pmr/csrs/*.rdl` | Spec Update | 2026-01-10 | - |\n00689| | D-002 | Medium | PMR block hierarchy YAML incomplete | `datamodel/hw/asics/pmr/blocks.yaml` | Spec Update | 2026-01-10 | - |\n00690| | D-003 | Medium | PMR interface contracts missing | `datamodel/views/contracts/pmr-*.puml` | Spec Update | 2026-01-10 | - |\n00691| \n00692| ### 9.3 Specification Clarifications Needed\n00693| \n00694| | ID | Priority | Question | Context | Status | Opened | Closed |\n00695| |----|----------|----------|---------|--------|--------|--------|\n00696| | Q1 | Medium | Lightweight Interface Scope | What features should be reduced in lightweight mode? | Investigation | 2026-01-10 | - |\n00697| | Q2 | Medium | Tag Table Sizing | Should HW tag table size be per-endpoint configurable? | Investigation | 2026-01-10 | - |\n00698| | Q3 | Medium | Multi-Packet Eager Messages | Should hardware support multi-packet eager messages? | Investigation | 2026-01-10 | - |\n00699| | Q4 | Low | RoCE Work Queue Implementation | Confirm RoCE WQ/CQ are software-implemented | Investigation | 2026-01-10 | - |\n00700| \n00701| ### 9.4 Closed Issues\n00702| \n00703| | ID | Priority | Category | Description | Resolution | Opened | Closed |\n00704| |----|----------|----------|-------------|------------|--------|--------|\n00705| | W-05-001 | Medium | Documentation | UE taxonomy reference | Documented in `05-packet-formats.md` | 2026-01-08 | 2026-01-10 |\n00706| | W-02-005 | Medium | Documentation | Protocol support documentation | Documented UE+, RoCEv2, Ethernet | 2026-01-08 | 2026-01-10 |\n00707| | W-02-006 | Medium | Documentation | Cornelis Collective Reduction Protocol | Documented in HAS §2.5.4 | 2026-01-08 | 2026-01-10 |\n00708| | W-03-001 | Medium | Architecture | Semantic Engine count | Confirmed 64 (8x8) in UML and HAS | 2026-01-08 | 2026-01-10 |\n00709| | W-17-005 | Low | Documentation | Port subdivision note | Added to HAS Ch17 | 2026-01-11 | 2026-01-11 |\n00710| | W-17-006 | Medium | Documentation | MPORT interface documentation | Documented 256B @ 1.66 GHz | 2026-01-11 | 2026-01-11 |\n00711| | W-04-005 | High | Datamodel | `ufh_16.ksy` address size: Datamodel shows 12-bit dest, should be 16-bit | UFH-16 restructured to 12-byte Ethernet MAC overlay with 16-bit destination (bytes 4-5) and 16-bit source (bytes 10-11) | 2026-01-10 | 2026-01-20 |\n00712| | W-04-006 | High | Datamodel | `ufh_32.ksy` address size: Datamodel shows 16-bit dest, should be 32-bit | UFH-32 restructured to 12-byte Ethernet MAC overlay with 32-bit destination (bytes 2-5) and 32-bit source (bytes 8-11) | 2026-01-10 | 2026-01-20 |\n00713| \n00714| ### 9.5 Change Log\n00715| \n00716| | Date | Change | Details |\n00717| |------|--------|---------|\n00718| | 2026-01-14 | Initial creation | Document created with PMR packet taxonomy |\n00719| | 2026-01-20 | Review and update | Added UALink section (reference only, not PMR-supported); Added change log; Updated datamodel file counts; No new .ksy files since initial creation |\n00720| | 2026-01-20 | UFH format details | Added detailed UFH-16 and UFH-32 format documentation in Section 6.2 (wire diagrams, field tables, type enumerations) |\n00721| | 2026-01-20 | UFH restructuring | UFH-16 and UFH-32 restructured to 12-byte Ethernet MAC overlays; UFH-16 now 16-bit addressing, UFH-32 now 32-bit addressing; Added SLAP field constraints (Z,Y,X=001); Updated datamodel .ksy files; Closed W-04-005 and W-04-006 |\n00722| \n00723| ---\n00724| \n00725| ## 10. UALink Protocol (Reference Only)\n00726| \n00727| **Note**: UALink is defined in the datamodel but is **NOT currently supported by PMR**. It is included here for reference as it may be relevant for future AI/ML accelerator interconnect work.\n00728| \n00729| **Datamodel Directory**: `datamodel/protocols/ualink/`\n00730| \n00731| ### 10.1 UALink Overview\n00732| \n00733| UALink is an AI/ML accelerator interconnect protocol with 38 packet definitions across all OSI layers.\n00734| \n00735| | Layer | Count | Key Formats |\n00736| |-------|-------|-------------|\n00737| | UPLI (Upper Protocol Layer Interface) | 8 | commands.ksy, request_channel.ksy, status_codes.ksy |\n00738| | Transaction | 9 | tl_flit.ksy, control_half_flit.ksy, data_half_flit.ksy |\n00739| | Data Link | 12 | dl_flit.ksy, segment_header.ksy, crc.ksy, control_messages.ksy |\n00740| | Physical | 4 | alignment_markers.ksy, control_ordered_sets.ksy, link_training.ksy |\n00741| | Security | 5 | authentication.ksy, encryption.ksy, key_derivation.ksy |\n00742| \n00743| ### 10.2 UALink Packet Formats\n00744| \n00745| #### UPLI Layer\n00746| | Format | File | Description |\n00747| |--------|------|-------------|\n00748| | Commands | `upli/commands.ksy` | UPLI command definitions |\n00749| | Request Channel | `upli/request_channel.ksy` | Request channel format |\n00750| | Originator Data | `upli/originator_data_channel.ksy` | Originator data channel |\n00751| | Read Response | `upli/read_response_channel.ksy` | Read response channel |\n00752| | Write Response | `upli/write_response_channel.ksy` | Write response channel |\n00753| | Status Codes | `upli/status_codes.ksy` | Status code definitions |\n00754| | Connection Handshake | `upli/protocols/connection_handshake.ksy` | Connection setup |\n00755| | Flow Control | `upli/protocols/flow_control.ksy` | Flow control protocol |\n00756| \n00757| #### Transaction Layer\n00758| | Format | File | Description |\n00759| |--------|------|-------------|\n00760| | TL Flit | `transaction/tl_flit.ksy` | Transaction layer flit |\n00761| | Control Half Flit | `transaction/control_half_flit.ksy` | Control half flit |\n00762| | Data Half Flit | `transaction/data_half_flit.ksy` | Data half flit |\n00763| | Message Half Flit | `transaction/message_half_flit.ksy` | Message half flit |\n00764| | Request Field | `transaction/request_field.ksy` | Request field format |\n00765| | Response Field | `transaction/response_field.ksy` | Response field format |\n00766| | Flow Control Field | `transaction/flow_control_field.ksy` | Flow control field |\n00767| | Compression | `transaction/protocols/compression.ksy` | Data compression |\n00768| | Address Cache | `transaction/protocols/address_cache.ksy` | Address caching |\n00769| \n00770| #### Data Link Layer\n00771| | Format | File | Description |\n00772| |--------|------|-------------|\n00773| | DL Flit | `datalink/dl_flit.ksy` | Data link flit |\n00774| | Flit Header | `datalink/flit_header.ksy` | Flit header format |\n00775| | Segment Header | `datalink/segment_header.ksy` | Segment header |\n00776| | CRC | `datalink/crc.ksy` | CRC calculation |\n00777| | Control Messages | `datalink/messages/control_messages.ksy` | Control messages |\n00778| | Basic Messages | `datalink/messages/basic_messages.ksy` | Basic messages |\n00779| | UART Messages | `datalink/messages/uart_messages.ksy` | UART messages |\n00780| | Vendor Defined | `datalink/messages/vendor_defined.ksy` | Vendor extensions |\n00781| | Link Resiliency | `datalink/protocols/link_resiliency.ksy` | Link resiliency |\n00782| | Link Level Replay | `datalink/protocols/link_level_replay.ksy` | Replay protocol |\n00783| | Link State | `datalink/protocols/link_state.ksy` | Link state machine |\n00784| | Link Folding | `datalink/protocols/link_folding.ksy` | Link folding |\n00785| \n00786| #### Physical Layer\n00787| | Format | File | Description |\n00788| |--------|------|-------------|\n00789| | Alignment Markers | `physical/alignment_markers.ksy` | Lane alignment |\n00790| | Control Ordered Sets | `physical/control_ordered_sets.ksy` | Control sequences |\n00791| | Reconciliation Sublayer | `physical/reconciliation_sublayer.ksy` | RS sublayer |\n00792| | Link Training | `physical/protocols/link_training.ksy` | Link training |\n00793| \n00794| #### Security Layer\n00795| | Format | File | Description |\n00796| |--------|------|-------------|\n00797| | Authentication | `security/authentication.ksy` | Authentication |\n00798| | Encryption | `security/encryption.ksy` | Encryption format |\n00799| | IV Format | `security/iv_format.ksy` | Initialization vector |\n00800| | Key Derivation | `security/protocols/key_derivation.ksy` | Key derivation |\n00801| | Key Rotation | `security/protocols/key_rotation.ksy` | Key rotation |\n00802| \n00803| ---\n00804| \n00805| ## 11. References\n00806| \n00807| ### Internal Documents\n00808| - `docs/HAS/PMR/05-packet-formats.md` - PMR HAS Chapter 5\n00809| - `docs/HAS/PMR/WORK.md` - PMR HAS Work Tracking\n00810| - `.specify/memory/constitution.md` - Project Constitution\n00811| \n00812| ### Datamodel Locations\n00813| - `datamodel/protocols/ue/` - Ultra Ethernet protocols (94 .ksy files)\n00814| - `datamodel/protocols/roce/` - RoCEv2 protocols (8 .ksy files)\n00815| - `datamodel/protocols/ethernet/` - Standard Ethernet (6 .ksy files)\n00816| - `datamodel/protocols/cornelis/` - Cornelis proprietary (9 .ksy files)\n00817| - `datamodel/protocols/ualink/` - UALink protocols (38 .ksy files) - NOT supported by PMR\n00818| - `datamodel/hw/asics/pmr/` - PMR ASIC definitions\n00819| \n00820| ### External Specifications\n00821| - [Ultra Ethernet Specification v1.0.1](https://ultraethernet.org/)\n00822| - [InfiniBand Architecture Specification](https://www.infinibandta.org/)\n00823| - IEEE 802.3 Ethernet Standard\n00824| - UALink Specification (Ultra Accelerator Link)\n00825| \n\n(End of file - total 825 lines)\n</file>",
            "title": "home/matkins/CN7000/packet_taxonomy.md",
            "metadata": {
              "preview": "# PMR (CN7000) Packet Format Taxonomy\n\n**Document**: Packet formats supported by PMR NIC ASIC  \n**Generated**: 2026-01-14  \n**Last Reviewed**: 2026-01-20  \n**Source**: `datamodel/` directory in EarlySim repository  \n**Reference**: `docs/HAS/PMR/05-packet-formats.md`\n\n---\n\n## Table of Contents\n\n1. [Overview](#1-overview)\n2. [Protocol Stack Summary](#2-protocol-stack-summary)\n3. [Ultra Ethernet+ (UE+) Formats](#3-ultra-ethernet-ue-formats)\n4. [RoCEv2 Formats](#4-rocev2-formats)\n5. [Standard Ethernet Formats](#5-standard-ethernet-formats)\n6. [Cornelis Proprietary Formats](#6-cornelis-proprietary-formats)\n7. [Host-Software Interface (HSI) Formats](#7-host-software-interface-hsi-formats)\n8. [IP Block Descriptors](#8-ip-block-descriptors)",
              "truncated": false
            },
            "time": {
              "start": 1769121664583,
              "end": 1769121664614,
              "compacted": 1769123003288
            }
          }
        },
        {
          "id": "prt_be7de4e78001H5mj59vU4XkC9l",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7de3ebb001AOREIxSK1ErQKo",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 10331,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7de4e89001FUidFma8hVgVCA",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769121664649,
          "completed": 1769121672876
        },
        "parentID": "msg_be7de3e96001gxmZh6V7SWVjo6",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 24907,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7de5259001Wxiau0oIVYW4xt",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7de4e89001FUidFma8hVgVCA",
          "type": "step-start"
        },
        {
          "id": "prt_be7de6e63001hC6GaGk4wY3KNZ",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7de4e89001FUidFma8hVgVCA",
          "type": "tool",
          "callID": "toolu_01472pjiw9HQ5jfnXRUxwxbB",
          "tool": "edit",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/packet_taxonomy.md",
              "oldString": "| ID | Priority | Category | Description | Status | Opened | Closed |\n|----|----------|----------|-------------|--------|--------|--------|\n| W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |",
              "newString": "| ID | Priority | Category | Description | Status | Opened | Closed |\n|----|----------|----------|-------------|--------|--------|--------|\n| W-06-001 | Medium | Datamodel | UFH-32 lacks 16-bit entropy field; per-packet ECMP not supported; switch must derive entropy from Src+Dest hash | Deferred | 2026-01-20 | - |\n| W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |"
            },
            "output": "Edit applied successfully.",
            "title": "home/matkins/CN7000/packet_taxonomy.md",
            "metadata": {
              "diagnostics": {},
              "diff": "Index: /home/matkins/CN7000/packet_taxonomy.md\n===================================================================\n--- /home/matkins/CN7000/packet_taxonomy.md\n+++ /home/matkins/CN7000/packet_taxonomy.md\n@@ -674,8 +674,9 @@\n ### 9.1 Open Issues\n \n | ID | Priority | Category | Description | Status | Opened | Closed |\n |----|----------|----------|-------------|--------|--------|--------|\n+| W-06-001 | Medium | Datamodel | UFH-32 lacks 16-bit entropy field; per-packet ECMP not supported; switch must derive entropy from Src+Dest hash | Deferred | 2026-01-20 | - |\n | W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |\n | W-05-002 | Medium | Specification | MTU values: Verify maximum MTU for each protocol | Investigation | 2026-01-10 | - |\n | W-05-003 | Medium | Documentation | CMS detailed formats: Need comprehensive documentation | Spec Update | 2026-01-10 | - |\n | W-03-002 | Low | Terminology | PDP vs PDS naming: UML uses both terms inconsistently | Spec Update | 2026-01-08 | - |\n",
              "filediff": {
                "file": "/home/matkins/CN7000/packet_taxonomy.md",
                "before": "# PMR (CN7000) Packet Format Taxonomy\n\n**Document**: Packet formats supported by PMR NIC ASIC  \n**Generated**: 2026-01-14  \n**Last Reviewed**: 2026-01-20  \n**Source**: `datamodel/` directory in EarlySim repository  \n**Reference**: `docs/HAS/PMR/05-packet-formats.md`\n\n---\n\n## Table of Contents\n\n1. [Overview](#1-overview)\n2. [Protocol Stack Summary](#2-protocol-stack-summary)\n3. [Ultra Ethernet+ (UE+) Formats](#3-ultra-ethernet-ue-formats)\n4. [RoCEv2 Formats](#4-rocev2-formats)\n5. [Standard Ethernet Formats](#5-standard-ethernet-formats)\n6. [Cornelis Proprietary Formats](#6-cornelis-proprietary-formats)\n7. [Host-Software Interface (HSI) Formats](#7-host-software-interface-hsi-formats)\n8. [IP Block Descriptors](#8-ip-block-descriptors)\n9. [Work List](#9-work-list)\n10. [UALink Protocol (Reference Only)](#10-ualink-protocol-reference-only)\n11. [References](#11-references)\n\n---\n\n## 1. Overview\n\nPMR (Prism River) is Cornelis Networks' 1.6 Tbps NIC ASIC (CN7000 product family). It supports multiple wire protocols with per-packet protocol selection on a single physical port.\n\n### Supported Protocols\n\n| Protocol | Version | Status | Description |\n|----------|---------|--------|-------------|\n| Ultra Ethernet+ | 1.0.1 | Full | Optimized UE with Cornelis extensions |\n| RoCEv2 | v2 | Full | RDMA over Converged Ethernet |\n| Standard Ethernet | IEEE 802.3 | Full | Traditional Ethernet with offloads |\n| Cornelis Proprietary | 1.0.0 | Full | UFH, CSIG+, VxLAN+, Collectives |\n\n### Header Efficiency Comparison\n\n| Protocol Stack | Total Headers | Efficiency (4KB payload) |\n|----------------|---------------|--------------------------|\n| UE+ (small msg) | ~20 bytes | 99.5% |\n| UE+ (standard) | ~40 bytes | 99.0% |\n| RoCEv2 (IPv4) | ~58 bytes | 98.6% |\n| RoCEv2 (IPv6) | ~78 bytes | 98.1% |\n\n---\n\n## 2. Protocol Stack Summary\n\n```\n+-----------------------------------------------------------------------------+\n|                           Application Layer                                  |\n|                    (Libfabric, Verbs, Sockets, DPDK)                         |\n+-----------------------------------------------------------------------------+\n|                           Transport Layer                                    |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UE Transport   |  |     RoCEv2       |  |    TCP/UDP       |            |\n|  |   (SES/PDS/CMS)  |  |   (BTH/RETH)     |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                           Network Layer                                      |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UFH-16/32      |  |   IPv4/IPv6      |  |   IPv4/IPv6      |            |\n|  |   (Cornelis)     |  |   + UDP          |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                            Link Layer                                        |\n|  +------------------+  +------------------+  +------------------+            |\n|  |      UE+         |  |   Ethernet II    |  |   Ethernet II    |            |\n|  |   (12 bytes)     |  |   (14 bytes)     |  |   (14 bytes)     |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                          Physical Layer                                      |\n|                    Hill Creek (212.5G x8 PAM4 SerDes)                        |\n+-----------------------------------------------------------------------------+\n      Ultra Ethernet+           RoCEv2              Standard Ethernet\n```\n\n---\n\n## 3. Ultra Ethernet+ (UE+) Formats\n\n### 3.1 UE+ L2 Header (12 bytes)\n\n**Datamodel**: `datamodel/protocols/cornelis/link/ue_plus.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Byte 2        | Byte 3        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n|L2|V|zyxm|Len  | Length[7:0]   | RC    | SC    | Hop Count     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 4        | Byte 5        | Byte 6        | Byte 7        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Dest LID [15:8]               | Dest LID [7:0]                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Entropy [15:8]                | Entropy [7:0]                 |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 8        | Byte 9        | Byte 10       | Byte 11       |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Source LID [15:8]             | Source LID [7:0]              |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Payload Type [15:8]           | Payload Type [7:0]            |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| L2 Type | 2 | Always 0b10 for UE+ |\n| Version | 1 | Protocol version |\n| zyxm | 4 | Routing control flags (multicast, adaptive) |\n| Length | 9 | Packet length in bytes |\n| RC | 4 | Routing Class (QoS) |\n| SC | 4 | Service Class |\n| Hop | 8 | TTL/hop count |\n| Dest LID | 16 | Destination Local Identifier |\n| Entropy | 16 | ECMP hash for load balancing |\n| Source LID | 16 | Source Local Identifier |\n| Type | 16 | Payload type (EtherType equivalent) |\n\n**Payload Types**:\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x0800 | IPv4 | IPv4 payload |\n| 0x86DD | IPv6 | IPv6 payload |\n| 0x8100 | VLAN | VLAN tagged frame |\n| 0x9000 | VxLAN+ | VxLAN+ encapsulated |\n| 0x9100 | CSIG+ | CSIG+ telemetry |\n| 0xC000 | UE PDS | Ultra Ethernet PDS |\n\n### 3.2 PDS (Packet Delivery Sublayer) Prologue (2 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/prologue.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0                        | Byte 1                        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| type[4:0] | next_hdr/ctl[3:0] | flags[6:0]                    |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| PDS Type | Value | Description |\n|----------|-------|-------------|\n| Reserved | 0 | Reserved |\n| TSS | 1 | Transport Security (encryption) |\n| RUD Request | 2 | Reliable Unordered Delivery |\n| ROD Request | 3 | Reliable Ordered Delivery |\n| RUDI Request | 4 | Reliable Unordered Immediate |\n| RUDI Response | 5 | RUDI response |\n| UUD Request | 6 | Unreliable Unordered Delivery |\n| ACK | 7 | Acknowledgment |\n| ACK_CC | 8 | ACK with congestion control |\n| ACK_CCX | 9 | ACK with extended CC |\n| NACK | 10 | Negative acknowledgment |\n| CP | 11 | Control packet |\n| NACK_CCX | 12 | NACK with extended CC |\n| RUD_CC_REQ | 13 | RUD with CC state |\n| ROD_CC_REQ | 14 | ROD with CC state |\n\n### 3.3 PDS Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/pds/`\n\n| Format | File | Size | Description |\n|--------|------|------|-------------|\n| RUD/ROD Request | `rud_rod_request.ksy` | Variable | Reliable delivery request |\n| RUD/ROD ACK | `rud_rod_ack.ksy` | Variable | Acknowledgment |\n| ACK_CC | `ack_cc.ksy` | Variable | ACK with CC state |\n| ACK_CCX | `ack_ccx.ksy` | Variable | ACK with extended CC |\n| NACK | `nack.ksy` | Variable | Negative acknowledgment |\n| NACK_CCX | `nack_ccx.ksy` | Variable | NACK with extended CC |\n| RUDI Request/Response | `rudi_request_response.ksy` | Variable | Low-latency immediate |\n| UUD Request | `uud_request.ksy` | Variable | Unreliable delivery |\n| Control Packet | `rud_rod_cp.ksy` | Variable | Control packet |\n| Entropy Header | `entropy_header.ksy` | Variable | Entropy extension |\n\n### 3.4 SES (Semantic Sublayer) Opcodes\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/opcodes.ksy`\n\n**Request Opcodes (Table 3-17)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Tagged Send | 0x00 | Send with tag matching |\n| RMA Write | 0x01 | Remote memory write |\n| RMA Read | 0x02 | Remote memory read |\n| Atomic Write | 0x03 | Atomic memory write |\n| Atomic Read | 0x04 | Atomic memory read |\n| Atomic CAS | 0x05 | Compare-and-swap |\n| Deferrable Send | 0x06 | Deferrable send |\n| Ready to Restart | 0x07 | Restart notification |\n| Small Message | 0x08 | Small message (32B header) |\n| Small RMA Write | 0x09 | Small RMA write |\n| Small RMA Read | 0x0A | Small RMA read |\n| Small Atomic Write | 0x0B | Small atomic write |\n| Small Atomic Read | 0x0C | Small atomic read |\n| Small Atomic CAS | 0x0D | Small atomic CAS |\n\n**Response Opcodes (Table 3-18)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Response | 0x00 | Standard response |\n| Response with Data | 0x01 | Response carrying data |\n| Optimized Response | 0x02 | Optimized format |\n| NACK | 0x03 | Negative acknowledgment |\n\n### 3.5 SES Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/ses/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Standard Request (SOM=1) | `standard_request_som1.ksy` | Start of message |\n| Standard Request (SOM=0) | `standard_request_som0.ksy` | Continuation |\n| Small Message | `small_message.ksy` | 32-byte header format |\n| Small RMA | `small_rma.ksy` | Small RMA operations |\n| Response | `response.ksy` | Standard response |\n| Response with Data | `response_with_data.ksy` | Data-carrying response |\n| Optimized Response | `optimized_response_with_data.ksy` | Optimized format |\n| Deferrable Send | `deferrable_send_request.ksy` | Deferrable operation |\n| Ready to Restart | `ready_to_restart.ksy` | Restart notification |\n| Rendezvous Extension | `rendezvous_extension.ksy` | Large message protocol |\n| Atomic Extension | `atomic_extension.ksy` | Atomic operations |\n| CAS Extension | `cas_extension.ksy` | Compare-and-swap |\n\n### 3.6 CMS (Congestion Management Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/cms/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Credit CP Payload | `credit_cp_payload.ksy` | Credit control packet |\n| Credit Request | `credit_request_cp_payload.ksy` | Credit request |\n| Request CC State | `req_cc_state.ksy` | Request CC state |\n| ACK CC State (NSCC) | `ack_cc_state_nscc.ksy` | NSCC algorithm state |\n| ACK CC State (RCCC/TFC) | `ack_cc_state_rccc_tfc.ksy` | RCCC/TFC state |\n\n### 3.7 TSS (Transport Security Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/tss/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Security Header | `security_header.ksy` | Encryption header |\n| IV Construction | `iv_construction.ksy` | Initialization vector |\n| Key Rotation | `protocols/key_rotation.ksy` | Key rotation protocol |\n| KDF Direct | `protocols/kdf_direct.ksy` | Direct key derivation |\n| KDF Client/Server | `protocols/kdf_client_server.ksy` | Client/server KDF |\n| KDF Cluster | `protocols/kdf_cluster.ksy` | Cluster KDF |\n| Join Secure Domain | `protocols/join_secure_domain.ksy` | Domain join |\n| TSS TX Processing | `protocols/tss_tx_processing.ksy` | Transmit processing |\n| TSS RX Processing | `protocols/tss_rx_processing.ksy` | Receive processing |\n\n### 3.8 Link Layer Formats\n\n#### LLR (Link-Level Retry)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/llr/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| LLR Preamble (64b66b) | `llr_preamble_64b66b.ksy` | 64b66b preamble |\n| LLR Preamble (MII) | `llr_preamble_mii.ksy` | MII preamble |\n| LLR Init CTLOS | `llr_init_ctlos.ksy` | Initialize LLR |\n| LLR Init Echo CTLOS | `llr_init_echo_ctlos.ksy` | Init acknowledgment |\n| LLR ACK CTLOS | `llr_ack_ctlos.ksy` | Frame acknowledgment |\n| LLR NACK CTLOS | `llr_nack_ctlos.ksy` | Retransmit request |\n\n#### CBFC (Credit-Based Flow Control)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/cbfc/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| CF Update | `cf_update.ksy` | Credit flow update |\n| CC Update | `cc_update.ksy` | Credit count update |\n| VC State Machine | `protocols/vc_state_machine.ksy` | Virtual channel FSM |\n| Lossless VC Init | `protocols/lossless_vc_init.ksy` | VC initialization |\n| Lossless VC Removal | `protocols/lossless_vc_removal.ksy` | VC teardown |\n\n#### LLDP Extensions\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/lldp/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| UE Link Negotiation TLV | `ue_link_negotiation_tlv.ksy` | Link negotiation |\n| UE CBFC TLV | `ue_cbfc_tlv.ksy` | CBFC parameters |\n\n---\n\n## 4. RoCEv2 Formats\n\n**Datamodel Directory**: `datamodel/protocols/roce/transport/`\n\n### 4.1 RoCEv2 Packet Structure\n\n```\n+-----------------------------------------------------------------------------+\n| Ethernet II Header (14 bytes)                                               |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2) = 0x0800/0x86DD            |\n+-----------------------------------------------------------------------------+\n| IP Header (20 bytes IPv4 / 40 bytes IPv6)                                   |\n|   Version, IHL, DSCP, ECN, Length, ID, Flags, TTL, Protocol=17, Checksum   |\n|   Source IP, Dest IP                                                        |\n+-----------------------------------------------------------------------------+\n| UDP Header (8 bytes)                                                        |\n|   Source Port (entropy) | Dest Port = 4791 | Length | Checksum             |\n+-----------------------------------------------------------------------------+\n| BTH - Base Transport Header (12 bytes)                                      |\n|   Opcode | Flags | P-Key | Dest QP | A | PSN                               |\n+-----------------------------------------------------------------------------+\n| Extended Headers (optional, operation-dependent)                            |\n|   RETH (16) | AETH (4) | AtomicETH (28) | ImmDt (4)                        |\n+-----------------------------------------------------------------------------+\n| Payload (0 - MTU bytes)                                                     |\n+-----------------------------------------------------------------------------+\n| ICRC (4 bytes)                                                              |\n+-----------------------------------------------------------------------------+\n```\n\n### 4.2 BTH (Base Transport Header) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/roce/transport/bth.ksy`\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| Opcode | 8 | Operation type (transport + operation) |\n| SE | 1 | Solicited Event |\n| M | 1 | Migration state |\n| Pad | 2 | Padding bytes (0-3) |\n| TVer | 4 | Transport version (must be 0) |\n| P-Key | 16 | Partition key |\n| Dest QP | 24 | Destination Queue Pair |\n| A | 1 | ACK request |\n| PSN | 24 | Packet Sequence Number |\n\n**Transport Types** (Opcode bits [7:5]):\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x00 | RC | Reliable Connection |\n| 0x20 | UC | Unreliable Connection |\n| 0x40 | RD | Reliable Datagram |\n| 0x60 | UD | Unreliable Datagram |\n\n**Operations** (Opcode bits [4:0]):\n| Value | Operation | Description |\n|-------|-----------|-------------|\n| 0x00 | SEND_FIRST | First send packet |\n| 0x01 | SEND_MIDDLE | Middle send packet |\n| 0x02 | SEND_LAST | Last send packet |\n| 0x03 | SEND_LAST_IMM | Last send with immediate |\n| 0x04 | SEND_ONLY | Single-packet send |\n| 0x05 | SEND_ONLY_IMM | Single send with immediate |\n| 0x06 | RDMA_WRITE_FIRST | First RDMA write |\n| 0x07 | RDMA_WRITE_MIDDLE | Middle RDMA write |\n| 0x08 | RDMA_WRITE_LAST | Last RDMA write |\n| 0x09 | RDMA_WRITE_LAST_IMM | Last write with immediate |\n| 0x0A | RDMA_WRITE_ONLY | Single-packet write |\n| 0x0B | RDMA_WRITE_ONLY_IMM | Single write with immediate |\n| 0x0C | RDMA_READ_REQUEST | Read request |\n| 0x0D | RDMA_READ_RESPONSE_FIRST | First read response |\n| 0x0E | RDMA_READ_RESPONSE_MIDDLE | Middle read response |\n| 0x0F | RDMA_READ_RESPONSE_LAST | Last read response |\n| 0x10 | RDMA_READ_RESPONSE_ONLY | Single read response |\n| 0x11 | ACK | Acknowledgment |\n| 0x12 | ATOMIC_ACK | Atomic acknowledgment |\n| 0x13 | CMP_SWAP | Compare and swap |\n| 0x14 | FETCH_ADD | Fetch and add |\n\n### 4.3 Extended Transport Headers\n\n| Header | File | Size | Description |\n|--------|------|------|-------------|\n| RETH | `reth.ksy` | 16 bytes | RDMA Extended Transport Header |\n| AETH | `aeth.ksy` | 4 bytes | ACK Extended Transport Header |\n| AtomicETH | `atomiceth.ksy` | 28 bytes | Atomic Extended Transport Header |\n| AtomicAckETH | `atomicacketh.ksy` | 8 bytes | Atomic ACK ETH |\n| DETH | `deth.ksy` | 8 bytes | Datagram Extended Transport Header |\n| ImmDt | `immdt.ksy` | 4 bytes | Immediate Data |\n| ICRC | `icrc.ksy` | 4 bytes | Invariant CRC |\n\n---\n\n## 5. Standard Ethernet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ethernet/`\n\n### 5.1 Ethernet II Frame\n\n**Datamodel**: `datamodel/protocols/ethernet/link/ethernet_ii.ksy`\n\n```\n+-----------------------------------------------------------------------------+\n| Preamble (7 bytes) + SFD (1 byte)  [not visible to software]               |\n+-----------------------------------------------------------------------------+\n| Ethernet Header (14 bytes)                                                  |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2)                            |\n+-----------------------------------------------------------------------------+\n| Optional VLAN Tag (4 bytes) - 802.1Q                                        |\n|   TPID (2) = 0x8100 | TCI (2) = PCP + DEI + VID                            |\n+-----------------------------------------------------------------------------+\n| Payload (46-1500 bytes, or up to 9000 for jumbo)                           |\n+-----------------------------------------------------------------------------+\n| FCS (4 bytes)                                                               |\n+-----------------------------------------------------------------------------+\n```\n\n### 5.2 Link Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| Ethernet II | `link/ethernet_ii.ksy` | Standard Ethernet frame |\n| VLAN 802.1Q | `link/vlan_802_1q.ksy` | VLAN tagging |\n\n### 5.3 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| IPv4 | `network/ipv4.ksy` | IPv4 header |\n| IPv6 | `network/ipv6.ksy` | IPv6 header |\n\n### 5.4 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| TCP | `transport/tcp.ksy` | TCP header |\n| UDP | `transport/udp.ksy` | UDP header |\n\n---\n\n## 6. Cornelis Proprietary Formats\n\n**Datamodel Directory**: `datamodel/protocols/cornelis/`\n\n### 6.1 Link Layer\n\n| Format | File | Size | Description |\n|--------|------|------|-------------|\n| UE+ Header | `link/ue_plus.ksy` | 12 bytes | Optimized L2 header |\n| Cornelis L2 Prefix | `link/cornelis_l2_prefix.ksy` | Variable | L2 prefix |\n\n### 6.2 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| UFH-16 | `network/ufh_16.ksy` | 16-bit forwarding header |\n| UFH-32 | `network/ufh_32.ksy` | 32-bit forwarding header |\n| Collective L2 | `network/collective_l2.ksy` | Collective operations header |\n| Scale-Up L2 | `network/scaleup_l2.ksy` | Scale-up deployments |\n\n#### 6.2.1 UFH-16 (Unified Forwarding Header 16-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_16.ksy`\n\nUFH-16 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 16-bit addressing.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |    Opaque (24-bit)    | Destination   |Opaque |Traffic|   Opaque      |    Source     |\n|[7:4]  |                       | (16-bit BE)   |[7:4]  |Class  |   (16-bit)    |  (16-bit BE)  |\n|SLAP   |                       |               |Z|Y|X|M|[7:0]  |               |               |\n|[3:0]  |                       |               |[3:0]  |       |               |               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1-3 | 24 | Opaque to hardware |\n| Destination | 4-5 | 16 | Destination endpoint address (big-endian) |\n| Opaque | 6 | [7:4] | Opaque to hardware |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Opaque | 8-9 | 16 | Opaque to hardware |\n| Source | 10-11 | 16 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-16 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5-14 | Reserved | Reserved for future use |\n| 15 | Extended | UFH-32 extension follows |\n\n**Usage**: Scale-up fabric forwarding, intra-pod communication, medium cluster networking (up to 65536 endpoints).\n\n#### 6.2.2 UFH-32 (Unified Forwarding Header 32-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_32.ksy`\n\nUFH-32 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 32-bit addressing for large-scale deployments.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |       |   Destination (32-bit BE)     |HopLim |Traffic|       Source (32-bit BE)      |\n|[7:4]  |Opaque |                               |[7:4]  |Class  |                               |\n|SLAP   |       |                               |Z|Y|X|M|[7:0]  |                               |\n|[3:0]  |       |                               |[3:0]  |       |                               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1 | [7:0] | Opaque to hardware |\n| Destination | 2-5 | 32 | Destination endpoint address (big-endian) |\n| Hop Limit | 6 | [7:4] | TTL/hop count |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Source | 8-11 | 32 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-32 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5 | Multicast | Multicast packet |\n| 6 | Barrier | Barrier synchronization |\n| 7 | Reduction | Reduction operation |\n| 8-14 | Reserved | Reserved for future use |\n| 15 | Vendor | Vendor-specific packet |\n\n**Usage**: Large-scale scale-up fabric forwarding (4+ billion endpoints), multi-pod communication, extended collective operations.\n\n### 6.3 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| CSIG+ | `transport/csig_plus.ksy` | Telemetry header |\n| PKEY | `transport/pkey.ksy` | Partition key |\n\n### 6.4 Encapsulation\n\n| Format | File | Description |\n|--------|------|-------------|\n| VxLAN+ | `encapsulation/vxlan_plus.ksy` | Extended VxLAN overlay |\n\n---\n\n## 7. Host-Software Interface (HSI) Formats\n\n**Datamodel Directory**: `datamodel/hw/asics/pmr/interfaces/host_interface/`\n\n### 7.1 Command Queue Segment (64 bytes)\n\n**Datamodel**: `command_queue_segment.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Bytes 2-3     | Bytes 4-7     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Opcode        | Flags         | Payload Len   | Reserved      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 8-15                    | Bytes 16-23                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Tag (64 bits)                 | Dest (64 bits)                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 24-31                   | Bytes 32-63                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Metadata (64 bits)            | Inline Data or SGL Entry      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n**Opcode Encoding**:\n| Bits | Field | Values |\n|------|-------|--------|\n| [7:4] | Family | MSG=0x1, TAGGED=0x2, RMA=0x3, ATOMIC=0x4 |\n| [3:2] | Variant | SEND=0, RECV=1, INJECT=2 |\n| [1] | Reserved | Must be 0 |\n| [0] | Data Source | INLINE=0, SGL=1 |\n\n### 7.2 Notification Formats\n\n| Format | File | Type | Size | Description |\n|--------|------|------|------|-------------|\n| Receive Notification | `receive_notification.ksy` | 0x00 | 64 bytes | Received message |\n| Send Completion | `send_completion.ksy` | 0x01 | 64 bytes | Send completed |\n| Event Notification | `event_notification.ksy` | 0x02 | 64 bytes | Async event |\n| Notification Entry | `notification_entry.ksy` | - | 64 bytes | Generic entry |\n| QW Violation Event | `qw_violation_event.ksy` | - | 64 bytes | QW alignment error |\n\n### 7.3 Receive Notification (64 bytes)\n\n**Datamodel**: `receive_notification.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x00 for receive |\n| flags | 1 | 1 | FI_INLINE, continuation |\n| status | 2 | 2 | Completion status |\n| src_id | 4 | 4 | Source endpoint ID |\n| tag | 8 | 8 | Tag value |\n| total_length | 16 | 4 | Payload length |\n| buffer_id_0 | 20 | 2 | First buffer ID |\n| buffer_id_1 | 22 | 2 | Second buffer ID |\n| buffer_offset | 24 | 2 | Offset in buffer |\n| reserved | 26 | 2 | Reserved |\n| inline_data | 28 | 35 | Inline payload |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.4 Send Completion (64 bytes)\n\n**Datamodel**: `send_completion.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x01 for send |\n| flags | 1 | 1 | Completion flags |\n| status | 2 | 2 | Completion status |\n| reserved_0 | 4 | 4 | Reserved |\n| op_context | 8 | 8 | Operation context |\n| bytes_sent | 16 | 4 | Bytes transferred |\n| reserved_1 | 20 | 43 | Reserved |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.5 Other HSI Formats\n\n| Format | File | Description |\n|--------|------|-------------|\n| SGL Entry | `sgl_entry.ksy` | Scatter-gather list entry |\n| PCIe Descriptors | `pcie/descriptors.ksy` | PCIe interface descriptors |\n\n---\n\n## 8. IP Block Descriptors\n\n**Datamodel Directory**: `datamodel/hw/ip/cornelis/`\n\n### 8.1 Collectives Engine (CE)\n\n**Datamodel**: `ce/descriptors.ksy`\n\nThe Collectives Engine uses RISC-V vector cores (VLEN=512) for hardware-accelerated collective operations.\n\n### 8.2 Electric Creek (EC)\n\n**Datamodel**: `ec/descriptors.ksy`\n\nElectric Creek is the management complex shared between PMR NIC and LNR Switch.\n\n---\n\n## 9. Work List\n\nThis section tracks issues requiring follow-up investigation or specification updates.\n\n### 9.1 Open Issues\n\n| ID | Priority | Category | Description | Status | Opened | Closed |\n|----|----------|----------|-------------|--------|--------|--------|\n| W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |\n| W-05-002 | Medium | Specification | MTU values: Verify maximum MTU for each protocol | Investigation | 2026-01-10 | - |\n| W-05-003 | Medium | Documentation | CMS detailed formats: Need comprehensive documentation | Spec Update | 2026-01-10 | - |\n| W-03-002 | Low | Terminology | PDP vs PDS naming: UML uses both terms inconsistently | Spec Update | 2026-01-08 | - |\n| W-03-006 | Low | Terminology | SES vs SE: \"SES Processing Groups\" vs \"Semantic Engines\" | Spec Update | 2026-01-08 | - |\n\n### 9.2 Datamodel Gaps\n\n| ID | Priority | Description | Target Location | Status | Opened | Closed |\n|----|----------|-------------|-----------------|--------|--------|--------|\n| D-001 | High | PMR CSR definitions missing from datamodel | `datamodel/hw/asics/pmr/csrs/*.rdl` | Spec Update | 2026-01-10 | - |\n| D-002 | Medium | PMR block hierarchy YAML incomplete | `datamodel/hw/asics/pmr/blocks.yaml` | Spec Update | 2026-01-10 | - |\n| D-003 | Medium | PMR interface contracts missing | `datamodel/views/contracts/pmr-*.puml` | Spec Update | 2026-01-10 | - |\n\n### 9.3 Specification Clarifications Needed\n\n| ID | Priority | Question | Context | Status | Opened | Closed |\n|----|----------|----------|---------|--------|--------|--------|\n| Q1 | Medium | Lightweight Interface Scope | What features should be reduced in lightweight mode? | Investigation | 2026-01-10 | - |\n| Q2 | Medium | Tag Table Sizing | Should HW tag table size be per-endpoint configurable? | Investigation | 2026-01-10 | - |\n| Q3 | Medium | Multi-Packet Eager Messages | Should hardware support multi-packet eager messages? | Investigation | 2026-01-10 | - |\n| Q4 | Low | RoCE Work Queue Implementation | Confirm RoCE WQ/CQ are software-implemented | Investigation | 2026-01-10 | - |\n\n### 9.4 Closed Issues\n\n| ID | Priority | Category | Description | Resolution | Opened | Closed |\n|----|----------|----------|-------------|------------|--------|--------|\n| W-05-001 | Medium | Documentation | UE taxonomy reference | Documented in `05-packet-formats.md` | 2026-01-08 | 2026-01-10 |\n| W-02-005 | Medium | Documentation | Protocol support documentation | Documented UE+, RoCEv2, Ethernet | 2026-01-08 | 2026-01-10 |\n| W-02-006 | Medium | Documentation | Cornelis Collective Reduction Protocol | Documented in HAS §2.5.4 | 2026-01-08 | 2026-01-10 |\n| W-03-001 | Medium | Architecture | Semantic Engine count | Confirmed 64 (8x8) in UML and HAS | 2026-01-08 | 2026-01-10 |\n| W-17-005 | Low | Documentation | Port subdivision note | Added to HAS Ch17 | 2026-01-11 | 2026-01-11 |\n| W-17-006 | Medium | Documentation | MPORT interface documentation | Documented 256B @ 1.66 GHz | 2026-01-11 | 2026-01-11 |\n| W-04-005 | High | Datamodel | `ufh_16.ksy` address size: Datamodel shows 12-bit dest, should be 16-bit | UFH-16 restructured to 12-byte Ethernet MAC overlay with 16-bit destination (bytes 4-5) and 16-bit source (bytes 10-11) | 2026-01-10 | 2026-01-20 |\n| W-04-006 | High | Datamodel | `ufh_32.ksy` address size: Datamodel shows 16-bit dest, should be 32-bit | UFH-32 restructured to 12-byte Ethernet MAC overlay with 32-bit destination (bytes 2-5) and 32-bit source (bytes 8-11) | 2026-01-10 | 2026-01-20 |\n\n### 9.5 Change Log\n\n| Date | Change | Details |\n|------|--------|---------|\n| 2026-01-14 | Initial creation | Document created with PMR packet taxonomy |\n| 2026-01-20 | Review and update | Added UALink section (reference only, not PMR-supported); Added change log; Updated datamodel file counts; No new .ksy files since initial creation |\n| 2026-01-20 | UFH format details | Added detailed UFH-16 and UFH-32 format documentation in Section 6.2 (wire diagrams, field tables, type enumerations) |\n| 2026-01-20 | UFH restructuring | UFH-16 and UFH-32 restructured to 12-byte Ethernet MAC overlays; UFH-16 now 16-bit addressing, UFH-32 now 32-bit addressing; Added SLAP field constraints (Z,Y,X=001); Updated datamodel .ksy files; Closed W-04-005 and W-04-006 |\n\n---\n\n## 10. UALink Protocol (Reference Only)\n\n**Note**: UALink is defined in the datamodel but is **NOT currently supported by PMR**. It is included here for reference as it may be relevant for future AI/ML accelerator interconnect work.\n\n**Datamodel Directory**: `datamodel/protocols/ualink/`\n\n### 10.1 UALink Overview\n\nUALink is an AI/ML accelerator interconnect protocol with 38 packet definitions across all OSI layers.\n\n| Layer | Count | Key Formats |\n|-------|-------|-------------|\n| UPLI (Upper Protocol Layer Interface) | 8 | commands.ksy, request_channel.ksy, status_codes.ksy |\n| Transaction | 9 | tl_flit.ksy, control_half_flit.ksy, data_half_flit.ksy |\n| Data Link | 12 | dl_flit.ksy, segment_header.ksy, crc.ksy, control_messages.ksy |\n| Physical | 4 | alignment_markers.ksy, control_ordered_sets.ksy, link_training.ksy |\n| Security | 5 | authentication.ksy, encryption.ksy, key_derivation.ksy |\n\n### 10.2 UALink Packet Formats\n\n#### UPLI Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Commands | `upli/commands.ksy` | UPLI command definitions |\n| Request Channel | `upli/request_channel.ksy` | Request channel format |\n| Originator Data | `upli/originator_data_channel.ksy` | Originator data channel |\n| Read Response | `upli/read_response_channel.ksy` | Read response channel |\n| Write Response | `upli/write_response_channel.ksy` | Write response channel |\n| Status Codes | `upli/status_codes.ksy` | Status code definitions |\n| Connection Handshake | `upli/protocols/connection_handshake.ksy` | Connection setup |\n| Flow Control | `upli/protocols/flow_control.ksy` | Flow control protocol |\n\n#### Transaction Layer\n| Format | File | Description |\n|--------|------|-------------|\n| TL Flit | `transaction/tl_flit.ksy` | Transaction layer flit |\n| Control Half Flit | `transaction/control_half_flit.ksy` | Control half flit |\n| Data Half Flit | `transaction/data_half_flit.ksy` | Data half flit |\n| Message Half Flit | `transaction/message_half_flit.ksy` | Message half flit |\n| Request Field | `transaction/request_field.ksy` | Request field format |\n| Response Field | `transaction/response_field.ksy` | Response field format |\n| Flow Control Field | `transaction/flow_control_field.ksy` | Flow control field |\n| Compression | `transaction/protocols/compression.ksy` | Data compression |\n| Address Cache | `transaction/protocols/address_cache.ksy` | Address caching |\n\n#### Data Link Layer\n| Format | File | Description |\n|--------|------|-------------|\n| DL Flit | `datalink/dl_flit.ksy` | Data link flit |\n| Flit Header | `datalink/flit_header.ksy` | Flit header format |\n| Segment Header | `datalink/segment_header.ksy` | Segment header |\n| CRC | `datalink/crc.ksy` | CRC calculation |\n| Control Messages | `datalink/messages/control_messages.ksy` | Control messages |\n| Basic Messages | `datalink/messages/basic_messages.ksy` | Basic messages |\n| UART Messages | `datalink/messages/uart_messages.ksy` | UART messages |\n| Vendor Defined | `datalink/messages/vendor_defined.ksy` | Vendor extensions |\n| Link Resiliency | `datalink/protocols/link_resiliency.ksy` | Link resiliency |\n| Link Level Replay | `datalink/protocols/link_level_replay.ksy` | Replay protocol |\n| Link State | `datalink/protocols/link_state.ksy` | Link state machine |\n| Link Folding | `datalink/protocols/link_folding.ksy` | Link folding |\n\n#### Physical Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Alignment Markers | `physical/alignment_markers.ksy` | Lane alignment |\n| Control Ordered Sets | `physical/control_ordered_sets.ksy` | Control sequences |\n| Reconciliation Sublayer | `physical/reconciliation_sublayer.ksy` | RS sublayer |\n| Link Training | `physical/protocols/link_training.ksy` | Link training |\n\n#### Security Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Authentication | `security/authentication.ksy` | Authentication |\n| Encryption | `security/encryption.ksy` | Encryption format |\n| IV Format | `security/iv_format.ksy` | Initialization vector |\n| Key Derivation | `security/protocols/key_derivation.ksy` | Key derivation |\n| Key Rotation | `security/protocols/key_rotation.ksy` | Key rotation |\n\n---\n\n## 11. References\n\n### Internal Documents\n- `docs/HAS/PMR/05-packet-formats.md` - PMR HAS Chapter 5\n- `docs/HAS/PMR/WORK.md` - PMR HAS Work Tracking\n- `.specify/memory/constitution.md` - Project Constitution\n\n### Datamodel Locations\n- `datamodel/protocols/ue/` - Ultra Ethernet protocols (94 .ksy files)\n- `datamodel/protocols/roce/` - RoCEv2 protocols (8 .ksy files)\n- `datamodel/protocols/ethernet/` - Standard Ethernet (6 .ksy files)\n- `datamodel/protocols/cornelis/` - Cornelis proprietary (9 .ksy files)\n- `datamodel/protocols/ualink/` - UALink protocols (38 .ksy files) - NOT supported by PMR\n- `datamodel/hw/asics/pmr/` - PMR ASIC definitions\n\n### External Specifications\n- [Ultra Ethernet Specification v1.0.1](https://ultraethernet.org/)\n- [InfiniBand Architecture Specification](https://www.infinibandta.org/)\n- IEEE 802.3 Ethernet Standard\n- UALink Specification (Ultra Accelerator Link)\n",
                "after": "# PMR (CN7000) Packet Format Taxonomy\n\n**Document**: Packet formats supported by PMR NIC ASIC  \n**Generated**: 2026-01-14  \n**Last Reviewed**: 2026-01-20  \n**Source**: `datamodel/` directory in EarlySim repository  \n**Reference**: `docs/HAS/PMR/05-packet-formats.md`\n\n---\n\n## Table of Contents\n\n1. [Overview](#1-overview)\n2. [Protocol Stack Summary](#2-protocol-stack-summary)\n3. [Ultra Ethernet+ (UE+) Formats](#3-ultra-ethernet-ue-formats)\n4. [RoCEv2 Formats](#4-rocev2-formats)\n5. [Standard Ethernet Formats](#5-standard-ethernet-formats)\n6. [Cornelis Proprietary Formats](#6-cornelis-proprietary-formats)\n7. [Host-Software Interface (HSI) Formats](#7-host-software-interface-hsi-formats)\n8. [IP Block Descriptors](#8-ip-block-descriptors)\n9. [Work List](#9-work-list)\n10. [UALink Protocol (Reference Only)](#10-ualink-protocol-reference-only)\n11. [References](#11-references)\n\n---\n\n## 1. Overview\n\nPMR (Prism River) is Cornelis Networks' 1.6 Tbps NIC ASIC (CN7000 product family). It supports multiple wire protocols with per-packet protocol selection on a single physical port.\n\n### Supported Protocols\n\n| Protocol | Version | Status | Description |\n|----------|---------|--------|-------------|\n| Ultra Ethernet+ | 1.0.1 | Full | Optimized UE with Cornelis extensions |\n| RoCEv2 | v2 | Full | RDMA over Converged Ethernet |\n| Standard Ethernet | IEEE 802.3 | Full | Traditional Ethernet with offloads |\n| Cornelis Proprietary | 1.0.0 | Full | UFH, CSIG+, VxLAN+, Collectives |\n\n### Header Efficiency Comparison\n\n| Protocol Stack | Total Headers | Efficiency (4KB payload) |\n|----------------|---------------|--------------------------|\n| UE+ (small msg) | ~20 bytes | 99.5% |\n| UE+ (standard) | ~40 bytes | 99.0% |\n| RoCEv2 (IPv4) | ~58 bytes | 98.6% |\n| RoCEv2 (IPv6) | ~78 bytes | 98.1% |\n\n---\n\n## 2. Protocol Stack Summary\n\n```\n+-----------------------------------------------------------------------------+\n|                           Application Layer                                  |\n|                    (Libfabric, Verbs, Sockets, DPDK)                         |\n+-----------------------------------------------------------------------------+\n|                           Transport Layer                                    |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UE Transport   |  |     RoCEv2       |  |    TCP/UDP       |            |\n|  |   (SES/PDS/CMS)  |  |   (BTH/RETH)     |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                           Network Layer                                      |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UFH-16/32      |  |   IPv4/IPv6      |  |   IPv4/IPv6      |            |\n|  |   (Cornelis)     |  |   + UDP          |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                            Link Layer                                        |\n|  +------------------+  +------------------+  +------------------+            |\n|  |      UE+         |  |   Ethernet II    |  |   Ethernet II    |            |\n|  |   (12 bytes)     |  |   (14 bytes)     |  |   (14 bytes)     |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                          Physical Layer                                      |\n|                    Hill Creek (212.5G x8 PAM4 SerDes)                        |\n+-----------------------------------------------------------------------------+\n      Ultra Ethernet+           RoCEv2              Standard Ethernet\n```\n\n---\n\n## 3. Ultra Ethernet+ (UE+) Formats\n\n### 3.1 UE+ L2 Header (12 bytes)\n\n**Datamodel**: `datamodel/protocols/cornelis/link/ue_plus.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Byte 2        | Byte 3        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n|L2|V|zyxm|Len  | Length[7:0]   | RC    | SC    | Hop Count     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 4        | Byte 5        | Byte 6        | Byte 7        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Dest LID [15:8]               | Dest LID [7:0]                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Entropy [15:8]                | Entropy [7:0]                 |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 8        | Byte 9        | Byte 10       | Byte 11       |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Source LID [15:8]             | Source LID [7:0]              |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Payload Type [15:8]           | Payload Type [7:0]            |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| L2 Type | 2 | Always 0b10 for UE+ |\n| Version | 1 | Protocol version |\n| zyxm | 4 | Routing control flags (multicast, adaptive) |\n| Length | 9 | Packet length in bytes |\n| RC | 4 | Routing Class (QoS) |\n| SC | 4 | Service Class |\n| Hop | 8 | TTL/hop count |\n| Dest LID | 16 | Destination Local Identifier |\n| Entropy | 16 | ECMP hash for load balancing |\n| Source LID | 16 | Source Local Identifier |\n| Type | 16 | Payload type (EtherType equivalent) |\n\n**Payload Types**:\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x0800 | IPv4 | IPv4 payload |\n| 0x86DD | IPv6 | IPv6 payload |\n| 0x8100 | VLAN | VLAN tagged frame |\n| 0x9000 | VxLAN+ | VxLAN+ encapsulated |\n| 0x9100 | CSIG+ | CSIG+ telemetry |\n| 0xC000 | UE PDS | Ultra Ethernet PDS |\n\n### 3.2 PDS (Packet Delivery Sublayer) Prologue (2 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/prologue.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0                        | Byte 1                        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| type[4:0] | next_hdr/ctl[3:0] | flags[6:0]                    |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| PDS Type | Value | Description |\n|----------|-------|-------------|\n| Reserved | 0 | Reserved |\n| TSS | 1 | Transport Security (encryption) |\n| RUD Request | 2 | Reliable Unordered Delivery |\n| ROD Request | 3 | Reliable Ordered Delivery |\n| RUDI Request | 4 | Reliable Unordered Immediate |\n| RUDI Response | 5 | RUDI response |\n| UUD Request | 6 | Unreliable Unordered Delivery |\n| ACK | 7 | Acknowledgment |\n| ACK_CC | 8 | ACK with congestion control |\n| ACK_CCX | 9 | ACK with extended CC |\n| NACK | 10 | Negative acknowledgment |\n| CP | 11 | Control packet |\n| NACK_CCX | 12 | NACK with extended CC |\n| RUD_CC_REQ | 13 | RUD with CC state |\n| ROD_CC_REQ | 14 | ROD with CC state |\n\n### 3.3 PDS Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/pds/`\n\n| Format | File | Size | Description |\n|--------|------|------|-------------|\n| RUD/ROD Request | `rud_rod_request.ksy` | Variable | Reliable delivery request |\n| RUD/ROD ACK | `rud_rod_ack.ksy` | Variable | Acknowledgment |\n| ACK_CC | `ack_cc.ksy` | Variable | ACK with CC state |\n| ACK_CCX | `ack_ccx.ksy` | Variable | ACK with extended CC |\n| NACK | `nack.ksy` | Variable | Negative acknowledgment |\n| NACK_CCX | `nack_ccx.ksy` | Variable | NACK with extended CC |\n| RUDI Request/Response | `rudi_request_response.ksy` | Variable | Low-latency immediate |\n| UUD Request | `uud_request.ksy` | Variable | Unreliable delivery |\n| Control Packet | `rud_rod_cp.ksy` | Variable | Control packet |\n| Entropy Header | `entropy_header.ksy` | Variable | Entropy extension |\n\n### 3.4 SES (Semantic Sublayer) Opcodes\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/opcodes.ksy`\n\n**Request Opcodes (Table 3-17)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Tagged Send | 0x00 | Send with tag matching |\n| RMA Write | 0x01 | Remote memory write |\n| RMA Read | 0x02 | Remote memory read |\n| Atomic Write | 0x03 | Atomic memory write |\n| Atomic Read | 0x04 | Atomic memory read |\n| Atomic CAS | 0x05 | Compare-and-swap |\n| Deferrable Send | 0x06 | Deferrable send |\n| Ready to Restart | 0x07 | Restart notification |\n| Small Message | 0x08 | Small message (32B header) |\n| Small RMA Write | 0x09 | Small RMA write |\n| Small RMA Read | 0x0A | Small RMA read |\n| Small Atomic Write | 0x0B | Small atomic write |\n| Small Atomic Read | 0x0C | Small atomic read |\n| Small Atomic CAS | 0x0D | Small atomic CAS |\n\n**Response Opcodes (Table 3-18)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Response | 0x00 | Standard response |\n| Response with Data | 0x01 | Response carrying data |\n| Optimized Response | 0x02 | Optimized format |\n| NACK | 0x03 | Negative acknowledgment |\n\n### 3.5 SES Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/ses/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Standard Request (SOM=1) | `standard_request_som1.ksy` | Start of message |\n| Standard Request (SOM=0) | `standard_request_som0.ksy` | Continuation |\n| Small Message | `small_message.ksy` | 32-byte header format |\n| Small RMA | `small_rma.ksy` | Small RMA operations |\n| Response | `response.ksy` | Standard response |\n| Response with Data | `response_with_data.ksy` | Data-carrying response |\n| Optimized Response | `optimized_response_with_data.ksy` | Optimized format |\n| Deferrable Send | `deferrable_send_request.ksy` | Deferrable operation |\n| Ready to Restart | `ready_to_restart.ksy` | Restart notification |\n| Rendezvous Extension | `rendezvous_extension.ksy` | Large message protocol |\n| Atomic Extension | `atomic_extension.ksy` | Atomic operations |\n| CAS Extension | `cas_extension.ksy` | Compare-and-swap |\n\n### 3.6 CMS (Congestion Management Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/cms/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Credit CP Payload | `credit_cp_payload.ksy` | Credit control packet |\n| Credit Request | `credit_request_cp_payload.ksy` | Credit request |\n| Request CC State | `req_cc_state.ksy` | Request CC state |\n| ACK CC State (NSCC) | `ack_cc_state_nscc.ksy` | NSCC algorithm state |\n| ACK CC State (RCCC/TFC) | `ack_cc_state_rccc_tfc.ksy` | RCCC/TFC state |\n\n### 3.7 TSS (Transport Security Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/tss/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Security Header | `security_header.ksy` | Encryption header |\n| IV Construction | `iv_construction.ksy` | Initialization vector |\n| Key Rotation | `protocols/key_rotation.ksy` | Key rotation protocol |\n| KDF Direct | `protocols/kdf_direct.ksy` | Direct key derivation |\n| KDF Client/Server | `protocols/kdf_client_server.ksy` | Client/server KDF |\n| KDF Cluster | `protocols/kdf_cluster.ksy` | Cluster KDF |\n| Join Secure Domain | `protocols/join_secure_domain.ksy` | Domain join |\n| TSS TX Processing | `protocols/tss_tx_processing.ksy` | Transmit processing |\n| TSS RX Processing | `protocols/tss_rx_processing.ksy` | Receive processing |\n\n### 3.8 Link Layer Formats\n\n#### LLR (Link-Level Retry)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/llr/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| LLR Preamble (64b66b) | `llr_preamble_64b66b.ksy` | 64b66b preamble |\n| LLR Preamble (MII) | `llr_preamble_mii.ksy` | MII preamble |\n| LLR Init CTLOS | `llr_init_ctlos.ksy` | Initialize LLR |\n| LLR Init Echo CTLOS | `llr_init_echo_ctlos.ksy` | Init acknowledgment |\n| LLR ACK CTLOS | `llr_ack_ctlos.ksy` | Frame acknowledgment |\n| LLR NACK CTLOS | `llr_nack_ctlos.ksy` | Retransmit request |\n\n#### CBFC (Credit-Based Flow Control)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/cbfc/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| CF Update | `cf_update.ksy` | Credit flow update |\n| CC Update | `cc_update.ksy` | Credit count update |\n| VC State Machine | `protocols/vc_state_machine.ksy` | Virtual channel FSM |\n| Lossless VC Init | `protocols/lossless_vc_init.ksy` | VC initialization |\n| Lossless VC Removal | `protocols/lossless_vc_removal.ksy` | VC teardown |\n\n#### LLDP Extensions\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/lldp/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| UE Link Negotiation TLV | `ue_link_negotiation_tlv.ksy` | Link negotiation |\n| UE CBFC TLV | `ue_cbfc_tlv.ksy` | CBFC parameters |\n\n---\n\n## 4. RoCEv2 Formats\n\n**Datamodel Directory**: `datamodel/protocols/roce/transport/`\n\n### 4.1 RoCEv2 Packet Structure\n\n```\n+-----------------------------------------------------------------------------+\n| Ethernet II Header (14 bytes)                                               |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2) = 0x0800/0x86DD            |\n+-----------------------------------------------------------------------------+\n| IP Header (20 bytes IPv4 / 40 bytes IPv6)                                   |\n|   Version, IHL, DSCP, ECN, Length, ID, Flags, TTL, Protocol=17, Checksum   |\n|   Source IP, Dest IP                                                        |\n+-----------------------------------------------------------------------------+\n| UDP Header (8 bytes)                                                        |\n|   Source Port (entropy) | Dest Port = 4791 | Length | Checksum             |\n+-----------------------------------------------------------------------------+\n| BTH - Base Transport Header (12 bytes)                                      |\n|   Opcode | Flags | P-Key | Dest QP | A | PSN                               |\n+-----------------------------------------------------------------------------+\n| Extended Headers (optional, operation-dependent)                            |\n|   RETH (16) | AETH (4) | AtomicETH (28) | ImmDt (4)                        |\n+-----------------------------------------------------------------------------+\n| Payload (0 - MTU bytes)                                                     |\n+-----------------------------------------------------------------------------+\n| ICRC (4 bytes)                                                              |\n+-----------------------------------------------------------------------------+\n```\n\n### 4.2 BTH (Base Transport Header) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/roce/transport/bth.ksy`\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| Opcode | 8 | Operation type (transport + operation) |\n| SE | 1 | Solicited Event |\n| M | 1 | Migration state |\n| Pad | 2 | Padding bytes (0-3) |\n| TVer | 4 | Transport version (must be 0) |\n| P-Key | 16 | Partition key |\n| Dest QP | 24 | Destination Queue Pair |\n| A | 1 | ACK request |\n| PSN | 24 | Packet Sequence Number |\n\n**Transport Types** (Opcode bits [7:5]):\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x00 | RC | Reliable Connection |\n| 0x20 | UC | Unreliable Connection |\n| 0x40 | RD | Reliable Datagram |\n| 0x60 | UD | Unreliable Datagram |\n\n**Operations** (Opcode bits [4:0]):\n| Value | Operation | Description |\n|-------|-----------|-------------|\n| 0x00 | SEND_FIRST | First send packet |\n| 0x01 | SEND_MIDDLE | Middle send packet |\n| 0x02 | SEND_LAST | Last send packet |\n| 0x03 | SEND_LAST_IMM | Last send with immediate |\n| 0x04 | SEND_ONLY | Single-packet send |\n| 0x05 | SEND_ONLY_IMM | Single send with immediate |\n| 0x06 | RDMA_WRITE_FIRST | First RDMA write |\n| 0x07 | RDMA_WRITE_MIDDLE | Middle RDMA write |\n| 0x08 | RDMA_WRITE_LAST | Last RDMA write |\n| 0x09 | RDMA_WRITE_LAST_IMM | Last write with immediate |\n| 0x0A | RDMA_WRITE_ONLY | Single-packet write |\n| 0x0B | RDMA_WRITE_ONLY_IMM | Single write with immediate |\n| 0x0C | RDMA_READ_REQUEST | Read request |\n| 0x0D | RDMA_READ_RESPONSE_FIRST | First read response |\n| 0x0E | RDMA_READ_RESPONSE_MIDDLE | Middle read response |\n| 0x0F | RDMA_READ_RESPONSE_LAST | Last read response |\n| 0x10 | RDMA_READ_RESPONSE_ONLY | Single read response |\n| 0x11 | ACK | Acknowledgment |\n| 0x12 | ATOMIC_ACK | Atomic acknowledgment |\n| 0x13 | CMP_SWAP | Compare and swap |\n| 0x14 | FETCH_ADD | Fetch and add |\n\n### 4.3 Extended Transport Headers\n\n| Header | File | Size | Description |\n|--------|------|------|-------------|\n| RETH | `reth.ksy` | 16 bytes | RDMA Extended Transport Header |\n| AETH | `aeth.ksy` | 4 bytes | ACK Extended Transport Header |\n| AtomicETH | `atomiceth.ksy` | 28 bytes | Atomic Extended Transport Header |\n| AtomicAckETH | `atomicacketh.ksy` | 8 bytes | Atomic ACK ETH |\n| DETH | `deth.ksy` | 8 bytes | Datagram Extended Transport Header |\n| ImmDt | `immdt.ksy` | 4 bytes | Immediate Data |\n| ICRC | `icrc.ksy` | 4 bytes | Invariant CRC |\n\n---\n\n## 5. Standard Ethernet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ethernet/`\n\n### 5.1 Ethernet II Frame\n\n**Datamodel**: `datamodel/protocols/ethernet/link/ethernet_ii.ksy`\n\n```\n+-----------------------------------------------------------------------------+\n| Preamble (7 bytes) + SFD (1 byte)  [not visible to software]               |\n+-----------------------------------------------------------------------------+\n| Ethernet Header (14 bytes)                                                  |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2)                            |\n+-----------------------------------------------------------------------------+\n| Optional VLAN Tag (4 bytes) - 802.1Q                                        |\n|   TPID (2) = 0x8100 | TCI (2) = PCP + DEI + VID                            |\n+-----------------------------------------------------------------------------+\n| Payload (46-1500 bytes, or up to 9000 for jumbo)                           |\n+-----------------------------------------------------------------------------+\n| FCS (4 bytes)                                                               |\n+-----------------------------------------------------------------------------+\n```\n\n### 5.2 Link Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| Ethernet II | `link/ethernet_ii.ksy` | Standard Ethernet frame |\n| VLAN 802.1Q | `link/vlan_802_1q.ksy` | VLAN tagging |\n\n### 5.3 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| IPv4 | `network/ipv4.ksy` | IPv4 header |\n| IPv6 | `network/ipv6.ksy` | IPv6 header |\n\n### 5.4 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| TCP | `transport/tcp.ksy` | TCP header |\n| UDP | `transport/udp.ksy` | UDP header |\n\n---\n\n## 6. Cornelis Proprietary Formats\n\n**Datamodel Directory**: `datamodel/protocols/cornelis/`\n\n### 6.1 Link Layer\n\n| Format | File | Size | Description |\n|--------|------|------|-------------|\n| UE+ Header | `link/ue_plus.ksy` | 12 bytes | Optimized L2 header |\n| Cornelis L2 Prefix | `link/cornelis_l2_prefix.ksy` | Variable | L2 prefix |\n\n### 6.2 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| UFH-16 | `network/ufh_16.ksy` | 16-bit forwarding header |\n| UFH-32 | `network/ufh_32.ksy` | 32-bit forwarding header |\n| Collective L2 | `network/collective_l2.ksy` | Collective operations header |\n| Scale-Up L2 | `network/scaleup_l2.ksy` | Scale-up deployments |\n\n#### 6.2.1 UFH-16 (Unified Forwarding Header 16-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_16.ksy`\n\nUFH-16 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 16-bit addressing.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |    Opaque (24-bit)    | Destination   |Opaque |Traffic|   Opaque      |    Source     |\n|[7:4]  |                       | (16-bit BE)   |[7:4]  |Class  |   (16-bit)    |  (16-bit BE)  |\n|SLAP   |                       |               |Z|Y|X|M|[7:0]  |               |               |\n|[3:0]  |                       |               |[3:0]  |       |               |               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1-3 | 24 | Opaque to hardware |\n| Destination | 4-5 | 16 | Destination endpoint address (big-endian) |\n| Opaque | 6 | [7:4] | Opaque to hardware |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Opaque | 8-9 | 16 | Opaque to hardware |\n| Source | 10-11 | 16 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-16 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5-14 | Reserved | Reserved for future use |\n| 15 | Extended | UFH-32 extension follows |\n\n**Usage**: Scale-up fabric forwarding, intra-pod communication, medium cluster networking (up to 65536 endpoints).\n\n#### 6.2.2 UFH-32 (Unified Forwarding Header 32-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_32.ksy`\n\nUFH-32 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 32-bit addressing for large-scale deployments.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |       |   Destination (32-bit BE)     |HopLim |Traffic|       Source (32-bit BE)      |\n|[7:4]  |Opaque |                               |[7:4]  |Class  |                               |\n|SLAP   |       |                               |Z|Y|X|M|[7:0]  |                               |\n|[3:0]  |       |                               |[3:0]  |       |                               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1 | [7:0] | Opaque to hardware |\n| Destination | 2-5 | 32 | Destination endpoint address (big-endian) |\n| Hop Limit | 6 | [7:4] | TTL/hop count |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Source | 8-11 | 32 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-32 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5 | Multicast | Multicast packet |\n| 6 | Barrier | Barrier synchronization |\n| 7 | Reduction | Reduction operation |\n| 8-14 | Reserved | Reserved for future use |\n| 15 | Vendor | Vendor-specific packet |\n\n**Usage**: Large-scale scale-up fabric forwarding (4+ billion endpoints), multi-pod communication, extended collective operations.\n\n### 6.3 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| CSIG+ | `transport/csig_plus.ksy` | Telemetry header |\n| PKEY | `transport/pkey.ksy` | Partition key |\n\n### 6.4 Encapsulation\n\n| Format | File | Description |\n|--------|------|-------------|\n| VxLAN+ | `encapsulation/vxlan_plus.ksy` | Extended VxLAN overlay |\n\n---\n\n## 7. Host-Software Interface (HSI) Formats\n\n**Datamodel Directory**: `datamodel/hw/asics/pmr/interfaces/host_interface/`\n\n### 7.1 Command Queue Segment (64 bytes)\n\n**Datamodel**: `command_queue_segment.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Bytes 2-3     | Bytes 4-7     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Opcode        | Flags         | Payload Len   | Reserved      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 8-15                    | Bytes 16-23                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Tag (64 bits)                 | Dest (64 bits)                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 24-31                   | Bytes 32-63                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Metadata (64 bits)            | Inline Data or SGL Entry      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n**Opcode Encoding**:\n| Bits | Field | Values |\n|------|-------|--------|\n| [7:4] | Family | MSG=0x1, TAGGED=0x2, RMA=0x3, ATOMIC=0x4 |\n| [3:2] | Variant | SEND=0, RECV=1, INJECT=2 |\n| [1] | Reserved | Must be 0 |\n| [0] | Data Source | INLINE=0, SGL=1 |\n\n### 7.2 Notification Formats\n\n| Format | File | Type | Size | Description |\n|--------|------|------|------|-------------|\n| Receive Notification | `receive_notification.ksy` | 0x00 | 64 bytes | Received message |\n| Send Completion | `send_completion.ksy` | 0x01 | 64 bytes | Send completed |\n| Event Notification | `event_notification.ksy` | 0x02 | 64 bytes | Async event |\n| Notification Entry | `notification_entry.ksy` | - | 64 bytes | Generic entry |\n| QW Violation Event | `qw_violation_event.ksy` | - | 64 bytes | QW alignment error |\n\n### 7.3 Receive Notification (64 bytes)\n\n**Datamodel**: `receive_notification.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x00 for receive |\n| flags | 1 | 1 | FI_INLINE, continuation |\n| status | 2 | 2 | Completion status |\n| src_id | 4 | 4 | Source endpoint ID |\n| tag | 8 | 8 | Tag value |\n| total_length | 16 | 4 | Payload length |\n| buffer_id_0 | 20 | 2 | First buffer ID |\n| buffer_id_1 | 22 | 2 | Second buffer ID |\n| buffer_offset | 24 | 2 | Offset in buffer |\n| reserved | 26 | 2 | Reserved |\n| inline_data | 28 | 35 | Inline payload |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.4 Send Completion (64 bytes)\n\n**Datamodel**: `send_completion.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x01 for send |\n| flags | 1 | 1 | Completion flags |\n| status | 2 | 2 | Completion status |\n| reserved_0 | 4 | 4 | Reserved |\n| op_context | 8 | 8 | Operation context |\n| bytes_sent | 16 | 4 | Bytes transferred |\n| reserved_1 | 20 | 43 | Reserved |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.5 Other HSI Formats\n\n| Format | File | Description |\n|--------|------|-------------|\n| SGL Entry | `sgl_entry.ksy` | Scatter-gather list entry |\n| PCIe Descriptors | `pcie/descriptors.ksy` | PCIe interface descriptors |\n\n---\n\n## 8. IP Block Descriptors\n\n**Datamodel Directory**: `datamodel/hw/ip/cornelis/`\n\n### 8.1 Collectives Engine (CE)\n\n**Datamodel**: `ce/descriptors.ksy`\n\nThe Collectives Engine uses RISC-V vector cores (VLEN=512) for hardware-accelerated collective operations.\n\n### 8.2 Electric Creek (EC)\n\n**Datamodel**: `ec/descriptors.ksy`\n\nElectric Creek is the management complex shared between PMR NIC and LNR Switch.\n\n---\n\n## 9. Work List\n\nThis section tracks issues requiring follow-up investigation or specification updates.\n\n### 9.1 Open Issues\n\n| ID | Priority | Category | Description | Status | Opened | Closed |\n|----|----------|----------|-------------|--------|--------|--------|\n| W-06-001 | Medium | Datamodel | UFH-32 lacks 16-bit entropy field; per-packet ECMP not supported; switch must derive entropy from Src+Dest hash | Deferred | 2026-01-20 | - |\n| W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |\n| W-05-002 | Medium | Specification | MTU values: Verify maximum MTU for each protocol | Investigation | 2026-01-10 | - |\n| W-05-003 | Medium | Documentation | CMS detailed formats: Need comprehensive documentation | Spec Update | 2026-01-10 | - |\n| W-03-002 | Low | Terminology | PDP vs PDS naming: UML uses both terms inconsistently | Spec Update | 2026-01-08 | - |\n| W-03-006 | Low | Terminology | SES vs SE: \"SES Processing Groups\" vs \"Semantic Engines\" | Spec Update | 2026-01-08 | - |\n\n### 9.2 Datamodel Gaps\n\n| ID | Priority | Description | Target Location | Status | Opened | Closed |\n|----|----------|-------------|-----------------|--------|--------|--------|\n| D-001 | High | PMR CSR definitions missing from datamodel | `datamodel/hw/asics/pmr/csrs/*.rdl` | Spec Update | 2026-01-10 | - |\n| D-002 | Medium | PMR block hierarchy YAML incomplete | `datamodel/hw/asics/pmr/blocks.yaml` | Spec Update | 2026-01-10 | - |\n| D-003 | Medium | PMR interface contracts missing | `datamodel/views/contracts/pmr-*.puml` | Spec Update | 2026-01-10 | - |\n\n### 9.3 Specification Clarifications Needed\n\n| ID | Priority | Question | Context | Status | Opened | Closed |\n|----|----------|----------|---------|--------|--------|--------|\n| Q1 | Medium | Lightweight Interface Scope | What features should be reduced in lightweight mode? | Investigation | 2026-01-10 | - |\n| Q2 | Medium | Tag Table Sizing | Should HW tag table size be per-endpoint configurable? | Investigation | 2026-01-10 | - |\n| Q3 | Medium | Multi-Packet Eager Messages | Should hardware support multi-packet eager messages? | Investigation | 2026-01-10 | - |\n| Q4 | Low | RoCE Work Queue Implementation | Confirm RoCE WQ/CQ are software-implemented | Investigation | 2026-01-10 | - |\n\n### 9.4 Closed Issues\n\n| ID | Priority | Category | Description | Resolution | Opened | Closed |\n|----|----------|----------|-------------|------------|--------|--------|\n| W-05-001 | Medium | Documentation | UE taxonomy reference | Documented in `05-packet-formats.md` | 2026-01-08 | 2026-01-10 |\n| W-02-005 | Medium | Documentation | Protocol support documentation | Documented UE+, RoCEv2, Ethernet | 2026-01-08 | 2026-01-10 |\n| W-02-006 | Medium | Documentation | Cornelis Collective Reduction Protocol | Documented in HAS §2.5.4 | 2026-01-08 | 2026-01-10 |\n| W-03-001 | Medium | Architecture | Semantic Engine count | Confirmed 64 (8x8) in UML and HAS | 2026-01-08 | 2026-01-10 |\n| W-17-005 | Low | Documentation | Port subdivision note | Added to HAS Ch17 | 2026-01-11 | 2026-01-11 |\n| W-17-006 | Medium | Documentation | MPORT interface documentation | Documented 256B @ 1.66 GHz | 2026-01-11 | 2026-01-11 |\n| W-04-005 | High | Datamodel | `ufh_16.ksy` address size: Datamodel shows 12-bit dest, should be 16-bit | UFH-16 restructured to 12-byte Ethernet MAC overlay with 16-bit destination (bytes 4-5) and 16-bit source (bytes 10-11) | 2026-01-10 | 2026-01-20 |\n| W-04-006 | High | Datamodel | `ufh_32.ksy` address size: Datamodel shows 16-bit dest, should be 32-bit | UFH-32 restructured to 12-byte Ethernet MAC overlay with 32-bit destination (bytes 2-5) and 32-bit source (bytes 8-11) | 2026-01-10 | 2026-01-20 |\n\n### 9.5 Change Log\n\n| Date | Change | Details |\n|------|--------|---------|\n| 2026-01-14 | Initial creation | Document created with PMR packet taxonomy |\n| 2026-01-20 | Review and update | Added UALink section (reference only, not PMR-supported); Added change log; Updated datamodel file counts; No new .ksy files since initial creation |\n| 2026-01-20 | UFH format details | Added detailed UFH-16 and UFH-32 format documentation in Section 6.2 (wire diagrams, field tables, type enumerations) |\n| 2026-01-20 | UFH restructuring | UFH-16 and UFH-32 restructured to 12-byte Ethernet MAC overlays; UFH-16 now 16-bit addressing, UFH-32 now 32-bit addressing; Added SLAP field constraints (Z,Y,X=001); Updated datamodel .ksy files; Closed W-04-005 and W-04-006 |\n\n---\n\n## 10. UALink Protocol (Reference Only)\n\n**Note**: UALink is defined in the datamodel but is **NOT currently supported by PMR**. It is included here for reference as it may be relevant for future AI/ML accelerator interconnect work.\n\n**Datamodel Directory**: `datamodel/protocols/ualink/`\n\n### 10.1 UALink Overview\n\nUALink is an AI/ML accelerator interconnect protocol with 38 packet definitions across all OSI layers.\n\n| Layer | Count | Key Formats |\n|-------|-------|-------------|\n| UPLI (Upper Protocol Layer Interface) | 8 | commands.ksy, request_channel.ksy, status_codes.ksy |\n| Transaction | 9 | tl_flit.ksy, control_half_flit.ksy, data_half_flit.ksy |\n| Data Link | 12 | dl_flit.ksy, segment_header.ksy, crc.ksy, control_messages.ksy |\n| Physical | 4 | alignment_markers.ksy, control_ordered_sets.ksy, link_training.ksy |\n| Security | 5 | authentication.ksy, encryption.ksy, key_derivation.ksy |\n\n### 10.2 UALink Packet Formats\n\n#### UPLI Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Commands | `upli/commands.ksy` | UPLI command definitions |\n| Request Channel | `upli/request_channel.ksy` | Request channel format |\n| Originator Data | `upli/originator_data_channel.ksy` | Originator data channel |\n| Read Response | `upli/read_response_channel.ksy` | Read response channel |\n| Write Response | `upli/write_response_channel.ksy` | Write response channel |\n| Status Codes | `upli/status_codes.ksy` | Status code definitions |\n| Connection Handshake | `upli/protocols/connection_handshake.ksy` | Connection setup |\n| Flow Control | `upli/protocols/flow_control.ksy` | Flow control protocol |\n\n#### Transaction Layer\n| Format | File | Description |\n|--------|------|-------------|\n| TL Flit | `transaction/tl_flit.ksy` | Transaction layer flit |\n| Control Half Flit | `transaction/control_half_flit.ksy` | Control half flit |\n| Data Half Flit | `transaction/data_half_flit.ksy` | Data half flit |\n| Message Half Flit | `transaction/message_half_flit.ksy` | Message half flit |\n| Request Field | `transaction/request_field.ksy` | Request field format |\n| Response Field | `transaction/response_field.ksy` | Response field format |\n| Flow Control Field | `transaction/flow_control_field.ksy` | Flow control field |\n| Compression | `transaction/protocols/compression.ksy` | Data compression |\n| Address Cache | `transaction/protocols/address_cache.ksy` | Address caching |\n\n#### Data Link Layer\n| Format | File | Description |\n|--------|------|-------------|\n| DL Flit | `datalink/dl_flit.ksy` | Data link flit |\n| Flit Header | `datalink/flit_header.ksy` | Flit header format |\n| Segment Header | `datalink/segment_header.ksy` | Segment header |\n| CRC | `datalink/crc.ksy` | CRC calculation |\n| Control Messages | `datalink/messages/control_messages.ksy` | Control messages |\n| Basic Messages | `datalink/messages/basic_messages.ksy` | Basic messages |\n| UART Messages | `datalink/messages/uart_messages.ksy` | UART messages |\n| Vendor Defined | `datalink/messages/vendor_defined.ksy` | Vendor extensions |\n| Link Resiliency | `datalink/protocols/link_resiliency.ksy` | Link resiliency |\n| Link Level Replay | `datalink/protocols/link_level_replay.ksy` | Replay protocol |\n| Link State | `datalink/protocols/link_state.ksy` | Link state machine |\n| Link Folding | `datalink/protocols/link_folding.ksy` | Link folding |\n\n#### Physical Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Alignment Markers | `physical/alignment_markers.ksy` | Lane alignment |\n| Control Ordered Sets | `physical/control_ordered_sets.ksy` | Control sequences |\n| Reconciliation Sublayer | `physical/reconciliation_sublayer.ksy` | RS sublayer |\n| Link Training | `physical/protocols/link_training.ksy` | Link training |\n\n#### Security Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Authentication | `security/authentication.ksy` | Authentication |\n| Encryption | `security/encryption.ksy` | Encryption format |\n| IV Format | `security/iv_format.ksy` | Initialization vector |\n| Key Derivation | `security/protocols/key_derivation.ksy` | Key derivation |\n| Key Rotation | `security/protocols/key_rotation.ksy` | Key rotation |\n\n---\n\n## 11. References\n\n### Internal Documents\n- `docs/HAS/PMR/05-packet-formats.md` - PMR HAS Chapter 5\n- `docs/HAS/PMR/WORK.md` - PMR HAS Work Tracking\n- `.specify/memory/constitution.md` - Project Constitution\n\n### Datamodel Locations\n- `datamodel/protocols/ue/` - Ultra Ethernet protocols (94 .ksy files)\n- `datamodel/protocols/roce/` - RoCEv2 protocols (8 .ksy files)\n- `datamodel/protocols/ethernet/` - Standard Ethernet (6 .ksy files)\n- `datamodel/protocols/cornelis/` - Cornelis proprietary (9 .ksy files)\n- `datamodel/protocols/ualink/` - UALink protocols (38 .ksy files) - NOT supported by PMR\n- `datamodel/hw/asics/pmr/` - PMR ASIC definitions\n\n### External Specifications\n- [Ultra Ethernet Specification v1.0.1](https://ultraethernet.org/)\n- [InfiniBand Architecture Specification](https://www.infinibandta.org/)\n- IEEE 802.3 Ethernet Standard\n- UALink Specification (Ultra Accelerator Link)\n",
                "additions": 1,
                "deletions": 0
              },
              "truncated": false
            },
            "time": {
              "start": 1769121672807,
              "end": 1769121672867,
              "compacted": 1769123003287
            }
          }
        },
        {
          "id": "prt_be7de6ea6001bwfRFvykFw1YUU",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7de4e89001FUidFma8hVgVCA",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 24907,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7de6ebd001uf3cW7JLtGXe6h",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769121672893,
          "completed": 1769121678157
        },
        "parentID": "msg_be7de3e96001gxmZh6V7SWVjo6",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 24916,
          "output": 21,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "stop"
      },
      "parts": [
        {
          "id": "prt_be7de7289001JngsbIFkPojBCy",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7de6ebd001uf3cW7JLtGXe6h",
          "type": "step-start"
        },
        {
          "id": "prt_be7de831b0012RT7NPg4SX3F2M",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7de6ebd001uf3cW7JLtGXe6h",
          "type": "text",
          "text": "Done. Added W-06-001 to the Open Issues table in Section 9.1.",
          "time": {
            "start": 1769121678147,
            "end": 1769121678147
          }
        },
        {
          "id": "prt_be7de8344001w6qzTmrNgVPcCb",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7de6ebd001uf3cW7JLtGXe6h",
          "type": "step-finish",
          "reason": "stop",
          "cost": 0,
          "tokens": {
            "input": 24916,
            "output": 21,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7df82af001NGMabN6wgr8sL9",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "user",
        "time": {
          "created": 1769121743540
        },
        "summary": {
          "title": "Move packet_taxonomy.md to analysis directory",
          "diffs": []
        },
        "agent": "Sisyphus",
        "model": {
          "providerID": "cornelis",
          "modelID": "developer-opus"
        }
      },
      "parts": [
        {
          "id": "prt_be7df82af002it6K3aeSlIrkxt",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7df82af001NGMabN6wgr8sL9",
          "type": "text",
          "text": "please move packet_taxonomy.md to ./analysis"
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7df82cf001qATlcDDMiL9iyf",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769121743567,
          "completed": 1769121755300
        },
        "parentID": "msg_be7df82af001NGMabN6wgr8sL9",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 24951,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7df872f001zBLpBaueSScZOQ",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7df82cf001qATlcDDMiL9iyf",
          "type": "step-start"
        },
        {
          "id": "prt_be7df93b2001D9Q6g5KE1TDhJV",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7df82cf001qATlcDDMiL9iyf",
          "type": "tool",
          "callID": "toolu_015oVhwxruQN4pXjW84U8dVU",
          "tool": "bash",
          "state": {
            "status": "completed",
            "input": {
              "command": "mv ./packet_taxonomy.md ./analysis/",
              "description": "Move packet_taxonomy.md to analysis directory"
            },
            "output": "",
            "title": "Move packet_taxonomy.md to analysis directory",
            "metadata": {
              "output": "",
              "exit": 0,
              "description": "Move packet_taxonomy.md to analysis directory",
              "truncated": false
            },
            "time": {
              "start": 1769121747901,
              "end": 1769121755289,
              "compacted": 1769123003287
            }
          }
        },
        {
          "id": "prt_be7dfb09a001bbm9BlXAdmzAeM",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7df82cf001qATlcDDMiL9iyf",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 24951,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7dfb0b50019q3Xdvx0J6A7Y0",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769121755317,
          "completed": 1769121759920
        },
        "parentID": "msg_be7df82af001NGMabN6wgr8sL9",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 24951,
          "output": 23,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "stop"
      },
      "parts": [
        {
          "id": "prt_be7dfb491001Wi5i3QL4vH1e5m",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7dfb0b50019q3Xdvx0J6A7Y0",
          "type": "step-start"
        },
        {
          "id": "prt_be7dfc283001tRdiiZH1Ljnz9g",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7dfb0b50019q3Xdvx0J6A7Y0",
          "type": "text",
          "text": "Done. Moved `packet_taxonomy.md` to `./analysis/packet_taxonomy.md`.",
          "time": {
            "start": 1769121759916,
            "end": 1769121759916
          }
        },
        {
          "id": "prt_be7dfc2ad001IVDrACcmrAOpID",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7dfb0b50019q3Xdvx0J6A7Y0",
          "type": "step-finish",
          "reason": "stop",
          "cost": 0,
          "tokens": {
            "input": 24951,
            "output": 23,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7e28b86001U2bxAs52hRVDKW",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "user",
        "time": {
          "created": 1769121942420
        },
        "summary": {
          "title": "Packet taxonomy: expand formats, identify spec discrepancies",
          "diffs": []
        },
        "agent": "Planner-Sisyphus",
        "model": {
          "providerID": "cornelis",
          "modelID": "developer-opus"
        }
      },
      "parts": [
        {
          "id": "prt_be7e28b870015LSNneHwMvvhqr",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e28b86001U2bxAs52hRVDKW",
          "type": "text",
          "text": "please expand any packet format not already expanded in analysis/packet_taxonomy.md. Identify any discrepancies with specifications that are not already identified as work items in the Work List in packet_taxonomy.md."
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7e28bb8001Qsgrza6wmVz60O",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769121942456,
          "completed": 1769121949931
        },
        "parentID": "msg_be7e28b86001U2bxAs52hRVDKW",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Planner-Sisyphus",
        "agent": "Planner-Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 18647,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7e290c4001ej63Bw26ioFywn",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e28bb8001Qsgrza6wmVz60O",
          "type": "step-start"
        },
        {
          "id": "prt_be7e2a8440010aKSzdbUX5nNbA",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e28bb8001Qsgrza6wmVz60O",
          "type": "tool",
          "callID": "toolu_011oDpGdFANRCsVpACcKy4hg",
          "tool": "glob",
          "state": {
            "status": "completed",
            "input": {
              "pattern": "earlysim/datamodel/**/*.ksy"
            },
            "output": "Found 100 file(s)\n\n./earlysim/datamodel/protocols/cornelis/network/ufh_32.ksy\n./earlysim/datamodel/protocols/cornelis/network/ufh_16.ksy\n./earlysim/datamodel/protocols/roce/protocols/qp_state_machine.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/protocols/ccc_state_machine.ksy\n./earlysim/datamodel/protocols/ue/transport/tss/security_header.ksy\n./earlysim/datamodel/protocols/ue/transport/tss/iv_construction.ksy\n./earlysim/datamodel/protocols/ue/transport/tss/protocols/tss_rx_processing.ksy\n./earlysim/datamodel/protocols/ue/transport/tss/protocols/kdf_client_server.ksy\n./earlysim/datamodel/protocols/ue/transport/tss/protocols/key_rotation.ksy\n./earlysim/datamodel/protocols/ue/transport/tss/protocols/tss_tx_processing.ksy\n./earlysim/datamodel/protocols/ue/transport/tss/protocols/kdf_direct.ksy\n./earlysim/datamodel/protocols/ue/transport/tss/protocols/kdf_cluster.ksy\n./earlysim/datamodel/protocols/ue/transport/tss/protocols/join_secure_domain.ksy\n./earlysim/datamodel/protocols/ualink/physical/reconciliation_sublayer.ksy\n./earlysim/datamodel/protocols/ualink/physical/control_ordered_sets.ksy\n./earlysim/datamodel/protocols/ualink/physical/protocols/link_training.ksy\n./earlysim/datamodel/protocols/ualink/physical/alignment_markers.ksy\n./earlysim/datamodel/protocols/ualink/transaction/tl_flit.ksy\n./earlysim/datamodel/protocols/ualink/transaction/control_half_flit.ksy\n./earlysim/datamodel/protocols/ualink/transaction/message_half_flit.ksy\n./earlysim/datamodel/protocols/ualink/transaction/flow_control_field.ksy\n./earlysim/datamodel/protocols/ualink/transaction/data_half_flit.ksy\n./earlysim/datamodel/protocols/ualink/transaction/request_field.ksy\n./earlysim/datamodel/protocols/ualink/transaction/protocols/compression.ksy\n./earlysim/datamodel/protocols/ualink/transaction/protocols/address_cache.ksy\n./earlysim/datamodel/protocols/ualink/transaction/response_field.ksy\n./earlysim/datamodel/protocols/ualink/datalink/segment_header.ksy\n./earlysim/datamodel/protocols/ualink/datalink/dl_flit.ksy\n./earlysim/datamodel/protocols/ualink/datalink/crc.ksy\n./earlysim/datamodel/protocols/ualink/datalink/flit_header.ksy\n./earlysim/datamodel/protocols/ualink/datalink/protocols/link_resiliency.ksy\n./earlysim/datamodel/protocols/ualink/datalink/protocols/link_level_replay.ksy\n./earlysim/datamodel/protocols/ualink/datalink/protocols/link_state.ksy\n./earlysim/datamodel/protocols/ualink/datalink/protocols/link_folding.ksy\n./earlysim/datamodel/protocols/ualink/datalink/messages/control_messages.ksy\n./earlysim/datamodel/protocols/ualink/datalink/messages/uart_messages.ksy\n./earlysim/datamodel/protocols/ualink/datalink/messages/vendor_defined.ksy\n./earlysim/datamodel/protocols/ualink/datalink/messages/basic_messages.ksy\n./earlysim/datamodel/protocols/ualink/upli/commands.ksy\n./earlysim/datamodel/protocols/ualink/upli/status_codes.ksy\n./earlysim/datamodel/protocols/ualink/upli/write_response_channel.ksy\n./earlysim/datamodel/protocols/ualink/upli/request_channel.ksy\n./earlysim/datamodel/protocols/ualink/upli/originator_data_channel.ksy\n./earlysim/datamodel/protocols/ualink/upli/read_response_channel.ksy\n./earlysim/datamodel/protocols/ualink/upli/protocols/flow_control.ksy\n./earlysim/datamodel/protocols/ualink/upli/protocols/connection_handshake.ksy\n./earlysim/datamodel/protocols/ualink/security/authentication.ksy\n./earlysim/datamodel/protocols/ualink/security/encryption.ksy\n./earlysim/datamodel/protocols/ualink/security/iv_format.ksy\n./earlysim/datamodel/protocols/ualink/security/protocols/key_derivation.ksy\n./earlysim/datamodel/protocols/ualink/security/protocols/key_rotation.ksy\n./earlysim/datamodel/protocols/ue/link/cbfc/cf_update.ksy\n./earlysim/datamodel/protocols/ue/network/dscp_categories.ksy\n./earlysim/datamodel/protocols/ue/network/packet_trimming.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/credit_request_cp_payload.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/req_cc_state.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/credit_cp_payload.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/ack_cc_state_rccc_tfc.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/ack_cc_state_nscc.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/protocols/rccc_destination.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/protocols/tfc_destination.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/protocols/tfc_source.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/protocols/rccc_source.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/protocols/nscc_destination.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/protocols/nscc_source.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/protocols/multipath_selection.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/prologue.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/ack_ccx.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/rud_rod_request.ksy\n./earlysim/datamodel/hw/asics/pmr/interfaces/host_interface/send_completion.ksy\n./earlysim/datamodel/hw/asics/pmr/interfaces/host_interface/notification_entry.ksy\n./earlysim/datamodel/hw/asics/pmr/interfaces/host_interface/command_queue_segment.ksy\n./earlysim/datamodel/hw/asics/pmr/interfaces/host_interface/receive_notification.ksy\n./earlysim/datamodel/hw/asics/pmr/interfaces/host_interface/event_notification.ksy\n./earlysim/datamodel/hw/asics/pmr/interfaces/host_interface/qw_violation_event.ksy\n./earlysim/datamodel/hw/asics/pmr/interfaces/host_interface/sgl_entry.ksy\n./earlysim/datamodel/hw/asics/pmr/interfaces/pcie/descriptors.ksy\n./earlysim/datamodel/protocols/roce/transport/bth.ksy\n./earlysim/datamodel/protocols/roce/transport/reth.ksy\n./earlysim/datamodel/protocols/roce/transport/deth.ksy\n./earlysim/datamodel/protocols/roce/transport/immdt.ksy\n./earlysim/datamodel/protocols/roce/transport/atomiceth.ksy\n./earlysim/datamodel/protocols/roce/transport/atomicacketh.ksy\n./earlysim/datamodel/protocols/roce/transport/icrc.ksy\n./earlysim/datamodel/protocols/roce/transport/aeth.ksy\n./earlysim/datamodel/protocols/cornelis/link/ue_plus.ksy\n./earlysim/datamodel/protocols/cornelis/link/cornelis_l2_prefix.ksy\n./earlysim/datamodel/protocols/cornelis/encapsulation/vxlan_plus.ksy\n./earlysim/datamodel/protocols/cornelis/network/collective_l2.ksy\n./earlysim/datamodel/protocols/cornelis/network/scaleup_l2.ksy\n./earlysim/datamodel/protocols/cornelis/transport/csig_plus.ksy\n./earlysim/datamodel/protocols/cornelis/transport/pkey.ksy\n./earlysim/datamodel/hw/ip/cornelis/ce/descriptors.ksy\n./earlysim/datamodel/hw/ip/cornelis/ec/descriptors.ksy\n./earlysim/datamodel/protocols/ethernet/link/vlan_802_1q.ksy\n./earlysim/datamodel/protocols/ethernet/link/ethernet_ii.ksy\n./earlysim/datamodel/protocols/ethernet/network/ipv4.ksy\n./earlysim/datamodel/protocols/ethernet/network/ipv6.ksy\n./earlysim/datamodel/protocols/ethernet/transport/udp.ksy\n./earlysim/datamodel/protocols/ethernet/transport/tcp.ksy\n\n(Results are truncated. Consider using a more specific path or pattern.)\n[Agent Usage Reminder]\n\nYou called a search/fetch tool directly without leveraging specialized agents.\n\nRECOMMENDED: Use background_task with explore/librarian agents for better results:\n\n```\n// Parallel exploration - fire multiple agents simultaneously\nbackground_task(agent=\"explore\", prompt=\"Find all files matching pattern X\")\nbackground_task(agent=\"explore\", prompt=\"Search for implementation of Y\") \nbackground_task(agent=\"librarian\", prompt=\"Lookup documentation for Z\")\n\n// Then continue your work while they run in background\n// System will notify you when each completes\n```\n\nWHY:\n- Agents can perform deeper, more thorough searches\n- Background tasks run in parallel, saving time\n- Specialized agents have domain expertise\n- Reduces context window usage in main session\n\nALWAYS prefer: Multiple parallel background_task calls > Direct tool calls\n",
            "title": "",
            "metadata": {
              "truncated": false
            },
            "time": {
              "start": 1769121949770,
              "end": 1769121949920,
              "compacted": 1769123003286
            }
          }
        },
        {
          "id": "prt_be7e2a84e0010k87rkdtVtxHlL",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e28bb8001Qsgrza6wmVz60O",
          "type": "tool",
          "callID": "toolu_016EuJTzS674TKA6UVJ7fHUR",
          "tool": "glob",
          "state": {
            "status": "completed",
            "input": {
              "pattern": "earlysim/docs/HAS/**/*.md"
            },
            "output": "Found 37 file(s)\n\n./earlysim/docs/HAS/ETC/CN7000_Electric_Creek_HAS.md\n./earlysim/docs/HAS/ETC/SESSION_NOTES.md\n./earlysim/docs/HAS/PMR/08-host-datamover.md\n./earlysim/docs/HAS/PMR/CSR-ROLLOUT-PLAN.md\n./earlysim/docs/HAS/PMR/appendix-hw-untagged-matching.md\n./earlysim/docs/HAS/PMR/WORK.md\n./earlysim/docs/HAS/PMR/06-programming-model.md\n./earlysim/docs/HAS/PMR/analysis-se-pdp-ue-protocol-routing.md\n./earlysim/docs/HAS/PMR/appendix-hw-accelerated-tag-matching.md\n./earlysim/docs/HAS/PMR/19-hill-creek-phy.md\n./earlysim/docs/HAS/PMR/15-counter-trigger-architecture.md\n./earlysim/docs/HAS/PMR/CARDINALITY-ANALYSIS-REPORT.md\n./earlysim/docs/HAS/PMR/02-overview.md\n./earlysim/docs/HAS/PMR/rx-path-csr-approach.md\n./earlysim/docs/HAS/PMR/13-semantic-engines.md\n./earlysim/docs/HAS/PMR/A2-appendix-ue-packet-flow-walkthrough.md\n./earlysim/docs/HAS/PMR/10-command-interface.md\n./earlysim/docs/HAS/PMR/17-receive-path.md\n./earlysim/docs/HAS/PMR/18-emc-replay-subsystem.md\n./earlysim/docs/HAS/PMR/README.md\n./earlysim/docs/HAS/PMR/01-introduction.md\n./earlysim/docs/HAS/PMR/AGENTS.md\n./earlysim/docs/HAS/PMR/14-packet-delivery-processors.md\n./earlysim/docs/HAS/PMR/appendix-sw-tag-matching-nic-service.md\n./earlysim/docs/HAS/PMR/A1-appendix-csr-reference.md\n./earlysim/docs/HAS/PMR/09-memory-translation.md\n./earlysim/docs/HAS/PMR/12-ethernet-delivery-processor.md\n./earlysim/docs/HAS/PMR/11-ethernet-netdev-interface.md\n./earlysim/docs/HAS/PMR/03-architecture.md\n./earlysim/docs/HAS/PMR/16-transmit-path.md\n./earlysim/docs/HAS/PMR/07-pcie-interface.md\n./earlysim/docs/HAS/PMR/00-prologue.md\n./earlysim/docs/HAS/ETC/RED_WARNINGS.md\n./earlysim/docs/HAS/PMR/04-addressing.md\n./earlysim/docs/HAS/PMR/05-packet-formats.md\n./earlysim/docs/HAS/ETC/README.md\n./earlysim/docs/HAS/CE/CE_HAS.md\n[Agent Usage Reminder]\n\nYou called a search/fetch tool directly without leveraging specialized agents.\n\nRECOMMENDED: Use background_task with explore/librarian agents for better results:\n\n```\n// Parallel exploration - fire multiple agents simultaneously\nbackground_task(agent=\"explore\", prompt=\"Find all files matching pattern X\")\nbackground_task(agent=\"explore\", prompt=\"Search for implementation of Y\") \nbackground_task(agent=\"librarian\", prompt=\"Lookup documentation for Z\")\n\n// Then continue your work while they run in background\n// System will notify you when each completes\n```\n\nWHY:\n- Agents can perform deeper, more thorough searches\n- Background tasks run in parallel, saving time\n- Specialized agents have domain expertise\n- Reduces context window usage in main session\n\nALWAYS prefer: Multiple parallel background_task calls > Direct tool calls\n",
            "title": "",
            "metadata": {
              "truncated": false
            },
            "time": {
              "start": 1769121949775,
              "end": 1769121949902,
              "compacted": 1769123003286
            }
          }
        },
        {
          "id": "prt_be7e2a850001eDyBfU7oFIR8Y9",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e28bb8001Qsgrza6wmVz60O",
          "type": "tool",
          "callID": "toolu_01JCNiPVdzXRfCKWUdEsVRUb",
          "tool": "glob",
          "state": {
            "status": "completed",
            "input": {
              "pattern": "earlysim/specs/**/*"
            },
            "output": "Found 100 file(s)\n\n./earlysim/specs/025-sim-directory-structure/tasks.md\n./earlysim/specs/025-sim-directory-structure/research.md\n./earlysim/specs/025-sim-directory-structure/data-model.md\n./earlysim/specs/025-sim-directory-structure/quickstart.md\n./earlysim/specs/026-requirements-to-datamodel/tasks.md\n./earlysim/specs/026-requirements-to-datamodel/research.md\n./earlysim/specs/026-requirements-to-datamodel/data-model.md\n./earlysim/specs/026-requirements-to-datamodel/contracts/requirement.schema.json\n./earlysim/specs/026-requirements-to-datamodel/quickstart.md\n./earlysim/specs/026-requirements-to-datamodel/review.md\n./earlysim/specs/025-sim-directory-structure/checklists/requirements.md\n./earlysim/specs/025-sim-directory-structure/spec.md\n./earlysim/specs/025-sim-directory-structure/plan.md\n./earlysim/specs/013-riscv-collectives-engine/tasks.md\n./earlysim/specs/013-riscv-collectives-engine/IMPLEMENTATION_COMPLETE.md\n./earlysim/specs/013-riscv-collectives-engine/research.md\n./earlysim/specs/013-riscv-collectives-engine/IMPLEMENTATION_STATUS.md\n./earlysim/specs/013-riscv-collectives-engine/KNOWN_ISSUES.md\n./earlysim/specs/013-riscv-collectives-engine/plan.md\n./earlysim/specs/021-command-queue-hsi/tasks.md\n./earlysim/specs/021-command-queue-hsi/research.md\n./earlysim/specs/021-command-queue-hsi/quickstart.md\n./earlysim/specs/021-command-queue-hsi/plan.md\n./earlysim/specs/017-lnr-asic-functional-model/tasks.md\n./earlysim/specs/017-lnr-asic-functional-model/research.md\n./earlysim/specs/017-lnr-asic-functional-model/quickstart.md\n./earlysim/specs/017-lnr-asic-functional-model/checklists/requirements.md\n./earlysim/specs/017-lnr-asic-functional-model/spec.md\n./earlysim/specs/017-lnr-asic-functional-model/plan.md\n./earlysim/specs/016-electric-creek-functional-model/tasks.md\n./earlysim/specs/016-electric-creek-functional-model/research.md\n./earlysim/specs/016-electric-creek-functional-model/quickstart.md\n./earlysim/specs/016-electric-creek-functional-model/traceability_matrix.md\n./earlysim/specs/016-electric-creek-functional-model/spec.md\n./earlysim/specs/016-electric-creek-functional-model/plan.md\n./earlysim/specs/014-ce-fifo-steering-debug/tasks.md\n./earlysim/specs/014-ce-fifo-steering-debug/research.md\n./earlysim/specs/014-ce-fifo-steering-debug/E2E_IMPLEMENTATION_STATUS.md\n./earlysim/specs/014-ce-fifo-steering-debug/E2E_TEST_PLAN.md\n./earlysim/specs/014-ce-fifo-steering-debug/quickstart.md\n./earlysim/specs/014-ce-fifo-steering-debug/plan.md\n./earlysim/specs/020-lnr-management-sonic/prompt.md\n./earlysim/specs/020-lnr-management-sonic/tasks.md\n./earlysim/specs/020-lnr-management-sonic/quickstart.md\n./earlysim/specs/020-lnr-management-sonic/spec.md\n./earlysim/specs/020-lnr-management-sonic/plan.md\n./earlysim/specs/011-libfabric-ping-pong/tasks.md\n./earlysim/specs/011-libfabric-ping-pong/research.md\n./earlysim/specs/011-libfabric-ping-pong/quickstart.md\n./earlysim/specs/011-libfabric-ping-pong/plan.md\n./earlysim/specs/011-libfabric-ping-pong/testing_checklist.md\n./earlysim/specs/019-lnr-add-bmc/tasks.md\n./earlysim/specs/019-lnr-add-bmc/plan.md\n./earlysim/specs/021-command-queue-hsi/data-model.md\n./earlysim/specs/021-command-queue-hsi/contracts/hsi-interfaces.yaml\n./earlysim/specs/021-command-queue-hsi/checklists/requirements.md\n./earlysim/specs/021-command-queue-hsi/spec.md\n./earlysim/specs/017-lnr-asic-functional-model/data-model.md\n./earlysim/specs/017-lnr-asic-functional-model/principles.md\n./earlysim/specs/017-lnr-asic-functional-model/contracts/sai-api.yaml\n./earlysim/specs/020-lnr-management-sonic/research.md\n./earlysim/specs/020-lnr-management-sonic/data-model.md\n./earlysim/specs/020-lnr-management-sonic/contracts/sonic-compose.yaml\n./earlysim/specs/020-lnr-management-sonic/checklists/requirements.md\n./earlysim/specs/019-lnr-add-bmc/TRACEABILITY.md\n./earlysim/specs/019-lnr-add-bmc/SUMMARY.md\n./earlysim/specs/019-lnr-add-bmc/IMPLEMENTATION-STATUS.md\n./earlysim/specs/019-lnr-add-bmc/checklists/requirements.md\n./earlysim/specs/019-lnr-add-bmc/spec.md\n./earlysim/specs/013-riscv-collectives-engine/NEXT_STEPS.md\n./earlysim/specs/013-riscv-collectives-engine/E2E_VALIDATION_RESULTS.md\n./earlysim/specs/013-riscv-collectives-engine/data-model.md\n./earlysim/specs/013-riscv-collectives-engine/COMPLETION_STATUS.md\n./earlysim/specs/013-riscv-collectives-engine/contracts/ce-commands.yaml\n./earlysim/specs/013-riscv-collectives-engine/contracts/ce-csrs.yaml\n./earlysim/specs/013-riscv-collectives-engine/quickstart.md\n./earlysim/specs/013-riscv-collectives-engine/checklists/requirements.md\n./earlysim/specs/013-riscv-collectives-engine/SESSION_SUMMARY.md\n./earlysim/specs/013-riscv-collectives-engine/spec.md\n./earlysim/specs/016-electric-creek-functional-model/data-model.md\n./earlysim/specs/016-electric-creek-functional-model/contracts/cbuf-interface.yaml\n./earlysim/specs/016-electric-creek-functional-model/contracts/sc-hal-interface.yaml\n./earlysim/specs/016-electric-creek-functional-model/contracts/caliptra-interface.yaml\n./earlysim/specs/016-electric-creek-functional-model/contracts/simem-interface.yaml\n./earlysim/specs/016-electric-creek-functional-model/checklists/requirements.md\n./earlysim/specs/014-ce-fifo-steering-debug/data-model.md\n./earlysim/specs/014-ce-fifo-steering-debug/COMPLETION_STATUS.md\n./earlysim/specs/014-ce-fifo-steering-debug/contracts/ce-commands.yaml\n./earlysim/specs/014-ce-fifo-steering-debug/contracts/ce-csrs.yaml\n./earlysim/specs/014-ce-fifo-steering-debug/checklists/requirements.md\n./earlysim/specs/014-ce-fifo-steering-debug/spec.md\n./earlysim/specs/011-libfabric-ping-pong/data-model.md\n./earlysim/specs/011-libfabric-ping-pong/contracts/provider_api.h\n./earlysim/specs/011-libfabric-ping-pong/checklists/requirements.md\n./earlysim/specs/011-libfabric-ping-pong/spec.md\n./earlysim/specs/007-unified-cmake-build/LESSONS_LEARNED.md\n./earlysim/specs/007-unified-cmake-build/design-review-approval.md\n./earlysim/specs/007-unified-cmake-build/tasks.md\n./earlysim/specs/007-unified-cmake-build/research.md\n./earlysim/specs/007-unified-cmake-build/data-model.md\n\n(Results are truncated. Consider using a more specific path or pattern.)\n[Agent Usage Reminder]\n\nYou called a search/fetch tool directly without leveraging specialized agents.\n\nRECOMMENDED: Use background_task with explore/librarian agents for better results:\n\n```\n// Parallel exploration - fire multiple agents simultaneously\nbackground_task(agent=\"explore\", prompt=\"Find all files matching pattern X\")\nbackground_task(agent=\"explore\", prompt=\"Search for implementation of Y\") \nbackground_task(agent=\"librarian\", prompt=\"Lookup documentation for Z\")\n\n// Then continue your work while they run in background\n// System will notify you when each completes\n```\n\nWHY:\n- Agents can perform deeper, more thorough searches\n- Background tasks run in parallel, saving time\n- Specialized agents have domain expertise\n- Reduces context window usage in main session\n\nALWAYS prefer: Multiple parallel background_task calls > Direct tool calls\n",
            "title": "",
            "metadata": {
              "truncated": false
            },
            "time": {
              "start": 1769121949777,
              "end": 1769121949917,
              "compacted": 1769123003285
            }
          }
        },
        {
          "id": "prt_be7e2a8e1001QI3qW4jtPeDhTm",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e28bb8001Qsgrza6wmVz60O",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 18647,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7e2a900001a7f7BD3jn5CKpp",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769121949952,
          "completed": 1769121956706
        },
        "parentID": "msg_be7e28b86001U2bxAs52hRVDKW",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Planner-Sisyphus",
        "agent": "Planner-Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 24462,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7e2ac6c001kkg0NC1V0i5J1S",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e2a900001a7f7BD3jn5CKpp",
          "type": "step-start"
        },
        {
          "id": "prt_be7e2c2f8001qWfNFyns50XQN0",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e2a900001a7f7BD3jn5CKpp",
          "type": "tool",
          "callID": "toolu_01KGqvmQ4LNiBq5ftBxFknaq",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/docs/HAS/PMR/05-packet-formats.md"
            },
            "output": "<file>\n00001| # Chapter 5: Packet Formats\n00002| \n00003| ## 5.1 Introduction\n00004| \n00005| This chapter describes the packet formats used by PMR for fabric communication.\n00006| PMR supports multiple protocol stacks, each with its own packet format hierarchy.\n00007| \n00008| > **Canonical Reference**: All packet formats are defined in the datamodel:\n00009| > - `datamodel/ue/` - Ultra Ethernet protocol formats (60+ packet types)\n00010| > - `datamodel/cornelis/` - Cornelis proprietary formats (UE+, UFH, HSI)\n00011| > - `datamodel/ethernet/` - Standard Ethernet formats\n00012| > - `datamodel/rdma/` - RoCEv2/IB transport formats\n00013| >\n00014| > This chapter provides an overview; the datamodel `.ksy` files are authoritative.\n00015| > Datamodel locations may change in the future.\n00016| \n00017| ---\n00018| \n00019| ## 5.2 Protocol Stack Overview\n00020| \n00021| PMR implements a layered protocol stack for each supported protocol:\n00022| \n00023| ```\n00024| ┌─────────────────────────────────────────────────────────────────────────────┐\n00025| │                           Application Layer                                  │\n00026| │                    (Libfabric, Verbs, Sockets, DPDK)                        │\n00027| ├─────────────────────────────────────────────────────────────────────────────┤\n00028| │                           Transport Layer                                    │\n00029| │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐              │\n00030| │  │   UE Transport  │  │     RoCEv2      │  │    TCP/UDP      │              │\n00031| │  │   (SES/PDS/CMS) │  │   (BTH/RETH)    │  │                 │              │\n00032| │  └─────────────────┘  └─────────────────┘  └─────────────────┘              │\n00033| ├─────────────────────────────────────────────────────────────────────────────┤\n00034| │                           Network Layer                                      │\n00035| │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐              │\n00036| │  │   UFH-16/32     │  │   IPv4/IPv6     │  │   IPv4/IPv6     │              │\n00037| │  │   (Cornelis)    │  │   + UDP         │  │                 │              │\n00038| │  └─────────────────┘  └─────────────────┘  └─────────────────┘              │\n00039| ├─────────────────────────────────────────────────────────────────────────────┤\n00040| │                            Link Layer                                        │\n00041| │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐              │\n00042| │  │      UE+        │  │   Ethernet II   │  │   Ethernet II   │              │\n00043| │  │   (12 bytes)    │  │   (14 bytes)    │  │   (14 bytes)    │              │\n00044| │  └─────────────────┘  └─────────────────┘  └─────────────────┘              │\n00045| ├─────────────────────────────────────────────────────────────────────────────┤\n00046| │                          Physical Layer                                      │\n00047| │                    Hill Creek (212.5G x8 PAM4 SerDes)                       │\n00048| └─────────────────────────────────────────────────────────────────────────────┘\n00049|       Ultra Ethernet+           RoCEv2              Standard Ethernet\n00050| ```\n00051| \n00052| ---\n00053| \n00054| ## 5.3 Ultra Ethernet+ Packet Format\n00055| \n00056| ### 5.3.1 UE+ Packet Structure\n00057| \n00058| Ultra Ethernet+ packets use a streamlined format optimized for HPC:\n00059| \n00060| ```\n00061| ┌─────────────────────────────────────────────────────────────────────────────┐\n00062| │                        UE+ Packet Structure                                  │\n00063| ├─────────────────────────────────────────────────────────────────────────────┤\n00064| │  UE+ L2 Header (12 bytes)                                                   │\n00065| │  ├── L2 Type (2 bits) = 0b10                                                │\n00066| │  ├── Version (1 bit)                                                        │\n00067| │  ├── Routing Flags (4 bits)                                                 │\n00068| │  ├── Length (9 bits)                                                        │\n00069| │  ├── Routing Class (4 bits)                                                 │\n00070| │  ├── Service Class (4 bits)                                                 │\n00071| │  ├── Hop Count (8 bits)                                                     │\n00072| │  ├── Dest LID (16 bits)                                                     │\n00073| │  ├── Entropy (16 bits)                                                      │\n00074| │  ├── Source LID (16 bits)                                                   │\n00075| │  └── Payload Type (16 bits)                                                 │\n00076| ├─────────────────────────────────────────────────────────────────────────────┤\n00077| │  PDS Header (variable, 2-32 bytes)                                          │\n00078| │  ├── PDS Prologue (2 bytes)                                                 │\n00079| │  │   ├── PDS Type (5 bits)                                                  │\n00080| │  │   ├── Next Header / Ctl Type (4 bits)                                    │\n00081| │  │   └── Flags (7 bits)                                                     │\n00082| │  └── Type-specific fields (0-30 bytes)                                      │\n00083| ├─────────────────────────────────────────────────────────────────────────────┤\n00084| │  SES Header (variable, 8-64 bytes)                                          │\n00085| │  ├── Opcode (6 bits)                                                        │\n00086| │  ├── Flags                                                                  │\n00087| │  ├── Message ID                                                             │\n00088| │  ├── Tag (for tagged operations)                                            │\n00089| │  └── Operation-specific fields                                              │\n00090| ├─────────────────────────────────────────────────────────────────────────────┤\n00091| │  Payload (0 - MTU bytes)                                                    │\n00092| ├─────────────────────────────────────────────────────────────────────────────┤\n00093| │  ICRC (4 bytes) - Invariant CRC                                             │\n00094| └─────────────────────────────────────────────────────────────────────────────┘\n00095| ```\n00096| \n00097| > **Canonical Definition**: See `datamodel/cornelis/link/ue_plus.ksy`\n00098| \n00099| ### 5.3.2 UE+ L2 Header\n00100| \n00101| The UE+ L2 header is 12 bytes, significantly smaller than standard Ethernet (14 bytes)\n00102| plus IP (20-40 bytes) plus UDP (8 bytes):\n00103| \n00104| | Field | Bits | Description |\n00105| |-------|------|-------------|\n00106| | **L2 Type** | 2 | Always 0b10 for UE+ |\n00107| | **Version** | 1 | Protocol version |\n00108| | **zyxm** | 4 | Routing control flags |\n00109| | **Length** | 9 | Packet length |\n00110| | **RC** | 4 | Routing Class |\n00111| | **SC** | 4 | Service Class |\n00112| | **Hop** | 8 | Hop count (TTL) |\n00113| | **Dest LID** | 16 | Destination endpoint |\n00114| | **Entropy** | 16 | ECMP hash |\n00115| | **Source LID** | 16 | Source endpoint |\n00116| | **Type** | 16 | Payload type |\n00117| \n00118| **Header Efficiency Comparison**:\n00119| \n00120| | Protocol | L2 + Network Headers | Savings vs Ethernet |\n00121| |----------|---------------------|---------------------|\n00122| | **UE+** | 12 bytes | — |\n00123| | **Ethernet + IPv4** | 34 bytes | 22 bytes (65%) |\n00124| | **Ethernet + IPv6** | 54 bytes | 42 bytes (78%) |\n00125| | **Standard UE over IPv4** | 58+ bytes | 46+ bytes (79%) |\n00126| \n00127| ---\n00128| \n00129| ## 5.4 UE Transport Layer (UET)\n00130| \n00131| The Ultra Ethernet Transport layer consists of three sublayers:\n00132| \n00133| ### 5.4.1 PDS (Packet Delivery Sublayer)\n00134| \n00135| PDS provides reliability and delivery mode selection:\n00136| \n00137| | PDS Type | Value | Description |\n00138| |----------|-------|-------------|\n00139| | Reserved | 0 | Reserved |\n00140| | TSS | 1 | Transport Security (encryption) |\n00141| | RUD Request | 2 | Reliable Unordered Delivery |\n00142| | ROD Request | 3 | Reliable Ordered Delivery |\n00143| | RUDI Request | 4 | Reliable Unordered Immediate |\n00144| | RUDI Response | 5 | RUDI response |\n00145| | UUD Request | 6 | Unreliable Unordered Delivery |\n00146| | ACK | 7 | Acknowledgment |\n00147| | ACK_CC | 8 | ACK with congestion control |\n00148| | ACK_CCX | 9 | ACK with extended CC |\n00149| | NACK | 10 | Negative acknowledgment |\n00150| | CP | 11 | Control packet |\n00151| | NACK_CCX | 12 | NACK with extended CC |\n00152| | RUD_CC_REQ | 13 | RUD with CC state |\n00153| | ROD_CC_REQ | 14 | ROD with CC state |\n00154| \n00155| > **Canonical Definition**: See `datamodel/ue/transport/pds/prologue.ksy`\n00156| \n00157| ### 5.4.2 SES (Semantic Sublayer)\n00158| \n00159| SES defines the operation semantics:\n00160| \n00161| **Request Opcodes** (from `datamodel/ue/transport/ses/opcodes.ksy`):\n00162| \n00163| | Opcode | Value | Description |\n00164| |--------|-------|-------------|\n00165| | Tagged Send | 0x00 | Send with tag matching |\n00166| | RMA Write | 0x01 | Remote memory write |\n00167| | RMA Read | 0x02 | Remote memory read |\n00168| | Atomic Write | 0x03 | Atomic memory write |\n00169| | Atomic Read | 0x04 | Atomic memory read |\n00170| | Atomic CAS | 0x05 | Compare-and-swap |\n00171| | Deferrable Send | 0x06 | Deferrable send |\n00172| | Ready to Restart | 0x07 | Restart notification |\n00173| | Small Message | 0x08 | Small message (32B header) |\n00174| | Small RMA Write | 0x09 | Small RMA write |\n00175| | Small RMA Read | 0x0A | Small RMA read |\n00176| | Small Atomic Write | 0x0B | Small atomic write |\n00177| | Small Atomic Read | 0x0C | Small atomic read |\n00178| | Small Atomic CAS | 0x0D | Small atomic CAS |\n00179| \n00180| **Response Opcodes**:\n00181| \n00182| | Opcode | Value | Description |\n00183| |--------|-------|-------------|\n00184| | Response | 0x00 | Standard response |\n00185| | Response with Data | 0x01 | Response carrying data |\n00186| | Optimized Response | 0x02 | Optimized format |\n00187| | NACK | 0x03 | Negative acknowledgment |\n00188| \n00189| ### 5.4.3 CMS (Congestion Management Sublayer)\n00190| \n00191| CMS provides congestion control state in ACK/NACK packets:\n00192| \n00193| | CMS Field | Description |\n00194| |-----------|-------------|\n00195| | CC State | Congestion control algorithm state |\n00196| | Credit | Flow control credits |\n00197| | Rate | Transmission rate feedback |\n00198| \n00199| > **Canonical Definition**: See `datamodel/ue/transport/cms/`\n00200| \n00201| ---\n00202| \n00203| ## 5.5 RoCEv2 Packet Format\n00204| \n00205| ### 5.5.1 RoCEv2 Packet Structure\n00206| \n00207| RoCEv2 packets use standard Ethernet/IP/UDP encapsulation:\n00208| \n00209| ```\n00210| ┌─────────────────────────────────────────────────────────────────────────────┐\n00211| │                        RoCEv2 Packet Structure                               │\n00212| ├─────────────────────────────────────────────────────────────────────────────┤\n00213| │  Ethernet II Header (14 bytes)                                              │\n00214| │  ├── Dest MAC (6 bytes)                                                     │\n00215| │  ├── Source MAC (6 bytes)                                                   │\n00216| │  └── EtherType (2 bytes) = 0x0800 (IPv4) or 0x86DD (IPv6)                  │\n00217| ├─────────────────────────────────────────────────────────────────────────────┤\n00218| │  IP Header (20 bytes IPv4 / 40 bytes IPv6)                                  │\n00219| │  ├── Version, IHL, DSCP, ECN                                                │\n00220| │  ├── Total Length                                                           │\n00221| │  ├── Identification, Flags, Fragment Offset                                 │\n00222| │  ├── TTL, Protocol (= 17 UDP)                                               │\n00223| │  ├── Header Checksum                                                        │\n00224| │  ├── Source IP                                                              │\n00225| │  └── Dest IP                                                                │\n00226| ├─────────────────────────────────────────────────────────────────────────────┤\n00227| │  UDP Header (8 bytes)                                                       │\n00228| │  ├── Source Port (entropy)                                                  │\n00229| │  ├── Dest Port (= 4791 RoCEv2)                                              │\n00230| │  ├── Length                                                                 │\n00231| │  └── Checksum                                                               │\n00232| ├─────────────────────────────────────────────────────────────────────────────┤\n00233| │  BTH - Base Transport Header (12 bytes)                                     │\n00234| │  ├── Opcode (8 bits)                                                        │\n00235| │  ├── Flags (SE, M, Pad, TVer, P-Key)                                        │\n00236| │  ├── Dest QP (24 bits)                                                      │\n00237| │  ├── A, Reserved                                                            │\n00238| │  └── PSN (24 bits)                                                          │\n00239| ├─────────────────────────────────────────────────────────────────────────────┤\n00240| │  Extended Headers (optional, operation-dependent)                           │\n00241| │  ├── RETH - RDMA Extended Header (16 bytes)                                 │\n00242| │  ├── AETH - ACK Extended Header (4 bytes)                                   │\n00243| │  ├── AtomicETH - Atomic Extended Header (28 bytes)                          │\n00244| │  └── ImmDt - Immediate Data (4 bytes)                                       │\n00245| ├─────────────────────────────────────────────────────────────────────────────┤\n00246| │  Payload (0 - MTU bytes)                                                    │\n00247| ├─────────────────────────────────────────────────────────────────────────────┤\n00248| │  ICRC (4 bytes) - Invariant CRC                                             │\n00249| └─────────────────────────────────────────────────────────────────────────────┘\n00250| ```\n00251| \n00252| > **Canonical Definition**: See `datamodel/rdma/transport/bth.ksy` and related files\n00253| \n00254| ### 5.5.2 BTH (Base Transport Header)\n00255| \n00256| | Field | Bits | Description |\n00257| |-------|------|-------------|\n00258| | **Opcode** | 8 | Operation type |\n00259| | **SE** | 1 | Solicited Event |\n00260| | **M** | 1 | Migration state |\n00261| | **Pad** | 2 | Padding bytes |\n00262| | **TVer** | 4 | Transport version |\n00263| | **P-Key** | 16 | Partition key |\n00264| | **Dest QP** | 24 | Destination Queue Pair |\n00265| | **A** | 1 | ACK request |\n00266| | **PSN** | 24 | Packet Sequence Number |\n00267| \n00268| ---\n00269| \n00270| ## 5.6 Standard Ethernet Packet Format\n00271| \n00272| ### 5.6.1 Ethernet II Frame\n00273| \n00274| ```\n00275| ┌─────────────────────────────────────────────────────────────────────────────┐\n00276| │                        Ethernet II Frame                                     │\n00277| ├─────────────────────────────────────────────────────────────────────────────┤\n00278| │  Preamble (7 bytes) + SFD (1 byte)  [not visible to software]               │\n00279| ├─────────────────────────────────────────────────────────────────────────────┤\n00280| │  Ethernet Header (14 bytes)                                                 │\n00281| │  ├── Dest MAC (6 bytes)                                                     │\n00282| │  ├── Source MAC (6 bytes)                                                   │\n00283| │  └── EtherType (2 bytes)                                                    │\n00284| ├─────────────────────────────────────────────────────────────────────────────┤\n00285| │  Optional VLAN Tag (4 bytes) - 802.1Q                                       │\n00286| │  ├── TPID (2 bytes) = 0x8100                                                │\n00287| │  └── TCI (2 bytes) = PCP + DEI + VID                                        │\n00288| ├─────────────────────────────────────────────────────────────────────────────┤\n00289| │  Payload (46-1500 bytes, or up to 9000 for jumbo frames)                    │\n00290| ├─────────────────────────────────────────────────────────────────────────────┤\n00291| │  FCS (4 bytes) - Frame Check Sequence                                       │\n00292| └─────────────────────────────────────────────────────────────────────────────┘\n00293| ```\n00294| \n00295| > **Canonical Definition**: See `datamodel/ethernet/link/ethernet_ii.ksy`\n00296| \n00297| ---\n00298| \n00299| ## 5.7 Cornelis Proprietary Formats\n00300| \n00301| ### 5.7.1 Collective L2 Header\n00302| \n00303| For collective operations, PMR uses a specialized L2 format:\n00304| \n00305| > **Canonical Definition**: See `datamodel/cornelis/network/collective_l2.ksy`\n00306| \n00307| ### 5.7.2 Scale-Up L2 Header\n00308| \n00309| For scale-up deployments with minimal overhead:\n00310| \n00311| > **Canonical Definition**: See `datamodel/cornelis/network/scaleup_l2.ksy`\n00312| \n00313| ### 5.7.3 VxLAN+ Encapsulation\n00314| \n00315| Extended VxLAN for fabric overlay:\n00316| \n00317| > **Canonical Definition**: See `datamodel/cornelis/encapsulation/vxlan_plus.ksy`\n00318| \n00319| ---\n00320| \n00321| ## 5.8 Link Layer Features\n00322| \n00323| ### 5.8.1 LLR (Link-Level Retry)\n00324| \n00325| Ultra Ethernet requires Link-Level Retry for lossless delivery:\n00326| \n00327| | LLR Packet | Description |\n00328| |------------|-------------|\n00329| | LLR Init | Initialize LLR session |\n00330| | LLR Init Echo | Acknowledge LLR init |\n00331| | LLR ACK | Acknowledge received frames |\n00332| | LLR NACK | Request retransmission |\n00333| \n00334| > **Canonical Definition**: See `datamodel/ue/link/llr/`\n00335| \n00336| ### 5.8.2 CBFC (Credit-Based Flow Control)\n00337| \n00338| Credit-based flow control for lossless operation:\n00339| \n00340| | CBFC Message | Description |\n00341| |--------------|-------------|\n00342| | CC Update | Credit count update |\n00343| | CF Update | Credit flow update |\n00344| \n00345| > **Canonical Definition**: See `datamodel/ue/link/cbfc/`\n00346| \n00347| ---\n00348| \n00349| ## 5.9 Packet Size Considerations\n00350| \n00351| ### 5.9.1 MTU\n00352| \n00353| | Protocol | Typical MTU | Maximum |\n00354| |----------|-------------|---------|\n00355| | **UE+** | 4096 bytes | 9216 bytes |\n00356| | **RoCEv2** | 4096 bytes | 9000 bytes |\n00357| | **Ethernet** | 1500 bytes | 9000 bytes (jumbo) |\n00358| \n00359| ### 5.9.2 Header Overhead Summary\n00360| \n00361| | Protocol Stack | Total Headers | Efficiency (4KB payload) |\n00362| |----------------|---------------|--------------------------|\n00363| | **UE+ (small msg)** | ~20 bytes | 99.5% |\n00364| | **UE+ (standard)** | ~40 bytes | 99.0% |\n00365| | **RoCEv2 (IPv4)** | ~58 bytes | 98.6% |\n00366| | **RoCEv2 (IPv6)** | ~78 bytes | 98.1% |\n00367| | **TCP/IPv4** | ~54 bytes | 98.7% |\n00368| \n00369| ---\n00370| \n00371| ## References\n00372| \n00373| - **Internal**: [Chapter 4: Addressing and Routing](04-addressing.md)\n00374| - **Internal**: [Chapter 6: Programming Model](06-programming-model.md)\n00375| - **Datamodel**: `datamodel/ue/README.md` - Complete UE taxonomy\n00376| - **Datamodel**: `datamodel/cornelis/` - Cornelis proprietary formats\n00377| - **External**: [Ultra Ethernet Specification v1.0.1](https://ultraethernet.org/)\n00378| - **External**: [InfiniBand Architecture Specification](https://www.infinibandta.org/)\n00379| \n00380| \n00381| \n\n(End of file - total 381 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/docs/HAS/PMR/05-packet-formats.md",
            "metadata": {
              "preview": "# Chapter 5: Packet Formats\n\n## 5.1 Introduction\n\nThis chapter describes the packet formats used by PMR for fabric communication.\nPMR supports multiple protocol stacks, each with its own packet format hierarchy.\n\n> **Canonical Reference**: All packet formats are defined in the datamodel:\n> - `datamodel/ue/` - Ultra Ethernet protocol formats (60+ packet types)\n> - `datamodel/cornelis/` - Cornelis proprietary formats (UE+, UFH, HSI)\n> - `datamodel/ethernet/` - Standard Ethernet formats\n> - `datamodel/rdma/` - RoCEv2/IB transport formats\n>\n> This chapter provides an overview; the datamodel `.ksy` files are authoritative.\n> Datamodel locations may change in the future.\n\n---\n\n## 5.2 Protocol Stack Overview\n",
              "truncated": false
            },
            "time": {
              "start": 1769121956603,
              "end": 1769121956642,
              "compacted": 1769123003285
            }
          }
        },
        {
          "id": "prt_be7e2c2fd001u73DAdxTufdmvy",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e2a900001a7f7BD3jn5CKpp",
          "type": "tool",
          "callID": "toolu_018VMywiX31YD2V5fZoZjgY9",
          "tool": "glob",
          "state": {
            "status": "completed",
            "input": {
              "pattern": "earlysim/datamodel/protocols/ue/**/*.ksy"
            },
            "output": "Found 96 file(s)\n\n./earlysim/datamodel/protocols/ue/link/llr/protocols/llr_transmit_sm.ksy\n./earlysim/datamodel/protocols/ue/link/llr/protocols/ack_nack_transmit_sm.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/protocols/ccc_state_machine.ksy\n./earlysim/datamodel/protocols/ue/transport/tss/security_header.ksy\n./earlysim/datamodel/protocols/ue/transport/tss/iv_construction.ksy\n./earlysim/datamodel/protocols/ue/transport/tss/protocols/tss_rx_processing.ksy\n./earlysim/datamodel/protocols/ue/transport/tss/protocols/kdf_client_server.ksy\n./earlysim/datamodel/protocols/ue/transport/tss/protocols/key_rotation.ksy\n./earlysim/datamodel/protocols/ue/transport/tss/protocols/tss_tx_processing.ksy\n./earlysim/datamodel/protocols/ue/transport/tss/protocols/kdf_direct.ksy\n./earlysim/datamodel/protocols/ue/transport/tss/protocols/kdf_cluster.ksy\n./earlysim/datamodel/protocols/ue/transport/tss/protocols/join_secure_domain.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/sequences/rendezvous_unexpected.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/sequences/read_large_ack.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/sequences/multi_packet_request.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/sequences/deferrable_unexpected.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/sequences/rendezvous_expected.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/sequences/deferrable_expected.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/sequences/single_packet_request.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/sequences/read_standard.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/sequences/buffered_messages.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/sequences/deferrable_no_buffer.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/standard_request_som1.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/small_message.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/small_rma.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/standard_request_som0.ksy\n./earlysim/datamodel/protocols/ue/link/cbfc/cf_update.ksy\n./earlysim/datamodel/protocols/ue/link/cbfc/protocols/lossless_vc_init.ksy\n./earlysim/datamodel/protocols/ue/link/cbfc/protocols/vc_state_machine.ksy\n./earlysim/datamodel/protocols/ue/link/cbfc/protocols/lossless_vc_removal.ksy\n./earlysim/datamodel/protocols/ue/link/cbfc/cc_update.ksy\n./earlysim/datamodel/protocols/ue/link/lldp/ue_link_negotiation_tlv.ksy\n./earlysim/datamodel/protocols/ue/link/lldp/ue_cbfc_tlv.ksy\n./earlysim/datamodel/protocols/ue/link/llr/llr_preamble_64b66b.ksy\n./earlysim/datamodel/protocols/ue/link/llr/llr_nack_ctlos.ksy\n./earlysim/datamodel/protocols/ue/link/llr/llr_init_echo_ctlos.ksy\n./earlysim/datamodel/protocols/ue/link/llr/llr_preamble_mii.ksy\n./earlysim/datamodel/protocols/ue/link/llr/llr_init_ctlos.ksy\n./earlysim/datamodel/protocols/ue/link/llr/llr_ack_ctlos.ksy\n./earlysim/datamodel/protocols/ue/link/llr/protocols/llr_receive.ksy\n./earlysim/datamodel/protocols/ue/physical/control_ordered_sets.ksy\n./earlysim/datamodel/protocols/ue/network/dscp_categories.ksy\n./earlysim/datamodel/protocols/ue/network/packet_trimming.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/credit_request_cp_payload.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/req_cc_state.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/credit_cp_payload.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/ack_cc_state_rccc_tfc.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/ack_cc_state_nscc.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/protocols/rccc_destination.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/protocols/tfc_destination.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/protocols/tfc_source.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/protocols/rccc_source.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/protocols/nscc_destination.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/protocols/nscc_source.ksy\n./earlysim/datamodel/protocols/ue/transport/cms/protocols/multipath_selection.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/prologue.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/ack_ccx.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/rud_rod_request.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/nack_ccx.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/nack.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/entropy_header.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/rud_rod_request_cc.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/rud_rod_cp.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/rud_rod_ack.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/ack_cc.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/rudi_request_response.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/uud_request.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/rud_rod_default_ses.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/protocols/rud_delivery.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/protocols/pdc_close.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/protocols/pdc_establishment.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/protocols/loss_detection_tail.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/protocols/loss_detection_ooo.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/protocols/rod_delivery.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/protocols/loss_detection_nack.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/protocols/pds_manager.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/protocols/pdc_initiator.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/protocols/loss_detection_ev.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/protocols/loss_detection_receiver.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/protocols/pdc_target.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/protocols/loss_detection_rto.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/protocols/loss_detection_cack_sack.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/protocols/rudi_delivery.ksy\n./earlysim/datamodel/protocols/ue/transport/pds/protocols/loss_detection_trimming.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/optimized_response_with_data.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/ready_to_restart.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/response_with_data.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/atomic_extension.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/opcodes.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/response.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/sequences/backoff_retry.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/sequences/buffered_headers.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/cas_extension.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/deferrable_send_request.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/rendezvous_extension.ksy\n./earlysim/datamodel/protocols/ue/transport/ses/optimized_non_matching.ksy\n[Agent Usage Reminder]\n\nYou called a search/fetch tool directly without leveraging specialized agents.\n\nRECOMMENDED: Use background_task with explore/librarian agents for better results:\n\n```\n// Parallel exploration - fire multiple agents simultaneously\nbackground_task(agent=\"explore\", prompt=\"Find all files matching pattern X\")\nbackground_task(agent=\"explore\", prompt=\"Search for implementation of Y\") \nbackground_task(agent=\"librarian\", prompt=\"Lookup documentation for Z\")\n\n// Then continue your work while they run in background\n// System will notify you when each completes\n```\n\nWHY:\n- Agents can perform deeper, more thorough searches\n- Background tasks run in parallel, saving time\n- Specialized agents have domain expertise\n- Reduces context window usage in main session\n\nALWAYS prefer: Multiple parallel background_task calls > Direct tool calls\n",
            "title": "",
            "metadata": {
              "truncated": false
            },
            "time": {
              "start": 1769121956606,
              "end": 1769121956695,
              "compacted": 1769123003284
            }
          }
        },
        {
          "id": "prt_be7e2c358001FYZxbZSOf3OX7T",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e2a900001a7f7BD3jn5CKpp",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 24462,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7e2c373001GsR01aV196HVXF",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769121956723,
          "completed": 1769121969142
        },
        "parentID": "msg_be7e28b86001U2bxAs52hRVDKW",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Planner-Sisyphus",
        "agent": "Planner-Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 33647,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7e2c731001F8dEJakQpveFq4",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e2c373001GsR01aV196HVXF",
          "type": "step-start"
        },
        {
          "id": "prt_be7e2f3ca001KaR76qILWGytje",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e2c373001GsR01aV196HVXF",
          "type": "tool",
          "callID": "toolu_01PFHcUZUHJGeSgUzZXG2T2p",
          "tool": "todowrite",
          "state": {
            "status": "completed",
            "input": {
              "todos": [
                {
                  "id": "1",
                  "content": "Identify packet formats not expanded in packet_taxonomy.md",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "2",
                  "content": "Read and analyze UE transport layer .ksy files (PDS, SES, CMS, TSS)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "3",
                  "content": "Read and analyze Cornelis proprietary .ksy files (CSIG+, VxLAN+, collective_l2, scaleup_l2)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "4",
                  "content": "Read and analyze RoCEv2 extended header .ksy files",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "5",
                  "content": "Read and analyze HSI .ksy files (event_notification, sgl_entry, etc.)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "6",
                  "content": "Read and analyze UE link layer .ksy files (LLR, CBFC, LLDP)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "7",
                  "content": "Compare datamodel against HAS specifications for discrepancies",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "8",
                  "content": "Draft expanded packet format sections for packet_taxonomy.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "9",
                  "content": "Identify new work items for discrepancies",
                  "status": "pending",
                  "priority": "high"
                }
              ]
            },
            "output": "[\n  {\n    \"id\": \"1\",\n    \"content\": \"Identify packet formats not expanded in packet_taxonomy.md\",\n    \"status\": \"in_progress\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"2\",\n    \"content\": \"Read and analyze UE transport layer .ksy files (PDS, SES, CMS, TSS)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"3\",\n    \"content\": \"Read and analyze Cornelis proprietary .ksy files (CSIG+, VxLAN+, collective_l2, scaleup_l2)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"4\",\n    \"content\": \"Read and analyze RoCEv2 extended header .ksy files\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"5\",\n    \"content\": \"Read and analyze HSI .ksy files (event_notification, sgl_entry, etc.)\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"6\",\n    \"content\": \"Read and analyze UE link layer .ksy files (LLR, CBFC, LLDP)\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"7\",\n    \"content\": \"Compare datamodel against HAS specifications for discrepancies\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"8\",\n    \"content\": \"Draft expanded packet format sections for packet_taxonomy.md\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"9\",\n    \"content\": \"Identify new work items for discrepancies\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  }\n]",
            "title": "9 todos",
            "metadata": {
              "todos": [
                {
                  "id": "1",
                  "content": "Identify packet formats not expanded in packet_taxonomy.md",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "2",
                  "content": "Read and analyze UE transport layer .ksy files (PDS, SES, CMS, TSS)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "3",
                  "content": "Read and analyze Cornelis proprietary .ksy files (CSIG+, VxLAN+, collective_l2, scaleup_l2)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "4",
                  "content": "Read and analyze RoCEv2 extended header .ksy files",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "5",
                  "content": "Read and analyze HSI .ksy files (event_notification, sgl_entry, etc.)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "6",
                  "content": "Read and analyze UE link layer .ksy files (LLR, CBFC, LLDP)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "7",
                  "content": "Compare datamodel against HAS specifications for discrepancies",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "8",
                  "content": "Draft expanded packet format sections for packet_taxonomy.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "9",
                  "content": "Identify new work items for discrepancies",
                  "status": "pending",
                  "priority": "high"
                }
              ],
              "truncated": false
            },
            "time": {
              "start": 1769121969102,
              "end": 1769121969131,
              "compacted": 1769123003284
            }
          }
        },
        {
          "id": "prt_be7e2f3f4001s8UwmlyaBF8j6H",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e2c373001GsR01aV196HVXF",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 33647,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7e2f40a001LkIP271axYAz9D",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769121969162,
          "completed": 1769121988285
        },
        "parentID": "msg_be7e28b86001U2bxAs52hRVDKW",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Planner-Sisyphus",
        "agent": "Planner-Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 34110,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7e2f78f0011rjtIFbHRa8Hk9",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e2f40a001LkIP271axYAz9D",
          "type": "step-start"
        },
        {
          "id": "prt_be7e33e47001XrOUtPvSqJTo0J",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e2f40a001LkIP271axYAz9D",
          "type": "tool",
          "callID": "toolu_014VybSG2hNTEAGz59BcEEQ8",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/rud_rod_request.ksy"
            },
            "output": "<file>\n00001| # GOLDEN REFERENCE: PDS RUD/ROD Request Header\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Table 3-33, Section 3.5.10.3, Page 256\n00004| #\n00005| # This is a GOLDEN REFERENCE definition for PDS (Packet Delivery Sublayer) headers.\n00006| # Demonstrates PDS packet format with delivery mode flags, sequence numbers, and\n00007| # PDC (Packet Delivery Context) identifiers.\n00008| #\n00009| # Quality Standards Applied:\n00010| # 1. Every field extracted with exact bit position from Table 3-33\n00011| # 2. All fields have x-required metadata\n00012| # 3. Complete x-spec metadata for traceability\n00013| # 4. All constraints captured (reserved bits, flag meanings, field overloading)\n00014| # 5. Byte-level layout matches UE Spec exactly (12 bytes total)\n00015| # 6. Field overloading documented (dpdcid vs pdc_info/psn_offset)\n00016| #\n00017| # Leverages Cornelis IP: OPA packet format rigor, PDS reliability patterns\n00018| \n00019| meta:\n00020|   id: pds_rud_rod_request\n00021|   title: PDS RUD/ROD Request Header\n00022|   endian: be\n00023|   bit-endian: be\n00024|   doc: |\n00025|     Ultra Ethernet Packet Delivery Sublayer (PDS) Request Header for\n00026|     RUD (Reliable Unordered Delivery) and ROD (Reliable Ordered Delivery) modes.\n00027|     \n00028|     This 12-byte header provides packet delivery context, sequence numbers,\n00029|     and delivery mode flags. It sits between the UET Entropy Header/PDS Prologue\n00030|     and the SES (Semantic) header.\n00031|     \n00032|     Total Size: 12 bytes (96 bits)\n00033|     \n00034|     Wire Format (bytes 0-11):\n00035|     - Byte 0-1: Type, next_hdr, flags (16 bits)\n00036|     - Byte 2-3: Clear PSN Offset (16 bits)\n00037|     - Byte 4-7: PSN (Packet Sequence Number) (32 bits)\n00038|     - Byte 8-9: Source PDCID (16 bits)\n00039|     - Byte 10-11: Destination PDCID or {pdc_info, psn_offset} (16 bits, overloaded)\n00040|   \n00041|   doc-ref:\n00042|     - \"UE Specification v1.0.1, Table 3-33, Page 256\"\n00043|     - \"UE Specification v1.0.1, Section 3.5.10.3 (RUD/ROD Request)\"\n00044|     - \"UE Specification v1.0.1, Figure 3-52 (RUD/ROD Request Header Format)\"\n00045|   \n00046|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00047|   ks-version: \"0.10\"\n00048| \n00049| x-spec:\n00050|   table: \"Table 3-33\"\n00051|   section: \"Section 3.5.10.3\"\n00052|   page: 256\n00053|   figure: \"Figure 3-52\"\n00054|   spec_version: \"1.0.1\"\n00055|   spec_date: \"2025-09-05\"\n00056| \n00057| x-packet:\n00058|   layer: \"transport\"\n00059|   sublayer: \"pds\"\n00060|   category: \"request_header\"\n00061|   delivery_modes: [\"RUD\", \"ROD\"]\n00062|   size_bytes: 12\n00063|   size_bits: 96\n00064|   \n00065|   constraints:\n00066|     - \"Reserved fields MUST be 0\"\n00067|     - \"type MUST be ROD Request or RUD Request\"\n00068|     - \"next_hdr identifies SES semantic type per Section 3.4.2.6\"\n00069|     - \"Last 16 bits overloaded: dpdcid when syn=0, {pdc_info, psn_offset} when syn=1\"\n00070| \n00071| seq:\n00072|   # Byte 0-1: Type, Next Header, Flags (16 bits total)\n00073|   # Bit layout: type(5) | next_hdr(4) | flags(7)\n00074|   \n00075|   - id: type\n00076|     type: b5\n00077|     enum: pds_type_enum\n00078|     doc: |\n00079|       Packet Type (5 bits). Identifies this as ROD Request or RUD Request.\n00080|       \n00081|       Values:\n00082|       - ROD Request: Reliable Ordered Delivery\n00083|       - RUD Request: Reliable Unordered Delivery\n00084|       \n00085|       UE Spec: Table 3-33, field 'type'\n00086|     x-required: true\n00087|     x-constraint: \"ROD Request or RUD Request\"\n00088|     x-spec-ref: \"Table 3-33, field 'type'\"\n00089|   \n00090|   - id: next_hdr\n00091|     type: b4\n00092|     enum: next_hdr_enum\n00093|     doc: |\n00094|       Next Header (4 bits). Encoding identifying UET Semantic type.\n00095|       Indicates the type of SES header that follows this PDS header.\n00096|       \n00097|       Refer to SES Section 3.4.2.6 and Table 3-16 for next header enumeration.\n00098|       \n00099|       UE Spec: Table 3-33, field 'next_hdr'; Section 3.4.2.6; Table 3-16\n00100|     x-required: true\n00101|     x-constraint: \"Valid next_hdr value per Table 3-16\"\n00102|     x-spec-ref: \"Table 3-33, field 'next_hdr'; Section 3.4.2.6; Table 3-16\"\n00103|   \n00104|   # Flags (7 bits): rsvd(2) | retx(1) | ar(1) | syn(1) | rsvd(2)\n00105|   \n00106|   - id: flags_rsvd_high\n00107|     type: b2\n00108|     doc: |\n00109|       Reserved bits (2 bits, high). MUST be 0.\n00110|       UE Spec: Table 3-33, pds.flags[6:5] reserved.\n00111|     x-required: true\n00112|     x-constraint: \"value == 0\"\n00113|     x-spec-ref: \"Table 3-33, field 'flags.rsvd'\"\n00114|   \n00115|   - id: flags_retx\n00116|     type: b1\n00117|     doc: |\n00118|       Retransmit flag (1 bit). When set to 1, indicates this packet is a retransmit.\n00119|       \n00120|       Retransmitted packets are handled specially for loss detection and\n00121|       congestion control purposes.\n00122|       \n00123|       UE Spec: Table 3-33, pds.flags.retx; Section 3.5.11.8.4\n00124|     x-required: true\n00125|     x-spec-ref: \"Table 3-33, field 'flags.retx'; Section 3.5.11.8.4\"\n00126|   \n00127|   - id: flags_ar\n00128|     type: b1\n00129|     doc: |\n00130|       ACK Request flag (1 bit). When set to 1, an ACK is requested to be sent\n00131|       for this packet.\n00132|       \n00133|       Used to trigger ACK generation at the receiver for flow control and\n00134|       reliability purposes.\n00135|       \n00136|       UE Spec: Table 3-33, pds.flags.ar; Section 3.5.12.2\n00137|     x-required: true\n00138|     x-spec-ref: \"Table 3-33, field 'flags.ar'; Section 3.5.12.2\"\n00139|   \n00140|   - id: flags_syn\n00141|     type: b1\n00142|     doc: |\n00143|       SYN flag (1 bit). When set to 1, indicates PDC (Packet Delivery Context)\n00144|       establishment request.\n00145|       \n00146|       When syn=1, the last 16 bits of the header are interpreted as\n00147|       {pdc_info, psn_offset} instead of dpdcid.\n00148|       \n00149|       UE Spec: Table 3-33, pds.flags.syn; Section 3.5.8.2\n00150|     x-required: true\n00151|     x-spec-ref: \"Table 3-33, field 'flags.syn'; Section 3.5.8.2\"\n00152|   \n00153|   - id: flags_rsvd_low\n00154|     type: b2\n00155|     doc: |\n00156|       Reserved bits (2 bits, low). MUST be 0.\n00157|       UE Spec: Table 3-33, pds.flags[1:0] reserved.\n00158|     x-required: true\n00159|     x-constraint: \"value == 0\"\n00160|     x-spec-ref: \"Table 3-33, field 'flags.rsvd'\"\n00161|   \n00162|   # Byte 2-3: Clear PSN Offset (16 bits)\n00163|   \n00164|   - id: clear_psn_offset\n00165|     type: u2\n00166|     doc: |\n00167|       Clear PSN Offset (16 bits). Encoding of CLEAR_PSN relative to PSN.\n00168|       \n00169|       This field is a sequence number used to acknowledge reception of PDS ACKs.\n00170|       It indicates which ACKs have been received and processed by the sender.\n00171|       \n00172|       UE Spec: Table 3-33, field 'clear_psn_offset'\n00173|     x-required: true\n00174|     x-spec-ref: \"Table 3-33, field 'clear_psn_offset'\"\n00175|   \n00176|   # Byte 4-7: PSN (32 bits)\n00177|   \n00178|   - id: psn\n00179|     type: u4\n00180|     doc: |\n00181|       Packet Sequence Number (32 bits). Sequence number assigned to this PDS Request.\n00182|       \n00183|       PSN is used for:\n00184|       - Ordering (ROD mode)\n00185|       - Loss detection\n00186|       - ACK/NACK generation\n00187|       - Duplicate detection\n00188|       \n00189|       PSN wraps at 2^32.\n00190|       \n00191|       UE Spec: Table 3-33, field 'psn'\n00192|     x-required: true\n00193|     x-spec-ref: \"Table 3-33, field 'psn'\"\n00194|   \n00195|   # Byte 8-9: Source PDCID (16 bits)\n00196|   \n00197|   - id: spdcid\n00198|     type: u2\n00199|     doc: |\n00200|       Source PDCID (16 bits). Packet Delivery Context ID assigned by the FEP\n00201|       that is the source of the packet.\n00202|       \n00203|       PDCID identifies the delivery context for this packet stream.\n00204|       \n00205|       UE Spec: Table 3-33, field 'spdcid'\n00206|     x-required: true\n00207|     x-spec-ref: \"Table 3-33, field 'spdcid'\"\n00208|   \n00209|   # Byte 10-11: Destination PDCID or {pdc_info, psn_offset} (16 bits, OVERLOADED)\n00210|   # Interpretation depends on flags.syn value\n00211|   \n00212|   - id: dpdcid_or_pdc_info\n00213|     type: u2\n00214|     doc: |\n00215|       Destination PDCID or {pdc_info, psn_offset} (16 bits). OVERLOADED FIELD.\n00216|       \n00217|       Interpretation depends on pds.flags.syn:\n00218|       \n00219|       WHEN pds.flags.syn = 0 (normal operation):\n00220|         This field contains dpdcid (Destination PDCID, 16 bits).\n00221|         Destination PDCID assigned by FEP that is the destination of the packet.\n00222|       \n00223|       WHEN pds.flags.syn = 1 (PDC establishment):\n00224|         This field contains {pdc_info, psn_offset}:\n00225|         - pdc_info (4 bits, high): PDC information\n00226|           - Bit 0: use_rsv_pdc (1 = use PDC from reserved pool, 0 = global shared pool)\n00227|           - Bits 3:1: Reserved\n00228|         - psn_offset (12 bits, low): Numerical difference between PSN in this packet\n00229|           and Start_PSN on the PDC (refer to Section 3.5.8.2)\n00230|       \n00231|       UE Spec: Table 3-33, field 'dpdcid' or '{pdc_info, psn_offset}'; Section 3.5.8.2\n00232|     x-required: true\n00233|     x-spec-ref: \"Table 3-33, field 'dpdcid' or '{pdc_info, psn_offset}'; Section 3.5.8.2\"\n00234|     x-overloaded: true\n00235|     x-interpretation:\n00236|       - condition: \"flags.syn == 0\"\n00237|         meaning: \"dpdcid (Destination PDCID, 16 bits)\"\n00238|       - condition: \"flags.syn == 1\"\n00239|         meaning: \"{pdc_info (4 bits), psn_offset (12 bits)}\"\n00240| \n00241| enums:\n00242|   pds_type_enum:\n00243|     # PDS packet types (5-bit encoding)\n00244|     # Full enumeration would include all types from UE Spec\n00245|     0x01: rud_request\n00246|     0x02: rod_request\n00247|     0x03: rud_request_cc\n00248|     0x04: rod_request_cc\n00249|     0x05: rud_rod_ack\n00250|     0x06: ack_cc\n00251|     0x07: ack_ccx\n00252|     0x08: rud_rod_cp\n00253|     0x09: rudi_request\n00254|     0x0a: rudi_response\n00255|     0x0b: nack\n00256|     0x0c: nack_ccx\n00257|     0x0d: uud_request\n00258|   \n00259|   next_hdr_enum:\n00260|     # Next header enumeration (4-bit encoding)\n00261|     # From Table 3-16 (Next Header Enumeration)\n00262|     0x0: standard_header_som1\n00263|     0x1: standard_header_som0\n00264|     0x2: optimized_non_matching\n00265|     0x3: small_message_small_rma\n00266|     0x4: response\n00267|     0x5: response_with_data\n00268|     0x6: optimized_response_with_data\n00269|     # Additional values from Table 3-16\n00270| \n00271| # Validation Notes:\n00272| # \n00273| # 1. Total header size MUST be exactly 12 bytes (96 bits)\n00274| # 2. All reserved fields MUST be 0\n00275| # 3. type MUST be RUD Request or ROD Request\n00276| # 4. next_hdr MUST be valid per Table 3-16\n00277| # 5. Last 16 bits are OVERLOADED:\n00278| #    - When flags.syn = 0: dpdcid (16 bits)\n00279| #    - When flags.syn = 1: {pdc_info (4 bits), psn_offset (12 bits)}\n00280| # 6. Field dependencies:\n00281| #    - flags.syn determines interpretation of last 16 bits\n00282| #    - flags.ar triggers ACK generation at receiver\n00283| #    - flags.retx indicates retransmitted packet\n00284| #\n00285| # Reference: ue-taxonomy/reference/field_definitions/pds_rud_rod_request.yaml\n00286| \n\n(End of file - total 286 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/rud_rod_request.ksy",
            "metadata": {
              "preview": "# GOLDEN REFERENCE: PDS RUD/ROD Request Header\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Table 3-33, Section 3.5.10.3, Page 256\n#\n# This is a GOLDEN REFERENCE definition for PDS (Packet Delivery Sublayer) headers.\n# Demonstrates PDS packet format with delivery mode flags, sequence numbers, and\n# PDC (Packet Delivery Context) identifiers.\n#\n# Quality Standards Applied:\n# 1. Every field extracted with exact bit position from Table 3-33\n# 2. All fields have x-required metadata\n# 3. Complete x-spec metadata for traceability\n# 4. All constraints captured (reserved bits, flag meanings, field overloading)\n# 5. Byte-level layout matches UE Spec exactly (12 bytes total)\n# 6. Field overloading documented (dpdcid vs pdc_info/psn_offset)\n#\n# Leverages Cornelis IP: OPA packet format rigor, PDS reliability patterns\n\nmeta:\n  id: pds_rud_rod_request",
              "truncated": false
            },
            "time": {
              "start": 1769121988169,
              "end": 1769121988271,
              "compacted": 1769123003283
            }
          }
        },
        {
          "id": "prt_be7e33e4f001Gv2U78rjYkdgIj",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e2f40a001LkIP271axYAz9D",
          "type": "tool",
          "callID": "toolu_01RoigKP3HEwRYjczUz1Tb7Z",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/ack_cc.ksy"
            },
            "output": "<file>\n00001| # GOLDEN REFERENCE: PDS ACK_CC (ACK with Congestion Control State)\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Table 3-36, Section 3.5.10.6, Page 259\n00004| #\n00005| # This is a GOLDEN REFERENCE definition for PDS ACK with congestion control state.\n00006| # Demonstrates complex PDS packet with embedded CC state, SACK bitmap, and\n00007| # congestion management integration.\n00008| #\n00009| # Quality Standards Applied:\n00010| # 1. Every field extracted with exact bit position from Table 3-36\n00011| # 2. All fields have x-required metadata\n00012| # 3. Complete x-spec metadata for traceability\n00013| # 4. First 12 bytes identical to PDS ACK (Table 3-35) with type=ACK_CC\n00014| # 5. Additional 16 bytes for CC state, SACK bitmap, and CC parameters\n00015| # 6. Total 28 bytes matching UE Spec exactly\n00016| #\n00017| # Leverages Cornelis IP: OPA reliability + congestion control patterns\n00018| \n00019| meta:\n00020|   id: pds_ack_cc\n00021|   title: PDS ACK_CC (ACK with Congestion Control State)\n00022|   endian: be\n00023|   bit-endian: be\n00024|   doc: |\n00025|     Ultra Ethernet Packet Delivery Sublayer (PDS) ACK with Congestion Control State.\n00026|     \n00027|     This 28-byte header extends the basic PDS ACK (12 bytes) with congestion control\n00028|     state information for NSCC (Network Signal-based Congestion Control) and other\n00029|     CC algorithms. It includes SACK (Selective ACK) bitmap and CC state fields.\n00030|     \n00031|     Total Size: 28 bytes (224 bits)\n00032|     - First 12 bytes: Identical to PDS ACK (Table 3-35) with type=ACK_CC\n00033|     - Next 16 bytes: CC type, flags, MPR, SACK bitmap, CC state\n00034|     \n00035|     Wire Format (bytes 0-27):\n00036|     - Byte 0-11: PDS ACK header (type, next_hdr, flags, ack_psn_offset, probe_opaque, cack_psn, spdcid, dpdcid)\n00037|     - Byte 12: CC type and CC flags (8 bits)\n00038|     - Byte 13: MPR (Maximum PSN Range) (8 bits)\n00039|     - Byte 14-15: SACK PSN Offset (16 bits)\n00040|     - Byte 16-23: SACK Bitmap (64 bits)\n00041|     - Byte 24-27: ACK CC State (64 bits)\n00042|   \n00043|   doc-ref:\n00044|     - \"UE Specification v1.0.1, Table 3-36, Page 259\"\n00045|     - \"UE Specification v1.0.1, Section 3.5.10.6 (RUD/ROD ACK_CC)\"\n00046|     - \"UE Specification v1.0.1, Figure 3-55 (ACK_CC Format)\"\n00047|     - \"UE Specification v1.0.1, Section 3.6.9 (CMS CC State Definitions)\"\n00048|   \n00049|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00050|   ks-version: \"0.10\"\n00051| \n00052| x-spec:\n00053|   table: \"Table 3-36\"\n00054|   section: \"Section 3.5.10.6\"\n00055|   page: 259\n00056|   figure: \"Figure 3-55\"\n00057|   spec_version: \"1.0.1\"\n00058|   spec_date: \"2025-09-05\"\n00059| \n00060| x-packet:\n00061|   layer: \"transport\"\n00062|   sublayer: \"pds\"\n00063|   category: \"ack_header\"\n00064|   congestion_control: true\n00065|   size_bytes: 28\n00066|   size_bits: 224\n00067|   \n00068|   constraints:\n00069|     - \"First 12 bytes identical to PDS ACK (Table 3-35) with type=ACK_CC\"\n00070|     - \"Reserved fields MUST be 0\"\n00071|     - \"cc_type defines contents of ack_cc_state per Section 3.6.9\"\n00072|     - \"SACK bitmap: 1 = ACK, 0 = not ACKed\"\n00073|     - \"When NSCC used, ACK_CC and/or ACK_CCX MUST be used\"\n00074| \n00075| seq:\n00076|   # Bytes 0-11: First 12 bytes identical to PDS ACK (Table 3-35)\n00077|   # Note: Table 3-36 states \"Identical to PDS ACK header but with pds.type set to ACK_CC\"\n00078|   # For brevity in golden reference, we document the structure without repeating all ACK fields\n00079|   # In production, these would be fully expanded or use Kaitai type inheritance\n00080|   \n00081|   - id: pds_ack_header\n00082|     size: 12\n00083|     doc: |\n00084|       First 12 bytes (96 bits). Identical to PDS ACK header (Table 3-35) but with\n00085|       pds.type set to ACK_CC.\n00086|       \n00087|       Contains:\n00088|       - type (5 bits): ACK_CC\n00089|       - next_hdr (4 bits): UET Semantic type\n00090|       - flags (7 bits): [rsvd, m, retx, p, req, rsvd]\n00091|       - ack_psn_offset (16 bits): Offset from CACK_PSN to ACK_PSN\n00092|       - probe_opaque (16 bits): Copied from Probe CP\n00093|       - cack_psn (32 bits): Cumulative ACK PSN\n00094|       - spdcid (16 bits): Source PDCID\n00095|       - dpdcid (16 bits): Destination PDCID\n00096|       \n00097|       UE Spec: Table 3-36, \"First 12 bytes\"; Table 3-35 for field details\n00098|     x-required: true\n00099|     x-spec-ref: \"Table 3-36, 'First 12 bytes'; Table 3-35\"\n00100|     x-note: \"In production taxonomy, expand to individual fields or use type inheritance\"\n00101|   \n00102|   # Byte 12: CC Type and CC Flags (8 bits)\n00103|   \n00104|   - id: cc_type\n00105|     type: b4\n00106|     enum: cc_type_enum\n00107|     doc: |\n00108|       CC Type (4 bits). Defines the contents of pds.ack_cc_state field used to\n00109|       support congestion control algorithms.\n00110|       \n00111|       Defined in CMS Section 3.6.9. Values:\n00112|       - CC_NSCC: NSCC (Network Signal-based CC) state\n00113|       - CC_CREDIT: RCCC/TFC credit-based CC state\n00114|       \n00115|       UE Spec: Table 3-36, field 'cc_type'; Section 3.6.9\n00116|     x-required: true\n00117|     x-constraint: \"Valid cc_type per Section 3.6.9\"\n00118|     x-spec-ref: \"Table 3-36, field 'cc_type'; Section 3.6.9\"\n00119|   \n00120|   - id: cc_flags_rsvd\n00121|     type: b4\n00122|     doc: |\n00123|       CC Flags Reserved (4 bits). MUST be 0.\n00124|       UE Spec: Table 3-36, pds.cc_flags.rsvd\n00125|     x-required: true\n00126|     x-constraint: \"value == 0\"\n00127|     x-spec-ref: \"Table 3-36, field 'cc_flags.rsvd'\"\n00128|   \n00129|   # Byte 13: MPR (8 bits)\n00130|   \n00131|   - id: mpr\n00132|     type: u1\n00133|     doc: |\n00134|       Maximum PSN Range (8 bits). Used to set a maximum window on source PDC.\n00135|       Defines the maximum number of outstanding (not yet cleared) packets tracked\n00136|       at destination.\n00137|       \n00138|       This provides flow control by limiting the sender's window size based on\n00139|       receiver capacity.\n00140|       \n00141|       UE Spec: Table 3-36, field 'mpr'\n00142|     x-required: true\n00143|     x-spec-ref: \"Table 3-36, field 'mpr'\"\n00144|   \n00145|   # Byte 14-15: SACK PSN Offset (16 bits)\n00146|   \n00147|   - id: sack_psn_offset\n00148|     type: u2\n00149|     doc: |\n00150|       SACK PSN Offset (16 bits). Signed representation of the offset from CACK_PSN\n00151|       to SACK_PSN. Reduces field size from 32 bits to 16 bits.\n00152|       \n00153|       Base SACK_PSN defines the lowest PSN in the SACK bitmap.\n00154|       SACK_PSN = CACK_PSN + sack_psn_offset (signed arithmetic)\n00155|       \n00156|       UE Spec: Table 3-36, field 'sack_psn_offset'\n00157|     x-required: true\n00158|     x-spec-ref: \"Table 3-36, field 'sack_psn_offset'\"\n00159|   \n00160|   # Byte 16-23: SACK Bitmap (64 bits)\n00161|   \n00162|   - id: sack_bitmap\n00163|     type: u8\n00164|     doc: |\n00165|       Selective ACK Bitmap (64 bits). Each bit represents one PSN in the range\n00166|       [SACK_PSN ... SACK_PSN+63].\n00167|       \n00168|       Bit value:\n00169|       - 1: PSN is ACKed (received successfully)\n00170|       - 0: PSN is not ACKed (not received or lost)\n00171|       \n00172|       This allows selective acknowledgement of out-of-order packets for\n00173|       efficient loss recovery.\n00174|       \n00175|       UE Spec: Table 3-36, field 'sack_bitmap'\n00176|     x-required: true\n00177|     x-spec-ref: \"Table 3-36, field 'sack_bitmap'\"\n00178|   \n00179|   # Byte 24-27: ACK CC State (32 bits)\n00180|   \n00181|   - id: ack_cc_state\n00182|     type: u4\n00183|     doc: |\n00184|       ACK CC State (32 bits). Congestion control state generated at the destination\n00185|       and carried to the source.\n00186|       \n00187|       Content is defined by pds.cc_type field:\n00188|       - When cc_type = CC_NSCC: Contains NSCC state (Table 3-74)\n00189|       - When cc_type = CC_CREDIT: Contains RCCC/TFC state (Table 3-75)\n00190|       \n00191|       This state is used by the source to adjust its sending rate based on\n00192|       network congestion signals from the destination.\n00193|       \n00194|       UE Spec: Table 3-36, field 'ack_cc_state (32b)'; Section 3.6.9\n00195|     x-required: true\n00196|     x-spec-ref: \"Table 3-36, field 'ack_cc_state (64b)'; Section 3.6.9\"\n00197|     x-interpretation:\n00198|       - condition: \"cc_type == CC_NSCC\"\n00199|         meaning: \"NSCC state per Table 3-74\"\n00200|       - condition: \"cc_type == CC_CREDIT\"\n00201|         meaning: \"RCCC/TFC state per Table 3-75\"\n00202| \n00203| enums:\n00204|   cc_type_enum:\n00205|     0x0: cc_nscc\n00206|     0x1: cc_credit\n00207|     # Additional CC types may be defined in future versions\n00208|   \n00209|   pds_type_enum:\n00210|     0x06: ack_cc\n00211| \n00212| # Validation Notes:\n00213| # \n00214| # 1. Total header size MUST be exactly 28 bytes (224 bits)\n00215| # 2. First 12 bytes MUST match PDS ACK structure (Table 3-35) with type=ACK_CC\n00216| # 3. All reserved fields MUST be 0\n00217| # 4. cc_type determines interpretation of ack_cc_state (64 bits)\n00218| # 5. SACK bitmap provides selective acknowledgement for 64 PSNs\n00219| # 6. MPR provides flow control (limits sender window)\n00220| # 7. When NSCC is used, ACK_CC and/or ACK_CCX MUST be used\n00221| #\n00222| # Reference: ue-taxonomy/reference/field_definitions/pds_ack_cc.yaml\n00223| \n\n(End of file - total 223 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/ack_cc.ksy",
            "metadata": {
              "preview": "# GOLDEN REFERENCE: PDS ACK_CC (ACK with Congestion Control State)\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Table 3-36, Section 3.5.10.6, Page 259\n#\n# This is a GOLDEN REFERENCE definition for PDS ACK with congestion control state.\n# Demonstrates complex PDS packet with embedded CC state, SACK bitmap, and\n# congestion management integration.\n#\n# Quality Standards Applied:\n# 1. Every field extracted with exact bit position from Table 3-36\n# 2. All fields have x-required metadata\n# 3. Complete x-spec metadata for traceability\n# 4. First 12 bytes identical to PDS ACK (Table 3-35) with type=ACK_CC\n# 5. Additional 16 bytes for CC state, SACK bitmap, and CC parameters\n# 6. Total 28 bytes matching UE Spec exactly\n#\n# Leverages Cornelis IP: OPA reliability + congestion control patterns\n\nmeta:\n  id: pds_ack_cc",
              "truncated": false
            },
            "time": {
              "start": 1769121988177,
              "end": 1769121988268,
              "compacted": 1769123003283
            }
          }
        },
        {
          "id": "prt_be7e33e59001emfxuFBAspGA1q",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e2f40a001LkIP271axYAz9D",
          "type": "tool",
          "callID": "toolu_01JRWoJbXTeubERDXjnhKUry",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/ack_ccx.ksy"
            },
            "output": "<file>\n00001| # PDS ACK_CCX Header\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Table 3-37, Section 3.5.10.6, Page 260\n00004| #\n00005| # ACK_CCX (ACK with Extended Congestion Control State) Header.\n00006| \n00007| meta:\n00008|   id: pds_ack_ccx\n00009|   title: PDS ACK_CCX (ACK with Extended CC State) Header\n00010|   endian: be\n00011|   bit-endian: be\n00012|   doc: |\n00013|     Ultra Ethernet Transport (UET) Packet Delivery Sublayer (PDS) ACK_CCX\n00014|     (ACK with Extended Congestion Control State) Header Format.\n00015|     \n00016|     This 44-byte header extends the standard ACK header (12 bytes) with an\n00017|     additional 32-byte ack_ccx_state field for extended congestion control.\n00018|     \n00019|     ACK_CCX provides flexibility to enable evolution of congestion management\n00020|     schemes in the future by allowing larger congestion control state.\n00021|     \n00022|     Total Size: 44 bytes (352 bits)\n00023|     - 12 bytes: Standard ACK header\n00024|     - 32 bytes: ack_ccx_state (extended congestion control state)\n00025|     \n00026|     Wire Format (bytes 0-43):\n00027|     - Byte 0-11: Standard ACK fields (same as Table 3-35)\n00028|     - Byte 12-43: ack_ccx_state (256 bits, algorithm-specific)\n00029|   \n00030|   doc-ref:\n00031|     - \"UE Specification v1.0.1, Table 3-37, Page 260\"\n00032|     - \"UE Specification v1.0.1, Section 3.5.10.6\"\n00033|     - \"UE Specification v1.0.1, Figure 3-56\"\n00034|   \n00035|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00036|   ks-version: \"0.10\"\n00037| \n00038| x-spec:\n00039|   table: \"Table 3-37\"\n00040|   section: \"Section 3.5.10.6\"\n00041|   page: 260\n00042|   figure: \"Figure 3-56\"\n00043|   spec_version: \"1.0.1\"\n00044|   spec_date: \"2025-09-05\"\n00045| \n00046| x-packet:\n00047|   layer: \"transport\"\n00048|   sublayer: \"pds\"\n00049|   category: \"ack_header\"\n00050|   size_bytes: 44\n00051|   size_bits: 352\n00052|   \n00053|   constraints:\n00054|     - \"Reserved fields MUST be 0\"\n00055|     - \"pds.type MUST be 9 (ACK_CCX)\"\n00056|     - \"First 12 bytes same as standard ACK\"\n00057|     - \"ack_ccx_state provides extended CC state (32 bytes)\"\n00058|   \n00059|   usage:\n00060|     - \"ACK with extended congestion control state\"\n00061|     - \"Enables future congestion management evolution\"\n00062|     - \"Larger state space than ACK_CC (32 bytes vs 16 bytes)\"\n00063|   \n00064|   related_packets:\n00065|     - \"rud_rod_ack\"\n00066|     - \"ack_cc\"\n00067|     - \"nack_ccx\"\n00068| \n00069| seq:\n00070|   # Bytes 0-11: Standard ACK header (same as Table 3-35)\n00071|   \n00072|   - id: pds_type\n00073|     type: b5\n00074|     enum: pds_type_enum\n00075|     doc: |\n00076|       PDS Packet Type (5 bits). MUST be 9 (ACK_CCX).\n00077|       \n00078|       UE Spec: Table 3-37, field 'type'.\n00079|     x-required: true\n00080|     x-constraint: \"value == 9 (ACK_CCX)\"\n00081|     x-spec-ref: \"Table 3-37, field 'type'\"\n00082|     valid:\n00083|       eq: 9\n00084|   \n00085|   - id: next_hdr\n00086|     type: b4\n00087|     doc: |\n00088|       Next Header (4 bits). Same as ACK.\n00089|       \n00090|       UE Spec: Table 3-37, field 'next_hdr'.\n00091|     x-required: true\n00092|     x-spec-ref: \"Table 3-37, field 'next_hdr'\"\n00093|   \n00094|   # Flags: [rsvd(1), m(1), retx(1), p(1), req(2), rsvd(1)]\n00095|   - id: rsvd_flag_0\n00096|     type: b1\n00097|     doc: |\n00098|       Reserved flag (1 bit). MUST be 0.\n00099|       UE Spec: Table 3-37, pds.flags.\n00100|     x-required: true\n00101|     x-constraint: \"value == 0\"\n00102|     x-spec-ref: \"Table 3-37, pds.flags, field 'rsvd'\"\n00103|     valid:\n00104|       eq: 0\n00105|   \n00106|   - id: ecn_marked\n00107|     type: b1\n00108|     doc: |\n00109|       ECN Marked flag (1 bit). Same as ACK.\n00110|       UE Spec: Table 3-37, pds.flags, field 'm'.\n00111|     x-required: true\n00112|     x-spec-ref: \"Table 3-37, pds.flags, field 'm'\"\n00113|   \n00114|   - id: retx_ack\n00115|     type: b1\n00116|     doc: |\n00117|       Retransmit ACK flag (1 bit). Same as ACK.\n00118|       UE Spec: Table 3-37, pds.flags, field 'retx'.\n00119|     x-required: true\n00120|     x-spec-ref: \"Table 3-37, pds.flags, field 'retx'\"\n00121|   \n00122|   - id: probe_ack\n00123|     type: b1\n00124|     doc: |\n00125|       Probe ACK flag (1 bit). Same as ACK.\n00126|       UE Spec: Table 3-37, pds.flags, field 'p'.\n00127|     x-required: true\n00128|     x-spec-ref: \"Table 3-37, pds.flags, field 'p'\"\n00129|   \n00130|   - id: req\n00131|     type: b2\n00132|     enum: req_enum\n00133|     doc: |\n00134|       Request field (2 bits). Same as ACK.\n00135|       UE Spec: Table 3-37, pds.flags, field 'req'.\n00136|     x-required: true\n00137|     x-spec-ref: \"Table 3-37, pds.flags, field 'req'\"\n00138|   \n00139|   - id: rsvd_flag_1\n00140|     type: b1\n00141|     doc: |\n00142|       Reserved flag (1 bit). MUST be 0.\n00143|       UE Spec: Table 3-37, pds.flags.\n00144|     x-required: true\n00145|     x-constraint: \"value == 0\"\n00146|     x-spec-ref: \"Table 3-37, pds.flags, field 'rsvd'\"\n00147|     valid:\n00148|       eq: 0\n00149|   \n00150|   - id: ack_psn_offset_or_probe_opaque\n00151|     type: u2\n00152|     doc: |\n00153|       ACK PSN Offset or Probe Opaque (16 bits). Same as ACK.\n00154|       UE Spec: Table 3-37, field 'ack_psn_offset' or 'probe_opaque'.\n00155|     x-required: true\n00156|     x-spec-ref: \"Table 3-37, field 'ack_psn_offset' or 'probe_opaque'\"\n00157|   \n00158|   - id: cack_psn\n00159|     type: u4\n00160|     doc: |\n00161|       Cumulative ACK PSN (32 bits). Same as ACK.\n00162|       UE Spec: Table 3-37, field 'cack_psn'.\n00163|     x-required: true\n00164|     x-spec-ref: \"Table 3-37, field 'cack_psn'\"\n00165|   \n00166|   - id: spdcid\n00167|     type: u2\n00168|     doc: |\n00169|       Source PDCID (16 bits). Same as ACK.\n00170|       UE Spec: Table 3-37, field 'spdcid'.\n00171|     x-required: true\n00172|     x-spec-ref: \"Table 3-37, field 'spdcid'\"\n00173|   \n00174|   - id: dpdcid\n00175|     type: u2\n00176|     doc: |\n00177|       Destination PDCID (16 bits). Same as ACK.\n00178|       UE Spec: Table 3-37, field 'dpdcid'.\n00179|     x-required: true\n00180|     x-spec-ref: \"Table 3-37, field 'dpdcid'\"\n00181|   \n00182|   # Bytes 12-43: ack_ccx_state (256 bits)\n00183|   - id: ack_ccx_state\n00184|     size: 32\n00185|     doc: |\n00186|       ACK Extended Congestion Control State (256 bits / 32 bytes).\n00187|       \n00188|       Extended congestion control state for future evolution of congestion\n00189|       management schemes. Provides larger state space than ACK_CC (32 bytes\n00190|       vs 16 bytes).\n00191|       \n00192|       Contents are algorithm-specific and defined by the congestion control\n00193|       protocol being used.\n00194|       \n00195|       UE Spec: Table 3-37, field 'ack_ccx_state'.\n00196|     x-required: true\n00197|     x-spec-ref: \"Table 3-37, field 'ack_ccx_state'\"\n00198| \n00199| enums:\n00200|   pds_type_enum:\n00201|     9:\n00202|       id: ack_ccx\n00203|       doc: \"ACK_CCX (ACK with Extended CC State)\"\n00204|   \n00205|   req_enum:\n00206|     0:\n00207|       id: req_none\n00208|       doc: \"No request\"\n00209|     1:\n00210|       id: req_clear\n00211|       doc: \"Request clear\"\n00212|     2:\n00213|       id: req_close\n00214|       doc: \"Request close\"\n00215|     3:\n00216|       id: req_reserved\n00217|       doc: \"Reserved\"\n00218| \n\n(End of file - total 218 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/ack_ccx.ksy",
            "metadata": {
              "preview": "# PDS ACK_CCX Header\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Table 3-37, Section 3.5.10.6, Page 260\n#\n# ACK_CCX (ACK with Extended Congestion Control State) Header.\n\nmeta:\n  id: pds_ack_ccx\n  title: PDS ACK_CCX (ACK with Extended CC State) Header\n  endian: be\n  bit-endian: be\n  doc: |\n    Ultra Ethernet Transport (UET) Packet Delivery Sublayer (PDS) ACK_CCX\n    (ACK with Extended Congestion Control State) Header Format.\n    \n    This 44-byte header extends the standard ACK header (12 bytes) with an\n    additional 32-byte ack_ccx_state field for extended congestion control.\n    \n    ACK_CCX provides flexibility to enable evolution of congestion management\n    schemes in the future by allowing larger congestion control state.",
              "truncated": false
            },
            "time": {
              "start": 1769121988186,
              "end": 1769121988253,
              "compacted": 1769123003282
            }
          }
        },
        {
          "id": "prt_be7e33e5b001nUCBKxElz7XCvE",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e2f40a001LkIP271axYAz9D",
          "type": "tool",
          "callID": "toolu_011ywtH4jXnfgtrZXb4oH8m3",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/nack.ksy"
            },
            "output": "<file>\n00001| # PDS NACK Header\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Table 3-40, Section 3.5.10.10, Page 263\n00004| #\n00005| # NACK Header for negative acknowledgements.\n00006| \n00007| meta:\n00008|   id: pds_nack\n00009|   title: PDS NACK Header\n00010|   endian: be\n00011|   bit-endian: be\n00012|   doc: |\n00013|     Ultra Ethernet Transport (UET) Packet Delivery Sublayer (PDS) NACK Header Format.\n00014|     \n00015|     This 12-byte header is used for negative acknowledgements (NACKs) indicating\n00016|     packet loss, errors, or other conditions requiring retransmission or error handling.\n00017|     \n00018|     The NACK includes:\n00019|     - nack_code: Reason for NACK (enumerated in Section 3.5.12.7)\n00020|     - nack_psn or nack_pkt_id: PSN of packet that triggered NACK (or packet ID for RUDI)\n00021|     - spdcid/dpdcid: PDCIDs (cleared to 0 for RUDI or PDC establishment failures)\n00022|     - payload: NACK-code-specific payload (32 bits)\n00023|     \n00024|     Total Size: 12 bytes (96 bits)\n00025|     \n00026|     Wire Format (bytes 0-11):\n00027|     - Byte 0-1: Prologue (type(5)=10, next_hdr(4), flags(7))\n00028|     - Byte 2: nack_code (8 bits)\n00029|     - Byte 3: vendor_code (8 bits)\n00030|     - Byte 4-7: nack_psn or nack_pkt_id (32 bits)\n00031|     - Byte 8-9: spdcid (16 bits, 0 if nt=1 or PDC failure)\n00032|     - Byte 10-11: dpdcid (16 bits, 0 if nt=1)\n00033|   \n00034|   doc-ref:\n00035|     - \"UE Specification v1.0.1, Table 3-40, Page 263\"\n00036|     - \"UE Specification v1.0.1, Section 3.5.10.10\"\n00037|     - \"UE Specification v1.0.1, Section 3.5.12.7 (NACK Codes)\"\n00038|     - \"UE Specification v1.0.1, Figure 3-59\"\n00039|   \n00040|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00041|   ks-version: \"0.10\"\n00042| \n00043| x-spec:\n00044|   table: \"Table 3-40\"\n00045|   section: \"Section 3.5.10.10\"\n00046|   page: 263\n00047|   figure: \"Figure 3-59\"\n00048|   spec_version: \"1.0.1\"\n00049|   spec_date: \"2025-09-05\"\n00050| \n00051| x-packet:\n00052|   layer: \"transport\"\n00053|   sublayer: \"pds\"\n00054|   category: \"nack_header\"\n00055|   size_bytes: 12\n00056|   size_bits: 96\n00057|   \n00058|   constraints:\n00059|     - \"Reserved fields MUST be 0\"\n00060|     - \"pds.type MUST be 10 (NACK)\"\n00061|     - \"next_hdr MUST be UET_HDR_NONE for NACKs\"\n00062|     - \"spdcid/dpdcid cleared to 0 for RUDI (nt=1) or PDC failures\"\n00063|   \n00064|   usage:\n00065|     - \"Indicates packet loss or errors\"\n00066|     - \"Triggers retransmission\"\n00067|     - \"Carries NACK code and vendor-specific info\"\n00068|   \n00069|   related_packets:\n00070|     - \"rud_rod_request\"\n00071|     - \"rud_rod_ack\"\n00072|     - \"nack_ccx\"\n00073| \n00074| seq:\n00075|   # Bytes 0-1: PDS Prologue\n00076|   - id: pds_type\n00077|     type: b5\n00078|     enum: pds_type_enum\n00079|     doc: |\n00080|       PDS Packet Type (5 bits). MUST be 10 (NACK).\n00081|       \n00082|       UE Spec: Table 3-40, field 'type'.\n00083|     x-required: true\n00084|     x-constraint: \"value == 10 (NACK)\"\n00085|     x-spec-ref: \"Table 3-40, field 'type'\"\n00086|     valid:\n00087|       eq: 10\n00088|   \n00089|   - id: next_hdr\n00090|     type: b4\n00091|     doc: |\n00092|       Next Header (4 bits). Always set to UET_HDR_NONE for NACKs.\n00093|       \n00094|       UE Spec: Table 3-40, field 'next_hdr'; Section 3.4.2.6\n00095|     x-required: true\n00096|     x-constraint: \"value == UET_HDR_NONE\"\n00097|     x-spec-ref: \"Table 3-40, field 'next_hdr'\"\n00098|   \n00099|   # Flags: [rsvd(1), m(1), retx(1), nt(1), rsvd(3)]\n00100|   - id: rsvd_flag_0\n00101|     type: b1\n00102|     doc: |\n00103|       Reserved flag (1 bit). MUST be 0.\n00104|       \n00105|       UE Spec: Table 3-40, pds.flags, field 'rsvd'.\n00106|     x-required: true\n00107|     x-constraint: \"value == 0\"\n00108|     x-spec-ref: \"Table 3-40, pds.flags, field 'rsvd'\"\n00109|     valid:\n00110|       eq: 0\n00111|   \n00112|   - id: ecn_marked\n00113|     type: b1\n00114|     doc: |\n00115|       ECN Marked flag (1 bit). Set to 1 if associated request packet was ECN marked.\n00116|       \n00117|       UE Spec: Table 3-40, pds.flags, field 'm'.\n00118|     x-required: true\n00119|     x-spec-ref: \"Table 3-40, pds.flags, field 'm'\"\n00120|   \n00121|   - id: retx\n00122|     type: b1\n00123|     doc: |\n00124|       Retransmit flag (1 bit). Set to 1 if the NACK'd packet was a retransmit.\n00125|       \n00126|       Refer to Section 3.5.11.8.4.\n00127|       \n00128|       UE Spec: Table 3-40, pds.flags, field 'retx'.\n00129|     x-required: true\n00130|     x-spec-ref: \"Table 3-40, pds.flags, field 'retx'; Section 3.5.11.8.4\"\n00131|   \n00132|   - id: nack_type\n00133|     type: b1\n00134|     doc: |\n00135|       NACK Type flag (1 bit). Indicates packet type being NACK'd.\n00136|       \n00137|       0 => RUD/ROD\n00138|       1 => RUDI\n00139|       \n00140|       When set to 1, nack_psn field is interpreted as nack_pkt_id, and\n00141|       spdcid/dpdcid fields are not valid (cleared to 0).\n00142|       \n00143|       UE Spec: Table 3-40, pds.flags, field 'nt'.\n00144|     x-required: true\n00145|     x-spec-ref: \"Table 3-40, pds.flags, field 'nt'\"\n00146|   \n00147|   - id: rsvd_flag_1\n00148|     type: b3\n00149|     doc: |\n00150|       Reserved flags (3 bits). MUST be 0.\n00151|       \n00152|       UE Spec: Table 3-40, pds.flags, field 'rsvd'.\n00153|     x-required: true\n00154|     x-constraint: \"value == 0\"\n00155|     x-spec-ref: \"Table 3-40, pds.flags, field 'rsvd'\"\n00156|     valid:\n00157|       eq: 0\n00158|   \n00159|   # Byte 2: nack_code (8 bits)\n00160|   - id: nack_code\n00161|     type: u1\n00162|     enum: nack_code_enum\n00163|     doc: |\n00164|       NACK Code (8 bits). Field indicating why the NACK was transmitted.\n00165|       \n00166|       Enumerated in Section 3.5.12.7 (Table 3-59).\n00167|       \n00168|       UE Spec: Table 3-40, field 'nack_code'; Section 3.5.12.7\n00169|     x-required: true\n00170|     x-constraint: \"value in Table 3-59 (PDS NACK Codes)\"\n00171|     x-spec-ref: \"Table 3-40, field 'nack_code'; Section 3.5.12.7\"\n00172|   \n00173|   # Byte 3: vendor_code (8 bits)\n00174|   - id: vendor_code\n00175|     type: u1\n00176|     doc: |\n00177|       Vendor Code (8 bits). Vendor-specific field for statistics collection.\n00178|       \n00179|       No processing requirements and no interop required. This field may be\n00180|       ignored. Interpretation is outside the scope of the UE Specification.\n00181|       \n00182|       UE Spec: Table 3-40, field 'vendor_code'.\n00183|     x-required: false\n00184|     x-spec-ref: \"Table 3-40, field 'vendor_code'\"\n00185|   \n00186|   # Bytes 4-7: nack_psn or nack_pkt_id (32 bits)\n00187|   - id: nack_psn_or_pkt_id\n00188|     type: u4\n00189|     doc: |\n00190|       NACK PSN or Packet ID (32 bits). Interpretation depends on nack_type flag.\n00191|       \n00192|       When nack_type = 0 (RUD/ROD):\n00193|         Packet sequence number associated with the received packet that triggered\n00194|         the generation of the NACK packet.\n00195|       \n00196|       When nack_type = 1 (RUDI):\n00197|         This field is pds.nack_pkt_id - the NACK'd packet was a RUDI packet.\n00198|         The pds.spdcid and pds.dpdcid fields are not valid.\n00199|       \n00200|       UE Spec: Table 3-40, field 'nack_psn' or 'nack_pkt_id'.\n00201|     x-required: true\n00202|     x-spec-ref: \"Table 3-40, field 'nack_psn' or 'nack_pkt_id'\"\n00203|   \n00204|   # Bytes 8-9: spdcid (16 bits)\n00205|   - id: spdcid\n00206|     type: u2\n00207|     doc: |\n00208|       Source PDCID (16 bits). Source Packet Delivery Context ID.\n00209|       \n00210|       If pds.nack_code indicates PDC establishment failure (e.g., out of PDC\n00211|       resources), this field is cleared to 0 and is not valid.\n00212|       \n00213|       Cleared to 0x0 if pds.flags.nt is set (RUDI NACK).\n00214|       \n00215|       UE Spec: Table 3-40, field 'spdcid'.\n00216|     x-required: true\n00217|     x-spec-ref: \"Table 3-40, field 'spdcid'\"\n00218|   \n00219|   # Bytes 10-11: dpdcid (16 bits)\n00220|   - id: dpdcid\n00221|     type: u2\n00222|     doc: |\n00223|       Destination PDCID (16 bits). Destination Packet Delivery Context ID.\n00224|       \n00225|       Cleared to 0x0 if pds.flags.nt is set (RUDI NACK).\n00226|       \n00227|       UE Spec: Table 3-40, field 'dpdcid'.\n00228|     x-required: true\n00229|     x-spec-ref: \"Table 3-40, field 'dpdcid'\"\n00230| \n00231| enums:\n00232|   pds_type_enum:\n00233|     10:\n00234|       id: nack\n00235|       doc: \"NACK packet type\"\n00236|   \n00237|   nack_code_enum:\n00238|     0x00:\n00239|       id: uet_no_pkt_buf\n00240|       doc: \"No packet buffer available\"\n00241|     0x01:\n00242|       id: uet_trimmed\n00243|       doc: \"Packet was trimmed\"\n00244|     0x02:\n00245|       id: uet_no_pdc_avail\n00246|       doc: \"No PDC resources available\"\n00247|     0x03:\n00248|       id: uet_inv_dpdcid\n00249|       doc: \"Invalid destination PDCID\"\n00250|     0x04:\n00251|       id: uet_pdc_hdr_mismatch\n00252|       doc: \"PDC header mismatch\"\n00253|     0x05:\n00254|       id: uet_psn_oor_window\n00255|       doc: \"PSN outside expected window\"\n00256|     0x06:\n00257|       id: uet_psn_gap\n00258|       doc: \"PSN gap detected (packet loss)\"\n00259| \n\n(End of file - total 259 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/nack.ksy",
            "metadata": {
              "preview": "# PDS NACK Header\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Table 3-40, Section 3.5.10.10, Page 263\n#\n# NACK Header for negative acknowledgements.\n\nmeta:\n  id: pds_nack\n  title: PDS NACK Header\n  endian: be\n  bit-endian: be\n  doc: |\n    Ultra Ethernet Transport (UET) Packet Delivery Sublayer (PDS) NACK Header Format.\n    \n    This 12-byte header is used for negative acknowledgements (NACKs) indicating\n    packet loss, errors, or other conditions requiring retransmission or error handling.\n    \n    The NACK includes:\n    - nack_code: Reason for NACK (enumerated in Section 3.5.12.7)\n    - nack_psn or nack_pkt_id: PSN of packet that triggered NACK (or packet ID for RUDI)",
              "truncated": false
            },
            "time": {
              "start": 1769121988188,
              "end": 1769121988258,
              "compacted": 1769123003281
            }
          }
        },
        {
          "id": "prt_be7e33e66001RPJKB9AmS8EoFG",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e2f40a001LkIP271axYAz9D",
          "type": "tool",
          "callID": "toolu_01B5ZCZzEUc7UiL4oDqtBzqT",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/nack_ccx.ksy"
            },
            "output": "<file>\n00001| # PDS NACK_CCX Header\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Table 3-41, Section 3.5.10.11, Page 264\n00004| #\n00005| # NACK_CCX (NACK with Extended Congestion Control State) Header.\n00006| \n00007| meta:\n00008|   id: pds_nack_ccx\n00009|   title: PDS NACK_CCX (NACK with Extended CC State) Header\n00010|   endian: be\n00011|   bit-endian: be\n00012|   doc: |\n00013|     Ultra Ethernet Transport (UET) Packet Delivery Sublayer (PDS) NACK_CCX\n00014|     (NACK with Extended Congestion Control State) Header Format.\n00015|     \n00016|     This 28-byte header extends the standard NACK header (12 bytes) with an\n00017|     additional 16-byte nack_ccx_state field for extended congestion control.\n00018|     \n00019|     Similar to ACK_CCX, NACK_CCX provides flexibility to enable evolution of\n00020|     congestion management schemes in the future.\n00021|     \n00022|     Total Size: 28 bytes (224 bits)\n00023|     - 12 bytes: Standard NACK header\n00024|     - 16 bytes: nack_ccx_state (extended congestion control state)\n00025|     \n00026|     Wire Format (bytes 0-27):\n00027|     - Byte 0-11: Standard NACK fields (same as Table 3-40)\n00028|     - Byte 12-27: nack_ccx_state (128 bits, algorithm-specific)\n00029|   \n00030|   doc-ref:\n00031|     - \"UE Specification v1.0.1, Table 3-41, Page 264\"\n00032|     - \"UE Specification v1.0.1, Section 3.5.10.11\"\n00033|     - \"UE Specification v1.0.1, Figure 3-60\"\n00034|   \n00035|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00036|   ks-version: \"0.10\"\n00037| \n00038| x-spec:\n00039|   table: \"Table 3-41\"\n00040|   section: \"Section 3.5.10.11\"\n00041|   page: 264\n00042|   figure: \"Figure 3-60\"\n00043|   spec_version: \"1.0.1\"\n00044|   spec_date: \"2025-09-05\"\n00045| \n00046| x-packet:\n00047|   layer: \"transport\"\n00048|   sublayer: \"pds\"\n00049|   category: \"nack_header\"\n00050|   size_bytes: 28\n00051|   size_bits: 224\n00052|   \n00053|   constraints:\n00054|     - \"Reserved fields MUST be 0\"\n00055|     - \"pds.type MUST be 12 (NACK_CCX)\"\n00056|     - \"First 12 bytes same as standard NACK\"\n00057|     - \"nack_ccx_state provides extended CC state (16 bytes)\"\n00058|   \n00059|   usage:\n00060|     - \"NACK with extended congestion control state\"\n00061|     - \"Enables future congestion management evolution\"\n00062|     - \"Carries extended state for loss/congestion correlation\"\n00063|   \n00064|   related_packets:\n00065|     - \"nack\"\n00066|     - \"ack_ccx\"\n00067|     - \"prologue\"\n00068| \n00069| seq:\n00070|   # Bytes 0-11: Standard NACK header (same as Table 3-40)\n00071|   \n00072|   - id: pds_type\n00073|     type: b5\n00074|     enum: pds_type_enum\n00075|     doc: |\n00076|       PDS Packet Type (5 bits). MUST be 12 (NACK_CCX).\n00077|       \n00078|       UE Spec: Table 3-41, field 'type'.\n00079|     x-required: true\n00080|     x-constraint: \"value == 12 (NACK_CCX)\"\n00081|     x-spec-ref: \"Table 3-41, field 'type'\"\n00082|     valid:\n00083|       eq: 12\n00084|   \n00085|   - id: next_hdr\n00086|     type: b4\n00087|     doc: |\n00088|       Next Header (4 bits). Always UET_HDR_NONE for NACKs.\n00089|       UE Spec: Table 3-41, field 'next_hdr'.\n00090|     x-required: true\n00091|     x-spec-ref: \"Table 3-41, field 'next_hdr'\"\n00092|   \n00093|   # Flags: [rsvd(1), m(1), retx(1), nt(1), rsvd(3)]\n00094|   - id: rsvd_flag_0\n00095|     type: b1\n00096|     doc: |\n00097|       Reserved flag (1 bit). MUST be 0.\n00098|       UE Spec: Table 3-41, pds.flags.\n00099|     x-required: true\n00100|     x-constraint: \"value == 0\"\n00101|     x-spec-ref: \"Table 3-41, pds.flags, field 'rsvd'\"\n00102|     valid:\n00103|       eq: 0\n00104|   \n00105|   - id: ecn_marked\n00106|     type: b1\n00107|     doc: |\n00108|       ECN Marked flag (1 bit). Same as NACK.\n00109|       UE Spec: Table 3-41, pds.flags, field 'm'.\n00110|     x-required: true\n00111|     x-spec-ref: \"Table 3-41, pds.flags, field 'm'\"\n00112|   \n00113|   - id: retx\n00114|     type: b1\n00115|     doc: |\n00116|       Retransmit flag (1 bit). Same as NACK.\n00117|       UE Spec: Table 3-41, pds.flags, field 'retx'.\n00118|     x-required: true\n00119|     x-spec-ref: \"Table 3-41, pds.flags, field 'retx'\"\n00120|   \n00121|   - id: nack_type\n00122|     type: b1\n00123|     doc: |\n00124|       NACK Type flag (1 bit). Same as NACK.\n00125|       0 => RUD/ROD, 1 => RUDI\n00126|       UE Spec: Table 3-41, pds.flags, field 'nt'.\n00127|     x-required: true\n00128|     x-spec-ref: \"Table 3-41, pds.flags, field 'nt'\"\n00129|   \n00130|   - id: rsvd_flag_1\n00131|     type: b3\n00132|     doc: |\n00133|       Reserved flags (3 bits). MUST be 0.\n00134|       UE Spec: Table 3-41, pds.flags.\n00135|     x-required: true\n00136|     x-constraint: \"value == 0\"\n00137|     x-spec-ref: \"Table 3-41, pds.flags, field 'rsvd'\"\n00138|     valid:\n00139|       eq: 0\n00140|   \n00141|   - id: nack_code\n00142|     type: u1\n00143|     enum: nack_code_enum\n00144|     doc: |\n00145|       NACK Code (8 bits). Same as NACK.\n00146|       UE Spec: Table 3-41, field 'nack_code'.\n00147|     x-required: true\n00148|     x-spec-ref: \"Table 3-41, field 'nack_code'\"\n00149|   \n00150|   - id: vendor_code\n00151|     type: u1\n00152|     doc: |\n00153|       Vendor Code (8 bits). Same as NACK.\n00154|       UE Spec: Table 3-41, field 'vendor_code'.\n00155|     x-required: false\n00156|     x-spec-ref: \"Table 3-41, field 'vendor_code'\"\n00157|   \n00158|   - id: nack_psn_or_pkt_id\n00159|     type: u4\n00160|     doc: |\n00161|       NACK PSN or Packet ID (32 bits). Same as NACK.\n00162|       UE Spec: Table 3-41, field 'nack_psn' or 'nack_pkt_id'.\n00163|     x-required: true\n00164|     x-spec-ref: \"Table 3-41, field 'nack_psn' or 'nack_pkt_id'\"\n00165|   \n00166|   - id: spdcid\n00167|     type: u2\n00168|     doc: |\n00169|       Source PDCID (16 bits). Same as NACK.\n00170|       UE Spec: Table 3-41, field 'spdcid'.\n00171|     x-required: true\n00172|     x-spec-ref: \"Table 3-41, field 'spdcid'\"\n00173|   \n00174|   - id: dpdcid\n00175|     type: u2\n00176|     doc: |\n00177|       Destination PDCID (16 bits). Same as NACK.\n00178|       UE Spec: Table 3-41, field 'dpdcid'.\n00179|     x-required: true\n00180|     x-spec-ref: \"Table 3-41, field 'dpdcid'\"\n00181|   \n00182|   # Bytes 12-27: nack_ccx_state (128 bits)\n00183|   - id: nack_ccx_state\n00184|     size: 16\n00185|     doc: |\n00186|       NACK Extended Congestion Control State (128 bits / 16 bytes).\n00187|       \n00188|       Extended congestion control state for NACKs. Enables correlation of\n00189|       loss events with congestion state.\n00190|       \n00191|       Contents are algorithm-specific.\n00192|       \n00193|       UE Spec: Table 3-41, field 'nack_ccx_state'.\n00194|     x-required: true\n00195|     x-spec-ref: \"Table 3-41, field 'nack_ccx_state'\"\n00196| \n00197| enums:\n00198|   pds_type_enum:\n00199|     12:\n00200|       id: nack_ccx\n00201|       doc: \"NACK_CCX (NACK with Extended CC State)\"\n00202|   \n00203|   nack_code_enum:\n00204|     0x00:\n00205|       id: uet_no_pkt_buf\n00206|       doc: \"No packet buffer available\"\n00207|     0x01:\n00208|       id: uet_trimmed\n00209|       doc: \"Packet was trimmed\"\n00210|     0x02:\n00211|       id: uet_no_pdc_avail\n00212|       doc: \"No PDC resources available\"\n00213|     0x03:\n00214|       id: uet_inv_dpdcid\n00215|       doc: \"Invalid destination PDCID\"\n00216|     0x04:\n00217|       id: uet_pdc_hdr_mismatch\n00218|       doc: \"PDC header mismatch\"\n00219|     0x05:\n00220|       id: uet_psn_oor_window\n00221|       doc: \"PSN outside expected window\"\n00222|     0x06:\n00223|       id: uet_psn_gap\n00224|       doc: \"PSN gap detected (packet loss)\"\n00225| \n\n(End of file - total 225 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/nack_ccx.ksy",
            "metadata": {
              "preview": "# PDS NACK_CCX Header\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Table 3-41, Section 3.5.10.11, Page 264\n#\n# NACK_CCX (NACK with Extended Congestion Control State) Header.\n\nmeta:\n  id: pds_nack_ccx\n  title: PDS NACK_CCX (NACK with Extended CC State) Header\n  endian: be\n  bit-endian: be\n  doc: |\n    Ultra Ethernet Transport (UET) Packet Delivery Sublayer (PDS) NACK_CCX\n    (NACK with Extended Congestion Control State) Header Format.\n    \n    This 28-byte header extends the standard NACK header (12 bytes) with an\n    additional 16-byte nack_ccx_state field for extended congestion control.\n    \n    Similar to ACK_CCX, NACK_CCX provides flexibility to enable evolution of\n    congestion management schemes in the future.",
              "truncated": false
            },
            "time": {
              "start": 1769121988199,
              "end": 1769121988236,
              "compacted": 1769123003280
            }
          }
        },
        {
          "id": "prt_be7e33e6b001cnqOPgEb3wYSz5",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e2f40a001LkIP271axYAz9D",
          "type": "tool",
          "callID": "toolu_014Yws3hybxstW8XVbpa9JeD",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/rudi_request_response.ksy"
            },
            "output": "<file>\n00001| # PDS RUDI Request/Response Header\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Table 3-39, Section 3.5.10.9, Page 262\n00004| #\n00005| # RUDI Request/Response Header for Reliable Unordered Delivery with Idempotence.\n00006| \n00007| meta:\n00008|   id: pds_rudi_request_response\n00009|   title: PDS RUDI Request/Response Header\n00010|   endian: be\n00011|   bit-endian: be\n00012|   doc: |\n00013|     Ultra Ethernet Transport (UET) Packet Delivery Sublayer (PDS) RUDI\n00014|     (Reliable Unordered Delivery with Idempotence) Request/Response Header Format.\n00015|     \n00016|     RUDI uses a packet identifier (pkt_id) instead of a sequence number. The\n00017|     pkt_id is locally unique on the source and is not a sequence number.\n00018|     See Section 3.5.22 for RUDI details.\n00019|     \n00020|     This header format is used for both RUDI requests (pds.type = 4) and\n00021|     RUDI responses (pds.type = 5).\n00022|     \n00023|     For RUDI Requests: pds.flags.m is reserved\n00024|     For RUDI Responses: pds.flags.m indicates ECN marking\n00025|     \n00026|     Total Size: 6 bytes (48 bits) - Note: Smaller than RUD/ROD headers\n00027|     \n00028|     Wire Format (bytes 0-5):\n00029|     - Byte 0-1: Prologue (type(5), next_hdr(4), flags(7))\n00030|     - Byte 2-5: pkt_id (32 bits)\n00031|   \n00032|   doc-ref:\n00033|     - \"UE Specification v1.0.1, Table 3-39, Page 262\"\n00034|     - \"UE Specification v1.0.1, Section 3.5.10.9\"\n00035|     - \"UE Specification v1.0.1, Section 3.5.22 (RUDI details)\"\n00036|     - \"UE Specification v1.0.1, Figure 3-58\"\n00037|   \n00038|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00039|   ks-version: \"0.10\"\n00040| \n00041| x-spec:\n00042|   table: \"Table 3-39\"\n00043|   section: \"Section 3.5.10.9\"\n00044|   page: 262\n00045|   figure: \"Figure 3-58\"\n00046|   spec_version: \"1.0.1\"\n00047|   spec_date: \"2025-09-05\"\n00048| \n00049| x-packet:\n00050|   layer: \"transport\"\n00051|   sublayer: \"pds\"\n00052|   category: \"request_response_header\"\n00053|   size_bytes: 6\n00054|   size_bits: 48\n00055|   \n00056|   constraints:\n00057|     - \"Reserved fields MUST be 0\"\n00058|     - \"pds.type MUST be 4 (RUDI Request) or 5 (RUDI Response)\"\n00059|     - \"pkt_id is locally unique on source (not a sequence number)\"\n00060|     - \"No PDCIDs (RUDI doesn't use PDC)\"\n00061|   \n00062|   usage:\n00063|     - \"Reliable Unordered Delivery with Idempotence\"\n00064|     - \"Uses packet ID instead of sequence number\"\n00065|     - \"Idempotent operations (safe to retry)\"\n00066|     - \"No connection context (PDC) required\"\n00067|   \n00068|   related_packets:\n00069|     - \"rud_rod_request\"\n00070|     - \"nack\"\n00071|     - \"prologue\"\n00072| \n00073| seq:\n00074|   # Bytes 0-1: PDS Prologue\n00075|   - id: pds_type\n00076|     type: b5\n00077|     enum: pds_type_enum\n00078|     doc: |\n00079|       PDS Packet Type (5 bits). MUST be 4 (RUDI Request) or 5 (RUDI Response).\n00080|       \n00081|       UE Spec: Table 3-39, field 'type'.\n00082|     x-required: true\n00083|     x-constraint: \"value in {4, 5}\"\n00084|     x-spec-ref: \"Table 3-39, field 'type'\"\n00085|   \n00086|   - id: next_hdr\n00087|     type: b4\n00088|     doc: |\n00089|       Next Header (4 bits). Encoding identifying UET Semantic type.\n00090|       \n00091|       Refer to SES Section 3.4.2.6 for encodings.\n00092|       \n00093|       UE Spec: Table 3-39, field 'next_hdr'; Section 3.4.2.6\n00094|     x-required: true\n00095|     x-spec-ref: \"Table 3-39, field 'next_hdr'; Section 3.4.2.6\"\n00096|   \n00097|   # Flags: [rsvd(1), rsvd_or_m(1), retx(1), rsvd(4)]\n00098|   - id: rsvd_flag_0\n00099|     type: b1\n00100|     doc: |\n00101|       Reserved flag (1 bit). MUST be 0.\n00102|       \n00103|       UE Spec: Table 3-39, pds.flags, field 'rsvd'.\n00104|     x-required: true\n00105|     x-constraint: \"value == 0\"\n00106|     x-spec-ref: \"Table 3-39, pds.flags, field 'rsvd'\"\n00107|     valid:\n00108|       eq: 0\n00109|   \n00110|   - id: rsvd_or_ecn_marked\n00111|     type: b1\n00112|     doc: |\n00113|       Reserved or ECN Marked flag (1 bit). Interpretation depends on packet type.\n00114|       \n00115|       For RUDI Requests (pds.type = 4): Reserved, MUST be 0\n00116|       For RUDI Responses (pds.type = 5): ECN marked flag (m)\n00117|         Set to 1 if associated request packet was ECN marked\n00118|       \n00119|       UE Spec: Table 3-39, pds.flags, field 'rsvd / m'.\n00120|     x-required: true\n00121|     x-spec-ref: \"Table 3-39, pds.flags, field 'rsvd / m'\"\n00122|   \n00123|   - id: retx\n00124|     type: b1\n00125|     doc: |\n00126|       Retransmit flag (1 bit). Set to 1 if this is a request/response for a\n00127|       retransmitted packet.\n00128|       \n00129|       UE Spec: Table 3-39, pds.flags, field 'retx'.\n00130|     x-required: true\n00131|     x-spec-ref: \"Table 3-39, pds.flags, field 'retx'\"\n00132|   \n00133|   - id: rsvd_flag_1\n00134|     type: b4\n00135|     doc: |\n00136|       Reserved flags (4 bits). MUST be 0.\n00137|       \n00138|       UE Spec: Table 3-39, pds.flags, field 'rsvd'.\n00139|     x-required: true\n00140|     x-constraint: \"value == 0\"\n00141|     x-spec-ref: \"Table 3-39, pds.flags, field 'rsvd'\"\n00142|     valid:\n00143|       eq: 0\n00144|   \n00145|   # Bytes 2-5: pkt_id (32 bits)\n00146|   - id: pkt_id\n00147|     type: u4\n00148|     doc: |\n00149|       RUDI Packet Identifier (32 bits). Locally unique on source.\n00150|       \n00151|       This is NOT a sequence number. RUDI uses packet identifiers instead of\n00152|       sequence numbers to enable idempotent operations.\n00153|       \n00154|       See Section 3.5.22 for RUDI details.\n00155|       \n00156|       UE Spec: Table 3-39, field 'pkt_id'; Section 3.5.22\n00157|     x-required: true\n00158|     x-spec-ref: \"Table 3-39, field 'pkt_id'; Section 3.5.22\"\n00159| \n00160| enums:\n00161|   pds_type_enum:\n00162|     4:\n00163|       id: rudi_request\n00164|       doc: \"RUDI Request\"\n00165|     5:\n00166|       id: rudi_response\n00167|       doc: \"RUDI Response\"\n00168| \n\n(End of file - total 168 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/rudi_request_response.ksy",
            "metadata": {
              "preview": "# PDS RUDI Request/Response Header\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Table 3-39, Section 3.5.10.9, Page 262\n#\n# RUDI Request/Response Header for Reliable Unordered Delivery with Idempotence.\n\nmeta:\n  id: pds_rudi_request_response\n  title: PDS RUDI Request/Response Header\n  endian: be\n  bit-endian: be\n  doc: |\n    Ultra Ethernet Transport (UET) Packet Delivery Sublayer (PDS) RUDI\n    (Reliable Unordered Delivery with Idempotence) Request/Response Header Format.\n    \n    RUDI uses a packet identifier (pkt_id) instead of a sequence number. The\n    pkt_id is locally unique on the source and is not a sequence number.\n    See Section 3.5.22 for RUDI details.\n    \n    This header format is used for both RUDI requests (pds.type = 4) and",
              "truncated": false
            },
            "time": {
              "start": 1769121988204,
              "end": 1769121988274,
              "compacted": 1769123003280
            }
          }
        },
        {
          "id": "prt_be7e33e6f001p4Rp4Mt5vNa9Ef",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e2f40a001LkIP271axYAz9D",
          "type": "tool",
          "callID": "toolu_01CVMkLLBBar3JZuWxxCgQXt",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/uud_request.ksy"
            },
            "output": "<file>\n00001| # PDS UUD Request Header\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Table 3-42, Section 3.5.10.12, Page 265\n00004| #\n00005| # UUD (Unreliable Unordered Delivery) Request Header.\n00006| \n00007| meta:\n00008|   id: pds_uud_request\n00009|   title: PDS UUD Request Header\n00010|   endian: be\n00011|   bit-endian: be\n00012|   doc: |\n00013|     Ultra Ethernet Transport (UET) Packet Delivery Sublayer (PDS) UUD\n00014|     (Unreliable Unordered Delivery) Request Header Format.\n00015|     \n00016|     UUD provides unreliable, unordered delivery with no acknowledgements or\n00017|     retransmissions. This is the simplest delivery mode, suitable for best-effort\n00018|     traffic where packet loss is acceptable.\n00019|     \n00020|     UUD uses a packet identifier (pkt_id) similar to RUDI, but without reliability\n00021|     guarantees. No PDC is used, and no ACKs/NACKs are generated.\n00022|     \n00023|     Total Size: 6 bytes (48 bits) - Same size as RUDI\n00024|     \n00025|     Wire Format (bytes 0-5):\n00026|     - Byte 0-1: Prologue (type(5)=6, next_hdr(4), flags(7))\n00027|     - Byte 2-5: pkt_id (32 bits)\n00028|   \n00029|   doc-ref:\n00030|     - \"UE Specification v1.0.1, Table 3-42, Page 265\"\n00031|     - \"UE Specification v1.0.1, Section 3.5.10.12\"\n00032|     - \"UE Specification v1.0.1, Section 3.5.7.4 (UUD Delivery)\"\n00033|     - \"UE Specification v1.0.1, Figure 3-61\"\n00034|   \n00035|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00036|   ks-version: \"0.10\"\n00037| \n00038| x-spec:\n00039|   table: \"Table 3-42\"\n00040|   section: \"Section 3.5.10.12\"\n00041|   page: 265\n00042|   figure: \"Figure 3-61\"\n00043|   spec_version: \"1.0.1\"\n00044|   spec_date: \"2025-09-05\"\n00045| \n00046| x-packet:\n00047|   layer: \"transport\"\n00048|   sublayer: \"pds\"\n00049|   category: \"request_header\"\n00050|   size_bytes: 6\n00051|   size_bits: 48\n00052|   \n00053|   constraints:\n00054|     - \"Reserved fields MUST be 0\"\n00055|     - \"pds.type MUST be 6 (UUD Request)\"\n00056|     - \"pkt_id is locally unique on source\"\n00057|     - \"No PDC, no ACKs, no NACKs\"\n00058|   \n00059|   usage:\n00060|     - \"Unreliable Unordered Delivery (best-effort)\"\n00061|     - \"No reliability guarantees\"\n00062|     - \"No acknowledgements or retransmissions\"\n00063|     - \"Suitable for loss-tolerant traffic\"\n00064|   \n00065|   related_packets:\n00066|     - \"rudi_request_response\"\n00067|     - \"rud_rod_request\"\n00068|     - \"prologue\"\n00069| \n00070| seq:\n00071|   # Bytes 0-1: PDS Prologue\n00072|   - id: pds_type\n00073|     type: b5\n00074|     enum: pds_type_enum\n00075|     doc: |\n00076|       PDS Packet Type (5 bits). MUST be 6 (UUD Request).\n00077|       \n00078|       UE Spec: Table 3-42, field 'type'.\n00079|     x-required: true\n00080|     x-constraint: \"value == 6 (UUD Request)\"\n00081|     x-spec-ref: \"Table 3-42, field 'type'\"\n00082|     valid:\n00083|       eq: 6\n00084|   \n00085|   - id: next_hdr\n00086|     type: b4\n00087|     doc: |\n00088|       Next Header (4 bits). Encoding identifying UET Semantic type.\n00089|       \n00090|       Refer to SES Section 3.4.2.6 for encodings.\n00091|       \n00092|       UE Spec: Table 3-42, field 'next_hdr'; Section 3.4.2.6\n00093|     x-required: true\n00094|     x-spec-ref: \"Table 3-42, field 'next_hdr'; Section 3.4.2.6\"\n00095|   \n00096|   # Flags: [rsvd(7)]\n00097|   - id: rsvd_flags\n00098|     type: b7\n00099|     doc: |\n00100|       Reserved flags (7 bits). MUST be 0.\n00101|       \n00102|       UE Spec: Table 3-42, pds.flags, field 'rsvd'.\n00103|     x-required: true\n00104|     x-constraint: \"value == 0\"\n00105|     x-spec-ref: \"Table 3-42, pds.flags, field 'rsvd'\"\n00106|     valid:\n00107|       eq: 0\n00108|   \n00109|   # Bytes 2-5: pkt_id (32 bits)\n00110|   - id: pkt_id\n00111|     type: u4\n00112|     doc: |\n00113|       UUD Packet Identifier (32 bits). Locally unique on source.\n00114|       \n00115|       Similar to RUDI, UUD uses packet identifiers instead of sequence numbers.\n00116|       However, unlike RUDI, UUD provides no reliability guarantees.\n00117|       \n00118|       UE Spec: Table 3-42, field 'pkt_id'.\n00119|     x-required: true\n00120|     x-spec-ref: \"Table 3-42, field 'pkt_id'\"\n00121| \n00122| enums:\n00123|   pds_type_enum:\n00124|     6:\n00125|       id: uud_request\n00126|       doc: \"UUD Request (Unreliable Unordered Delivery)\"\n00127| \n\n(End of file - total 127 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/uud_request.ksy",
            "metadata": {
              "preview": "# PDS UUD Request Header\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Table 3-42, Section 3.5.10.12, Page 265\n#\n# UUD (Unreliable Unordered Delivery) Request Header.\n\nmeta:\n  id: pds_uud_request\n  title: PDS UUD Request Header\n  endian: be\n  bit-endian: be\n  doc: |\n    Ultra Ethernet Transport (UET) Packet Delivery Sublayer (PDS) UUD\n    (Unreliable Unordered Delivery) Request Header Format.\n    \n    UUD provides unreliable, unordered delivery with no acknowledgements or\n    retransmissions. This is the simplest delivery mode, suitable for best-effort\n    traffic where packet loss is acceptable.\n    \n    UUD uses a packet identifier (pkt_id) similar to RUDI, but without reliability",
              "truncated": false
            },
            "time": {
              "start": 1769121988208,
              "end": 1769121988266,
              "compacted": 1769123003279
            }
          }
        },
        {
          "id": "prt_be7e33e72001KcPTtHAxq68jFY",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e2f40a001LkIP271axYAz9D",
          "type": "tool",
          "callID": "toolu_016K5pjWy4Uom7tZNuzs59va",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/rud_rod_cp.ksy"
            },
            "output": "<file>\n00001| # PDS RUD/ROD Control Packet\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Table 3-38, Section 3.5.10.8, Page 261\n00004| #\n00005| # RUD/ROD Control Packet with 10 subtypes.\n00006| \n00007| meta:\n00008|   id: pds_rud_rod_cp\n00009|   title: PDS RUD/ROD Control Packet Header\n00010|   endian: be\n00011|   bit-endian: be\n00012|   doc: |\n00013|     Ultra Ethernet Transport (UET) Packet Delivery Sublayer (PDS) RUD/ROD\n00014|     Control Packet (CP) Header Format.\n00015|     \n00016|     Control Packets are used for various control operations in RUD/ROD delivery:\n00017|     - NOOP (0): No operation\n00018|     - ACK Request (1): Source requesting ACK for specific PSN\n00019|     - Clear Command (2): Initiator to target to clear guaranteed delivery state\n00020|     - Clear Request (3): Target requests source to send clear\n00021|     - Close Command (4): Initiator indicating PDC is being closed\n00022|     - Close Request (5): Target request to initiator to close PDC\n00023|     - Probe (6): Source to destination to request PDS ACK\n00024|     - Credit (7): Destination to source carrying congestion control credit\n00025|     - Credit Request (8): Source to destination requesting credit\n00026|     - Negotiation (9): PDC negotiation\n00027|     - Reserved (10-15)\n00028|     \n00029|     The ctl_type field (in prologue) identifies the specific CP subtype.\n00030|     \n00031|     Total Size: 12 bytes (96 bits)\n00032|     \n00033|     Wire Format (bytes 0-11):\n00034|     - Byte 0-1: Prologue (type(5)=11, ctl_type(4), flags(7))\n00035|     - Byte 2-3: probe_opaque (16 bits)\n00036|     - Byte 4-7: psn (32 bits)\n00037|     - Byte 8-11: spdcid and dpdcid or {pdc_info, psn_offset} (32 bits)\n00038|   \n00039|   doc-ref:\n00040|     - \"UE Specification v1.0.1, Table 3-38, Page 261\"\n00041|     - \"UE Specification v1.0.1, Section 3.5.10.8\"\n00042|     - \"UE Specification v1.0.1, Section 3.5.16 (CP details)\"\n00043|     - \"UE Specification v1.0.1, Figure 3-57\"\n00044|   \n00045|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00046|   ks-version: \"0.10\"\n00047| \n00048| x-spec:\n00049|   table: \"Table 3-38\"\n00050|   section: \"Section 3.5.10.8\"\n00051|   page: 261\n00052|   figure: \"Figure 3-57\"\n00053|   spec_version: \"1.0.1\"\n00054|   spec_date: \"2025-09-05\"\n00055| \n00056| x-packet:\n00057|   layer: \"transport\"\n00058|   sublayer: \"pds\"\n00059|   category: \"control_packet\"\n00060|   size_bytes: 12\n00061|   size_bits: 96\n00062|   \n00063|   constraints:\n00064|     - \"Reserved fields MUST be 0\"\n00065|     - \"pds.type MUST be 11 (CP)\"\n00066|     - \"ctl_type identifies CP subtype (10 defined subtypes)\"\n00067|     - \"Some CPs consume a new PSN (see Section 3.5.16)\"\n00068|   \n00069|   usage:\n00070|     - \"Various control operations for RUD/ROD\"\n00071|     - \"PDC management (close, clear)\"\n00072|     - \"ACK/Probe requests\"\n00073|     - \"Credit management\"\n00074|     - \"Negotiation\"\n00075|   \n00076|   related_packets:\n00077|     - \"rud_rod_request\"\n00078|     - \"rud_rod_ack\"\n00079|     - \"prologue\"\n00080| \n00081| seq:\n00082|   # Bytes 0-1: PDS Prologue\n00083|   - id: pds_type\n00084|     type: b5\n00085|     enum: pds_type_enum\n00086|     doc: |\n00087|       PDS Packet Type (5 bits). MUST be 11 (CP).\n00088|       \n00089|       UE Spec: Table 3-38, field 'type'.\n00090|     x-required: true\n00091|     x-constraint: \"value == 11 (CP)\"\n00092|     x-spec-ref: \"Table 3-38, field 'type'\"\n00093|     valid:\n00094|       eq: 11\n00095|   \n00096|   - id: ctl_type\n00097|     type: b4\n00098|     enum: ctl_type_enum\n00099|     doc: |\n00100|       Control Type (4 bits). Identifies type of CP.\n00101|       \n00102|       See Section 3.5.16 for CP details.\n00103|       \n00104|       Subtypes:\n00105|       - 0: NOOP\n00106|       - 1: ACK Request\n00107|       - 2: Clear Command\n00108|       - 3: Clear Request\n00109|       - 4: Close Command\n00110|       - 5: Close Request\n00111|       - 6: Probe\n00112|       - 7: Credit\n00113|       - 8: Credit Request\n00114|       - 9: Negotiation\n00115|       - 10-15: Reserved\n00116|       \n00117|       UE Spec: Table 3-38, field 'ctl_type'; Section 3.5.16\n00118|     x-required: true\n00119|     x-constraint: \"value in {0..9} or reserved\"\n00120|     x-spec-ref: \"Table 3-38, field 'ctl_type'; Section 3.5.16\"\n00121|   \n00122|   # Flags: [rsvd(1), rsvd_or_isrod(1), retx(1), ar(1), syn(1), rsvd(2)]\n00123|   - id: rsvd_flag_0\n00124|     type: b1\n00125|     doc: |\n00126|       Reserved flag (1 bit). MUST be 0.\n00127|       UE Spec: Table 3-38, pds.flags.\n00128|     x-required: true\n00129|     x-constraint: \"value == 0\"\n00130|     x-spec-ref: \"Table 3-38, pds.flags, field 'rsvd'\"\n00131|     valid:\n00132|       eq: 0\n00133|   \n00134|   - id: rsvd_or_isrod\n00135|     type: b1\n00136|     doc: |\n00137|       Reserved or IsROD flag (1 bit). Context-dependent.\n00138|       \n00139|       For NOOP and Negotiation: 1 => PDC is ROD, 0 => PDC is RUD\n00140|       For other delivery modes: Reserved\n00141|       \n00142|       UE Spec: Table 3-38, pds.flags, field 'rsvd/isrod'.\n00143|     x-required: true\n00144|     x-spec-ref: \"Table 3-38, pds.flags, field 'rsvd/isrod'\"\n00145|   \n00146|   - id: retx\n00147|     type: b1\n00148|     doc: |\n00149|       Retransmit flag (1 bit). Set to 1 if this CP is a retransmit.\n00150|       UE Spec: Table 3-38, pds.flags, field 'retx'.\n00151|     x-required: true\n00152|     x-spec-ref: \"Table 3-38, pds.flags, field 'retx'\"\n00153|   \n00154|   - id: ar\n00155|     type: b1\n00156|     doc: |\n00157|       ACK Request flag (1 bit). Set to 1 to request ACK.\n00158|       UE Spec: Table 3-38, pds.flags, field 'ar'.\n00159|     x-required: true\n00160|     x-spec-ref: \"Table 3-38, pds.flags, field 'ar'\"\n00161|   \n00162|   - id: syn\n00163|     type: b1\n00164|     doc: |\n00165|       SYN flag (1 bit). Set to 1 for PDC establishment request.\n00166|       UE Spec: Table 3-38, pds.flags, field 'syn'.\n00167|     x-required: true\n00168|     x-spec-ref: \"Table 3-38, pds.flags, field 'syn'\"\n00169|   \n00170|   - id: rsvd_flag_1\n00171|     type: b2\n00172|     doc: |\n00173|       Reserved flags (2 bits). MUST be 0.\n00174|       UE Spec: Table 3-38, pds.flags.\n00175|     x-required: true\n00176|     x-constraint: \"value == 0\"\n00177|     x-spec-ref: \"Table 3-38, pds.flags, field 'rsvd'\"\n00178|     valid:\n00179|       eq: 0\n00180|   \n00181|   # Bytes 2-3: probe_opaque (16 bits)\n00182|   - id: probe_opaque\n00183|     type: u2\n00184|     doc: |\n00185|       Probe Opaque (16 bits). Same as ACK.\n00186|       \n00187|       UE Spec: Table 3-38, field 'probe_opaque'.\n00188|     x-required: true\n00189|     x-spec-ref: \"Table 3-38, field 'probe_opaque'\"\n00190|   \n00191|   # Bytes 4-7: psn (32 bits)\n00192|   - id: psn\n00193|     type: u4\n00194|     doc: |\n00195|       Packet Sequence Number (32 bits). PSN assigned to the PDS CP.\n00196|       \n00197|       Some CPs consume a new PSN; refer to Section 3.5.16 for specifics.\n00198|       \n00199|       UE Spec: Table 3-38, field 'psn'; Section 3.5.16\n00200|     x-required: true\n00201|     x-spec-ref: \"Table 3-38, field 'psn'; Section 3.5.16\"\n00202|   \n00203|   # Bytes 8-9: spdcid (16 bits)\n00204|   - id: spdcid\n00205|     type: u2\n00206|     doc: |\n00207|       Source PDCID (16 bits). Same as ACK.\n00208|       \n00209|       UE Spec: Table 3-38, field 'spdcid'.\n00210|     x-required: true\n00211|     x-spec-ref: \"Table 3-38, field 'spdcid'\"\n00212|   \n00213|   # Bytes 10-11: dpdcid or {pdc_info, psn_offset} (16 bits)\n00214|   - id: dpdcid_or_pdc_info\n00215|     type: u2\n00216|     doc: |\n00217|       Destination PDCID or PDC Info/PSN Offset (16 bits). Same as ACK.\n00218|       \n00219|       UE Spec: Table 3-38, field '{dpdcid} or {pdc_info, psn_offset}'.\n00220|     x-required: true\n00221|     x-spec-ref: \"Table 3-38, field '{dpdcid} or {pdc_info, psn_offset}'\"\n00222| \n00223| enums:\n00224|   pds_type_enum:\n00225|     11:\n00226|       id: cp\n00227|       doc: \"CP (Control Packet)\"\n00228|   \n00229|   ctl_type_enum:\n00230|     0:\n00231|       id: noop\n00232|       doc: \"NOOP - No operation\"\n00233|     1:\n00234|       id: ack_request\n00235|       doc: \"ACK Request - Source requesting ACK for specific PSN\"\n00236|     2:\n00237|       id: clear_command\n00238|       doc: \"Clear Command - Initiator to target to clear guaranteed delivery state\"\n00239|     3:\n00240|       id: clear_request\n00241|       doc: \"Clear Request - Target requests source to send clear\"\n00242|     4:\n00243|       id: close_command\n00244|       doc: \"Close Command - Initiator indicating PDC is being closed\"\n00245|     5:\n00246|       id: close_request\n00247|       doc: \"Close Request - Target request to initiator to close PDC\"\n00248|     6:\n00249|       id: probe\n00250|       doc: \"Probe - Source to destination to request PDS ACK\"\n00251|     7:\n00252|       id: credit\n00253|       doc: \"Credit - Destination to source carrying congestion control credit\"\n00254|     8:\n00255|       id: credit_request\n00256|       doc: \"Credit Request - Source to destination requesting credit\"\n00257|     9:\n00258|       id: negotiation\n00259|       doc: \"Negotiation - PDC negotiation\"\n00260| \n\n(End of file - total 260 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/rud_rod_cp.ksy",
            "metadata": {
              "preview": "# PDS RUD/ROD Control Packet\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Table 3-38, Section 3.5.10.8, Page 261\n#\n# RUD/ROD Control Packet with 10 subtypes.\n\nmeta:\n  id: pds_rud_rod_cp\n  title: PDS RUD/ROD Control Packet Header\n  endian: be\n  bit-endian: be\n  doc: |\n    Ultra Ethernet Transport (UET) Packet Delivery Sublayer (PDS) RUD/ROD\n    Control Packet (CP) Header Format.\n    \n    Control Packets are used for various control operations in RUD/ROD delivery:\n    - NOOP (0): No operation\n    - ACK Request (1): Source requesting ACK for specific PSN\n    - Clear Command (2): Initiator to target to clear guaranteed delivery state\n    - Clear Request (3): Target requests source to send clear",
              "truncated": false
            },
            "time": {
              "start": 1769121988211,
              "end": 1769121988263,
              "compacted": 1769123003278
            }
          }
        },
        {
          "id": "prt_be7e33eb4001kqSv3K18x5UHt7",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e2f40a001LkIP271axYAz9D",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 34110,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7e33ece001wiNZDRIajDheZG",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769121988302,
          "completed": 1769122001730
        },
        "parentID": "msg_be7e28b86001U2bxAs52hRVDKW",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Planner-Sisyphus",
        "agent": "Planner-Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 55688,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7e342ee001IA0rO2KH3noxuJ",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e33ece001wiNZDRIajDheZG",
          "type": "step-start"
        },
        {
          "id": "prt_be7e3730e0011A3Ki0liQlQd4K",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e33ece001wiNZDRIajDheZG",
          "type": "tool",
          "callID": "toolu_01SVPC4hYMzXD7Ax2of1mP6R",
          "tool": "todowrite",
          "state": {
            "status": "completed",
            "input": {
              "todos": [
                {
                  "id": "1",
                  "content": "Identify packet formats not expanded in packet_taxonomy.md",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "2",
                  "content": "Read and analyze UE transport layer .ksy files (PDS, SES, CMS, TSS)",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "3",
                  "content": "Read and analyze Cornelis proprietary .ksy files (CSIG+, VxLAN+, collective_l2, scaleup_l2)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "4",
                  "content": "Read and analyze RoCEv2 extended header .ksy files",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "5",
                  "content": "Read and analyze HSI .ksy files (event_notification, sgl_entry, etc.)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "6",
                  "content": "Read and analyze UE link layer .ksy files (LLR, CBFC, LLDP)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "7",
                  "content": "Compare datamodel against HAS specifications for discrepancies",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "8",
                  "content": "Draft expanded packet format sections for packet_taxonomy.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "9",
                  "content": "Identify new work items for discrepancies",
                  "status": "pending",
                  "priority": "high"
                }
              ]
            },
            "output": "[\n  {\n    \"id\": \"1\",\n    \"content\": \"Identify packet formats not expanded in packet_taxonomy.md\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"2\",\n    \"content\": \"Read and analyze UE transport layer .ksy files (PDS, SES, CMS, TSS)\",\n    \"status\": \"in_progress\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"3\",\n    \"content\": \"Read and analyze Cornelis proprietary .ksy files (CSIG+, VxLAN+, collective_l2, scaleup_l2)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"4\",\n    \"content\": \"Read and analyze RoCEv2 extended header .ksy files\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"5\",\n    \"content\": \"Read and analyze HSI .ksy files (event_notification, sgl_entry, etc.)\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"6\",\n    \"content\": \"Read and analyze UE link layer .ksy files (LLR, CBFC, LLDP)\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"7\",\n    \"content\": \"Compare datamodel against HAS specifications for discrepancies\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"8\",\n    \"content\": \"Draft expanded packet format sections for packet_taxonomy.md\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"9\",\n    \"content\": \"Identify new work items for discrepancies\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  }\n]",
            "title": "8 todos",
            "metadata": {
              "todos": [
                {
                  "id": "1",
                  "content": "Identify packet formats not expanded in packet_taxonomy.md",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "2",
                  "content": "Read and analyze UE transport layer .ksy files (PDS, SES, CMS, TSS)",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "3",
                  "content": "Read and analyze Cornelis proprietary .ksy files (CSIG+, VxLAN+, collective_l2, scaleup_l2)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "4",
                  "content": "Read and analyze RoCEv2 extended header .ksy files",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "5",
                  "content": "Read and analyze HSI .ksy files (event_notification, sgl_entry, etc.)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "6",
                  "content": "Read and analyze UE link layer .ksy files (LLR, CBFC, LLDP)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "7",
                  "content": "Compare datamodel against HAS specifications for discrepancies",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "8",
                  "content": "Draft expanded packet format sections for packet_taxonomy.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "9",
                  "content": "Identify new work items for discrepancies",
                  "status": "pending",
                  "priority": "high"
                }
              ],
              "truncated": false
            },
            "time": {
              "start": 1769122001681,
              "end": 1769122001698,
              "compacted": 1769124449186
            }
          }
        },
        {
          "id": "prt_be7e37339001JeZHHvHgiykHnI",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e33ece001wiNZDRIajDheZG",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 55688,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7e37350001M0JnhjKsNzdvWT",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769122001744,
          "completed": 1769122011055
        },
        "parentID": "msg_be7e28b86001U2bxAs52hRVDKW",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Planner-Sisyphus",
        "agent": "Planner-Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 56151,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7e3771a001T01LcHDFrQIFyg",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e37350001M0JnhjKsNzdvWT",
          "type": "step-start"
        },
        {
          "id": "prt_be7e39755001GyJ3mXdWjGaSy1",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e37350001M0JnhjKsNzdvWT",
          "type": "tool",
          "callID": "toolu_01Nx54N65WLwQYG8tRPMYqj6",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/ses/standard_request_som1.ksy"
            },
            "output": "<file>\n00001| # GOLDEN REFERENCE: SES Standard Request Header (SOM=1)\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Table 3-8, Section 3.4.2.1, Page 158\n00004| # \n00005| # This is a GOLDEN REFERENCE definition demonstrating extreme rigor and serving\n00006| # as a template for all subsequent packet definitions in the UE taxonomy.\n00007| #\n00008| # Quality Standards Applied:\n00009| # 1. Every field extracted with exact bit position and width from Table 3-8\n00010| # 2. All fields have x-required metadata (mandatory/optional per UE Spec)\n00011| # 3. Complete x-spec metadata (table, section, page) for traceability\n00012| # 4. All constraints captured (reserved bits MUST be 0, enum types, valid ranges)\n00013| # 5. Field dependencies and relationships documented\n00014| # 6. Byte-level and bit-level layout matches UE Spec exactly (44 bytes total)\n00015| # 7. All section references included for validation\n00016| #\n00017| # Leverages Cornelis IP:\n00018| # - Omni-Path packet format rigor (field-level validation, reserved bit handling)\n00019| # - Kaitai Struct best practices (enums, contents validation, bit-endian)\n00020| # - Linux netlink YAML patterns (byte-order, padding, checks)\n00021| \n00022| meta:\n00023|   id: ses_standard_request_som1\n00024|   title: SES Standard Header Format (SOM=1)\n00025|   endian: be  # Network byte order (big-endian) per UE Spec convention\n00026|   bit-endian: be  # Big-endian bit ordering for bit fields\n00027|   doc: |\n00028|     Ultra Ethernet Transport (UET) Semantic Sublayer (SES) Standard Request Header\n00029|     when ses.som (Start of Message) is 1.\n00030|     \n00031|     This is the full 44-byte header format used for the first packet of most UET\n00032|     operations including sends, tagged sends, RMA operations, and atomic operations.\n00033|     \n00034|     The header provides complete addressing information (JobID, PIDonFEP, Resource Index),\n00035|     matching criteria (initiator, match_bits/memory_key), buffer offset, request length,\n00036|     and optional header data for completion.\n00037|     \n00038|     Total Size: 44 bytes (352 bits)\n00039|     \n00040|     Wire Format (bytes 0-43):\n00041|     - Byte 0-1: Control flags and opcode (16 bits)\n00042|     - Byte 2-3: Message ID (16 bits)\n00043|     - Byte 4: RI Generation (8 bits)\n00044|     - Byte 5-7: JobID (24 bits)\n00045|     - Byte 8-9: PIDonFEP and reserved (16 bits)\n00046|     - Byte 10-11: Resource Index and reserved (16 bits)\n00047|     - Byte 12-19: Buffer Offset (64 bits)\n00048|     - Byte 20-23: Initiator (32 bits)\n00049|     - Byte 24-31: Match Bits / Memory Key (64 bits)\n00050|     - Byte 32-39: Header Data (64 bits)\n00051|     - Byte 40-43: Request Length (32 bits)\n00052|   \n00053|   doc-ref:\n00054|     - \"UE Specification v1.0.1, Table 3-8, Page 158\"\n00055|     - \"UE Specification v1.0.1, Section 3.4.2.1 (Semantic Header Formats)\"\n00056|     - \"UE Specification v1.0.1, Figure 3-9 (Standard Header Format Diagram)\"\n00057|   \n00058|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00059|   ks-version: \"0.10\"\n00060| \n00061| # UE Specification Traceability Metadata\n00062| # Per clarification: All packets must have x-spec metadata for validation\n00063| x-spec:\n00064|   table: \"Table 3-8\"\n00065|   section: \"Section 3.4.2.1\"\n00066|   page: 158\n00067|   figure: \"Figure 3-9\"\n00068|   spec_version: \"1.0.1\"\n00069|   spec_date: \"2025-09-05\"\n00070| \n00071| # Packet-level metadata\n00072| x-packet:\n00073|   layer: \"transport\"\n00074|   sublayer: \"ses\"\n00075|   category: \"request_header\"\n00076|   size_bytes: 44\n00077|   size_bits: 352\n00078|   \n00079|   # Validation constraints\n00080|   constraints:\n00081|     - \"Reserved fields MUST be 0\"\n00082|     - \"ses.som MUST be 1 for this header format\"\n00083|     - \"ses.opcode MUST be valid request opcode per Table 3-17\"\n00084|     - \"message_id value 0 is reserved (indicates message ID not valid)\"\n00085|     - \"request_length maximum is 2^32-1 bytes\"\n00086|     - \"buffer_offset special use for deferrable sends (restart token)\"\n00087| \n00088| seq:\n00089|   # Byte 0-1: Control Flags and Opcode (16 bits total)\n00090|   # Bit layout (MSB to LSB): rsvd(2) | opcode(6) | ver(2) | dc(1) | ie(1) | rel(1) | hd(1) | eom(1) | som(1)\n00091|   \n00092|   - id: rsvd_0\n00093|     type: b2\n00094|     doc: |\n00095|       Reserved bits (2 bits). MUST be 0.\n00096|       UE Spec: Table 3-8, first field.\n00097|     x-required: true\n00098|     x-constraint: \"value == 0\"\n00099|     x-spec-ref: \"Table 3-8, field 'rsvd'\"\n00100|   \n00101|   - id: opcode\n00102|     type: b6\n00103|     enum: ses_opcode_enum\n00104|     doc: |\n00105|       Operation code (6 bits). Defines the operation being performed for this packet.\n00106|       Valid values are defined in Table 3-17 (Supported Request Messages).\n00107|       \n00108|       Examples:\n00109|       - 0x00: UET_NO_OP\n00110|       - 0x01: UET_WRITE\n00111|       - 0x02: UET_READ\n00112|       - 0x03: UET_ATOMIC\n00113|       - 0x04: UET_FETCHING_ATOMIC\n00114|       - 0x05: UET_SEND\n00115|       - ... (see Table 3-17 for complete list)\n00116|       \n00117|       UE Spec: Table 3-8, Section 3.4.6.2\n00118|     x-required: true\n00119|     x-constraint: \"value in Table 3-17 (valid request opcodes)\"\n00120|     x-spec-ref: \"Table 3-8, field 'opcode'; Table 3-17\"\n00121|   \n00122|   - id: version\n00123|     type: b2\n00124|     doc: |\n00125|       Semantic protocol version (2 bits). Set to 0 in the initial version.\n00126|       UE Spec: Table 3-8, field 'version (ver)'.\n00127|     x-required: true\n00128|     x-constraint: \"value == 0 for UE Spec v1.0.1\"\n00129|     x-spec-ref: \"Table 3-8, field 'version (ver)'\"\n00130|   \n00131|   - id: delivery_complete\n00132|     type: b1\n00133|     doc: |\n00134|       Delivery Complete flag (1 bit). When set to 1, defer the semantic response\n00135|       until the packet has been made globally observable (Section 3.4.8.3).\n00136|       Matches the FI_DELIVERY_COMPLETE option in libfabric.\n00137|       \n00138|       UE Spec: Table 3-8, Section 3.4.8.3\n00139|     x-required: true\n00140|     x-spec-ref: \"Table 3-8, field 'Delivery Complete (dc)'; Section 3.4.8.3\"\n00141|   \n00142|   - id: initiator_error\n00143|     type: b1\n00144|     doc: |\n00145|       Initiator Error flag (1 bit). When set to 1, indicates this packet encountered\n00146|       an error at the initiator. Prevents the packet from being written at the target.\n00147|       Should be set only for packets that MUST cause the message to complete in error.\n00148|       Primarily designed for multi-packet messages.\n00149|       \n00150|       UE Spec: Table 3-8, Section 3.4.5.4.1\n00151|     x-required: true\n00152|     x-spec-ref: \"Table 3-8, field 'Initiator Error (ie)'; Section 3.4.5.4.1\"\n00153|   \n00154|   - id: relative\n00155|     type: b1\n00156|     doc: |\n00157|       Relative addressing flag (1 bit). When set to 1, this packet uses relative\n00158|       addressing mode. When set to 0, uses absolute addressing mode.\n00159|       \n00160|       UE Spec: Table 3-8, Section 3.4.1.3\n00161|     x-required: true\n00162|     x-spec-ref: \"Table 3-8, field 'Relative (rel)'; Section 3.4.1.3\"\n00163|   \n00164|   - id: header_data_present\n00165|     type: b1\n00166|     doc: |\n00167|       Header Data Present flag (1 bit). When set to 1, header data was provided\n00168|       for this message and the header_data field contains valid completion data.\n00169|       When set to 0, the header_data field is ignored.\n00170|       \n00171|       UE Spec: Table 3-8, Section 3.4.1.9\n00172|     x-required: true\n00173|     x-spec-ref: \"Table 3-8, field 'header data present (hd)'; Section 3.4.1.9\"\n00174|   \n00175|   - id: end_of_msg\n00176|     type: b1\n00177|     doc: |\n00178|       End of Message flag (1 bit). When set to 1, indicates the last packet of\n00179|       the message. ses.eom MUST be set on the last packet of a message.\n00180|       \n00181|       UE Spec: Table 3-8, Section 3.4.1.7.3\n00182|     x-required: true\n00183|     x-spec-ref: \"Table 3-8, field 'End of Msg (eom)'; Section 3.4.1.7.3\"\n00184|   \n00185|   - id: start_of_msg\n00186|     type: b1\n00187|     doc: |\n00188|       Start of Message flag (1 bit). When set to 1, indicates this is the first\n00189|       packet of a message. Impacts the interpretation of header_data field.\n00190|       MUST be 1 for this header format (Table 3-8 is for SOM=1).\n00191|       \n00192|       UE Spec: Table 3-8, Section 3.4.1.7.3\n00193|     x-required: true\n00194|     x-constraint: \"value == 1 (this header format requires SOM=1)\"\n00195|     x-spec-ref: \"Table 3-8, field 'Start of Msg (som)'; Section 3.4.1.7.3\"\n00196|   \n00197|   # Byte 2-3: Message ID (16 bits)\n00198|   \n00199|   - id: message_id\n00200|     type: u2\n00201|     doc: |\n00202|       Message Identifier (16 bits). Assists in associating different packets to one\n00203|       message at the target. Also assists in reverse mapping responses to messages.\n00204|       \n00205|       The value of 0 is reserved to indicate that the message ID is not valid.\n00206|       \n00207|       UE Spec: Table 3-8, Section 3.4.1.14\n00208|     x-required: true\n00209|     x-constraint: \"value == 0 is reserved (indicates message ID not valid)\"\n00210|     x-spec-ref: \"Table 3-8, field 'message_id'; Section 3.4.1.14\"\n00211|   \n00212|   # Byte 4: RI Generation (8 bits)\n00213|   \n00214|   - id: ri_generation\n00215|     type: u1\n00216|     doc: |\n00217|       Resource Index Generation (8 bits). Used for resource index generation\n00218|       and buffer exhaustion recovery mechanisms.\n00219|       \n00220|       UE Spec: Table 3-8, Section 3.4.3.6.3\n00221|     x-required: true\n00222|     x-spec-ref: \"Table 3-8, field 'ri_generation'; Section 3.4.3.6.3\"\n00223|   \n00224|   # Byte 5-7: JobID (24 bits)\n00225|   \n00226|   - id: job_id\n00227|     type: b24\n00228|     doc: |\n00229|       Job Identifier (24 bits). Used for relative addressing and for buffer access\n00230|       authorization. Matches size of VXLAN VNI.\n00231|       \n00232|       The JobID MUST be assigned by or validated by a trusted layer within the\n00233|       initiating node. For every access to a buffer, the implementation MUST\n00234|       validate that the JobID is allowed to access the buffer.\n00235|       \n00236|       UE Spec: Table 3-8, Section 3.4.1.3.1\n00237|     x-required: true\n00238|     x-spec-ref: \"Table 3-8, field 'JobID'; Section 3.4.1.3.1\"\n00239|   \n00240|   # Byte 8-9: Reserved (4 bits) + PIDonFEP (12 bits)\n00241|   \n00242|   - id: rsvd_1\n00243|     type: b4\n00244|     doc: |\n00245|       Reserved bits (4 bits). MUST be 0.\n00246|       UE Spec: Table 3-8, between JobID and PIDonFEP.\n00247|     x-required: true\n00248|     x-constraint: \"value == 0\"\n00249|     x-spec-ref: \"Table 3-8, field 'rsvd'\"\n00250|   \n00251|   - id: pid_on_fep\n00252|     type: b12\n00253|     doc: |\n00254|       Process ID on FEP (12 bits). The PIDonFEP value to be used at the target.\n00255|       Identifies the target process within the fabric endpoint.\n00256|       \n00257|       UE Spec: Table 3-8, Section 3.4.1.3.2\n00258|     x-required: true\n00259|     x-spec-ref: \"Table 3-8, field 'PIDonFEP'; Section 3.4.1.3.2\"\n00260|   \n00261|   # Byte 10-11: Reserved (4 bits) + Resource Index (12 bits)\n00262|   \n00263|   - id: rsvd_2\n00264|     type: b4\n00265|     doc: |\n00266|       Reserved bits (4 bits). MUST be 0.\n00267|       UE Spec: Table 3-8, between PIDonFEP and resource_index.\n00268|     x-required: true\n00269|     x-constraint: \"value == 0\"\n00270|     x-spec-ref: \"Table 3-8, field 'rsvd'\"\n00271|   \n00272|   - id: resource_index\n00273|     type: b12\n00274|     doc: |\n00275|       Resource Index (12 bits). Selects a specific resource (buffer, queue, etc.)\n00276|       within the target process identified by {JobID, PIDonFEP}.\n00277|       \n00278|       UE Spec: Table 3-8, Section 3.4.1.3.3\n00279|     x-required: true\n00280|     x-spec-ref: \"Table 3-8, field 'resource_index'; Section 3.4.1.3.3\"\n00281|   \n00282|   # Byte 12-19: Buffer Offset (64 bits)\n00283|   \n00284|   - id: buffer_offset\n00285|     type: u8\n00286|     doc: |\n00287|       Buffer Offset (64 bits). Offset within the target buffer used for 0-based addressing.\n00288|       \n00289|       The first memory access of the first packet in a message begins at Buffer Offset\n00290|       bytes from the base of the memory region selected. In multi-packet messages,\n00291|       Buffer Offset is the same across packets, so that Buffer Offset and Request Length\n00292|       can be used together to determine if the message fits in the target buffer.\n00293|       \n00294|       The access address of a given packet is:\n00295|         Buffer Base Address (from memory region) + Buffer Offset + \n00296|         offset within message (from header_data field for packets with ses.som=0)\n00297|       \n00298|       SPECIAL USE CASE for deferrable send requests (UET_DEFERRABLE_SEND,\n00299|       UET_DEFERRABLE_TSEND): This field carries the restart token instead of buffer offset.\n00300|       - Upper 32 bits: Initiator restart token (allocated by initiator)\n00301|       - Lower 32 bits: Target restart token (set to 0 in initial request)\n00302|       All active restart tokens must be unique at the initiating FEP.\n00303|       \n00304|       SPECIAL USE CASE for FI_MR_VIRT_ADDR: Some implementations may support\n00305|       FI_MR_VIRT_ADDR in libfabric API. In these cases, this field carries the\n00306|       absolute virtual address where the payload is delivered.\n00307|       \n00308|       UE Spec: Table 3-8, Section 3.4.1.7 (buffer offset), Section 3.4.4.4 (deferrable sends)\n00309|     x-required: true\n00310|     x-spec-ref: \"Table 3-8, field 'buffer_offset'\"\n00311|     x-special-use:\n00312|       - \"Deferrable sends: restart token (upper 32b initiator, lower 32b target)\"\n00313|       - \"FI_MR_VIRT_ADDR: absolute virtual address\"\n00314|   \n00315|   # Byte 20-23: Initiator (32 bits)\n00316|   \n00317|   - id: initiator\n00318|     type: u4\n00319|     doc: |\n00320|       Initiator ID (32 bits). Used as part of matching criteria for tagged operations.\n00321|       \n00322|       For tagged sends (UET_SEND, UET_TAGGED_SEND, UET_RENDEZVOUS_SEND, etc.),\n00323|       the {initiator, match_bits} tuple is used to match against posted receive buffers\n00324|       at the target. The initiator field allows the target to distinguish messages from\n00325|       different senders.\n00326|       \n00327|       UE Spec: Table 3-8, Section 3.4.1.3.4\n00328|     x-required: true\n00329|     x-spec-ref: \"Table 3-8, field 'initiator'; Section 3.4.1.3.4\"\n00330|   \n00331|   # Byte 24-31: Match Bits / Memory Key (64 bits)\n00332|   \n00333|   - id: match_bits_or_memory_key\n00334|     type: u8\n00335|     doc: |\n00336|       Match Bits / Memory Key (64 bits). Dual-purpose field depending on opcode.\n00337|       \n00338|       FOR TAGGED OPERATIONS (sends, tagged sends):\n00339|         Used for tagged matching. The {initiator, match_bits} tuple selects a buffer\n00340|         from the tagged receive queue. Matching criteria can include ignore bits\n00341|         (wildcards) unless exact matching is required by the endpoint.\n00342|       \n00343|       FOR RMA OPERATIONS (reads, writes):\n00344|         Used as a memory key to identify and authorize access to the target memory region.\n00345|         The memory key encoding is defined by the libfabric provider implementation.\n00346|         In abbreviated encoding, all key information is in the Resource Index.\n00347|         In full encoding, this 64-bit field transports the complete memory key.\n00348|       \n00349|       FOR READY-TO-RESTART REQUESTS (UET_DEFERRABLE_RTR):\n00350|         This field carries the restart token:\n00351|         - Upper 32 bits: Initiator restart token (echoed from original request)\n00352|         - Lower 32 bits: Target restart token (allocated by target in RTR message)\n00353|       \n00354|       UE Spec: Table 3-8, Section 3.4.1.3.5\n00355|     x-required: true\n00356|     x-spec-ref: \"Table 3-8, field 'match_bits / memory_key'; Section 3.4.1.3.5\"\n00357|     x-usage:\n00358|       - \"Tagged operations: matching criteria with initiator\"\n00359|       - \"RMA operations: memory key for authorization\"\n00360|       - \"Ready-to-restart: restart token (initiator + target)\"\n00361|   \n00362|   # Byte 32-39: Header Data (64 bits)\n00363|   \n00364|   - id: header_data\n00365|     type: u8\n00366|     doc: |\n00367|       Header Data (64 bits). Completion data to deliver at the target when this\n00368|       operation completes, when ses.som=1.\n00369|       \n00370|       If ses.hd (header_data_present) flag is 0, this field is ignored.\n00371|       \n00372|       When ses.som=1: This field contains completion data (e.g., immediate data for\n00373|       RDMA Write-with-Immediate, or completion context for the application).\n00374|       \n00375|       When ses.som=0: This field contains the message offset (32 bits) - see Table 3-9.\n00376|       \n00377|       UE Spec: Table 3-8, Section 3.4.1.11\n00378|     x-required: true\n00379|     x-conditional: \"Valid only if header_data_present flag is 1\"\n00380|     x-spec-ref: \"Table 3-8, field 'header_data'; Section 3.4.1.11\"\n00381|   \n00382|   # Byte 40-43: Request Length (32 bits)\n00383|   \n00384|   - id: request_length\n00385|     type: u4\n00386|     doc: |\n00387|       Request Length (32 bits). Length of the payload to be transferred (in bytes).\n00388|       \n00389|       Valid range: 0 to 2^32-1 bytes (0 is legal for 0-byte write/read operations).\n00390|       Maximum size is 4GB - 1 byte.\n00391|       \n00392|       The request_length field MUST be populated both when ses.som=1 and ses.som=0.\n00393|       \n00394|       Individual implementations MAY limit the size of RMA operations and send\n00395|       operations separately. Such limits are exposed through max message size\n00396|       capabilities in libfabric.\n00397|       \n00398|       Implementations MUST break data into packets containing payload sizes conforming\n00399|       to Payload MTU. All packets in a message (except the last) carry exactly\n00400|       Payload MTU bytes of data.\n00401|       \n00402|       UE Spec: Table 3-8, Section 3.4.1.11\n00403|     x-required: true\n00404|     x-constraint: \"value <= 2^32-1 (maximum 4GB-1)\"\n00405|     x-spec-ref: \"Table 3-8, field 'request_length'\"\n00406| \n00407| # Enumerations for SES Opcodes\n00408| # Per Kaitai best practices: Use enums for clarity and validation\n00409| # Source: UE Specification v1.0.1, Table 3-17 (Supported Request Messages)\n00410| enums:\n00411|   ses_opcode_enum:\n00412|     0x00: uet_no_op\n00413|     0x01: uet_write\n00414|     0x02: uet_read\n00415|     0x03: uet_atomic\n00416|     0x04: uet_fetching_atomic\n00417|     0x05: uet_send\n00418|     0x06: uet_rendezvous_send\n00419|     0x07: uet_datagram_send\n00420|     0x08: uet_deferrable_send\n00421|     0x09: uet_tagged_send\n00422|     0x0a: uet_rendezvous_tsend\n00423|     0x0b: uet_deferrable_tsend\n00424|     0x0c: uet_deferrable_rtr\n00425|     0x0d: uet_tsend_atomic\n00426|     0x0e: uet_tsend_fetch_atomic\n00427|     0x3f: uet_msg_error\n00428| \n00429| # Validation Notes (for field validator):\n00430| # \n00431| # 1. Total header size MUST be exactly 44 bytes (352 bits)\n00432| # 2. All reserved fields MUST be 0\n00433| # 3. ses.som MUST be 1 for this header format\n00434| # 4. ses.opcode MUST be a valid request opcode from Table 3-17\n00435| # 5. message_id == 0 is reserved (indicates message ID not valid)\n00436| # 6. request_length maximum is 2^32-1\n00437| # 7. Field dependencies:\n00438| #    - If header_data_present == 0, header_data is ignored\n00439| #    - If opcode is deferrable send, buffer_offset contains restart token\n00440| #    - If opcode is RMA, match_bits_or_memory_key contains memory key\n00441| #    - If opcode is tagged send, match_bits_or_memory_key contains match bits\n00442| #\n00443| # Reference: ue-taxonomy/reference/field_definitions/ses_standard_request_som1.yaml\n00444| \n\n(End of file - total 444 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/ses/standard_request_som1.ksy",
            "metadata": {
              "preview": "# GOLDEN REFERENCE: SES Standard Request Header (SOM=1)\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Table 3-8, Section 3.4.2.1, Page 158\n# \n# This is a GOLDEN REFERENCE definition demonstrating extreme rigor and serving\n# as a template for all subsequent packet definitions in the UE taxonomy.\n#\n# Quality Standards Applied:\n# 1. Every field extracted with exact bit position and width from Table 3-8\n# 2. All fields have x-required metadata (mandatory/optional per UE Spec)\n# 3. Complete x-spec metadata (table, section, page) for traceability\n# 4. All constraints captured (reserved bits MUST be 0, enum types, valid ranges)\n# 5. Field dependencies and relationships documented\n# 6. Byte-level and bit-level layout matches UE Spec exactly (44 bytes total)\n# 7. All section references included for validation\n#\n# Leverages Cornelis IP:\n# - Omni-Path packet format rigor (field-level validation, reserved bit handling)\n# - Kaitai Struct best practices (enums, contents validation, bit-endian)\n# - Linux netlink YAML patterns (byte-order, padding, checks)",
              "truncated": false
            },
            "time": {
              "start": 1769122010969,
              "end": 1769122011037,
              "compacted": 1769124449185
            }
          }
        },
        {
          "id": "prt_be7e3975f001KFosYYBLdM6NEh",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e37350001M0JnhjKsNzdvWT",
          "type": "tool",
          "callID": "toolu_013dJR8zjYS5CraPxYRMULoX",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/ses/small_message.ksy"
            },
            "output": "<file>\n00001| # SES Small Message Header\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Figure 3-14, Section 3.4.2.3, Page 164\n00004| #\n00005| # Small Message format for single-packet messages with matching criteria.\n00006| \n00007| meta:\n00008|   id: ses_small_message\n00009|   title: SES Small Message Header Format\n00010|   endian: be\n00011|   bit-endian: be\n00012|   doc: |\n00013|     Ultra Ethernet Transport (UET) Semantic Sublayer (SES) Small Message Header Format.\n00014|     \n00015|     This 32-byte header is used for single-packet messages with matching criteria.\n00016|     It carries an abbreviated 14-bit request_length field and includes header_data\n00017|     but eliminates the buffer_offset field (not needed for single-packet messages).\n00018|     \n00019|     Usage: Single-packet message with matching criteria that still utilizes header\n00020|     data but does not need an offset.\n00021|     \n00022|     Both ses.som and ses.eom must be set to 1 (single packet).\n00023|     \n00024|     Total Size: 32 bytes (256 bits)\n00025|     \n00026|     Wire Format (bytes 0-31):\n00027|     - Byte 0-1: Control flags and opcode (16 bits)\n00028|     - Byte 2-3: reserved(2) + request_length(14)\n00029|     - Byte 4: ri_generation (8 bits)\n00030|     - Byte 5-7: JobID (24 bits)\n00031|     - Byte 8-9: PIDonFEP and reserved (16 bits)\n00032|     - Byte 10-11: resource_index and reserved (16 bits)\n00033|     - Byte 12-15: initiator (32 bits)\n00034|     - Byte 16-23: match_bits (64 bits)\n00035|     - Byte 24-31: header_data (64 bits)\n00036|   \n00037|   doc-ref:\n00038|     - \"UE Specification v1.0.1, Figure 3-14, Page 164\"\n00039|     - \"UE Specification v1.0.1, Section 3.4.2.3\"\n00040|   \n00041|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00042|   ks-version: \"0.10\"\n00043| \n00044| x-spec:\n00045|   figure: \"Figure 3-14\"\n00046|   section: \"Section 3.4.2.3\"\n00047|   page: 164\n00048|   spec_version: \"1.0.1\"\n00049|   spec_date: \"2025-09-05\"\n00050| \n00051| x-packet:\n00052|   layer: \"transport\"\n00053|   sublayer: \"ses\"\n00054|   category: \"request_header\"\n00055|   size_bytes: 32\n00056|   size_bits: 256\n00057|   \n00058|   constraints:\n00059|     - \"Reserved fields MUST be 0\"\n00060|     - \"ses.som and ses.eom MUST both be 1 (single packet)\"\n00061|     - \"request_length is 14 bits (max 16383 bytes)\"\n00062|     - \"Includes matching criteria (initiator, match_bits)\"\n00063|     - \"Includes header_data\"\n00064|     - \"No buffer_offset (single packet)\"\n00065|   \n00066|   usage:\n00067|     - \"Single-packet message with matching\"\n00068|     - \"Utilizes header_data\"\n00069|     - \"No offset needed\"\n00070|   \n00071|   related_packets:\n00072|     - \"standard_request_som1\"\n00073|     - \"small_rma\"\n00074|     - \"optimized_non_matching\"\n00075| \n00076| seq:\n00077|   # Byte 0: opcode(6) + version(2)\n00078|   - id: opcode\n00079|     type: b6\n00080|     enum: ses_opcode_enum\n00081|     doc: |\n00082|       Operation code (6 bits). Valid values from Table 3-17.\n00083|       UE Spec: Figure 3-14, Section 3.4.6.2\n00084|     x-required: true\n00085|     x-constraint: \"value in Table 3-17\"\n00086|     x-spec-ref: \"Figure 3-14, field 'opcode'; Table 3-17\"\n00087|   \n00088|   - id: version\n00089|     type: b2\n00090|     doc: |\n00091|       Semantic protocol version (2 bits). Set to 0 in initial version.\n00092|       UE Spec: Figure 3-14.\n00093|     x-required: true\n00094|     x-constraint: \"value == 0 for UE Spec v1.0.1\"\n00095|     x-spec-ref: \"Figure 3-14, field 'version (ver)'\"\n00096|   \n00097|   # Byte 1: dc(1) + ie(1) + rel(1) + hd(1) + eom(1) + som(1) + rsvd(2)\n00098|   - id: delivery_complete\n00099|     type: b1\n00100|     doc: |\n00101|       Delivery Complete flag (1 bit).\n00102|       UE Spec: Figure 3-14, Section 3.4.8.3\n00103|     x-required: true\n00104|     x-spec-ref: \"Figure 3-14, field 'dc'\"\n00105|   \n00106|   - id: initiator_error\n00107|     type: b1\n00108|     doc: |\n00109|       Initiator Error flag (1 bit).\n00110|       UE Spec: Figure 3-14, Section 3.4.5.4.1\n00111|     x-required: true\n00112|     x-spec-ref: \"Figure 3-14, field 'ie'\"\n00113|   \n00114|   - id: relative\n00115|     type: b1\n00116|     doc: |\n00117|       Relative addressing flag (1 bit).\n00118|       UE Spec: Figure 3-14, Section 3.4.1.3\n00119|     x-required: true\n00120|     x-spec-ref: \"Figure 3-14, field 'rel'\"\n00121|   \n00122|   - id: header_data_present\n00123|     type: b1\n00124|     doc: |\n00125|       Header Data Present flag (1 bit).\n00126|       UE Spec: Figure 3-14\n00127|     x-required: true\n00128|     x-spec-ref: \"Figure 3-14, field 'hd'\"\n00129|   \n00130|   - id: end_of_msg\n00131|     type: b1\n00132|     doc: |\n00133|       End of Message flag (1 bit). MUST be 1 (single packet).\n00134|       UE Spec: Figure 3-14\n00135|     x-required: true\n00136|     x-constraint: \"value == 1\"\n00137|     x-spec-ref: \"Figure 3-14, field 'eom'\"\n00138|     valid:\n00139|       eq: 1\n00140|   \n00141|   - id: start_of_msg\n00142|     type: b1\n00143|     doc: |\n00144|       Start of Message flag (1 bit). MUST be 1 (single packet).\n00145|       UE Spec: Figure 3-14\n00146|     x-required: true\n00147|     x-constraint: \"value == 1\"\n00148|     x-spec-ref: \"Figure 3-14, field 'som'\"\n00149|     valid:\n00150|       eq: 1\n00151|   \n00152|   - id: rsvd_1\n00153|     type: b2\n00154|     doc: |\n00155|       Reserved bits (2 bits). MUST be 0.\n00156|       UE Spec: Figure 3-14.\n00157|     x-required: true\n00158|     x-constraint: \"value == 0\"\n00159|     x-spec-ref: \"Figure 3-14, field 'rsvd'\"\n00160|     valid:\n00161|       eq: 0\n00162|   \n00163|   # Bytes 2-3: rsvd(2) + request_length(14)\n00164|   - id: rsvd_2\n00165|     type: b2\n00166|     doc: |\n00167|       Reserved bits (2 bits). MUST be 0.\n00168|       UE Spec: Figure 3-14.\n00169|     x-required: true\n00170|     x-constraint: \"value == 0\"\n00171|     x-spec-ref: \"Figure 3-14, field 'rsvd'\"\n00172|     valid:\n00173|       eq: 0\n00174|   \n00175|   - id: request_length\n00176|     type: b14\n00177|     doc: |\n00178|       Request Length (14 bits). Length of payload (max 16383 bytes).\n00179|       UE Spec: Figure 3-14.\n00180|     x-required: true\n00181|     x-constraint: \"value <= 16383\"\n00182|     x-spec-ref: \"Figure 3-14, field 'request_length'\"\n00183|   \n00184|   # Byte 4: ri_generation\n00185|   - id: ri_generation\n00186|     type: u1\n00187|     doc: |\n00188|       Resource Index Generation (8 bits).\n00189|       UE Spec: Figure 3-14, Section 3.4.3.6.3\n00190|     x-required: true\n00191|     x-spec-ref: \"Figure 3-14, field 'ri_generation'\"\n00192|   \n00193|   # Bytes 5-7: JobID\n00194|   - id: job_id\n00195|     type: b24\n00196|     doc: |\n00197|       Job Identifier (24 bits).\n00198|       UE Spec: Figure 3-14, Section 3.4.1.3.1\n00199|     x-required: true\n00200|     x-spec-ref: \"Figure 3-14, field 'JobID'\"\n00201|   \n00202|   # Bytes 8-9: rsvd(4) + pid_on_fep(12)\n00203|   - id: rsvd_8\n00204|     type: b4\n00205|     doc: |\n00206|       Reserved bits (4 bits). MUST be 0.\n00207|       UE Spec: Figure 3-14.\n00208|     x-required: true\n00209|     x-constraint: \"value == 0\"\n00210|     x-spec-ref: \"Figure 3-14, field 'rsvd'\"\n00211|     valid:\n00212|       eq: 0\n00213|   \n00214|   - id: pid_on_fep\n00215|     type: b12\n00216|     doc: |\n00217|       Process ID on FEP (12 bits).\n00218|       UE Spec: Figure 3-14, Section 3.4.1.3.2\n00219|     x-required: true\n00220|     x-spec-ref: \"Figure 3-14, field 'PIDonFEP'\"\n00221|   \n00222|   # Bytes 10-11: rsvd(4) + resource_index(12)\n00223|   - id: rsvd_10\n00224|     type: b4\n00225|     doc: |\n00226|       Reserved bits (4 bits). MUST be 0.\n00227|       UE Spec: Figure 3-14.\n00228|     x-required: true\n00229|     x-constraint: \"value == 0\"\n00230|     x-spec-ref: \"Figure 3-14, field 'rsvd'\"\n00231|     valid:\n00232|       eq: 0\n00233|   \n00234|   - id: resource_index\n00235|     type: b12\n00236|     doc: |\n00237|       Resource Index (12 bits).\n00238|       UE Spec: Figure 3-14, Section 3.4.1.3.3\n00239|     x-required: true\n00240|     x-spec-ref: \"Figure 3-14, field 'resource_index'\"\n00241|   \n00242|   # Bytes 12-15: initiator\n00243|   - id: initiator\n00244|     type: u4\n00245|     doc: |\n00246|       Initiator ID (32 bits). Used as part of matching criteria.\n00247|       UE Spec: Figure 3-14, Section 3.4.1.3.4\n00248|     x-required: true\n00249|     x-spec-ref: \"Figure 3-14, field 'initiator'\"\n00250|   \n00251|   # Bytes 16-23: match_bits\n00252|   - id: match_bits\n00253|     type: u8\n00254|     doc: |\n00255|       Match Bits (64 bits). Used for tagged matching.\n00256|       UE Spec: Figure 3-14, Section 3.4.1.3.5\n00257|     x-required: true\n00258|     x-spec-ref: \"Figure 3-14, field 'match_bits'\"\n00259|   \n00260|   # Bytes 24-31: header_data\n00261|   - id: header_data\n00262|     type: u8\n00263|     doc: |\n00264|       Header Data (64 bits). Completion data to deliver at target.\n00265|       UE Spec: Figure 3-14, Section 3.4.1.11\n00266|     x-required: true\n00267|     x-spec-ref: \"Figure 3-14, field 'header_data'\"\n00268| \n00269| enums:\n00270|   ses_opcode_enum:\n00271|     0x00:\n00272|       id: uet_no_op\n00273|       doc: \"No operation\"\n00274|     0x01:\n00275|       id: uet_write\n00276|       doc: \"Write operation\"\n00277|     0x02:\n00278|       id: uet_read\n00279|       doc: \"Read operation\"\n00280|     0x05:\n00281|       id: uet_send\n00282|       doc: \"Send operation\"\n00283|     0x06:\n00284|       id: uet_tsend\n00285|       doc: \"Tagged send operation\"\n00286|     0x0E:\n00287|       id: uet_small_message\n00288|       doc: \"Small message operation\"\n00289| \n\n(End of file - total 289 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/ses/small_message.ksy",
            "metadata": {
              "preview": "# SES Small Message Header\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Figure 3-14, Section 3.4.2.3, Page 164\n#\n# Small Message format for single-packet messages with matching criteria.\n\nmeta:\n  id: ses_small_message\n  title: SES Small Message Header Format\n  endian: be\n  bit-endian: be\n  doc: |\n    Ultra Ethernet Transport (UET) Semantic Sublayer (SES) Small Message Header Format.\n    \n    This 32-byte header is used for single-packet messages with matching criteria.\n    It carries an abbreviated 14-bit request_length field and includes header_data\n    but eliminates the buffer_offset field (not needed for single-packet messages).\n    \n    Usage: Single-packet message with matching criteria that still utilizes header\n    data but does not need an offset.",
              "truncated": false
            },
            "time": {
              "start": 1769122010976,
              "end": 1769122011026,
              "compacted": 1769124449185
            }
          }
        },
        {
          "id": "prt_be7e3976900165PgvpkVNc5WL7",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e37350001M0JnhjKsNzdvWT",
          "type": "tool",
          "callID": "toolu_01UptbKJ72hkuKfm2k6vG2sV",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/ses/response.ksy"
            },
            "output": "<file>\n00001| # GOLDEN REFERENCE: SES Response Header\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Table 3-11, Section 3.4.2.5, Page 167\n00004| #\n00005| # This is a GOLDEN REFERENCE definition demonstrating extreme rigor for a simpler\n00006| # packet format (16 bytes vs 44 bytes for standard request).\n00007| #\n00008| # Quality Standards Applied:\n00009| # 1. Every field extracted with exact bit position and width from Table 3-11\n00010| # 2. All fields have x-required metadata\n00011| # 3. Complete x-spec metadata for traceability\n00012| # 4. All constraints captured (reserved bits, enum types, valid ranges)\n00013| # 5. Byte-level layout matches UE Spec exactly (16 bytes total)\n00014| # 6. All section references included\n00015| #\n00016| # Leverages Cornelis IP: OPA packet format rigor, Kaitai best practices\n00017| \n00018| meta:\n00019|   id: ses_response\n00020|   title: SES Response Header\n00021|   endian: be\n00022|   bit-endian: be\n00023|   doc: |\n00024|     Ultra Ethernet Transport (UET) Semantic Sublayer (SES) Response Header.\n00025|     \n00026|     This is the basic 16-byte response header used for semantic responses without\n00027|     payload data. It carries the return code, message ID of the original request,\n00028|     and modified length indicating how many bytes were actually transferred.\n00029|     \n00030|     For responses with data payload, see Table 3-12 (Response with Data Header).\n00031|     For optimized responses with data, see Table 3-13.\n00032|     \n00033|     Total Size: 16 bytes (128 bits)\n00034|     \n00035|     Wire Format (bytes 0-15):\n00036|     - Byte 0-1: Control flags, opcode, return code (16 bits)\n00037|     - Byte 2-3: Message ID (16 bits)\n00038|     - Byte 4: RI Generation (8 bits)\n00039|     - Byte 5-7: JobID (24 bits)\n00040|     - Byte 8-11: Modified Length (32 bits)\n00041|     - Byte 12-15: Reserved (32 bits)\n00042|   \n00043|   doc-ref:\n00044|     - \"UE Specification v1.0.1, Table 3-11, Page 167\"\n00045|     - \"UE Specification v1.0.1, Section 3.4.2.5 (Response Header Formats)\"\n00046|   \n00047|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00048|   ks-version: \"0.10\"\n00049| \n00050| x-spec:\n00051|   table: \"Table 3-11\"\n00052|   section: \"Section 3.4.2.5\"\n00053|   page: 167\n00054|   spec_version: \"1.0.1\"\n00055|   spec_date: \"2025-09-05\"\n00056| \n00057| x-packet:\n00058|   layer: \"transport\"\n00059|   sublayer: \"ses\"\n00060|   category: \"response_header\"\n00061|   size_bytes: 16\n00062|   size_bits: 128\n00063|   \n00064|   constraints:\n00065|     - \"Reserved fields MUST be 0\"\n00066|     - \"opcode MUST be valid response opcode per Table 3-18\"\n00067|     - \"return_code MUST be valid per Table 3-19\"\n00068|     - \"list field indicates expected vs unexpected delivery\"\n00069| \n00070| seq:\n00071|   # Byte 0-1: Control Flags, Opcode, Return Code (16 bits total)\n00072|   # Bit layout: list(2) | opcode(6) | ver(2) | return_code(6)\n00073|   \n00074|   - id: list\n00075|     type: b2\n00076|     enum: list_enum\n00077|     doc: |\n00078|       List indicator (2 bits). Indicates if the payload was delivered to the\n00079|       expected or unexpected list at the target.\n00080|       \n00081|       Values (Table 3-20):\n00082|       - 0: Expected list\n00083|       - 1: Unexpected list\n00084|       - 2-3: Reserved\n00085|       \n00086|       UE Spec: Table 3-11, Section 3.4.6.3\n00087|     x-required: true\n00088|     x-constraint: \"Valid values: 0 (expected), 1 (unexpected), 2-3 (reserved)\"\n00089|     x-spec-ref: \"Table 3-11, field 'list'; Section 3.4.6.3; Table 3-20\"\n00090|   \n00091|   - id: opcode\n00092|     type: b6\n00093|     enum: ses_response_opcode_enum\n00094|     doc: |\n00095|       Response opcode (6 bits). Indicates type of response.\n00096|       Valid values are defined in Table 3-18 (Supported Response Messages).\n00097|       \n00098|       Examples:\n00099|       - 0x00: UET_DEFAULT_RESPONSE\n00100|       - 0x01: UET_RESPONSE\n00101|       - 0x02: UET_RESPONSE_W_DATA\n00102|       - 0x3F: UET_NO_RESPONSE\n00103|       \n00104|       UE Spec: Table 3-11, Section 3.4.6.2, Table 3-18\n00105|     x-required: true\n00106|     x-constraint: \"value in Table 3-18 (valid response opcodes)\"\n00107|     x-spec-ref: \"Table 3-11, field 'opcode'; Section 3.4.6.2; Table 3-18\"\n00108|   \n00109|   - id: version\n00110|     type: b2\n00111|     doc: |\n00112|       Semantic protocol version (2 bits). Set to 0 in the initial version.\n00113|       UE Spec: Table 3-11, field 'version (ver)'.\n00114|     x-required: true\n00115|     x-constraint: \"value == 0 for UE Spec v1.0.1\"\n00116|     x-spec-ref: \"Table 3-11, field 'version (ver)'\"\n00117|   \n00118|   - id: return_code\n00119|     type: b6\n00120|     enum: return_code_enum\n00121|     doc: |\n00122|       Return code (6 bits). Indicates success conditions and some types of error\n00123|       conditions detected at the semantic sublayer.\n00124|       \n00125|       Valid values are defined in Table 3-19 (Defined Semantic Return Codes).\n00126|       \n00127|       Examples:\n00128|       - 0x00: RC_OK (success)\n00129|       - 0x01: RC_NO_MATCH (no matching buffer found)\n00130|       - 0x02: RC_BUFFER_TOO_SMALL\n00131|       - 0x03: RC_AUTHORIZATION_FAILURE\n00132|       - ... (see Table 3-19 for complete list)\n00133|       \n00134|       UE Spec: Table 3-11, Section 3.4.6.3, Table 3-19\n00135|     x-required: true\n00136|     x-constraint: \"value in Table 3-19 (valid return codes)\"\n00137|     x-spec-ref: \"Table 3-11, field 'return_code'; Section 3.4.6.3; Table 3-19\"\n00138|   \n00139|   # Byte 2-3: Message ID (16 bits)\n00140|   \n00141|   - id: message_id\n00142|     type: u2\n00143|     doc: |\n00144|       Message ID (16 bits). Message ID of the original request.\n00145|       Used to associate this response with the initiating request.\n00146|       \n00147|       UE Spec: Table 3-11, Section 3.4.1.14\n00148|     x-required: true\n00149|     x-spec-ref: \"Table 3-11, field 'message_id'; Section 3.4.1.14\"\n00150|   \n00151|   # Byte 4: RI Generation (8 bits)\n00152|   \n00153|   - id: ri_generation\n00154|     type: u1\n00155|     doc: |\n00156|       Resource Index Generation (8 bits). Contains the new index generation\n00157|       on a generation mismatch response.\n00158|       \n00159|       Used for resource index generation and buffer exhaustion recovery.\n00160|       \n00161|       UE Spec: Table 3-11, Section 3.4.3.6.3\n00162|     x-required: true\n00163|     x-spec-ref: \"Table 3-11, field 'ri_generation'; Section 3.4.3.6.3\"\n00164|   \n00165|   # Byte 5-7: JobID (24 bits)\n00166|   \n00167|   - id: job_id\n00168|     type: b24\n00169|     doc: |\n00170|       Job Identifier (24 bits). JobID of the original request.\n00171|       Used to route the response back to the correct job context.\n00172|       \n00173|       UE Spec: Table 3-11, Section 3.4.1.3.1, Section 3.4.1.4.1\n00174|     x-required: true\n00175|     x-spec-ref: \"Table 3-11, field 'JobID'; Section 3.4.1.3.1; Section 3.4.1.4.1\"\n00176|   \n00177|   # Byte 8-11: Modified Length (32 bits)\n00178|   \n00179|   - id: modified_length\n00180|     type: u4\n00181|     doc: |\n00182|       Modified Length (32 bits). Indicates the number of bytes of the target buffer\n00183|       that will be modified by this transaction.\n00184|       \n00185|       For example, a message may be truncated because no buffer is available or\n00186|       the buffer it was targeting is too small. The modified_length indicates the\n00187|       actual number of bytes transferred, which may be less than the requested length.\n00188|       \n00189|       UE Spec: Table 3-11\n00190|     x-required: true\n00191|     x-constraint: \"value <= request_length from original request\"\n00192|     x-spec-ref: \"Table 3-11, field 'modified_length'\"\n00193|   \n00194|   # Byte 12-15: Reserved (32 bits)\n00195|   \n00196|   - id: rsvd\n00197|     type: u4\n00198|     doc: |\n00199|       Reserved (32 bits). MUST be 0.\n00200|       UE Spec: Table 3-11 (implied - total size is 16 bytes, remaining 4 bytes are reserved).\n00201|     x-required: true\n00202|     x-constraint: \"value == 0\"\n00203|     x-spec-ref: \"Table 3-11 (reserved padding to 16 bytes)\"\n00204| \n00205| enums:\n00206|   list_enum:\n00207|     0: expected_list\n00208|     1: unexpected_list\n00209|     # 2-3: reserved\n00210|   \n00211|   ses_response_opcode_enum:\n00212|     0x00: uet_default_response\n00213|     0x01: uet_response\n00214|     0x02: uet_response_w_data\n00215|     0x3f: uet_no_response\n00216|   \n00217|   return_code_enum:\n00218|     0x00: rc_ok\n00219|     0x01: rc_no_match\n00220|     0x02: rc_buffer_too_small\n00221|     0x03: rc_authorization_failure\n00222|     0x04: rc_invalid_operation\n00223|     0x05: rc_resource_exhaustion\n00224|     0x06: rc_generation_mismatch\n00225|     0x07: rc_truncated\n00226|     # Additional return codes from Table 3-19\n00227|     # (Full enumeration would include all codes from spec)\n00228| \n00229| # Validation Notes:\n00230| # \n00231| # 1. Total header size MUST be exactly 16 bytes (128 bits)\n00232| # 2. All reserved fields MUST be 0\n00233| # 3. opcode MUST be a valid response opcode from Table 3-18\n00234| # 4. return_code MUST be a valid return code from Table 3-19\n00235| # 5. list field MUST be 0 (expected) or 1 (unexpected)\n00236| # 6. message_id matches the message_id from the original request\n00237| # 7. modified_length <= request_length from original request\n00238| #\n00239| # Reference: ue-taxonomy/reference/field_definitions/ses_response.yaml\n00240| \n\n(End of file - total 240 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/ses/response.ksy",
            "metadata": {
              "preview": "# GOLDEN REFERENCE: SES Response Header\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Table 3-11, Section 3.4.2.5, Page 167\n#\n# This is a GOLDEN REFERENCE definition demonstrating extreme rigor for a simpler\n# packet format (16 bytes vs 44 bytes for standard request).\n#\n# Quality Standards Applied:\n# 1. Every field extracted with exact bit position and width from Table 3-11\n# 2. All fields have x-required metadata\n# 3. Complete x-spec metadata for traceability\n# 4. All constraints captured (reserved bits, enum types, valid ranges)\n# 5. Byte-level layout matches UE Spec exactly (16 bytes total)\n# 6. All section references included\n#\n# Leverages Cornelis IP: OPA packet format rigor, Kaitai best practices\n\nmeta:\n  id: ses_response\n  title: SES Response Header",
              "truncated": false
            },
            "time": {
              "start": 1769122010986,
              "end": 1769122011030,
              "compacted": 1769124449184
            }
          }
        },
        {
          "id": "prt_be7e3976b001eFpBNLQWnC7NyL",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e37350001M0JnhjKsNzdvWT",
          "type": "tool",
          "callID": "toolu_01JDiBek2r3R45y5V2pqrUEQ",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/ses/response_with_data.ksy"
            },
            "output": "<file>\n00001| # SES Response with Data Header\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Table 3-12, Section 3.4.2.5, Page 168\n00004| #\n00005| # Semantic Response with Data Header Format for responses carrying payload data.\n00006| \n00007| meta:\n00008|   id: ses_response_with_data\n00009|   title: SES Response with Data Header Format\n00010|   endian: be\n00011|   bit-endian: be\n00012|   doc: |\n00013|     Ultra Ethernet Transport (UET) Semantic Sublayer (SES) Response with Data\n00014|     Header Format.\n00015|     \n00016|     This 24-byte header is used for semantic responses that carry payload data\n00017|     (e.g., read responses, fetching atomic responses). It includes fields for\n00018|     tracking the original request and indicating the amount of data being returned.\n00019|     \n00020|     Total Size: 24 bytes (192 bits)\n00021|     \n00022|     Wire Format (bytes 0-23):\n00023|     - Byte 0: list(2) + opcode(6)\n00024|     - Byte 1: version(2) + return_code(6)\n00025|     - Byte 2-3: response_message_id (16 bits)\n00026|     - Byte 4: reserved (8 bits)\n00027|     - Byte 5-7: JobID (24 bits)\n00028|     - Byte 8-9: read_request_message_id (16 bits)\n00029|     - Byte 10-11: reserved(2) + payload_length(14)\n00030|     - Byte 12-15: modified_length (32 bits)\n00031|     - Byte 16-19: message_offset (32 bits)\n00032|     - Byte 20-23: reserved (32 bits)\n00033|   \n00034|   doc-ref:\n00035|     - \"UE Specification v1.0.1, Table 3-12, Page 168\"\n00036|     - \"UE Specification v1.0.1, Section 3.4.2.5\"\n00037|     - \"UE Specification v1.0.1, Figure 3-19\"\n00038|   \n00039|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00040|   ks-version: \"0.10\"\n00041| \n00042| x-spec:\n00043|   table: \"Table 3-12\"\n00044|   section: \"Section 3.4.2.5\"\n00045|   page: 168\n00046|   figure: \"Figure 3-19\"\n00047|   spec_version: \"1.0.1\"\n00048|   spec_date: \"2025-09-05\"\n00049| \n00050| x-packet:\n00051|   layer: \"transport\"\n00052|   sublayer: \"ses\"\n00053|   category: \"response_header\"\n00054|   size_bytes: 24\n00055|   size_bits: 192\n00056|   \n00057|   constraints:\n00058|     - \"Reserved fields MUST be 0\"\n00059|     - \"Used for read responses and fetching atomic responses\"\n00060|     - \"payload_length indicates data in this packet\"\n00061|     - \"modified_length indicates total data being returned\"\n00062|   \n00063|   related_packets:\n00064|     - \"response\"\n00065|     - \"optimized_response_with_data\"\n00066|     - \"standard_request_som1\"\n00067| \n00068| seq:\n00069|   # Byte 0: list(2) + opcode(6)\n00070|   - id: list\n00071|     type: b2\n00072|     enum: list_type_enum\n00073|     doc: |\n00074|       List indicator (2 bits). Indicates if payload was delivered to expected\n00075|       or unexpected list.\n00076|       \n00077|       UE Spec: Table 3-12, Section 3.4.6.3\n00078|     x-required: true\n00079|     x-spec-ref: \"Table 3-12, field 'list'; Section 3.4.6.3\"\n00080|   \n00081|   - id: opcode\n00082|     type: b6\n00083|     enum: ses_response_opcode_enum\n00084|     doc: |\n00085|       Response opcode (6 bits). Indicates type of response (e.g., semantic ACK,\n00086|       response with payload, etc.).\n00087|       \n00088|       Valid values from Table 3-18.\n00089|       \n00090|       UE Spec: Table 3-12, Section 3.4.6.2\n00091|     x-required: true\n00092|     x-constraint: \"value in Table 3-18 (valid response opcodes)\"\n00093|     x-spec-ref: \"Table 3-12, field 'opcode'; Table 3-18\"\n00094|   \n00095|   # Byte 1: version(2) + return_code(6)\n00096|   - id: version\n00097|     type: b2\n00098|     doc: |\n00099|       Semantic protocol version (2 bits). Set to 0 in initial version.\n00100|       \n00101|       UE Spec: Table 3-12, field 'version (ver)'.\n00102|     x-required: true\n00103|     x-constraint: \"value == 0 for UE Spec v1.0.1\"\n00104|     x-spec-ref: \"Table 3-12, field 'version (ver)'\"\n00105|   \n00106|   - id: return_code\n00107|     type: b6\n00108|     enum: ses_return_code_enum\n00109|     doc: |\n00110|       Return code (6 bits). Indicates success conditions and some types of error\n00111|       conditions detected at the semantic sublayer.\n00112|       \n00113|       Valid values from Table 3-19.\n00114|       \n00115|       UE Spec: Table 3-12, Section 3.4.6.3\n00116|     x-required: true\n00117|     x-constraint: \"value in Table 3-19 (defined return codes)\"\n00118|     x-spec-ref: \"Table 3-12, field 'return_code'; Table 3-19\"\n00119|   \n00120|   # Bytes 2-3: response_message_id (16 bits)\n00121|   - id: response_message_id\n00122|     type: u2\n00123|     doc: |\n00124|       Response Message ID (16 bits). Message ID of the response.\n00125|       \n00126|       UE Spec: Table 3-12, Section 3.4.1.14\n00127|     x-required: true\n00128|     x-spec-ref: \"Table 3-12, field 'response_message_id'; Section 3.4.1.14\"\n00129|   \n00130|   # Byte 4: reserved (8 bits)\n00131|   - id: reserved_4\n00132|     type: u1\n00133|     doc: |\n00134|       Reserved (8 bits). MUST be 0.\n00135|       \n00136|       UE Spec: Table 3-12, field 'rsvd'.\n00137|     x-required: true\n00138|     x-constraint: \"value == 0\"\n00139|     x-spec-ref: \"Table 3-12, field 'rsvd'\"\n00140|     valid:\n00141|       eq: 0\n00142|   \n00143|   # Bytes 5-7: JobID (24 bits)\n00144|   - id: job_id\n00145|     type: b24\n00146|     doc: |\n00147|       Job Identifier (24 bits). JobID of the original request.\n00148|       \n00149|       UE Spec: Table 3-12, Section 3.4.1.3.1, Section 3.4.1.4.1\n00150|     x-required: true\n00151|     x-spec-ref: \"Table 3-12, field 'JobID'; Section 3.4.1.3.1, 3.4.1.4.1\"\n00152|   \n00153|   # Bytes 8-9: read_request_message_id (16 bits)\n00154|   - id: read_request_message_id\n00155|     type: u2\n00156|     doc: |\n00157|       Read Request Message ID (16 bits). Message ID used in the original read\n00158|       request (or of the original fetching atomic operation request).\n00159|       \n00160|       UE Spec: Table 3-12, Section 3.4.1.14\n00161|     x-required: true\n00162|     x-spec-ref: \"Table 3-12, field 'read_request_message_id'; Section 3.4.1.14\"\n00163|   \n00164|   # Bytes 10-11: reserved(2) + payload_length(14)\n00165|   - id: reserved_10\n00166|     type: b2\n00167|     doc: |\n00168|       Reserved (2 bits). MUST be 0.\n00169|       \n00170|       UE Spec: Table 3-12, field 'rsvd'.\n00171|     x-required: true\n00172|     x-constraint: \"value == 0\"\n00173|     x-spec-ref: \"Table 3-12, field 'rsvd'\"\n00174|     valid:\n00175|       eq: 0\n00176|   \n00177|   - id: payload_length\n00178|     type: b14\n00179|     doc: |\n00180|       Payload Length (14 bits). Length of the payload in this specific packet\n00181|       for a response with data.\n00182|       \n00183|       Note: These bits are reserved in a semantic response without payload.\n00184|       \n00185|       UE Spec: Table 3-12, field 'payload_length'.\n00186|     x-required: true\n00187|     x-constraint: \"value <= 16383 (14-bit max)\"\n00188|     x-spec-ref: \"Table 3-12, field 'payload_length'\"\n00189|   \n00190|   # Bytes 12-15: modified_length (32 bits)\n00191|   - id: modified_length\n00192|     type: u4\n00193|     doc: |\n00194|       Modified Length (32 bits). Indicates the total number of bytes of the\n00195|       initiator buffer that will be modified by this transaction.\n00196|       \n00197|       For example, a message may be truncated because no buffer is available\n00198|       or the buffer it was targeting is too small.\n00199|       \n00200|       UE Spec: Table 3-12, field 'modified_length'.\n00201|     x-required: true\n00202|     x-spec-ref: \"Table 3-12, field 'modified_length'\"\n00203|   \n00204|   # Bytes 16-19: message_offset (32 bits)\n00205|   - id: message_offset\n00206|     type: u4\n00207|     doc: |\n00208|       Message Offset (32 bits). Indicates the relative position in the message\n00209|       that this payload corresponds to.\n00210|       \n00211|       UE Spec: Table 3-12, field 'message_offset'.\n00212|     x-required: true\n00213|     x-spec-ref: \"Table 3-12, field 'message_offset'\"\n00214|   \n00215|   # Bytes 20-23: reserved (32 bits)\n00216|   - id: reserved_20_23\n00217|     type: u4\n00218|     doc: |\n00219|       Reserved (32 bits). MUST be 0.\n00220|       \n00221|       UE Spec: Table 3-12 (implied - total size 24 bytes).\n00222|     x-required: true\n00223|     x-constraint: \"value == 0\"\n00224|     x-spec-ref: \"Table 3-12 (implied reserved space)\"\n00225|     valid:\n00226|       eq: 0\n00227| \n00228| enums:\n00229|   list_type_enum:\n00230|     0:\n00231|       id: expected_list\n00232|       doc: \"Payload delivered to expected list\"\n00233|     1:\n00234|       id: unexpected_list\n00235|       doc: \"Payload delivered to unexpected list\"\n00236|   \n00237|   ses_response_opcode_enum:\n00238|     0x00:\n00239|       id: uet_ack\n00240|       doc: \"Semantic acknowledgement\"\n00241|     0x01:\n00242|       id: uet_response_with_data\n00243|       doc: \"Response with payload data\"\n00244|     0x02:\n00245|       id: uet_response_error\n00246|       doc: \"Response indicating error\"\n00247|   \n00248|   ses_return_code_enum:\n00249|     0x00:\n00250|       id: rc_success\n00251|       doc: \"Operation completed successfully\"\n00252|     0x01:\n00253|       id: rc_no_response\n00254|       doc: \"No response generated\"\n00255|     0x02:\n00256|       id: rc_truncated\n00257|       doc: \"Message was truncated\"\n00258|     0x03:\n00259|       id: rc_buffer_error\n00260|       doc: \"Buffer error at target\"\n00261|     0x04:\n00262|       id: rc_permission_error\n00263|       doc: \"Permission/protection error\"\n00264|     0x05:\n00265|       id: rc_invalid_operation\n00266|       doc: \"Invalid operation\"\n00267|     0x06:\n00268|       id: rc_resource_error\n00269|       doc: \"Resource exhaustion\"\n00270|     0x07:\n00271|       id: rc_other_error\n00272|       doc: \"Other error condition\"\n00273| \n\n(End of file - total 273 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/ses/response_with_data.ksy",
            "metadata": {
              "preview": "# SES Response with Data Header\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Table 3-12, Section 3.4.2.5, Page 168\n#\n# Semantic Response with Data Header Format for responses carrying payload data.\n\nmeta:\n  id: ses_response_with_data\n  title: SES Response with Data Header Format\n  endian: be\n  bit-endian: be\n  doc: |\n    Ultra Ethernet Transport (UET) Semantic Sublayer (SES) Response with Data\n    Header Format.\n    \n    This 24-byte header is used for semantic responses that carry payload data\n    (e.g., read responses, fetching atomic responses). It includes fields for\n    tracking the original request and indicating the amount of data being returned.\n    \n    Total Size: 24 bytes (192 bits)",
              "truncated": false
            },
            "time": {
              "start": 1769122010989,
              "end": 1769122011050,
              "compacted": 1769124449183
            }
          }
        },
        {
          "id": "prt_be7e39775001soINx6GyQ8s40S",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e37350001M0JnhjKsNzdvWT",
          "type": "tool",
          "callID": "toolu_01FJzCnLvSoXCT3m1YLw2xF6",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/ses/atomic_extension.ksy"
            },
            "output": "<file>\n00001| # SES Atomic Operation Extension Header\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Figure 3-16, Section 3.4.2.4, Page 165\n00004| #\n00005| # Atomic Operation Extension Header for atomic operations.\n00006| \n00007| meta:\n00008|   id: ses_atomic_extension\n00009|   title: SES Atomic Operation Extension Header Format\n00010|   endian: be\n00011|   bit-endian: be\n00012|   doc: |\n00013|     Ultra Ethernet Transport (UET) Semantic Sublayer (SES) Atomic Operation\n00014|     Extension Header Format.\n00015|     \n00016|     Atomic operations include this 8-byte atomic header to describe the atomic\n00017|     operation. The memory model for atomic operations is discussed in Section 3.4.8.\n00018|     \n00019|     Atomic headers are carried with every packet of an atomic operation. They can\n00020|     be used with any of the optimized header formats or the standard header formats.\n00021|     \n00022|     Atomic headers MUST NOT be combined with the rendezvous header format.\n00023|     \n00024|     For non-fetching atomic operations, the number of elements is determined by:\n00025|       num_elements = request_length / atomic_datatype_size\n00026|     \n00027|     The payload part of messages containing atomic operations should be an integral\n00028|     multiple of the atomic datatype size. If not, the target FEP MUST truncate the\n00029|     operation to 0 bytes.\n00030|     \n00031|     Total Size: 8 bytes (64 bits)\n00032|     \n00033|     Wire Format (bytes 0-7):\n00034|     - Byte 0: atomic_opcode (8 bits)\n00035|     - Byte 1: atomic_datatype (8 bits)\n00036|     - Byte 2-3: semantic_control (16 bits)\n00037|     - Byte 4-7: reserved (32 bits)\n00038|   \n00039|   doc-ref:\n00040|     - \"UE Specification v1.0.1, Figure 3-16, Page 165\"\n00041|     - \"UE Specification v1.0.1, Section 3.4.2.4\"\n00042|     - \"UE Specification v1.0.1, Section 3.4.8 (Atomic Memory Model)\"\n00043|     - \"UE Specification v1.0.1, Table 3-21 (Atomic Opcodes)\"\n00044|     - \"UE Specification v1.0.1, Table 3-22 (Atomic Datatypes)\"\n00045|     - \"UE Specification v1.0.1, Table 3-23 (Semantic Control)\"\n00046|   \n00047|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00048|   ks-version: \"0.10\"\n00049| \n00050| x-spec:\n00051|   figure: \"Figure 3-16\"\n00052|   section: \"Section 3.4.2.4\"\n00053|   page: 165\n00054|   spec_version: \"1.0.1\"\n00055|   spec_date: \"2025-09-05\"\n00056| \n00057| x-packet:\n00058|   layer: \"transport\"\n00059|   sublayer: \"ses\"\n00060|   category: \"extension_header\"\n00061|   size_bytes: 8\n00062|   size_bits: 64\n00063|   \n00064|   constraints:\n00065|     - \"Reserved fields MUST be 0\"\n00066|     - \"Used with UET_ATOMIC or UET_FETCHING_ATOMIC opcodes\"\n00067|     - \"MUST NOT be combined with rendezvous header\"\n00068|     - \"Payload must be integral multiple of atomic_datatype size\"\n00069|     - \"Fetching atomics MUST NOT operate on more than one element\"\n00070|   \n00071|   usage:\n00072|     - \"Describes atomic operation type and datatype\"\n00073|     - \"Semantic control provides additional operation info\"\n00074|     - \"Payload follows atomic header\"\n00075|   \n00076|   related_packets:\n00077|     - \"standard_request_som1\"\n00078|     - \"optimized_non_matching\"\n00079|     - \"cas_extension\"\n00080| \n00081| seq:\n00082|   # Byte 0: atomic_opcode (8 bits)\n00083|   - id: atomic_opcode\n00084|     type: u1\n00085|     enum: atomic_opcode_enum\n00086|     doc: |\n00087|       Atomic Opcode (8 bits). Specifies the atomic operation to perform.\n00088|       \n00089|       Valid values from Table 3-21 (21 defined operations + vendor extensions).\n00090|       \n00091|       Examples: MIN, MAX, SUM, DIFF, PROD, LOR, LAND, BOR, BAND, LXOR, BXOR,\n00092|       READ, WRITE, CSWAP variants, MSWAP, INVAL.\n00093|       \n00094|       UE Spec: Figure 3-16, Table 3-21\n00095|     x-required: true\n00096|     x-constraint: \"value in Table 3-21 (atomic operation opcodes)\"\n00097|     x-spec-ref: \"Figure 3-16, field 'atomic_opcode'; Table 3-21\"\n00098|   \n00099|   # Byte 1: atomic_datatype (8 bits)\n00100|   - id: atomic_datatype\n00101|     type: u1\n00102|     enum: atomic_datatype_enum\n00103|     doc: |\n00104|       Atomic Datatype (8 bits). Specifies the datatype for the atomic operation.\n00105|       \n00106|       Valid values from Table 3-22.\n00107|       \n00108|       Examples: INT8, UINT8, INT16, UINT16, INT32, UINT32, INT64, UINT64,\n00109|       FLOAT, DOUBLE, FLOAT_COMPLEX, DOUBLE_COMPLEX, LONG_DOUBLE, LONG_DOUBLE_COMPLEX,\n00110|       FLOAT16, BFLOAT16.\n00111|       \n00112|       UE Spec: Figure 3-16, Table 3-22\n00113|     x-required: true\n00114|     x-constraint: \"value in Table 3-22 (atomic datatypes)\"\n00115|     x-spec-ref: \"Figure 3-16, field 'atomic_datatype'; Table 3-22\"\n00116|   \n00117|   # Bytes 2-3: semantic_control (16 bits)\n00118|   - id: semantic_control\n00119|     type: u2\n00120|     doc: |\n00121|       Semantic Control (16 bits). Provides additional information for handling\n00122|       of atomic operations.\n00123|       \n00124|       Defined in Table 3-23. Includes flags for operation behavior.\n00125|       \n00126|       UE Spec: Figure 3-16, Table 3-23\n00127|     x-required: true\n00128|     x-spec-ref: \"Figure 3-16, field 'semantic_control'; Table 3-23\"\n00129|   \n00130|   # Bytes 4-7: reserved (32 bits)\n00131|   - id: reserved_4_7\n00132|     type: u4\n00133|     doc: |\n00134|       Reserved (32 bits). MUST be 0.\n00135|       \n00136|       UE Spec: Figure 3-16 (implied - total size 8 bytes).\n00137|     x-required: true\n00138|     x-constraint: \"value == 0\"\n00139|     x-spec-ref: \"Figure 3-16 (implied reserved space)\"\n00140|     valid:\n00141|       eq: 0\n00142| \n00143| enums:\n00144|   atomic_opcode_enum:\n00145|     0x00:\n00146|       id: uet_amo_min\n00147|       doc: \"Minimum: Target = MIN(Target, Initiator)\"\n00148|     0x01:\n00149|       id: uet_amo_max\n00150|       doc: \"Maximum: Target = MAX(Target, Initiator)\"\n00151|     0x02:\n00152|       id: uet_amo_sum\n00153|       doc: \"Sum: Target = Target + Initiator\"\n00154|     0x03:\n00155|       id: uet_amo_diff\n00156|       doc: \"Diff: Target = Target - Initiator\"\n00157|     0x04:\n00158|       id: uet_amo_prod\n00159|       doc: \"Product: Target = Target * Initiator\"\n00160|     0x05:\n00161|       id: uet_amo_lor\n00162|       doc: \"Logical OR: Target = Target || Initiator\"\n00163|     0x06:\n00164|       id: uet_amo_land\n00165|       doc: \"Logical AND: Target = Target && Initiator\"\n00166|     0x07:\n00167|       id: uet_amo_bor\n00168|       doc: \"Bitwise OR: Target = Target | Initiator\"\n00169|     0x08:\n00170|       id: uet_amo_band\n00171|       doc: \"Bitwise AND: Target = Target & Initiator\"\n00172|     0x09:\n00173|       id: uet_amo_lxor\n00174|       doc: \"Logical XOR: Target = (Target && !Initiator) || (!Target && Initiator)\"\n00175|     0x0A:\n00176|       id: uet_amo_bxor\n00177|       doc: \"Bitwise XOR: Target = Target ^ Initiator\"\n00178|     0x0B:\n00179|       id: uet_amo_read\n00180|       doc: \"Atomic Read: Initiator = Target\"\n00181|     0x0C:\n00182|       id: uet_amo_write\n00183|       doc: \"Atomic Write: Target = Initiator\"\n00184|     0x0D:\n00185|       id: uet_amo_cswap\n00186|       doc: \"Compare and swap if equal\"\n00187|     0x0E:\n00188|       id: uet_amo_cswap_ne\n00189|       doc: \"Compare and swap if not equal\"\n00190|     0x0F:\n00191|       id: uet_amo_cswap_le\n00192|       doc: \"Compare and swap if less than or equal\"\n00193|     0x10:\n00194|       id: uet_amo_cswap_lt\n00195|       doc: \"Compare and swap if less than\"\n00196|     0x11:\n00197|       id: uet_amo_cswap_ge\n00198|       doc: \"Compare and swap if greater than or equal\"\n00199|     0x12:\n00200|       id: uet_amo_cswap_gt\n00201|       doc: \"Compare and swap if greater than\"\n00202|     0x13:\n00203|       id: uet_amo_mswap\n00204|       doc: \"Swap masked bits: Target = (Target & Mask) ^ Initiator\"\n00205|     0x14:\n00206|       id: uet_amo_inval\n00207|       doc: \"Invalidate cache at target location\"\n00208|   \n00209|   atomic_datatype_enum:\n00210|     0x00:\n00211|       id: int8\n00212|       doc: \"8-bit signed integer\"\n00213|     0x01:\n00214|       id: uint8\n00215|       doc: \"8-bit unsigned integer\"\n00216|     0x02:\n00217|       id: int16\n00218|       doc: \"16-bit signed integer\"\n00219|     0x03:\n00220|       id: uint16\n00221|       doc: \"16-bit unsigned integer\"\n00222|     0x04:\n00223|       id: int32\n00224|       doc: \"32-bit signed integer\"\n00225|     0x05:\n00226|       id: uint32\n00227|       doc: \"32-bit unsigned integer\"\n00228|     0x06:\n00229|       id: int64\n00230|       doc: \"64-bit signed integer\"\n00231|     0x07:\n00232|       id: uint64\n00233|       doc: \"64-bit unsigned integer\"\n00234|     0x08:\n00235|       id: float\n00236|       doc: \"32-bit floating point\"\n00237|     0x09:\n00238|       id: double\n00239|       doc: \"64-bit floating point\"\n00240|     0x0A:\n00241|       id: float_complex\n00242|       doc: \"64-bit complex (2x32-bit float)\"\n00243|     0x0B:\n00244|       id: double_complex\n00245|       doc: \"128-bit complex (2x64-bit double)\"\n00246|     0x0C:\n00247|       id: long_double\n00248|       doc: \"128-bit extended precision float\"\n00249|     0x0D:\n00250|       id: long_double_complex\n00251|       doc: \"256-bit complex (2x128-bit long double)\"\n00252|     0x0E:\n00253|       id: float16\n00254|       doc: \"16-bit floating point (IEEE 754)\"\n00255|     0x0F:\n00256|       id: bfloat16\n00257|       doc: \"16-bit brain floating point\"\n00258| \n\n(End of file - total 258 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/ses/atomic_extension.ksy",
            "metadata": {
              "preview": "# SES Atomic Operation Extension Header\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Figure 3-16, Section 3.4.2.4, Page 165\n#\n# Atomic Operation Extension Header for atomic operations.\n\nmeta:\n  id: ses_atomic_extension\n  title: SES Atomic Operation Extension Header Format\n  endian: be\n  bit-endian: be\n  doc: |\n    Ultra Ethernet Transport (UET) Semantic Sublayer (SES) Atomic Operation\n    Extension Header Format.\n    \n    Atomic operations include this 8-byte atomic header to describe the atomic\n    operation. The memory model for atomic operations is discussed in Section 3.4.8.\n    \n    Atomic headers are carried with every packet of an atomic operation. They can\n    be used with any of the optimized header formats or the standard header formats.",
              "truncated": false
            },
            "time": {
              "start": 1769122010998,
              "end": 1769122011041,
              "compacted": 1769124449183
            }
          }
        },
        {
          "id": "prt_be7e3977b001W70mWYBG4ZD6KN",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e37350001M0JnhjKsNzdvWT",
          "type": "tool",
          "callID": "toolu_01SnSAmucoob14V4biUHs1ij",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/ses/rendezvous_extension.ksy"
            },
            "output": "<file>\n00001| # SES Rendezvous Extension Header\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Figure 3-15, Section 3.4.2.3, Page 165\n00004| #\n00005| # Rendezvous Extension Header for rendezvous transactions.\n00006| \n00007| meta:\n00008|   id: ses_rendezvous_extension\n00009|   title: SES Rendezvous Extension Header Format\n00010|   endian: be\n00011|   bit-endian: be\n00012|   doc: |\n00013|     Ultra Ethernet Transport (UET) Semantic Sublayer (SES) Rendezvous Extension\n00014|     Header Format.\n00015|     \n00016|     The wire protocol includes the option for rendezvous transactions. Rendezvous\n00017|     transactions leverage this 32-byte extension header which includes a 32-bit\n00018|     eager length indicating how much message payload is being pushed with the request.\n00019|     \n00020|     The remaining fields correspond exactly to the addressing information needed\n00021|     to issue a read operation for pulling the remaining data.\n00022|     \n00023|     This extension header is used immediately following the standard header\n00024|     (Figure 3-9). It is used when a rendezvous send or Tsend opcode is used\n00025|     (UET_RENDEZVOUS_SEND, UET_RENDEZVOUS_TSEND).\n00026|     \n00027|     A rendezvous extension header should be placed on every packet using a\n00028|     rendezvous opcode.\n00029|     \n00030|     Total Size: 32 bytes (256 bits)\n00031|     \n00032|     Wire Format (bytes 0-31):\n00033|     - Byte 0-3: eager_length (32 bits)\n00034|     - Byte 4-11: memory_key (64 bits)\n00035|     - Byte 12-19: buffer_offset (64 bits)\n00036|     - Byte 20-23: remaining_length (32 bits)\n00037|     - Byte 24-31: reserved (64 bits)\n00038|   \n00039|   doc-ref:\n00040|     - \"UE Specification v1.0.1, Figure 3-15, Page 165\"\n00041|     - \"UE Specification v1.0.1, Section 3.4.2.3\"\n00042|     - \"UE Specification v1.0.1, Section 3.4.3.4 (Rendezvous details)\"\n00043|   \n00044|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00045|   ks-version: \"0.10\"\n00046| \n00047| x-spec:\n00048|   figure: \"Figure 3-15\"\n00049|   section: \"Section 3.4.2.3\"\n00050|   page: 165\n00051|   spec_version: \"1.0.1\"\n00052|   spec_date: \"2025-09-05\"\n00053| \n00054| x-packet:\n00055|   layer: \"transport\"\n00056|   sublayer: \"ses\"\n00057|   category: \"extension_header\"\n00058|   size_bytes: 32\n00059|   size_bits: 256\n00060|   \n00061|   constraints:\n00062|     - \"Reserved fields MUST be 0\"\n00063|     - \"Used with UET_RENDEZVOUS_SEND or UET_RENDEZVOUS_TSEND opcodes\"\n00064|     - \"Follows standard header (Figure 3-9)\"\n00065|     - \"MUST NOT be combined with atomic header\"\n00066|     - \"Placed on every packet using rendezvous opcode\"\n00067|   \n00068|   usage:\n00069|     - \"Enables two-sided rendezvous protocol\"\n00070|     - \"Eager length indicates pushed data amount\"\n00071|     - \"Remaining fields enable target to pull remaining data via read\"\n00072|   \n00073|   related_packets:\n00074|     - \"standard_request_som1\"\n00075|     - \"response_with_data\"\n00076| \n00077| seq:\n00078|   # Bytes 0-3: eager_length (32 bits)\n00079|   - id: eager_length\n00080|     type: u4\n00081|     doc: |\n00082|       Eager Length (32 bits). Indicates how much message payload is being pushed\n00083|       with the request.\n00084|       \n00085|       The target can use this to determine how much data is being delivered\n00086|       eagerly vs how much needs to be pulled via read operation.\n00087|       \n00088|       UE Spec: Figure 3-15, field 'eager_length'.\n00089|     x-required: true\n00090|     x-spec-ref: \"Figure 3-15, field 'eager_length'\"\n00091|   \n00092|   # Bytes 4-11: memory_key (64 bits)\n00093|   - id: memory_key\n00094|     type: u8\n00095|     doc: |\n00096|       Memory Key (64 bits). Memory key for the initiator's buffer.\n00097|       \n00098|       This corresponds to the addressing information needed to issue a read\n00099|       operation to pull the remaining data from the initiator.\n00100|       \n00101|       UE Spec: Figure 3-15, field 'memory_key'.\n00102|     x-required: true\n00103|     x-spec-ref: \"Figure 3-15, field 'memory_key'\"\n00104|   \n00105|   # Bytes 12-19: buffer_offset (64 bits)\n00106|   - id: buffer_offset\n00107|     type: u8\n00108|     doc: |\n00109|       Buffer Offset (64 bits). Offset within the initiator's buffer.\n00110|       \n00111|       Used by target to issue read operation for pulling remaining data.\n00112|       \n00113|       UE Spec: Figure 3-15, field 'buffer_offset'.\n00114|     x-required: true\n00115|     x-spec-ref: \"Figure 3-15, field 'buffer_offset'\"\n00116|   \n00117|   # Bytes 20-23: remaining_length (32 bits)\n00118|   - id: remaining_length\n00119|     type: u4\n00120|     doc: |\n00121|       Remaining Length (32 bits). Amount of data remaining to be pulled.\n00122|       \n00123|       This is the total message length minus the eager length.\n00124|       Target uses this to determine how much data to read.\n00125|       \n00126|       UE Spec: Figure 3-15, field 'remaining_length'.\n00127|     x-required: true\n00128|     x-spec-ref: \"Figure 3-15, field 'remaining_length'\"\n00129|   \n00130|   # Bytes 24-31: reserved (64 bits)\n00131|   - id: reserved_24_31\n00132|     type: u8\n00133|     doc: |\n00134|       Reserved (64 bits). MUST be 0.\n00135|       \n00136|       UE Spec: Figure 3-15 (implied - total size 32 bytes).\n00137|     x-required: true\n00138|     x-constraint: \"value == 0\"\n00139|     x-spec-ref: \"Figure 3-15 (implied reserved space)\"\n00140|     valid:\n00141|       eq: 0\n00142| \n\n(End of file - total 142 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/ses/rendezvous_extension.ksy",
            "metadata": {
              "preview": "# SES Rendezvous Extension Header\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Figure 3-15, Section 3.4.2.3, Page 165\n#\n# Rendezvous Extension Header for rendezvous transactions.\n\nmeta:\n  id: ses_rendezvous_extension\n  title: SES Rendezvous Extension Header Format\n  endian: be\n  bit-endian: be\n  doc: |\n    Ultra Ethernet Transport (UET) Semantic Sublayer (SES) Rendezvous Extension\n    Header Format.\n    \n    The wire protocol includes the option for rendezvous transactions. Rendezvous\n    transactions leverage this 32-byte extension header which includes a 32-bit\n    eager length indicating how much message payload is being pushed with the request.\n    \n    The remaining fields correspond exactly to the addressing information needed",
              "truncated": false
            },
            "time": {
              "start": 1769122011003,
              "end": 1769122011034,
              "compacted": 1769124449182
            }
          }
        },
        {
          "id": "prt_be7e397ab001QM7mwxgyW3t4nS",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e37350001M0JnhjKsNzdvWT",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 56151,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7e397ca0011PtScUgWR09MTy",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769122011082,
          "completed": 1769122021257
        },
        "parentID": "msg_be7e28b86001U2bxAs52hRVDKW",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Planner-Sisyphus",
        "agent": "Planner-Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 77438,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7e39bb4001wwyJmBWwD5faZP",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e397ca0011PtScUgWR09MTy",
          "type": "step-start"
        },
        {
          "id": "prt_be7e3bf37001hGBSaBPQjz5t3H",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e397ca0011PtScUgWR09MTy",
          "type": "tool",
          "callID": "toolu_019ggm6tYd148ZLaT5CKeLkx",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/cornelis/transport/csig_plus.ksy"
            },
            "output": "<file>\n00001| # CSIG+ (Cornelis Signal Plus) Telemetry Header\n00002| # Cornelis Networks proprietary 4-byte telemetry extension\n00003| # Reference: CN7000 Packet Taxonomy\n00004| #\n00005| # CSIG+ extends the UE PDS type field to carry in-band telemetry\n00006| # information for network monitoring and diagnostics.\n00007| \n00008| meta:\n00009|   id: csig_plus\n00010|   title: CSIG+ Telemetry Header\n00011|   endian: be\n00012|   bit-endian: be\n00013|   ks-version: \"0.10\"\n00014| \n00015| doc: |\n00016|   CSIG+ (Cornelis Signal Plus) Telemetry Header - 4 bytes\n00017| \n00018|   Cornelis proprietary in-band telemetry header that extends UE PDS packets\n00019|   to carry network monitoring and diagnostic information. CSIG+ uses the\n00020|   UE PDS type field extension mechanism.\n00021| \n00022|   Header Layout (4 bytes):\n00023|     Byte 0:     Version[7:4] | Type[3:0]\n00024|     Byte 1:     Flags[7:0]\n00025|     Bytes 2-3:  Telemetry Data[15:0]\n00026| \n00027|   CSIG+ enables:\n00028|   - In-band network telemetry (INT)\n00029|   - Per-hop latency measurement\n00030|   - Queue depth monitoring\n00031|   - Congestion notification\n00032|   - Path tracing\n00033| \n00034|   When present, CSIG+ is placed after the UE+ L2 header and before\n00035|   the payload. The UE+ type field is set to 0x9100 to indicate CSIG+.\n00036| \n00037| doc-ref:\n00038|   - \"CN7000 Packet Taxonomy\"\n00039|   - \"Cornelis Networks CSIG+ Specification\"\n00040| \n00041| x-spec:\n00042|   section: \"CSIG+ Telemetry\"\n00043|   spec_version: \"1.0\"\n00044| \n00045| x-packet:\n00046|   layer: \"transport\"\n00047|   sublayer: \"telemetry\"\n00048|   category: \"header\"\n00049|   size_bytes: 4\n00050|   size_bits: 32\n00051| \n00052|   constraints:\n00053|     - \"Version must be 0 for current specification\"\n00054|     - \"Type identifies telemetry data format\"\n00055| \n00056|   usage:\n00057|     - \"In-band network telemetry\"\n00058|     - \"Per-hop latency tracking\"\n00059|     - \"Congestion monitoring\"\n00060|     - \"Path verification\"\n00061| \n00062| seq:\n00063|   # Byte 0: Version[7:4] | Type[3:0]\n00064|   - id: version\n00065|     type: b4\n00066|     doc: |\n00067|       Version (4 bits).\n00068|       CSIG+ protocol version.\n00069|       Current version is 0.\n00070|     x-required: true\n00071|     x-constraint: \"value == 0\"\n00072| \n00073|   - id: telemetry_type\n00074|     type: b4\n00075|     enum: csig_type_enum\n00076|     doc: |\n00077|       Telemetry Type (4 bits).\n00078|       Identifies the type of telemetry data.\n00079| \n00080|       Types:\n00081|       - 0: Latency measurement\n00082|       - 1: Queue depth\n00083|       - 2: Congestion notification\n00084|       - 3: Path trace\n00085|       - 4: Timestamp\n00086|       - 5-14: Reserved\n00087|       - 15: Custom/vendor-specific\n00088|     x-required: true\n00089| \n00090|   # Byte 1: Flags[7:0]\n00091|   - id: flags\n00092|     type: u1\n00093|     doc: |\n00094|       Flags (8 bits).\n00095|       Control flags for telemetry processing.\n00096| \n00097|       Bit 7: Accumulate (add hop data vs replace)\n00098|       Bit 6: Report (generate telemetry report)\n00099|       Bit 5: Sink (final hop for telemetry)\n00100|       Bit 4: Source (originating hop)\n00101|       Bits 3-0: Type-specific flags\n00102|     x-required: true\n00103| \n00104|   # Bytes 2-3: Telemetry Data[15:0]\n00105|   - id: telemetry_data\n00106|     type: u2\n00107|     doc: |\n00108|       Telemetry Data (16 bits).\n00109|       Type-specific telemetry payload.\n00110| \n00111|       For Latency (type 0):\n00112|         - Accumulated latency in nanoseconds (16-bit)\n00113| \n00114|       For Queue Depth (type 1):\n00115|         - Queue occupancy percentage (8-bit) + Queue ID (8-bit)\n00116| \n00117|       For Congestion (type 2):\n00118|         - ECN bits (2-bit) + Congestion level (6-bit) + Reserved (8-bit)\n00119| \n00120|       For Path Trace (type 3):\n00121|         - Switch ID (16-bit)\n00122| \n00123|       For Timestamp (type 4):\n00124|         - Truncated timestamp (16-bit)\n00125|     x-required: true\n00126| \n00127| instances:\n00128|   header_size:\n00129|     value: 4\n00130|     doc: \"CSIG+ header size in bytes\"\n00131| \n00132|   accumulate:\n00133|     value: \"(flags & 0x80) != 0\"\n00134|     doc: \"True if telemetry should be accumulated\"\n00135| \n00136|   report:\n00137|     value: \"(flags & 0x40) != 0\"\n00138|     doc: \"True if telemetry report should be generated\"\n00139| \n00140|   is_sink:\n00141|     value: \"(flags & 0x20) != 0\"\n00142|     doc: \"True if this is the final telemetry hop\"\n00143| \n00144|   is_source:\n00145|     value: \"(flags & 0x10) != 0\"\n00146|     doc: \"True if this is the originating telemetry hop\"\n00147| \n00148|   type_flags:\n00149|     value: \"flags & 0x0F\"\n00150|     doc: \"Type-specific flag bits\"\n00151| \n00152| enums:\n00153|   csig_type_enum:\n00154|     0:\n00155|       id: latency\n00156|       doc: \"Latency measurement (nanoseconds)\"\n00157|     1:\n00158|       id: queue_depth\n00159|       doc: \"Queue depth/occupancy\"\n00160|     2:\n00161|       id: congestion\n00162|       doc: \"Congestion notification\"\n00163|     3:\n00164|       id: path_trace\n00165|       doc: \"Path tracing (switch IDs)\"\n00166|     4:\n00167|       id: timestamp\n00168|       doc: \"Timestamp data\"\n00169|     5:\n00170|       id: reserved_5\n00171|       doc: \"Reserved\"\n00172|     6:\n00173|       id: reserved_6\n00174|       doc: \"Reserved\"\n00175|     7:\n00176|       id: reserved_7\n00177|       doc: \"Reserved\"\n00178|     8:\n00179|       id: reserved_8\n00180|       doc: \"Reserved\"\n00181|     9:\n00182|       id: reserved_9\n00183|       doc: \"Reserved\"\n00184|     10:\n00185|       id: reserved_10\n00186|       doc: \"Reserved\"\n00187|     11:\n00188|       id: reserved_11\n00189|       doc: \"Reserved\"\n00190|     12:\n00191|       id: reserved_12\n00192|       doc: \"Reserved\"\n00193|     13:\n00194|       id: reserved_13\n00195|       doc: \"Reserved\"\n00196|     14:\n00197|       id: reserved_14\n00198|       doc: \"Reserved\"\n00199|     15:\n00200|       id: custom\n00201|       doc: \"Custom/vendor-specific telemetry\"\n00202| \n\n(End of file - total 202 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/cornelis/transport/csig_plus.ksy",
            "metadata": {
              "preview": "# CSIG+ (Cornelis Signal Plus) Telemetry Header\n# Cornelis Networks proprietary 4-byte telemetry extension\n# Reference: CN7000 Packet Taxonomy\n#\n# CSIG+ extends the UE PDS type field to carry in-band telemetry\n# information for network monitoring and diagnostics.\n\nmeta:\n  id: csig_plus\n  title: CSIG+ Telemetry Header\n  endian: be\n  bit-endian: be\n  ks-version: \"0.10\"\n\ndoc: |\n  CSIG+ (Cornelis Signal Plus) Telemetry Header - 4 bytes\n\n  Cornelis proprietary in-band telemetry header that extends UE PDS packets\n  to carry network monitoring and diagnostic information. CSIG+ uses the\n  UE PDS type field extension mechanism.",
              "truncated": false
            },
            "time": {
              "start": 1769122021178,
              "end": 1769122021242,
              "compacted": 1769124449182
            }
          }
        },
        {
          "id": "prt_be7e3bf3d001dTCx9vgTHZBChI",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e397ca0011PtScUgWR09MTy",
          "type": "tool",
          "callID": "toolu_01VszkB8HP77YPKE3fc9wPpk",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/cornelis/encapsulation/vxlan_plus.ksy"
            },
            "output": "<file>\n00001| # VxLAN+ (VxLAN Plus) Encapsulation Header\n00002| # Cornelis Networks proprietary 4-byte extension to VxLAN\n00003| # Reference: CN7000 Packet Taxonomy\n00004| #\n00005| # VxLAN+ extends standard VxLAN with fabric-aware features\n00006| # using the UE PDS type field extension mechanism.\n00007| \n00008| meta:\n00009|   id: vxlan_plus\n00010|   title: VxLAN+ Encapsulation Header\n00011|   endian: be\n00012|   bit-endian: be\n00013|   ks-version: \"0.10\"\n00014| \n00015| doc: |\n00016|   VxLAN+ (VxLAN Plus) Encapsulation Header - 4 bytes\n00017| \n00018|   Cornelis proprietary extension to VxLAN (Virtual eXtensible LAN)\n00019|   that adds fabric-aware overlay networking features. VxLAN+ uses\n00020|   the UE PDS type field extension mechanism.\n00021| \n00022|   VxLAN+ extends standard VxLAN (RFC 7348) with:\n00023|   - Fabric-level tenant isolation\n00024|   - Enhanced load balancing entropy\n00025|   - Priority/QoS integration with fabric\n00026|   - Extended VNI space\n00027| \n00028|   Header Layout (4 bytes):\n00029|     Byte 0:     Flags[7:0]\n00030|     Byte 1:     VNI[23:16] (high byte)\n00031|     Byte 2:     VNI[15:8] (middle byte)\n00032|     Byte 3:     VNI[7:0] | Reserved[7:4] | Priority[3:0] (low nibble reused)\n00033| \n00034|   Note: Standard VxLAN has 8-byte header with VNI in bytes 4-6.\n00035|   VxLAN+ uses 4 bytes with compressed format for fabric efficiency.\n00036| \n00037|   When UE+ type field is 0x9000, VxLAN+ header follows.\n00038| \n00039| doc-ref:\n00040|   - \"CN7000 Packet Taxonomy\"\n00041|   - \"RFC 7348 (VxLAN)\"\n00042|   - \"Cornelis Networks VxLAN+ Specification\"\n00043| \n00044| x-spec:\n00045|   section: \"VxLAN+ Encapsulation\"\n00046|   spec_version: \"1.0\"\n00047| \n00048| x-packet:\n00049|   layer: \"encapsulation\"\n00050|   sublayer: \"overlay\"\n00051|   category: \"header\"\n00052|   size_bytes: 4\n00053|   size_bits: 32\n00054| \n00055|   constraints:\n00056|     - \"VNI must be valid (0 to 16,777,215)\"\n00057|     - \"I flag must be set for valid VNI\"\n00058| \n00059|   usage:\n00060|     - \"Overlay network encapsulation\"\n00061|     - \"Multi-tenant fabric isolation\"\n00062|     - \"VM/container networking\"\n00063|     - \"Data center interconnect\"\n00064| \n00065| seq:\n00066|   # Byte 0: Flags[7:0]\n00067|   - id: flags\n00068|     type: u1\n00069|     doc: |\n00070|       Flags (8 bits).\n00071|       VxLAN+ control flags.\n00072| \n00073|       Bit 7: I - VNI valid indicator (must be 1)\n00074|       Bit 6: P - Policy applied indicator\n00075|       Bit 5: B - BUM (Broadcast/Unknown/Multicast) indicator\n00076|       Bit 4: O - OAM frame indicator\n00077|       Bits 3-0: Reserved (must be 0)\n00078| \n00079|       The I flag must be set for the VNI field to be valid.\n00080|     x-required: true\n00081|     x-constraint: \"(value & 0x80) != 0\"  # I flag must be set\n00082| \n00083|   # Bytes 1-3: VNI[23:0] with Priority in low nibble\n00084|   - id: vni_high\n00085|     type: u1\n00086|     doc: |\n00087|       VNI High Byte (8 bits).\n00088|       Bits 23:16 of 24-bit Virtual Network Identifier.\n00089|     x-required: true\n00090| \n00091|   - id: vni_mid\n00092|     type: u1\n00093|     doc: |\n00094|       VNI Middle Byte (8 bits).\n00095|       Bits 15:8 of 24-bit Virtual Network Identifier.\n00096|     x-required: true\n00097| \n00098|   - id: vni_low_and_priority\n00099|     type: u1\n00100|     doc: |\n00101|       VNI Low Nibble and Priority (8 bits).\n00102|       Bits 7:4 - VNI bits 7:4 (low nibble of VNI)\n00103|       Bits 3:0 - Fabric priority level\n00104| \n00105|       Note: VNI bits 3:0 are always 0 in VxLAN+, giving\n00106|       effective VNI granularity of 16 (VNI mod 16 == 0).\n00107|     x-required: true\n00108| \n00109| instances:\n00110|   header_size:\n00111|     value: 4\n00112|     doc: \"VxLAN+ header size in bytes\"\n00113| \n00114|   vni:\n00115|     value: \"(vni_high << 16) | (vni_mid << 8) | (vni_low_and_priority & 0xF0)\"\n00116|     doc: \"24-bit Virtual Network Identifier (with low nibble masked)\"\n00117| \n00118|   priority:\n00119|     value: \"vni_low_and_priority & 0x0F\"\n00120|     doc: \"4-bit fabric priority level\"\n00121| \n00122|   vni_valid:\n00123|     value: \"(flags & 0x80) != 0\"\n00124|     doc: \"True if VNI is valid (I flag set)\"\n00125| \n00126|   policy_applied:\n00127|     value: \"(flags & 0x40) != 0\"\n00128|     doc: \"True if policy has been applied\"\n00129| \n00130|   is_bum:\n00131|     value: \"(flags & 0x20) != 0\"\n00132|     doc: \"True if BUM (Broadcast/Unknown/Multicast) traffic\"\n00133| \n00134|   is_oam:\n00135|     value: \"(flags & 0x10) != 0\"\n00136|     doc: \"True if OAM (Operations/Admin/Maintenance) frame\"\n00137| \n\n(End of file - total 137 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/cornelis/encapsulation/vxlan_plus.ksy",
            "metadata": {
              "preview": "# VxLAN+ (VxLAN Plus) Encapsulation Header\n# Cornelis Networks proprietary 4-byte extension to VxLAN\n# Reference: CN7000 Packet Taxonomy\n#\n# VxLAN+ extends standard VxLAN with fabric-aware features\n# using the UE PDS type field extension mechanism.\n\nmeta:\n  id: vxlan_plus\n  title: VxLAN+ Encapsulation Header\n  endian: be\n  bit-endian: be\n  ks-version: \"0.10\"\n\ndoc: |\n  VxLAN+ (VxLAN Plus) Encapsulation Header - 4 bytes\n\n  Cornelis proprietary extension to VxLAN (Virtual eXtensible LAN)\n  that adds fabric-aware overlay networking features. VxLAN+ uses\n  the UE PDS type field extension mechanism.",
              "truncated": false
            },
            "time": {
              "start": 1769122021182,
              "end": 1769122021246,
              "compacted": 1769124449181
            }
          }
        },
        {
          "id": "prt_be7e3bf3f001EBOsdmglVuddLH",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e397ca0011PtScUgWR09MTy",
          "type": "tool",
          "callID": "toolu_01SVzW4z8FUj3dFHbGfM3BGi",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/cornelis/network/collective_l2.ksy"
            },
            "output": "<file>\n00001| # Collective L2 Header\n00002| # Cornelis Networks proprietary collective operations header\n00003| # Reference: CN7000 Packet Taxonomy\n00004| #\n00005| # Collective L2 provides hardware-accelerated collective operations\n00006| # for HPC workloads including reductions, barriers, and broadcasts.\n00007| \n00008| meta:\n00009|   id: collective_l2\n00010|   title: Collective L2 Operations Header\n00011|   endian: be\n00012|   bit-endian: be\n00013|   ks-version: \"0.10\"\n00014| \n00015| doc: |\n00016|   Collective L2 Operations Header - 4 bytes\n00017| \n00018|   Cornelis proprietary header for hardware-accelerated collective\n00019|   operations. Supports common HPC collective patterns at the\n00020|   fabric level for improved performance.\n00021| \n00022|   Header Layout (4 bytes):\n00023|     Byte 0:     Op[7:4] | Flags[3:0]\n00024|     Byte 1:     Group ID[7:0]\n00025|     Byte 2:     Sequence[7:0]\n00026|     Byte 3:     Data Type[7:4] | Count[3:0]\n00027| \n00028|   Collective L2 provides:\n00029|   - Hardware-accelerated reductions (sum, min, max, etc.)\n00030|   - Barrier synchronization\n00031|   - Broadcast/scatter/gather\n00032|   - All-to-all operations\n00033|   - Tree-based and ring-based topologies\n00034| \n00035|   Status: Specification in progress (per CN7000 Packet Taxonomy)\n00036| \n00037| doc-ref:\n00038|   - \"CN7000 Packet Taxonomy\"\n00039|   - \"Cornelis Networks Collective Specification (WIP)\"\n00040| \n00041| x-spec:\n00042|   section: \"Collective L2 Operations\"\n00043|   spec_version: \"0.1\"\n00044|   status: \"work_in_progress\"\n00045| \n00046| x-packet:\n00047|   layer: \"network\"\n00048|   sublayer: \"collective\"\n00049|   category: \"header\"\n00050|   size_bytes: 4\n00051|   size_bits: 32\n00052| \n00053|   constraints:\n00054|     - \"Group ID must be valid for the operation\"\n00055|     - \"Sequence number for ordering\"\n00056|     - \"Data type must match payload format\"\n00057| \n00058|   usage:\n00059|     - \"MPI collective operations\"\n00060|     - \"Hardware-accelerated reductions\"\n00061|     - \"Barrier synchronization\"\n00062|     - \"Broadcast operations\"\n00063| \n00064| seq:\n00065|   # Byte 0: Op[7:4] | Flags[3:0]\n00066|   - id: operation\n00067|     type: b4\n00068|     enum: collective_op_enum\n00069|     doc: |\n00070|       Collective Operation (4 bits).\n00071|       Identifies the collective operation type.\n00072| \n00073|       Operations:\n00074|       - 0: Barrier\n00075|       - 1: Broadcast\n00076|       - 2: Reduce (to root)\n00077|       - 3: All-reduce\n00078|       - 4: Scatter\n00079|       - 5: Gather\n00080|       - 6: All-gather\n00081|       - 7: All-to-all\n00082|       - 8: Scan (prefix)\n00083|       - 9: Reduce-scatter\n00084|       - 10-14: Reserved\n00085|       - 15: Custom\n00086|     x-required: true\n00087| \n00088|   - id: flags\n00089|     type: b4\n00090|     doc: |\n00091|       Operation Flags (4 bits).\n00092|       Control flags for collective operation.\n00093| \n00094|       Bit 3: In-place operation\n00095|       Bit 2: Completion notification required\n00096|       Bit 1: Tree-based topology (vs ring)\n00097|       Bit 0: Root indicator\n00098|     x-required: true\n00099| \n00100|   # Byte 1: Group ID[7:0]\n00101|   - id: group_id\n00102|     type: u1\n00103|     doc: |\n00104|       Collective Group ID (8 bits).\n00105|       Identifies the group participating in the collective.\n00106|       Groups are pre-configured with member lists.\n00107|     x-required: true\n00108| \n00109|   # Byte 2: Sequence[7:0]\n00110|   - id: sequence\n00111|     type: u1\n00112|     doc: |\n00113|       Sequence Number (8 bits).\n00114|       Ordering number for the collective operation.\n00115|       Ensures proper sequencing of multi-phase operations.\n00116|     x-required: true\n00117| \n00118|   # Byte 3: Data Type[7:4] | Count[3:0]\n00119|   - id: data_type\n00120|     type: b4\n00121|     enum: collective_dtype_enum\n00122|     doc: |\n00123|       Data Type (4 bits).\n00124|       Identifies the element data type for the operation.\n00125| \n00126|       Types:\n00127|       - 0: INT8\n00128|       - 1: INT16\n00129|       - 2: INT32\n00130|       - 3: INT64\n00131|       - 4: UINT8\n00132|       - 5: UINT16\n00133|       - 6: UINT32\n00134|       - 7: UINT64\n00135|       - 8: FLOAT16\n00136|       - 9: FLOAT32\n00137|       - 10: FLOAT64\n00138|       - 11: BFLOAT16\n00139|       - 12-14: Reserved\n00140|       - 15: Custom\n00141|     x-required: true\n00142| \n00143|   - id: count_exponent\n00144|     type: b4\n00145|     doc: |\n00146|       Count Exponent (4 bits).\n00147|       Element count as power of 2.\n00148|       Actual count = 2^count_exponent.\n00149|       Range: 1 to 32768 elements.\n00150|     x-required: true\n00151| \n00152| instances:\n00153|   header_size:\n00154|     value: 4\n00155|     doc: \"Collective L2 header size in bytes\"\n00156| \n00157|   element_count:\n00158|     value: \"1 << count_exponent\"\n00159|     doc: \"Number of elements in operation\"\n00160| \n00161|   is_in_place:\n00162|     value: \"(flags & 0x08) != 0\"\n00163|     doc: \"True if in-place operation\"\n00164| \n00165|   needs_completion:\n00166|     value: \"(flags & 0x04) != 0\"\n00167|     doc: \"True if completion notification required\"\n00168| \n00169|   is_tree_topology:\n00170|     value: \"(flags & 0x02) != 0\"\n00171|     doc: \"True if tree-based topology\"\n00172| \n00173|   is_root:\n00174|     value: \"(flags & 0x01) != 0\"\n00175|     doc: \"True if this node is root\"\n00176| \n00177| enums:\n00178|   collective_op_enum:\n00179|     0:\n00180|       id: barrier\n00181|       doc: \"Barrier synchronization\"\n00182|     1:\n00183|       id: broadcast\n00184|       doc: \"Broadcast from root\"\n00185|     2:\n00186|       id: reduce\n00187|       doc: \"Reduce to root\"\n00188|     3:\n00189|       id: all_reduce\n00190|       doc: \"All-reduce (reduce + broadcast)\"\n00191|     4:\n00192|       id: scatter\n00193|       doc: \"Scatter from root\"\n00194|     5:\n00195|       id: gather\n00196|       doc: \"Gather to root\"\n00197|     6:\n00198|       id: all_gather\n00199|       doc: \"All-gather (gather + broadcast)\"\n00200|     7:\n00201|       id: all_to_all\n00202|       doc: \"All-to-all exchange\"\n00203|     8:\n00204|       id: scan\n00205|       doc: \"Prefix scan\"\n00206|     9:\n00207|       id: reduce_scatter\n00208|       doc: \"Reduce-scatter\"\n00209|     10:\n00210|       id: reserved_10\n00211|       doc: \"Reserved\"\n00212|     11:\n00213|       id: reserved_11\n00214|       doc: \"Reserved\"\n00215|     12:\n00216|       id: reserved_12\n00217|       doc: \"Reserved\"\n00218|     13:\n00219|       id: reserved_13\n00220|       doc: \"Reserved\"\n00221|     14:\n00222|       id: reserved_14\n00223|       doc: \"Reserved\"\n00224|     15:\n00225|       id: custom\n00226|       doc: \"Custom operation\"\n00227| \n00228|   collective_dtype_enum:\n00229|     0:\n00230|       id: int8\n00231|       doc: \"Signed 8-bit integer\"\n00232|     1:\n00233|       id: int16\n00234|       doc: \"Signed 16-bit integer\"\n00235|     2:\n00236|       id: int32\n00237|       doc: \"Signed 32-bit integer\"\n00238|     3:\n00239|       id: int64\n00240|       doc: \"Signed 64-bit integer\"\n00241|     4:\n00242|       id: uint8\n00243|       doc: \"Unsigned 8-bit integer\"\n00244|     5:\n00245|       id: uint16\n00246|       doc: \"Unsigned 16-bit integer\"\n00247|     6:\n00248|       id: uint32\n00249|       doc: \"Unsigned 32-bit integer\"\n00250|     7:\n00251|       id: uint64\n00252|       doc: \"Unsigned 64-bit integer\"\n00253|     8:\n00254|       id: float16\n00255|       doc: \"16-bit floating point\"\n00256|     9:\n00257|       id: float32\n00258|       doc: \"32-bit floating point\"\n00259|     10:\n00260|       id: float64\n00261|       doc: \"64-bit floating point\"\n00262|     11:\n00263|       id: bfloat16\n00264|       doc: \"Brain floating point 16\"\n00265|     12:\n00266|       id: reserved_12\n00267|       doc: \"Reserved\"\n00268|     13:\n00269|       id: reserved_13\n00270|       doc: \"Reserved\"\n00271|     14:\n00272|       id: reserved_14\n00273|       doc: \"Reserved\"\n00274|     15:\n00275|       id: custom\n00276|       doc: \"Custom data type\"\n00277| \n\n(End of file - total 277 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/cornelis/network/collective_l2.ksy",
            "metadata": {
              "preview": "# Collective L2 Header\n# Cornelis Networks proprietary collective operations header\n# Reference: CN7000 Packet Taxonomy\n#\n# Collective L2 provides hardware-accelerated collective operations\n# for HPC workloads including reductions, barriers, and broadcasts.\n\nmeta:\n  id: collective_l2\n  title: Collective L2 Operations Header\n  endian: be\n  bit-endian: be\n  ks-version: \"0.10\"\n\ndoc: |\n  Collective L2 Operations Header - 4 bytes\n\n  Cornelis proprietary header for hardware-accelerated collective\n  operations. Supports common HPC collective patterns at the\n  fabric level for improved performance.",
              "truncated": false
            },
            "time": {
              "start": 1769122021184,
              "end": 1769122021238,
              "compacted": 1769124449180
            }
          }
        },
        {
          "id": "prt_be7e3bf41001BrITxHcy16OvL3",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e397ca0011PtScUgWR09MTy",
          "type": "tool",
          "callID": "toolu_01TXTene19ceDcNY6wVV5LmY",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/cornelis/network/scaleup_l2.ksy"
            },
            "output": "<file>\n00001| # Scale-Up L2 Header\n00002| # Cornelis Networks proprietary scale-up networking header\n00003| # Reference: CN7000 Packet Taxonomy\n00004| #\n00005| # Scale-Up L2 provides optimized networking for tightly-coupled\n00006| # compute environments such as GPU clusters and HPC pods.\n00007| \n00008| meta:\n00009|   id: scaleup_l2\n00010|   title: Scale-Up L2 Networking Header\n00011|   endian: be\n00012|   bit-endian: be\n00013|   ks-version: \"0.10\"\n00014| \n00015| doc: |\n00016|   Scale-Up L2 Networking Header - 4 bytes\n00017| \n00018|   Cornelis proprietary header for scale-up networking in\n00019|   tightly-coupled compute environments. Optimized for\n00020|   low-latency, high-bandwidth communication within a\n00021|   single compute domain (pod, rack, or chassis).\n00022| \n00023|   Header Layout (4 bytes):\n00024|     Byte 0:     Version[7:6] | Type[5:2] | Priority[1:0]\n00025|     Byte 1:     Source Node[7:0]\n00026|     Byte 2:     Dest Node[7:0]\n00027|     Byte 3:     Flags[7:4] | Channel[3:0]\n00028| \n00029|   Scale-Up L2 provides:\n00030|   - Direct node-to-node addressing (256 nodes)\n00031|   - Multiple virtual channels per link\n00032|   - Hardware priority levels\n00033|   - GPU-direct and NVLink integration support\n00034| \n00035|   Status: Specification in progress (per CN7000 Packet Taxonomy)\n00036| \n00037| doc-ref:\n00038|   - \"CN7000 Packet Taxonomy\"\n00039|   - \"Cornelis Networks Scale-Up Specification (WIP)\"\n00040| \n00041| x-spec:\n00042|   section: \"Scale-Up L2 Networking\"\n00043|   spec_version: \"0.1\"\n00044|   status: \"work_in_progress\"\n00045| \n00046| x-packet:\n00047|   layer: \"network\"\n00048|   sublayer: \"scaleup\"\n00049|   category: \"header\"\n00050|   size_bytes: 4\n00051|   size_bits: 32\n00052| \n00053|   constraints:\n00054|     - \"Version must be 0 for current specification\"\n00055|     - \"Node IDs are local to the scale-up domain\"\n00056|     - \"Channel must be configured on the link\"\n00057| \n00058|   usage:\n00059|     - \"GPU cluster interconnect\"\n00060|     - \"HPC scale-up networking\"\n00061|     - \"AI/ML training clusters\"\n00062|     - \"Tightly-coupled compute\"\n00063| \n00064| seq:\n00065|   # Byte 0: Version[7:6] | Type[5:2] | Priority[1:0]\n00066|   - id: version\n00067|     type: b2\n00068|     doc: |\n00069|       Protocol Version (2 bits).\n00070|       Scale-Up L2 protocol version.\n00071|       Current version is 0.\n00072|     x-required: true\n00073|     x-constraint: \"value == 0\"\n00074| \n00075|   - id: packet_type\n00076|     type: b4\n00077|     enum: scaleup_type_enum\n00078|     doc: |\n00079|       Packet Type (4 bits).\n00080|       Identifies the scale-up packet type.\n00081| \n00082|       Types:\n00083|       - 0: Data transfer\n00084|       - 1: Credit return\n00085|       - 2: RDMA read request\n00086|       - 3: RDMA read response\n00087|       - 4: RDMA write\n00088|       - 5: Atomic operation\n00089|       - 6: Completion notification\n00090|       - 7: Flow control\n00091|       - 8-14: Reserved\n00092|       - 15: Management\n00093|     x-required: true\n00094| \n00095|   - id: priority\n00096|     type: b2\n00097|     doc: |\n00098|       Priority Level (2 bits).\n00099|       Hardware priority for scheduling.\n00100|       0 = lowest, 3 = highest.\n00101|     x-required: true\n00102| \n00103|   # Byte 1: Source Node[7:0]\n00104|   - id: source_node\n00105|     type: u1\n00106|     doc: |\n00107|       Source Node ID (8 bits).\n00108|       Local node identifier within the scale-up domain.\n00109|       Supports up to 256 nodes per domain.\n00110|     x-required: true\n00111| \n00112|   # Byte 2: Dest Node[7:0]\n00113|   - id: dest_node\n00114|     type: u1\n00115|     doc: |\n00116|       Destination Node ID (8 bits).\n00117|       Target node identifier within the scale-up domain.\n00118|     x-required: true\n00119| \n00120|   # Byte 3: Flags[7:4] | Channel[3:0]\n00121|   - id: flags\n00122|     type: b4\n00123|     doc: |\n00124|       Control Flags (4 bits).\n00125|       Packet handling flags.\n00126| \n00127|       Bit 3: Last packet indicator\n00128|       Bit 2: First packet indicator\n00129|       Bit 1: GPU-direct enable\n00130|       Bit 0: Zero-copy enable\n00131|     x-required: true\n00132| \n00133|   - id: channel\n00134|     type: b4\n00135|     doc: |\n00136|       Virtual Channel (4 bits).\n00137|       Virtual channel ID for the transfer.\n00138|       Allows multiple independent streams per link.\n00139|       16 channels per link pair.\n00140|     x-required: true\n00141| \n00142| instances:\n00143|   header_size:\n00144|     value: 4\n00145|     doc: \"Scale-Up L2 header size in bytes\"\n00146| \n00147|   is_last:\n00148|     value: \"(flags & 0x08) != 0\"\n00149|     doc: \"True if last packet in transfer\"\n00150| \n00151|   is_first:\n00152|     value: \"(flags & 0x04) != 0\"\n00153|     doc: \"True if first packet in transfer\"\n00154| \n00155|   gpu_direct:\n00156|     value: \"(flags & 0x02) != 0\"\n00157|     doc: \"True if GPU-direct enabled\"\n00158| \n00159|   zero_copy:\n00160|     value: \"(flags & 0x01) != 0\"\n00161|     doc: \"True if zero-copy enabled\"\n00162| \n00163|   is_data:\n00164|     value: \"packet_type == scaleup_type_enum::data\"\n00165|     doc: \"True if data transfer\"\n00166| \n00167|   is_rdma:\n00168|     value: \"(packet_type == scaleup_type_enum::rdma_read_req) or (packet_type == scaleup_type_enum::rdma_read_resp) or (packet_type == scaleup_type_enum::rdma_write)\"\n00169|     doc: \"True if RDMA operation\"\n00170| \n00171| enums:\n00172|   scaleup_type_enum:\n00173|     0:\n00174|       id: data\n00175|       doc: \"Data transfer\"\n00176|     1:\n00177|       id: credit\n00178|       doc: \"Credit return\"\n00179|     2:\n00180|       id: rdma_read_req\n00181|       doc: \"RDMA read request\"\n00182|     3:\n00183|       id: rdma_read_resp\n00184|       doc: \"RDMA read response\"\n00185|     4:\n00186|       id: rdma_write\n00187|       doc: \"RDMA write\"\n00188|     5:\n00189|       id: atomic\n00190|       doc: \"Atomic operation\"\n00191|     6:\n00192|       id: completion\n00193|       doc: \"Completion notification\"\n00194|     7:\n00195|       id: flow_control\n00196|       doc: \"Flow control\"\n00197|     8:\n00198|       id: reserved_8\n00199|       doc: \"Reserved\"\n00200|     9:\n00201|       id: reserved_9\n00202|       doc: \"Reserved\"\n00203|     10:\n00204|       id: reserved_10\n00205|       doc: \"Reserved\"\n00206|     11:\n00207|       id: reserved_11\n00208|       doc: \"Reserved\"\n00209|     12:\n00210|       id: reserved_12\n00211|       doc: \"Reserved\"\n00212|     13:\n00213|       id: reserved_13\n00214|       doc: \"Reserved\"\n00215|     14:\n00216|       id: reserved_14\n00217|       doc: \"Reserved\"\n00218|     15:\n00219|       id: management\n00220|       doc: \"Management packet\"\n00221| \n\n(End of file - total 221 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/cornelis/network/scaleup_l2.ksy",
            "metadata": {
              "preview": "# Scale-Up L2 Header\n# Cornelis Networks proprietary scale-up networking header\n# Reference: CN7000 Packet Taxonomy\n#\n# Scale-Up L2 provides optimized networking for tightly-coupled\n# compute environments such as GPU clusters and HPC pods.\n\nmeta:\n  id: scaleup_l2\n  title: Scale-Up L2 Networking Header\n  endian: be\n  bit-endian: be\n  ks-version: \"0.10\"\n\ndoc: |\n  Scale-Up L2 Networking Header - 4 bytes\n\n  Cornelis proprietary header for scale-up networking in\n  tightly-coupled compute environments. Optimized for\n  low-latency, high-bandwidth communication within a",
              "truncated": false
            },
            "time": {
              "start": 1769122021186,
              "end": 1769122021230,
              "compacted": 1769124449180
            }
          }
        },
        {
          "id": "prt_be7e3bf43001sZt69TJWQ3C2wP",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e397ca0011PtScUgWR09MTy",
          "type": "tool",
          "callID": "toolu_01DaWBWKx8YFxhpGTJWWAvxT",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/cornelis/link/ue_plus.ksy"
            },
            "output": "<file>\n00001| # UE+ (Optimized Ultra Ethernet) L2 Header\n00002| # Cornelis Networks proprietary 12-byte header\n00003| # Reference: CN7000 Packet Taxonomy\n00004| #\n00005| # UE+ provides a streamlined L2 header for high-performance fabric networking,\n00006| # replacing standard Ethernet for internal fabric traffic while supporting\n00007| # encapsulation of standard Ethernet packets.\n00008| \n00009| meta:\n00010|   id: ue_plus_header\n00011|   title: UE+ Optimized Ultra Ethernet L2 Header\n00012|   endian: be\n00013|   bit-endian: be\n00014|   ks-version: \"0.10\"\n00015| \n00016| doc: |\n00017|   UE+ (Optimized Ultra Ethernet) L2 Header - 12 bytes\n00018| \n00019|   Cornelis Networks proprietary header format for high-performance fabric\n00020|   networking. UE+ replaces standard Ethernet L2 for internal fabric traffic\n00021|   while supporting encapsulation of regular Ethernet packets.\n00022| \n00023|   Header Layout (12 bytes total):\n00024|     Byte 0:     L2[7:6] | V[5] | zyxm[4:1] | Length[0] (MSB)\n00025|     Byte 1:     Length[7:0] (LSB)\n00026|     Byte 2:     RC[7:4] | SC[3:0]\n00027|     Byte 3:     Hop[7:0]\n00028|     Bytes 4-5:  Dest LID[15:0]\n00029|     Bytes 6-7:  Entropy[15:0]\n00030|     Bytes 8-9:  Source LID[15:0]\n00031|     Bytes 10-11: Type[15:0]\n00032| \n00033|   Key Features:\n00034|   - L2 field (2 bits): Layer 2 identifier, always 0b10 for UE+\n00035|   - V field (1 bit): Version indicator\n00036|   - zyxm field (4 bits): Routing control bits\n00037|   - Length field (9 bits): Packet length\n00038|   - RC field (4 bits): Routing Class for QoS/traffic class\n00039|   - SC field (4 bits): Service Class\n00040|   - Hop field (8 bits): TTL/hop count\n00041|   - Dest LID (16 bits): Destination Local Identifier\n00042|   - Entropy (16 bits): Entropy for ECMP load balancing\n00043|   - Source LID (16 bits): Source Local Identifier\n00044|   - Type (16 bits): Payload type (similar to EtherType)\n00045| \n00046| doc-ref:\n00047|   - \"CN7000 Packet Taxonomy\"\n00048|   - \"Cornelis Networks UE+ Specification\"\n00049| \n00050| x-spec:\n00051|   section: \"UE+ L2 Header\"\n00052|   spec_version: \"1.0\"\n00053| \n00054| x-packet:\n00055|   layer: \"link\"\n00056|   sublayer: \"l2\"\n00057|   category: \"header\"\n00058|   size_bytes: 12\n00059|   size_bits: 96\n00060| \n00061|   constraints:\n00062|     - \"L2 field MUST be 0b10 (2) for UE+ packets\"\n00063|     - \"Length field contains packet length in bytes\"\n00064|     - \"Hop count decremented at each fabric hop\"\n00065| \n00066|   usage:\n00067|     - \"Primary L2 header for Cornelis fabric traffic\"\n00068|     - \"Replaces Ethernet II for internal fabric\"\n00069|     - \"Supports encapsulation of standard Ethernet\"\n00070| \n00071| seq:\n00072|   # Byte 0: L2[7:6] | V[5] | zyxm[4:1] | Length[0]\n00073|   - id: l2_type\n00074|     type: b2\n00075|     doc: |\n00076|       L2 Type Identifier (2 bits).\n00077|       Always 0b10 (2) for UE+ packets.\n00078|       Distinguishes UE+ from standard Ethernet at L2.\n00079|     x-required: true\n00080|     x-constraint: \"value == 2\"\n00081| \n00082|   - id: version\n00083|     type: b1\n00084|     doc: |\n00085|       Version bit (1 bit).\n00086|       Protocol version indicator.\n00087|     x-required: true\n00088| \n00089|   - id: zyxm\n00090|     type: b4\n00091|     doc: |\n00092|       Routing control bits (4 bits).\n00093|       z, y, x, m flags for routing decisions.\n00094|       Controls multicast, adaptive routing, etc.\n00095|     x-required: true\n00096| \n00097|   - id: length_high\n00098|     type: b1\n00099|     doc: |\n00100|       Length MSB (1 bit).\n00101|       High bit of 9-bit length field.\n00102|     x-required: true\n00103| \n00104|   # Byte 1: Length[7:0]\n00105|   - id: length_low\n00106|     type: u1\n00107|     doc: |\n00108|       Length LSB (8 bits).\n00109|       Low 8 bits of 9-bit length field.\n00110|     x-required: true\n00111| \n00112|   # Byte 2: RC[7:4] | SC[3:0]\n00113|   - id: routing_class\n00114|     type: b4\n00115|     doc: |\n00116|       Routing Class (4 bits).\n00117|       Traffic class for QoS and routing decisions.\n00118|       Maps to fabric priority levels.\n00119|     x-required: true\n00120| \n00121|   - id: service_class\n00122|     type: b4\n00123|     doc: |\n00124|       Service Class (4 bits).\n00125|       Service level for traffic differentiation.\n00126|       Used for SLA enforcement.\n00127|     x-required: true\n00128| \n00129|   # Byte 3: Hop[7:0]\n00130|   - id: hop_count\n00131|     type: u1\n00132|     doc: |\n00133|       Hop Count (8 bits).\n00134|       Time-to-live equivalent for fabric routing.\n00135|       Decremented at each fabric hop.\n00136|       Packet dropped when reaches 0.\n00137|     x-required: true\n00138|     x-constraint: \"value > 0\"\n00139| \n00140|   # Bytes 4-5: Dest LID[15:0]\n00141|   - id: dest_lid\n00142|     type: u2\n00143|     doc: |\n00144|       Destination Local Identifier (16 bits).\n00145|       Identifies the destination endpoint in the fabric.\n00146|       Used for fabric routing decisions.\n00147|     x-required: true\n00148| \n00149|   # Bytes 6-7: Entropy[15:0]\n00150|   - id: entropy\n00151|     type: u2\n00152|     doc: |\n00153|       Entropy field (16 bits).\n00154|       Used for ECMP (Equal-Cost Multi-Path) load balancing.\n00155|       Typically derived from flow hash.\n00156|     x-required: true\n00157| \n00158|   # Bytes 8-9: Source LID[15:0]\n00159|   - id: source_lid\n00160|     type: u2\n00161|     doc: |\n00162|       Source Local Identifier (16 bits).\n00163|       Identifies the source endpoint in the fabric.\n00164|       Used for return path routing.\n00165|     x-required: true\n00166| \n00167|   # Bytes 10-11: Type[15:0]\n00168|   - id: payload_type\n00169|     type: u2\n00170|     enum: ue_plus_type\n00171|     doc: |\n00172|       Payload Type (16 bits).\n00173|       Identifies the type of payload following the UE+ header.\n00174|       Similar to EtherType in Ethernet II frames.\n00175| \n00176|       Common types:\n00177|       - 0x0800: IPv4\n00178|       - 0x86DD: IPv6\n00179|       - 0x8100: VLAN tagged\n00180|       - 0x9000: VxLAN+ encapsulated\n00181|       - 0x9100: CSIG+ telemetry\n00182|       - 0x9200: PKEY stacked\n00183|       - 0xC000: UE PDS (Ultra Ethernet Packet Delivery)\n00184|     x-required: true\n00185| \n00186| instances:\n00187|   header_size:\n00188|     value: 12\n00189|     doc: \"UE+ header size in bytes\"\n00190| \n00191|   length:\n00192|     value: \"(length_high << 8) | length_low\"\n00193|     doc: \"Complete 9-bit packet length\"\n00194| \n00195|   is_multicast:\n00196|     value: \"(zyxm & 0x08) != 0\"\n00197|     doc: \"True if multicast bit (m) is set\"\n00198| \n00199|   is_adaptive:\n00200|     value: \"(zyxm & 0x04) != 0\"\n00201|     doc: \"True if adaptive routing bit (x) is set\"\n00202| \n00203| enums:\n00204|   ue_plus_type:\n00205|     0x0800:\n00206|       id: ipv4\n00207|       doc: \"IPv4 payload\"\n00208|     0x86DD:\n00209|       id: ipv6\n00210|       doc: \"IPv6 payload\"\n00211|     0x8100:\n00212|       id: vlan\n00213|       doc: \"VLAN tagged frame\"\n00214|     0x0806:\n00215|       id: arp\n00216|       doc: \"ARP payload\"\n00217|     0x9000:\n00218|       id: vxlan_plus\n00219|       doc: \"VxLAN+ encapsulated payload\"\n00220|     0x9100:\n00221|       id: csig_plus\n00222|       doc: \"CSIG+ telemetry header\"\n00223|     0x9200:\n00224|       id: pkey_stacked\n00225|       doc: \"PKEY stacked header\"\n00226|     0xC000:\n00227|       id: ue_pds\n00228|       doc: \"UE Packet Delivery Sublayer\"\n00229| \n\n(End of file - total 229 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/cornelis/link/ue_plus.ksy",
            "metadata": {
              "preview": "# UE+ (Optimized Ultra Ethernet) L2 Header\n# Cornelis Networks proprietary 12-byte header\n# Reference: CN7000 Packet Taxonomy\n#\n# UE+ provides a streamlined L2 header for high-performance fabric networking,\n# replacing standard Ethernet for internal fabric traffic while supporting\n# encapsulation of standard Ethernet packets.\n\nmeta:\n  id: ue_plus_header\n  title: UE+ Optimized Ultra Ethernet L2 Header\n  endian: be\n  bit-endian: be\n  ks-version: \"0.10\"\n\ndoc: |\n  UE+ (Optimized Ultra Ethernet) L2 Header - 12 bytes\n\n  Cornelis Networks proprietary header format for high-performance fabric\n  networking. UE+ replaces standard Ethernet L2 for internal fabric traffic",
              "truncated": false
            },
            "time": {
              "start": 1769122021187,
              "end": 1769122021235,
              "compacted": 1769124449180
            }
          }
        },
        {
          "id": "prt_be7e3bf7f001KboVjPtWe1Cbyv",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e397ca0011PtScUgWR09MTy",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 77438,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7e3bfa00019TvL5SD4wy3JeH",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769122021280,
          "completed": 1769122034119
        },
        "parentID": "msg_be7e28b86001U2bxAs52hRVDKW",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Planner-Sisyphus",
        "agent": "Planner-Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 88367,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7e3c3ad0012g2kfvwo9qPyEQ",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e3bfa00019TvL5SD4wy3JeH",
          "type": "step-start"
        },
        {
          "id": "prt_be7e3f192001skH7DlHM4PEAM1",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e3bfa00019TvL5SD4wy3JeH",
          "type": "tool",
          "callID": "toolu_01PyjdxRJjN8DJVWitAoDxfK",
          "tool": "todowrite",
          "state": {
            "status": "completed",
            "input": {
              "todos": [
                {
                  "id": "1",
                  "content": "Identify packet formats not expanded in packet_taxonomy.md",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "2",
                  "content": "Read and analyze UE transport layer .ksy files (PDS, SES, CMS, TSS)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "3",
                  "content": "Read and analyze Cornelis proprietary .ksy files (CSIG+, VxLAN+, collective_l2, scaleup_l2)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "4",
                  "content": "Read and analyze RoCEv2 extended header .ksy files",
                  "status": "in_progress",
                  "priority": "medium"
                },
                {
                  "id": "5",
                  "content": "Read and analyze HSI .ksy files (event_notification, sgl_entry, etc.)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "6",
                  "content": "Read and analyze UE link layer .ksy files (LLR, CBFC, LLDP)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "7",
                  "content": "Compare datamodel against HAS specifications for discrepancies",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "8",
                  "content": "Draft expanded packet format sections for packet_taxonomy.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "9",
                  "content": "Identify new work items for discrepancies",
                  "status": "pending",
                  "priority": "high"
                }
              ]
            },
            "output": "[\n  {\n    \"id\": \"1\",\n    \"content\": \"Identify packet formats not expanded in packet_taxonomy.md\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"2\",\n    \"content\": \"Read and analyze UE transport layer .ksy files (PDS, SES, CMS, TSS)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"3\",\n    \"content\": \"Read and analyze Cornelis proprietary .ksy files (CSIG+, VxLAN+, collective_l2, scaleup_l2)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"4\",\n    \"content\": \"Read and analyze RoCEv2 extended header .ksy files\",\n    \"status\": \"in_progress\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"5\",\n    \"content\": \"Read and analyze HSI .ksy files (event_notification, sgl_entry, etc.)\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"6\",\n    \"content\": \"Read and analyze UE link layer .ksy files (LLR, CBFC, LLDP)\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"7\",\n    \"content\": \"Compare datamodel against HAS specifications for discrepancies\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"8\",\n    \"content\": \"Draft expanded packet format sections for packet_taxonomy.md\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"9\",\n    \"content\": \"Identify new work items for discrepancies\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  }\n]",
            "title": "6 todos",
            "metadata": {
              "todos": [
                {
                  "id": "1",
                  "content": "Identify packet formats not expanded in packet_taxonomy.md",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "2",
                  "content": "Read and analyze UE transport layer .ksy files (PDS, SES, CMS, TSS)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "3",
                  "content": "Read and analyze Cornelis proprietary .ksy files (CSIG+, VxLAN+, collective_l2, scaleup_l2)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "4",
                  "content": "Read and analyze RoCEv2 extended header .ksy files",
                  "status": "in_progress",
                  "priority": "medium"
                },
                {
                  "id": "5",
                  "content": "Read and analyze HSI .ksy files (event_notification, sgl_entry, etc.)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "6",
                  "content": "Read and analyze UE link layer .ksy files (LLR, CBFC, LLDP)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "7",
                  "content": "Compare datamodel against HAS specifications for discrepancies",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "8",
                  "content": "Draft expanded packet format sections for packet_taxonomy.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "9",
                  "content": "Identify new work items for discrepancies",
                  "status": "pending",
                  "priority": "high"
                }
              ],
              "truncated": false
            },
            "time": {
              "start": 1769122034068,
              "end": 1769122034085,
              "compacted": 1769124449179
            }
          }
        },
        {
          "id": "prt_be7e3f1c3001z2WCm7sX6IzoQX",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e3bfa00019TvL5SD4wy3JeH",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 88367,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7e3f1e6001VdEcWpFbXAvhSd",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769122034150,
          "completed": 1769122043597
        },
        "parentID": "msg_be7e28b86001U2bxAs52hRVDKW",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Planner-Sisyphus",
        "agent": "Planner-Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 88831,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7e3f622001H4Hf3VNIoGdZAD",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e3f1e6001VdEcWpFbXAvhSd",
          "type": "step-start"
        },
        {
          "id": "prt_be7e416680017MprChYh6Afp0C",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e3f1e6001VdEcWpFbXAvhSd",
          "type": "tool",
          "callID": "toolu_01Ag6ibpmjvpxU7GHQMwK6Tk",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/roce/transport/reth.ksy"
            },
            "output": "<file>\n00001| meta:\n00002|   id: roce_reth\n00003|   title: RoCEv2 RDMA Extended Transport Header\n00004|   ks-version: \"0.10\"\n00005|   endian: be\n00006| \n00007| doc: |\n00008|   RoCEv2 RDMA Extended Transport Header (RETH) - 16 bytes\n00009| \n00010|   Present in RDMA READ Request and RDMA WRITE First/Only packets.\n00011|   Specifies the remote memory region to read from or write to.\n00012| \n00013|   Reference: InfiniBand Architecture Specification Vol 1, Section 9.3\n00014| \n00015|   Used with opcodes:\n00016|     - RDMA_WRITE_FIRST (0x06)\n00017|     - RDMA_WRITE_ONLY (0x0A)\n00018|     - RDMA_WRITE_ONLY_IMM (0x0B)\n00019|     - RDMA_READ_REQUEST (0x0C)\n00020| \n00021|   Packet structure:\n00022|     BTH | RETH | [Payload] | ICRC\n00023| \n00024| seq:\n00025|   - id: virtual_address\n00026|     type: u8\n00027|     doc: |\n00028|       Virtual Address (64 bits)\n00029|       Starting address in remote memory region where data will be\n00030|       read from (RDMA READ) or written to (RDMA WRITE).\n00031| \n00032|   - id: rkey\n00033|     type: u4\n00034|     doc: |\n00035|       Remote Key (32 bits)\n00036|       Authorization key for accessing the remote memory region.\n00037|       Must match an rkey registered on the remote node.\n00038| \n00039|   - id: dma_length\n00040|     type: u4\n00041|     doc: |\n00042|       DMA Length (32 bits)\n00043|       Total number of bytes to transfer.\n00044|       For multi-packet operations, this is the total length\n00045|       across all packets in the sequence.\n00046| \n00047| instances:\n00048|   header_size:\n00049|     value: 16\n00050|     doc: RETH header size in bytes\n00051| \n00052|   is_valid_length:\n00053|     value: dma_length > 0\n00054|     doc: True if DMA length is non-zero (valid transfer)\n00055| \n00056|   max_dma_length:\n00057|     value: 0x80000000\n00058|     doc: Maximum DMA length (2GB per RDMA operation)\n00059| \n\n(End of file - total 59 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/roce/transport/reth.ksy",
            "metadata": {
              "preview": "meta:\n  id: roce_reth\n  title: RoCEv2 RDMA Extended Transport Header\n  ks-version: \"0.10\"\n  endian: be\n\ndoc: |\n  RoCEv2 RDMA Extended Transport Header (RETH) - 16 bytes\n\n  Present in RDMA READ Request and RDMA WRITE First/Only packets.\n  Specifies the remote memory region to read from or write to.\n\n  Reference: InfiniBand Architecture Specification Vol 1, Section 9.3\n\n  Used with opcodes:\n    - RDMA_WRITE_FIRST (0x06)\n    - RDMA_WRITE_ONLY (0x0A)\n    - RDMA_WRITE_ONLY_IMM (0x0B)\n    - RDMA_READ_REQUEST (0x0C)\n",
              "truncated": false
            },
            "time": {
              "start": 1769122043498,
              "end": 1769122043578,
              "compacted": 1769124449179
            }
          }
        },
        {
          "id": "prt_be7e4166e001ayhw4pL5Gf0yK8",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e3f1e6001VdEcWpFbXAvhSd",
          "type": "tool",
          "callID": "toolu_01CPMSY59H1WqMNKGy7vffki",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/roce/transport/aeth.ksy"
            },
            "output": "<file>\n00001| meta:\n00002|   id: roce_aeth\n00003|   title: RoCEv2 ACK Extended Transport Header\n00004|   ks-version: \"0.10\"\n00005|   endian: be\n00006| \n00007| doc: |\n00008|   RoCEv2 ACK Extended Transport Header (AETH) - 4 bytes\n00009| \n00010|   Present in ACK, RDMA READ Response, and Atomic ACK packets.\n00011|   Contains acknowledgment information and credit updates.\n00012| \n00013|   Reference: InfiniBand Architecture Specification Vol 1, Section 9.4\n00014| \n00015|   Used with opcodes:\n00016|     - ACK (0x11)\n00017|     - ATOMIC_ACK (0x12)\n00018|     - RDMA_READ_RESPONSE_FIRST (0x0D)\n00019|     - RDMA_READ_RESPONSE_MIDDLE (0x0E)\n00020|     - RDMA_READ_RESPONSE_LAST (0x0F)\n00021|     - RDMA_READ_RESPONSE_ONLY (0x10)\n00022| \n00023|   Packet structure:\n00024|     BTH | AETH | [Payload/AtomicAckETH] | ICRC\n00025| \n00026| seq:\n00027|   - id: syndrome\n00028|     type: u1\n00029|     doc: |\n00030|       Syndrome field (8 bits)\n00031|       Encodes ACK type and additional information:\n00032|         - Bits [7:6]: ACK type\n00033|           00 = ACK (positive acknowledgment)\n00034|           01 = RNR NAK (Receiver Not Ready)\n00035|           10 = Reserved\n00036|           11 = NAK (Negative acknowledgment)\n00037|         - Bits [5:0]: Meaning depends on ACK type\n00038|           For ACK: Credit count (number of additional WQEs receiver can accept)\n00039|           For RNR NAK: RNR NAK timeout value\n00040|           For NAK: NAK error code\n00041| \n00042|   - id: msn\n00043|     type: b24\n00044|     doc: |\n00045|       Message Sequence Number (24 bits)\n00046|       Identifies which message is being acknowledged.\n00047|       Incremented for each new message sent on the QP.\n00048| \n00049| instances:\n00050|   header_size:\n00051|     value: 4\n00052|     doc: AETH header size in bytes\n00053| \n00054|   ack_type:\n00055|     value: (syndrome >> 6) & 0x03\n00056|     doc: ACK type (0=ACK, 1=RNR_NAK, 3=NAK)\n00057| \n00058|   credit_count:\n00059|     value: syndrome & 0x1f\n00060|     doc: Credit count for ACK type (max 31)\n00061| \n00062|   rnr_timeout:\n00063|     value: syndrome & 0x1f\n00064|     doc: RNR NAK timeout value for RNR_NAK type\n00065| \n00066|   nak_code:\n00067|     value: syndrome & 0x1f\n00068|     doc: NAK error code for NAK type\n00069| \n00070|   is_ack:\n00071|     value: ack_type == 0\n00072|     doc: True if this is a positive ACK\n00073| \n00074|   is_rnr_nak:\n00075|     value: ack_type == 1\n00076|     doc: True if this is an RNR NAK (Receiver Not Ready)\n00077| \n00078|   is_nak:\n00079|     value: ack_type == 3\n00080|     doc: True if this is a NAK (error)\n00081| \n00082| enums:\n00083|   ack_types:\n00084|     0: ack\n00085|     1: rnr_nak\n00086|     2: reserved\n00087|     3: nak\n00088| \n00089|   nak_codes:\n00090|     0x00: psn_seq_error\n00091|     0x01: invalid_request\n00092|     0x02: remote_access_error\n00093|     0x03: remote_op_error\n00094|     0x04: invalid_rd_request\n00095| \n00096|   rnr_timeout_values:\n00097|     0x00: t_655_36_ms\n00098|     0x01: t_0_01_ms\n00099|     0x02: t_0_02_ms\n00100|     0x03: t_0_03_ms\n00101|     0x04: t_0_04_ms\n00102|     0x05: t_0_06_ms\n00103|     0x06: t_0_08_ms\n00104|     0x07: t_0_12_ms\n00105|     0x08: t_0_16_ms\n00106|     0x09: t_0_24_ms\n00107|     0x0a: t_0_32_ms\n00108|     0x0b: t_0_48_ms\n00109|     0x0c: t_0_64_ms\n00110|     0x0d: t_0_96_ms\n00111|     0x0e: t_1_28_ms\n00112|     0x0f: t_1_92_ms\n00113|     0x10: t_2_56_ms\n00114|     0x11: t_3_84_ms\n00115|     0x12: t_5_12_ms\n00116|     0x13: t_7_68_ms\n00117|     0x14: t_10_24_ms\n00118|     0x15: t_15_36_ms\n00119|     0x16: t_20_48_ms\n00120|     0x17: t_30_72_ms\n00121|     0x18: t_40_96_ms\n00122|     0x19: t_61_44_ms\n00123|     0x1a: t_81_92_ms\n00124|     0x1b: t_122_88_ms\n00125|     0x1c: t_163_84_ms\n00126|     0x1d: t_245_76_ms\n00127|     0x1e: t_327_68_ms\n00128|     0x1f: t_491_52_ms\n00129| \n\n(End of file - total 129 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/roce/transport/aeth.ksy",
            "metadata": {
              "preview": "meta:\n  id: roce_aeth\n  title: RoCEv2 ACK Extended Transport Header\n  ks-version: \"0.10\"\n  endian: be\n\ndoc: |\n  RoCEv2 ACK Extended Transport Header (AETH) - 4 bytes\n\n  Present in ACK, RDMA READ Response, and Atomic ACK packets.\n  Contains acknowledgment information and credit updates.\n\n  Reference: InfiniBand Architecture Specification Vol 1, Section 9.4\n\n  Used with opcodes:\n    - ACK (0x11)\n    - ATOMIC_ACK (0x12)\n    - RDMA_READ_RESPONSE_FIRST (0x0D)\n    - RDMA_READ_RESPONSE_MIDDLE (0x0E)\n    - RDMA_READ_RESPONSE_LAST (0x0F)",
              "truncated": false
            },
            "time": {
              "start": 1769122043503,
              "end": 1769122043570,
              "compacted": 1769124449178
            }
          }
        },
        {
          "id": "prt_be7e41670001Gf23CdjXAYlLCm",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e3f1e6001VdEcWpFbXAvhSd",
          "type": "tool",
          "callID": "toolu_0192tdTDcfF32WdMmhigpbXQ",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/roce/transport/atomiceth.ksy"
            },
            "output": "<file>\n00001| meta:\n00002|   id: roce_atomiceth\n00003|   title: RoCEv2 Atomic Extended Transport Header\n00004|   ks-version: \"0.10\"\n00005|   endian: be\n00006| \n00007| doc: |\n00008|   RoCEv2 Atomic Extended Transport Header (AtomicETH) - 28 bytes\n00009| \n00010|   Present in atomic operation request packets.\n00011|   Specifies the remote memory address and operands for\n00012|   compare-and-swap or fetch-and-add operations.\n00013| \n00014|   Reference: InfiniBand Architecture Specification Vol 1, Section 9.8\n00015| \n00016|   Used with opcodes:\n00017|     - CMP_SWAP (0x13): Compare and Swap\n00018|     - FETCH_ADD (0x14): Fetch and Add\n00019| \n00020|   Packet structure:\n00021|     BTH | AtomicETH | ICRC\n00022| \n00023|   Atomic operations are always 8 bytes and must be naturally aligned.\n00024| \n00025| seq:\n00026|   - id: virtual_address\n00027|     type: u8\n00028|     doc: |\n00029|       Virtual Address (64 bits)\n00030|       Address in remote memory where atomic operation is performed.\n00031|       Must be 8-byte aligned.\n00032| \n00033|   - id: rkey\n00034|     type: u4\n00035|     doc: |\n00036|       Remote Key (32 bits)\n00037|       Authorization key for accessing the remote memory region.\n00038| \n00039|   - id: swap_or_add_data\n00040|     type: u8\n00041|     doc: |\n00042|       Swap/Add Data (64 bits)\n00043|       For CMP_SWAP: Value to write if comparison succeeds\n00044|       For FETCH_ADD: Value to add to the remote location\n00045| \n00046|   - id: compare_data\n00047|     type: u8\n00048|     doc: |\n00049|       Compare Data (64 bits)\n00050|       For CMP_SWAP: Value to compare against remote location\n00051|       For FETCH_ADD: Must be zero (unused)\n00052| \n00053| instances:\n00054|   header_size:\n00055|     value: 28\n00056|     doc: AtomicETH header size in bytes\n00057| \n00058|   is_aligned:\n00059|     value: (virtual_address & 0x07) == 0\n00060|     doc: True if address is 8-byte aligned (required for atomics)\n00061| \n00062|   atomic_size:\n00063|     value: 8\n00064|     doc: Atomic operations are always 8 bytes\n00065| \n\n(End of file - total 65 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/roce/transport/atomiceth.ksy",
            "metadata": {
              "preview": "meta:\n  id: roce_atomiceth\n  title: RoCEv2 Atomic Extended Transport Header\n  ks-version: \"0.10\"\n  endian: be\n\ndoc: |\n  RoCEv2 Atomic Extended Transport Header (AtomicETH) - 28 bytes\n\n  Present in atomic operation request packets.\n  Specifies the remote memory address and operands for\n  compare-and-swap or fetch-and-add operations.\n\n  Reference: InfiniBand Architecture Specification Vol 1, Section 9.8\n\n  Used with opcodes:\n    - CMP_SWAP (0x13): Compare and Swap\n    - FETCH_ADD (0x14): Fetch and Add\n\n  Packet structure:",
              "truncated": false
            },
            "time": {
              "start": 1769122043505,
              "end": 1769122043563,
              "compacted": 1769124449178
            }
          }
        },
        {
          "id": "prt_be7e41673001VDJnvc8XywyOvm",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e3f1e6001VdEcWpFbXAvhSd",
          "type": "tool",
          "callID": "toolu_01M34Kyrt2Jrp23GFwFnn1f6",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/hw/asics/pmr/interfaces/host_interface/event_notification.ksy"
            },
            "output": "<file>\n00001| # Event Notification - 64-byte async event notification\n00002| # CN7000 Host-Software Interface\n00003| # Reference: specs/021-command-queue-hsi/spec.md (FR-OB-002)\n00004| #\n00005| # Async event notification for anomalous conditions.\n00006| # Delivered to notification queue for provider handling.\n00007| \n00008| meta:\n00009|   id: event_notification\n00010|   title: Event Notification\n00011|   endian: le\n00012|   bit-endian: le\n00013|   ks-version: \"0.10\"\n00014| \n00015| doc: |\n00016|   Event Notification - 64 bytes\n00017| \n00018|   Async event notification for anomalous conditions.\n00019|   Delivered to notification queue alongside completions.\n00020| \n00021|   Layout:\n00022|     Byte 0:      type (0x02)\n00023|     Byte 1:      event_type\n00024|     Bytes 2-3:   status\n00025|     Bytes 4-5:   endpoint_id\n00026|     Bytes 6-7:   reserved_0\n00027|     Bytes 8-15:  event_data\n00028|     Bytes 16-23: timestamp\n00029|     Bytes 24-62: reserved_1\n00030|     Byte 63:     marker\n00031| \n00032|   Event Types:\n00033|     0x01: RXPOOL_EXHAUSTED - Spare pool exhausted (drop mode)\n00034|     0x02: HELD_BUFFER_THRESHOLD - Held buffer count exceeded\n00035|     0x03: CREDIT_STARVATION - Credit starvation detected\n00036|     0x04: INVALID_DESCRIPTOR - Invalid descriptor format\n00037|     0x05: PROTECTION_VIOLATION - Memory protection violation\n00038|     0x06: PCIE_ERROR - PCIe transport error\n00039| \n00040|   Provider Handling:\n00041|     Events indicate conditions requiring attention.\n00042|     Provider should log, update counters, and potentially\n00043|     notify application via fi_eq_read().\n00044| \n00045| doc-ref:\n00046|   - \"specs/021-command-queue-hsi/spec.md\"\n00047|   - \"specs/021-command-queue-hsi/data-model.md\"\n00048| \n00049| x-spec:\n00050|   section: \"Observability\"\n00051|   requirements:\n00052|     - \"FR-OB-002\"\n00053|   spec_version: \"1.0\"\n00054| \n00055| x-packet:\n00056|   layer: \"hsi\"\n00057|   sublayer: \"notification\"\n00058|   category: \"event\"\n00059|   size_bytes: 64\n00060|   size_bits: 512\n00061| \n00062|   constraints:\n00063|     - \"type MUST be 0x02\"\n00064|     - \"event_type MUST be valid enum value\"\n00065|     - \"endpoint_id identifies affected endpoint\"\n00066| \n00067|   usage:\n00068|     - \"Error reporting\"\n00069|     - \"Resource exhaustion notification\"\n00070|     - \"Diagnostic event delivery\"\n00071| \n00072| enums:\n00073|   event_type:\n00074|     0x01: rxpool_exhausted\n00075|     0x02: held_buffer_threshold\n00076|     0x03: credit_starvation\n00077|     0x04: invalid_descriptor\n00078|     0x05: protection_violation\n00079|     0x06: pcie_error\n00080| \n00081|   event_severity:\n00082|     0x00: info\n00083|     0x01: warning\n00084|     0x02: error\n00085|     0x03: fatal\n00086| \n00087| seq:\n00088|   # Byte 0: type\n00089|   - id: type\n00090|     type: u1\n00091|     doc: \"Notification type (must be 0x02 for event)\"\n00092|     x-required: true\n00093|     x-constraint: \"value == 0x02\"\n00094| \n00095|   # Byte 1: event_type\n00096|   - id: event_type\n00097|     type: u1\n00098|     doc: |\n00099|       Event category (8 bits).\n00100|       0x01 = RXPOOL_EXHAUSTED\n00101|       0x02 = HELD_BUFFER_THRESHOLD\n00102|       0x03 = CREDIT_STARVATION\n00103|       0x04 = INVALID_DESCRIPTOR\n00104|       0x05 = PROTECTION_VIOLATION\n00105|       0x06 = PCIE_ERROR\n00106|     x-required: true\n00107|     x-constraint: \"value >= 0x01 and value <= 0x06\"\n00108| \n00109|   # Bytes 2-3: status\n00110|   - id: status\n00111|     type: u2\n00112|     doc: |\n00113|       Event status/severity (16 bits).\n00114|       Bits [1:0]: Severity (0=info, 1=warning, 2=error, 3=fatal)\n00115|       Bits [15:2]: Event-specific status\n00116|     x-required: true\n00117| \n00118|   # Bytes 4-5: endpoint_id\n00119|   - id: endpoint_id\n00120|     type: u2\n00121|     doc: |\n00122|       Affected endpoint identifier (16 bits).\n00123|       Identifies which endpoint generated the event.\n00124|     x-required: true\n00125| \n00126|   # Bytes 6-7: reserved_0\n00127|   - id: reserved_0\n00128|     type: u2\n00129|     doc: \"Reserved (must be 0)\"\n00130|     x-required: true\n00131|     x-constraint: \"value == 0\"\n00132| \n00133|   # Bytes 8-15: event_data\n00134|   - id: event_data\n00135|     type: u8\n00136|     doc: |\n00137|       Event-specific data (64 bits).\n00138|       Interpretation depends on event_type:\n00139|       - RXPOOL_EXHAUSTED: dropped packet count\n00140|       - HELD_BUFFER_THRESHOLD: current held count\n00141|       - CREDIT_STARVATION: starvation duration (cycles)\n00142|       - INVALID_DESCRIPTOR: descriptor offset\n00143|       - PROTECTION_VIOLATION: faulting address\n00144|       - PCIE_ERROR: PCIe error code\n00145|     x-required: true\n00146| \n00147|   # Bytes 16-23: timestamp\n00148|   - id: timestamp\n00149|     type: u8\n00150|     doc: |\n00151|       Event timestamp (64 bits).\n00152|       CPU cycles when event occurred.\n00153|       Enables correlation with other events.\n00154|     x-required: true\n00155| \n00156|   # Bytes 24-62: reserved_1\n00157|   - id: reserved_1\n00158|     size: 39\n00159|     doc: \"Reserved (must be 0)\"\n00160| \n00161|   # Byte 63: marker\n00162|   - id: marker\n00163|     type: u1\n00164|     doc: \"Prime marker (1-13) for validity detection\"\n00165|     x-required: true\n00166|     x-constraint: \"value >= 1 and value <= 13\"\n00167| \n00168| instances:\n00169|   entry_size:\n00170|     value: 64\n00171|     doc: \"Notification entry size in bytes\"\n00172| \n00173|   severity:\n00174|     value: \"status & 0x03\"\n00175|     doc: \"Event severity (0=info, 1=warning, 2=error, 3=fatal)\"\n00176| \n00177|   is_fatal:\n00178|     value: \"(status & 0x03) == 0x03\"\n00179|     doc: \"True if fatal event\"\n00180| \n00181|   is_error:\n00182|     value: \"(status & 0x03) >= 0x02\"\n00183|     doc: \"True if error or fatal\"\n00184| \n00185|   is_rxpool_exhausted:\n00186|     value: \"event_type == 0x01\"\n00187|     doc: \"True if RXPool exhausted event\"\n00188| \n00189|   is_held_buffer_threshold:\n00190|     value: \"event_type == 0x02\"\n00191|     doc: \"True if held buffer threshold event\"\n00192| \n00193|   is_credit_starvation:\n00194|     value: \"event_type == 0x03\"\n00195|     doc: \"True if credit starvation event\"\n00196| \n00197|   is_invalid_descriptor:\n00198|     value: \"event_type == 0x04\"\n00199|     doc: \"True if invalid descriptor event\"\n00200| \n00201|   is_protection_violation:\n00202|     value: \"event_type == 0x05\"\n00203|     doc: \"True if protection violation event\"\n00204| \n00205|   is_pcie_error:\n00206|     value: \"event_type == 0x06\"\n00207|     doc: \"True if PCIe error event\"\n00208| \n\n(End of file - total 208 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/hw/asics/pmr/interfaces/host_interface/event_notification.ksy",
            "metadata": {
              "preview": "# Event Notification - 64-byte async event notification\n# CN7000 Host-Software Interface\n# Reference: specs/021-command-queue-hsi/spec.md (FR-OB-002)\n#\n# Async event notification for anomalous conditions.\n# Delivered to notification queue for provider handling.\n\nmeta:\n  id: event_notification\n  title: Event Notification\n  endian: le\n  bit-endian: le\n  ks-version: \"0.10\"\n\ndoc: |\n  Event Notification - 64 bytes\n\n  Async event notification for anomalous conditions.\n  Delivered to notification queue alongside completions.\n",
              "truncated": false
            },
            "time": {
              "start": 1769122043508,
              "end": 1769122043585,
              "compacted": 1769124449177
            }
          }
        },
        {
          "id": "prt_be7e41675001PXPYBay1ohWsJ1",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e3f1e6001VdEcWpFbXAvhSd",
          "type": "tool",
          "callID": "toolu_01NWsb9PpGpw5cUU68e3wULo",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/hw/asics/pmr/interfaces/host_interface/sgl_entry.ksy"
            },
            "output": "<file>\n00001| # SGL Entry - 32-byte scatter-gather list entry\n00002| # CN7000 Host-Software Interface\n00003| # Reference: specs/021-command-queue-hsi/spec.md (FR-CQ-006)\n00004| #\n00005| # 32-byte entry specifying either indirect (DMA) data or inline data.\n00006| # INLINE flag in bit 32 of length_flags determines interpretation.\n00007| \n00008| meta:\n00009|   id: sgl_entry\n00010|   title: SGL Entry\n00011|   endian: le\n00012|   bit-endian: le\n00013|   ks-version: \"0.10\"\n00014| \n00015| doc: |\n00016|   SGL Entry - 32 bytes\n00017| \n00018|   Scatter-gather list entry specifying either indirect (DMA) data\n00019|   or inline data. Two SGL entries fit in a 64-byte continuation segment.\n00020| \n00021|   Layout:\n00022|     Bytes 0-7:   physical_address (or inline data QW0)\n00023|     Bytes 8-15:  memory_key (or inline data QW1)\n00024|     Bytes 16-23: reserved (or inline data QW2)\n00025|     Bytes 24-31: length_flags (length[31:0], INLINE flag[32])\n00026| \n00027|   Interpretation:\n00028|     - Indirect (bit 32 = 0): physical_address is DMA source\n00029|     - Inline (bit 32 = 1): QW0-QW2 contain 24 bytes of inline data\n00030| \n00031|   Memory Key:\n00032|     64-bit memory region key for protection domain validation.\n00033|     Larger than libibverbs 32-bit lkey; verbs translation layer\n00034|     maintains lkey→memory_key mapping table.\n00035| \n00036| doc-ref:\n00037|   - \"specs/021-command-queue-hsi/spec.md\"\n00038|   - \"specs/021-command-queue-hsi/data-model.md\"\n00039| \n00040| x-spec:\n00041|   section: \"Command Queue\"\n00042|   requirements:\n00043|     - \"FR-CQ-006\"\n00044|   spec_version: \"1.0\"\n00045| \n00046| x-packet:\n00047|   layer: \"hsi\"\n00048|   sublayer: \"command\"\n00049|   category: \"sgl\"\n00050|   size_bytes: 32\n00051|   size_bits: 256\n00052| \n00053|   constraints:\n00054|     - \"physical_address MUST be 64-byte aligned for indirect entries\"\n00055|     - \"memory_key MUST match registered memory region\"\n00056|     - \"length MUST NOT be zero for indirect entries\"\n00057| \n00058|   usage:\n00059|     - \"fi_send() with scatter-gather\"\n00060|     - \"fi_tsend() with multiple buffers\"\n00061|     - \"fi_write() with indirect data\"\n00062| \n00063| seq:\n00064|   # Bytes 0-7: physical_address or inline_data_qw0\n00065|   - id: physical_address\n00066|     type: u8\n00067|     doc: |\n00068|       Physical address for DMA (64 bits).\n00069|       For indirect entries: DMA source address (must be 64-byte aligned).\n00070|       For inline entries: First 8 bytes of inline data.\n00071|     x-required: true\n00072| \n00073|   # Bytes 8-15: memory_key or inline_data_qw1\n00074|   - id: memory_key\n00075|     type: u8\n00076|     doc: |\n00077|       64-bit memory region key.\n00078|       For indirect entries: Protection domain key for validation.\n00079|       For inline entries: Bytes 8-15 of inline data.\n00080|     x-required: true\n00081| \n00082|   # Bytes 16-23: reserved or inline_data_qw2\n00083|   - id: reserved\n00084|     type: u8\n00085|     doc: |\n00086|       Reserved field (64 bits).\n00087|       For indirect entries: Must be 0.\n00088|       For inline entries: Bytes 16-23 of inline data.\n00089|     x-required: true\n00090| \n00091|   # Bytes 24-31: length_flags\n00092|   - id: length_flags\n00093|     type: u8\n00094|     doc: |\n00095|       Length and flags (64 bits).\n00096|       Bits [31:0]: Length in bytes for indirect entries\n00097|       Bit [32]: INLINE flag (0=indirect DMA, 1=inline data)\n00098|       Bits [63:33]: Reserved\n00099|     x-required: true\n00100| \n00101| instances:\n00102|   entry_size:\n00103|     value: 32\n00104|     doc: \"SGL entry size in bytes\"\n00105| \n00106|   length:\n00107|     value: \"length_flags & 0xFFFFFFFF\"\n00108|     doc: \"Data length in bytes (for indirect entries)\"\n00109| \n00110|   is_inline:\n00111|     value: \"(length_flags & 0x100000000) != 0\"\n00112|     doc: \"True if inline data (bit 32 set)\"\n00113| \n00114|   is_indirect:\n00115|     value: \"(length_flags & 0x100000000) == 0\"\n00116|     doc: \"True if indirect DMA (bit 32 clear)\"\n00117| \n00118|   inline_data_size:\n00119|     value: 24\n00120|     doc: \"Maximum inline data per SGL entry (bytes 0-23)\"\n00121| \n00122|   # For inline entries, extract the 24 bytes of inline data\n00123|   # Note: In actual use, parser would access physical_address, memory_key, reserved\n00124|   # as raw bytes when is_inline is true\n00125| \n\n(End of file - total 125 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/hw/asics/pmr/interfaces/host_interface/sgl_entry.ksy",
            "metadata": {
              "preview": "# SGL Entry - 32-byte scatter-gather list entry\n# CN7000 Host-Software Interface\n# Reference: specs/021-command-queue-hsi/spec.md (FR-CQ-006)\n#\n# 32-byte entry specifying either indirect (DMA) data or inline data.\n# INLINE flag in bit 32 of length_flags determines interpretation.\n\nmeta:\n  id: sgl_entry\n  title: SGL Entry\n  endian: le\n  bit-endian: le\n  ks-version: \"0.10\"\n\ndoc: |\n  SGL Entry - 32 bytes\n\n  Scatter-gather list entry specifying either indirect (DMA) data\n  or inline data. Two SGL entries fit in a 64-byte continuation segment.\n",
              "truncated": false
            },
            "time": {
              "start": 1769122043510,
              "end": 1769122043556,
              "compacted": 1769124449176
            }
          }
        },
        {
          "id": "prt_be7e416c2001vXqkM57ByH11XE",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e3f1e6001VdEcWpFbXAvhSd",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 88831,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7e416e4001aHQjzGd27pDeYF",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769122043620,
          "completed": 1769122054379
        },
        "parentID": "msg_be7e28b86001U2bxAs52hRVDKW",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Planner-Sisyphus",
        "agent": "Planner-Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 95115,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7e41b1e001VLeG0eowhywOLw",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e416e4001aHQjzGd27pDeYF",
          "type": "step-start"
        },
        {
          "id": "prt_be7e44081001ooz73369Mmulzf",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e416e4001aHQjzGd27pDeYF",
          "type": "tool",
          "callID": "toolu_01D4tDfoV1uRMsXnsnewgm8x",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/link/llr/llr_ack_ctlos.ksy"
            },
            "output": "<file>\n00001| # GOLDEN REFERENCE: LLR_ACK Control Ordered Set\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Tables 5-7 and 5-8, Section 5.1.4, Page 467\n00004| # \n00005| # This is a GOLDEN REFERENCE definition demonstrating extreme rigor for Link Layer\n00006| # Reliable (LLR) control ordered sets, serving as a template for all link layer\n00007| # packet definitions in the UE taxonomy.\n00008| #\n00009| # Quality Standards Applied:\n00010| # 1. Every field extracted with exact bit position and width from Tables 5-7, 5-8\n00011| # 2. All fields have x-required metadata (mandatory/optional per UE Spec)\n00012| # 3. Complete x-spec metadata (table, section, page) for traceability\n00013| # 4. All constraints captured (reserved bits, O-code values, sequence number ranges)\n00014| # 5. 64B/66B block format structure documented\n00015| # 6. Byte-level and bit-level layout matches UE Spec exactly (8 bytes data payload)\n00016| # 7. All section references included for validation\n00017| #\n00018| # Leverages Cornelis IP:\n00019| # - Omni-Path link layer reliability patterns (ACK/NACK, sequence numbers)\n00020| # - Kaitai Struct best practices (enums, contents validation, bit-endian)\n00021| # - 64B/66B PCS encoding knowledge from Ethernet standards\n00022| \n00023| meta:\n00024|   id: llr_ack_ctlos\n00025|   title: LLR_ACK Control Ordered Set (CtlOS)\n00026|   endian: le  # Little-endian for xMII lane data (transmitted LSB first per spec)\n00027|   bit-endian: le  # Little-endian bit ordering for bit fields\n00028|   doc: |\n00029|     Ultra Ethernet Link Layer Reliable (LLR) ACK Control Ordered Set.\n00030|     \n00031|     LLR_ACK is used to acknowledge successful receipt of LLR frames. The ACK\n00032|     contains a 20-bit sequence number (ack_nack_seq) indicating the most recently\n00033|     processed received frame.\n00034|     \n00035|     This CtlOS is transmitted periodically (according to ctlos_target_spacing) to\n00036|     ensure adequate frequency of communication between stations. The transmission\n00037|     rate must be between once every 400 bytes (maximum) and once every 17296 bytes\n00038|     (minimum) unless in NACK_SENT state.\n00039|     \n00040|     Total Size: 8 bytes (64 bits) data payload in 64B/66B block\n00041|     \n00042|     64B/66B Block Format (from Table 5-8):\n00043|     - Sync Header: 2'b10 (control block)\n00044|     - Block Type Field (D0): 0x4B (control ordered set)\n00045|     - CtlOS Type (D1): 0x01 (LLR_ACK)\n00046|     - Sequence Number (D2, D3, D4[7:4]): 20-bit ack_nack_seq\n00047|     - O-code (D4[3:0]): 0x6 (ordered set code)\n00048|     - Reserved (D5, D6, D7): 0x00 (must be zero)\n00049|     \n00050|     Wire Format Example (ack_nack_seq=0x12345):\n00051|     10_11010010_10000000_01001000_00101100_01101010_00000000_00000000_00000000\n00052|   \n00053|   doc-ref:\n00054|     - \"UE Specification v1.0.1, Table 5-7, Page 467\"\n00055|     - \"UE Specification v1.0.1, Table 5-8, Page 467\"\n00056|     - \"UE Specification v1.0.1, Section 5.1.4 (LLR Control Ordered Sets)\"\n00057|     - \"IEEE 802.3-2022, Clause 82.2.3 (64B/66B Block Format)\"\n00058|   \n00059|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00060|   ks-version: \"0.10\"\n00061| \n00062| # UE Specification Traceability Metadata\n00063| x-spec:\n00064|   table: \"Table 5-7, Table 5-8\"\n00065|   section: \"Section 5.1.4\"\n00066|   page: 467\n00067|   spec_version: \"1.0.1\"\n00068|   spec_date: \"2025-09-05\"\n00069| \n00070| # Packet-level metadata\n00071| x-packet:\n00072|   layer: \"link\"\n00073|   sublayer: \"llr\"\n00074|   category: \"control_ordered_set\"\n00075|   size_bytes: 8\n00076|   size_bits: 64\n00077|   \n00078|   # Validation constraints\n00079|   constraints:\n00080|     - \"Block Type Field (D0) MUST be 0x4B\"\n00081|     - \"CtlOS Type (D1) MUST be 0x01 for LLR_ACK\"\n00082|     - \"O-code (D4[3:0]) MUST be 0x6\"\n00083|     - \"Reserved fields (D5, D6, D7) MUST be 0x00\"\n00084|     - \"ack_nack_seq is 20-bit value (0x00000 to 0xFFFFF)\"\n00085|     - \"Transmitted LSB first per IEEE 802.3 64B/66B encoding\"\n00086|     - \"Sync header 2'b10 indicates control block (not in data payload)\"\n00087| \n00088| seq:\n00089|   # Lane 0 (D0): Block Type Field\n00090|   - id: block_type\n00091|     type: u1\n00092|     doc: |\n00093|       Block Type Field for 64B/66B control block.\n00094|       MUST be 0x4B per IEEE 802.3-2022 and UE Spec Table 5-8.\n00095|       \n00096|       This identifies the block as a control ordered set with sync header 2'b10.\n00097|       \n00098|       UE Spec: Table 5-8, Lane 0 (D0).\n00099|     x-required: true\n00100|     x-constraint: \"value == 0x4B\"\n00101|     x-spec-ref: \"Table 5-8, D0 field\"\n00102|     valid:\n00103|       eq: 0x4B\n00104|   \n00105|   # Lane 1 (D1): CtlOS Message Type\n00106|   - id: ctlos_type\n00107|     type: u1\n00108|     enum: llr_ctlos_type\n00109|     doc: |\n00110|       CtlOS Message Type identifier.\n00111|       MUST be 0x01 for LLR_ACK.\n00112|       \n00113|       Other values:\n00114|       - 0x02: LLR_NACK\n00115|       - 0x03: LLR_INIT\n00116|       - 0x04: LLR_INIT_ECHO\n00117|       \n00118|       UE Spec: Table 5-7, Table 5-8, Lane 1 (D1).\n00119|     x-required: true\n00120|     x-constraint: \"value == 0x01\"\n00121|     x-spec-ref: \"Table 5-7, Table 5-8, D1 field\"\n00122|   \n00123|   # Lane 2 (D2): ack_nack_seq[19:12]\n00124|   - id: ack_nack_seq_high\n00125|     type: u1\n00126|     doc: |\n00127|       ACK/NACK sequence number bits [19:12] (upper 8 bits).\n00128|       \n00129|       This is the most recently processed received frame sequence number.\n00130|       Transmitted LSB first per IEEE 802.3 encoding.\n00131|       \n00132|       UE Spec: Table 5-8, Lane 2 (D2), ack_nack_seq<19:4> upper byte.\n00133|     x-required: true\n00134|     x-constraint: \"value <= 0xFF\"\n00135|     x-spec-ref: \"Table 5-8, D2 field\"\n00136|   \n00137|   # Lane 3 (D3): ack_nack_seq[11:4]\n00138|   - id: ack_nack_seq_mid\n00139|     type: u1\n00140|     doc: |\n00141|       ACK/NACK sequence number bits [11:4] (middle 8 bits).\n00142|       \n00143|       Transmitted LSB first per IEEE 802.3 encoding.\n00144|       \n00145|       UE Spec: Table 5-8, Lane 3 (D3), ack_nack_seq<19:4> lower byte.\n00146|     x-required: true\n00147|     x-constraint: \"value <= 0xFF\"\n00148|     x-spec-ref: \"Table 5-8, D3 field\"\n00149|   \n00150|   # Lane 4 (D4): ack_nack_seq[3:0] (upper nibble) + O-code (lower nibble)\n00151|   - id: ack_nack_seq_low_and_ocode\n00152|     type: u1\n00153|     doc: |\n00154|       Combined field containing:\n00155|       - Bits [7:4]: ack_nack_seq[3:0] (lower 4 bits of sequence number)\n00156|       - Bits [3:0]: O-code = 0x6 (ordered set code)\n00157|       \n00158|       The O-code MUST be 0x6 per IEEE 802.3 64B/66B encoding for ordered sets.\n00159|       \n00160|       UE Spec: Table 5-8, Lane 4 (D4[7:4] and O0).\n00161|     x-required: true\n00162|     x-constraint: \"(value & 0x0F) == 0x06\"\n00163|     x-spec-ref: \"Table 5-8, D4 field and O0\"\n00164|   \n00165|   # Lane 5 (D5): Reserved\n00166|   - id: reserved_d5\n00167|     type: u1\n00168|     doc: |\n00169|       Reserved field. MUST be 0x00.\n00170|       \n00171|       UE Spec: Table 5-8, Lane 5 (D5).\n00172|     x-required: true\n00173|     x-constraint: \"value == 0x00\"\n00174|     x-spec-ref: \"Table 5-8, D5 field\"\n00175|     valid:\n00176|       eq: 0x00\n00177|   \n00178|   # Lane 6 (D6): Reserved\n00179|   - id: reserved_d6\n00180|     type: u1\n00181|     doc: |\n00182|       Reserved field. MUST be 0x00.\n00183|       \n00184|       UE Spec: Table 5-8, Lane 6 (D6).\n00185|     x-required: true\n00186|     x-constraint: \"value == 0x00\"\n00187|     x-spec-ref: \"Table 5-8, D6 field\"\n00188|     valid:\n00189|       eq: 0x00\n00190|   \n00191|   # Lane 7 (D7): Reserved\n00192|   - id: reserved_d7\n00193|     type: u1\n00194|     doc: |\n00195|       Reserved field. MUST be 0x00.\n00196|       \n00197|       UE Spec: Table 5-8, Lane 7 (D7).\n00198|     x-required: true\n00199|     x-constraint: \"value == 0x00\"\n00200|     x-spec-ref: \"Table 5-8, D7 field\"\n00201|     valid:\n00202|       eq: 0x00\n00203| \n00204| instances:\n00205|   # Computed 20-bit sequence number from three fields\n00206|   ack_nack_seq:\n00207|     value: |\n00208|       (ack_nack_seq_high << 12) |\n00209|       (ack_nack_seq_mid << 4) |\n00210|       ((ack_nack_seq_low_and_ocode >> 4) & 0x0F)\n00211|     doc: |\n00212|       Complete 20-bit ACK/NACK sequence number.\n00213|       \n00214|       Reconstructed from:\n00215|       - ack_nack_seq_high (bits [19:12])\n00216|       - ack_nack_seq_mid (bits [11:4])\n00217|       - ack_nack_seq_low_and_ocode[7:4] (bits [3:0])\n00218|       \n00219|       Valid range: 0x00000 to 0xFFFFF (20 bits).\n00220|       \n00221|       UE Spec: Table 5-8, ack_nack_seq<19:4> and ack_nack_seq<3:0>.\n00222|   \n00223|   # Extract O-code for validation\n00224|   ocode:\n00225|     value: ack_nack_seq_low_and_ocode & 0x0F\n00226|     doc: |\n00227|       Ordered set code extracted from D4[3:0].\n00228|       MUST be 0x6 per IEEE 802.3 64B/66B encoding.\n00229|       \n00230|       UE Spec: Table 5-8, O0 field.\n00231| \n00232| enums:\n00233|   llr_ctlos_type:\n00234|     0x01:\n00235|       id: llr_ack\n00236|       doc: \"LLR frame acknowledgement\"\n00237|     0x02:\n00238|       id: llr_nack\n00239|       doc: \"LLR frame negative acknowledgement\"\n00240|     0x03:\n00241|       id: llr_init\n00242|       doc: \"Initialize next_rx_seq state in link partner\"\n00243|     0x04:\n00244|       id: llr_init_echo\n00245|       doc: \"LLR_INIT received and processed, ready to receive frames\"\n00246| \n00247| # Protocol behavior metadata (for future state machine integration)\n00248| x-protocol:\n00249|   description: \"LLR ACK Control Ordered Set transmission protocol\"\n00250|   timing_constraints:\n00251|     - name: \"ctlos_target_spacing\"\n00252|       operation: \"CtlOS transmission\"\n00253|       min_value: 400\n00254|       max_value: 17296\n00255|       unit: \"bytes\"\n00256|       description: \"Target spacing between successive CtlOS transmissions\"\n00257|     - name: \"ctlos_min_spacing_in_frame\"\n00258|       operation: \"CtlOS insertion\"\n00259|       min_value: 256\n00260|       unit: \"bytes\"\n00261|       description: \"CtlOS SHALL NOT be inserted among first 256 bytes of frame\"\n00262|     - name: \"ctlos_min_spacing_between\"\n00263|       operation: \"CtlOS spacing\"\n00264|       min_value: 2048\n00265|       unit: \"bytes\"\n00266|       description: \"Two CtlOS within same frame MUST be spaced apart by at least 2 kB\"\n00267|   \n00268|   usage_notes:\n00269|     - \"LLR_ACK/LLR_NACK CtlOS should be transmitted periodically\"\n00270|     - \"Appropriate sequence number corresponds to most recently processed received frame\"\n00271|     - \"Implementations may deviate from target spacing for any given interval\"\n00272|     - \"Transmission rate constraints ensure adequate communication frequency\"\n00273|     - \"To mitigate per-frame switch latency impact, spacing constraints apply\"\n00274| \n\n(End of file - total 274 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/link/llr/llr_ack_ctlos.ksy",
            "metadata": {
              "preview": "# GOLDEN REFERENCE: LLR_ACK Control Ordered Set\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Tables 5-7 and 5-8, Section 5.1.4, Page 467\n# \n# This is a GOLDEN REFERENCE definition demonstrating extreme rigor for Link Layer\n# Reliable (LLR) control ordered sets, serving as a template for all link layer\n# packet definitions in the UE taxonomy.\n#\n# Quality Standards Applied:\n# 1. Every field extracted with exact bit position and width from Tables 5-7, 5-8\n# 2. All fields have x-required metadata (mandatory/optional per UE Spec)\n# 3. Complete x-spec metadata (table, section, page) for traceability\n# 4. All constraints captured (reserved bits, O-code values, sequence number ranges)\n# 5. 64B/66B block format structure documented\n# 6. Byte-level and bit-level layout matches UE Spec exactly (8 bytes data payload)\n# 7. All section references included for validation\n#\n# Leverages Cornelis IP:\n# - Omni-Path link layer reliability patterns (ACK/NACK, sequence numbers)\n# - Kaitai Struct best practices (enums, contents validation, bit-endian)",
              "truncated": false
            },
            "time": {
              "start": 1769122054275,
              "end": 1769122054355,
              "compacted": 1769125778428
            }
          }
        },
        {
          "id": "prt_be7e440870012Lrb2jGe7BQ23d",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e416e4001aHQjzGd27pDeYF",
          "type": "tool",
          "callID": "toolu_01Bt6YjRBPebgqJgSMft7iqV",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/link/cbfc/cc_update.ksy"
            },
            "output": "<file>\n00001| # CBFC CC_Update Message\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Table 5-22, Section 5.2.6.2, Page 493\n00004| #\n00005| # Credit Consumed Update message (Ethernet packet format).\n00006| \n00007| meta:\n00008|   id: cbfc_cc_update\n00009|   title: CBFC CC_Update Message\n00010|   endian: be\n00011|   bit-endian: be\n00012|   doc: |\n00013|     Ultra Ethernet Credit-Based Flow Control (CBFC) CC_Update Message.\n00014|     \n00015|     CC_Update messages are used to communicate credit consumed (CC) information\n00016|     for virtual channels (VCs). Unlike CF_Update which uses Control Ordered Sets,\n00017|     CC_Update uses standard Ethernet packet format.\n00018|     \n00019|     CC_Update messages are less frequent than CF_Update messages. They carry\n00020|     credit consumed information from source to destination.\n00021|     \n00022|     The message includes:\n00023|     - VC index (5 bits) identifying the virtual channel\n00024|     - CC counter value (15 bits) indicating credits consumed\n00025|     \n00026|     Total Size: 8 bytes (64 bits) - Ethernet packet payload\n00027|     \n00028|     Wire Format (bytes 0-7):\n00029|     - Byte 0-1: Ethernet header fields (type, etc.)\n00030|     - Byte 2: VC index and CC counter upper bits\n00031|     - Byte 3-4: CC counter middle and lower bits\n00032|     - Byte 5-7: Reserved\n00033|   \n00034|   doc-ref:\n00035|     - \"UE Specification v1.0.1, Table 5-22, Page 493\"\n00036|     - \"UE Specification v1.0.1, Section 5.2.6.2\"\n00037|     - \"UE Specification v1.0.1, Table 5-31 (Counter values)\"\n00038|   \n00039|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00040|   ks-version: \"0.10\"\n00041| \n00042| x-spec:\n00043|   table: \"Table 5-22\"\n00044|   section: \"Section 5.2.6.2\"\n00045|   page: 493\n00046|   spec_version: \"1.0.1\"\n00047|   spec_date: \"2025-09-05\"\n00048| \n00049| x-packet:\n00050|   layer: \"link\"\n00051|   sublayer: \"cbfc\"\n00052|   category: \"credit_update\"\n00053|   size_bytes: 8\n00054|   size_bits: 64\n00055|   \n00056|   constraints:\n00057|     - \"VC index is 5-bit value (0-31)\"\n00058|     - \"CC counter is 15-bit value (0-32767)\"\n00059|     - \"Uses Ethernet packet format (not CtlOS)\"\n00060|     - \"Less frequent than CF_Update\"\n00061|   \n00062|   usage:\n00063|     - \"Communicate credit consumed information\"\n00064|     - \"Source to destination credit updates\"\n00065|     - \"Complements CF_Update (credit freed)\"\n00066|   \n00067|   related_packets:\n00068|     - \"cf_update\"\n00069| \n00070| seq:\n00071|   # Note: Table 5-22 shows this as Ethernet packet format\n00072|   # Simplified representation - actual format may include Ethernet framing\n00073|   \n00074|   - id: message_type\n00075|     type: u1\n00076|     doc: |\n00077|       Message type identifier for CC_Update.\n00078|       UE Spec: Table 5-22.\n00079|     x-required: true\n00080|     x-spec-ref: \"Table 5-22, field 'type'\"\n00081|   \n00082|   - id: vc_index_and_cc_high\n00083|     type: u1\n00084|     doc: |\n00085|       Combined field:\n00086|       - Bits [7:3]: VC index (5 bits)\n00087|       - Bits [2:0]: CC counter upper 3 bits\n00088|       \n00089|       UE Spec: Table 5-22.\n00090|     x-required: true\n00091|     x-spec-ref: \"Table 5-22, VC index and CC counter\"\n00092|   \n00093|   - id: cc_counter_mid\n00094|     type: u1\n00095|     doc: |\n00096|       CC counter middle 8 bits.\n00097|       UE Spec: Table 5-22.\n00098|     x-required: true\n00099|     x-spec-ref: \"Table 5-22, CC counter\"\n00100|   \n00101|   - id: cc_counter_low\n00102|     type: u1\n00103|     doc: |\n00104|       CC counter lower 4 bits (upper nibble).\n00105|       UE Spec: Table 5-22.\n00106|     x-required: true\n00107|     x-spec-ref: \"Table 5-22, CC counter\"\n00108|   \n00109|   - id: reserved\n00110|     size: 4\n00111|     doc: |\n00112|       Reserved (32 bits). MUST be 0.\n00113|       UE Spec: Table 5-22 (implied).\n00114|     x-required: true\n00115|     x-constraint: \"value == 0\"\n00116|     x-spec-ref: \"Table 5-22 (implied reserved)\"\n00117| \n00118| instances:\n00119|   vc_index:\n00120|     value: (vc_index_and_cc_high >> 3) & 0x1F\n00121|     doc: \"VC index (5 bits)\"\n00122|   \n00123|   cc_counter:\n00124|     value: |\n00125|       ((vc_index_and_cc_high & 0x07) << 12) |\n00126|       (cc_counter_mid << 4) |\n00127|       ((cc_counter_low >> 4) & 0x0F)\n00128|     doc: \"Complete 15-bit CC counter value\"\n00129| \n\n(End of file - total 129 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/link/cbfc/cc_update.ksy",
            "metadata": {
              "preview": "# CBFC CC_Update Message\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Table 5-22, Section 5.2.6.2, Page 493\n#\n# Credit Consumed Update message (Ethernet packet format).\n\nmeta:\n  id: cbfc_cc_update\n  title: CBFC CC_Update Message\n  endian: be\n  bit-endian: be\n  doc: |\n    Ultra Ethernet Credit-Based Flow Control (CBFC) CC_Update Message.\n    \n    CC_Update messages are used to communicate credit consumed (CC) information\n    for virtual channels (VCs). Unlike CF_Update which uses Control Ordered Sets,\n    CC_Update uses standard Ethernet packet format.\n    \n    CC_Update messages are less frequent than CF_Update messages. They carry\n    credit consumed information from source to destination.",
              "truncated": false
            },
            "time": {
              "start": 1769122054279,
              "end": 1769122054340,
              "compacted": 1769125778427
            }
          }
        },
        {
          "id": "prt_be7e4408c0017ONUY6yxR41Y3P",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e416e4001aHQjzGd27pDeYF",
          "type": "tool",
          "callID": "toolu_011Fe5Fbroz9AT3gFAJ5zAKb",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/link/lldp/ue_link_negotiation_tlv.ksy"
            },
            "output": "<file>\n00001| # UE Link Negotiation Options TLV\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Section 5.3.2.1, Page 509\n00004| #\n00005| # This packet definition captures the UE Link Negotiation Options TLV format\n00006| # used in LLDP for Ultra Ethernet link configuration negotiation.\n00007| \n00008| meta:\n00009|   id: ue_link_negotiation_tlv\n00010|   title: UE Link Negotiation Options TLV\n00011|   endian: be\n00012|   bit-endian: be\n00013|   \n00014|   x-spec:\n00015|     section: \"Section 5.3.2.1\"\n00016|     page: 509\n00017|     description: \"UE Link Negotiation Options TLV for LLDP\"\n00018|   \n00019|   x-packet:\n00020|     layer: \"link\"\n00021|     sublayer: \"lldp\"\n00022|     category: \"control\"\n00023|     related_packets:\n00024|       - ue_cbfc_tlv\n00025| \n00026| doc: |\n00027|   Ultra Ethernet Link Negotiation Options TLV.\n00028|   \n00029|   This TLV is used in LLDP frames to negotiate UE-specific link parameters\n00030|   including LLR (Link Layer Retry), CBFC (Credit-Based Flow Control), and\n00031|   other UE transport features.\n00032|   \n00033|   The TLV follows standard LLDP TLV format:\n00034|   - Type: 127 (Organizationally Specific TLV)\n00035|   - Length: Variable\n00036|   - OUI: Ultra Ethernet Consortium OUI\n00037|   - Subtype: UE Link Negotiation\n00038|   - Value: UE-specific negotiation parameters\n00039|   \n00040|   Reference: UE Specification v1.0.1, Section 5.3.2.1\n00041| \n00042| seq:\n00043|   - id: tlv_type\n00044|     type: b7\n00045|     doc: |\n00046|       TLV Type = 127 (Organizationally Specific TLV).\n00047|       UE Spec: Section 5.3.2.1, field 'TLV Type'.\n00048|     x-required: true\n00049|     x-constraint: \"Must be 127\"\n00050|     x-spec-ref: \"Section 5.3.2.1, field 'TLV Type'\"\n00051|   \n00052|   - id: tlv_length\n00053|     type: b9\n00054|     doc: |\n00055|       TLV Length in octets (variable, includes OUI + Subtype + Value).\n00056|       UE Spec: Section 5.3.2.1, field 'TLV Length'.\n00057|     x-required: true\n00058|     x-constraint: \"Length >= 4 (OUI + Subtype minimum)\"\n00059|     x-spec-ref: \"Section 5.3.2.1, field 'TLV Length'\"\n00060|   \n00061|   - id: oui\n00062|     type: u3\n00063|     doc: |\n00064|       Organizationally Unique Identifier (OUI) for Ultra Ethernet Consortium.\n00065|       UE Spec: Section 5.3.2.1, field 'OUI'.\n00066|     x-required: true\n00067|     x-constraint: \"UE Consortium OUI\"\n00068|     x-spec-ref: \"Section 5.3.2.1, field 'OUI'\"\n00069|   \n00070|   - id: subtype\n00071|     type: u1\n00072|     doc: |\n00073|       UE-specific subtype = 1 (Link Negotiation Options).\n00074|       UE Spec: Section 5.3.2.1, field 'Subtype'.\n00075|     x-required: true\n00076|     x-constraint: \"Must be 1 for Link Negotiation\"\n00077|     x-spec-ref: \"Section 5.3.2.1, field 'Subtype'\"\n00078|   \n00079|   - id: llr_enabled\n00080|     type: b1\n00081|     doc: |\n00082|       Link Layer Retry (LLR) enabled flag.\n00083|       0 = LLR disabled, 1 = LLR enabled.\n00084|       UE Spec: Section 5.3.2.1, field 'LLR Enabled'.\n00085|     x-required: true\n00086|     x-constraint: \"0 or 1\"\n00087|     x-spec-ref: \"Section 5.3.2.1, field 'LLR Enabled'\"\n00088|   \n00089|   - id: cbfc_enabled\n00090|     type: b1\n00091|     doc: |\n00092|       Credit-Based Flow Control (CBFC) enabled flag.\n00093|       0 = CBFC disabled, 1 = CBFC enabled.\n00094|       UE Spec: Section 5.3.2.1, field 'CBFC Enabled'.\n00095|     x-required: true\n00096|     x-constraint: \"0 or 1\"\n00097|     x-spec-ref: \"Section 5.3.2.1, field 'CBFC Enabled'\"\n00098|   \n00099|   - id: reserved\n00100|     type: b6\n00101|     doc: |\n00102|       Reserved bits, must be 0.\n00103|       UE Spec: Section 5.3.2.1, field 'Reserved'.\n00104|     x-required: true\n00105|     x-constraint: \"Must be 0\"\n00106|     x-spec-ref: \"Section 5.3.2.1, field 'Reserved'\"\n00107|   \n00108|   - id: ue_version\n00109|     type: u1\n00110|     doc: |\n00111|       UE Specification version supported.\n00112|       UE Spec: Section 5.3.2.1, field 'UE Version'.\n00113|     x-required: true\n00114|     x-constraint: \"Version number (e.g., 1 for v1.0.1)\"\n00115|     x-spec-ref: \"Section 5.3.2.1, field 'UE Version'\"\n00116| \n\n(End of file - total 116 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/link/lldp/ue_link_negotiation_tlv.ksy",
            "metadata": {
              "preview": "# UE Link Negotiation Options TLV\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Section 5.3.2.1, Page 509\n#\n# This packet definition captures the UE Link Negotiation Options TLV format\n# used in LLDP for Ultra Ethernet link configuration negotiation.\n\nmeta:\n  id: ue_link_negotiation_tlv\n  title: UE Link Negotiation Options TLV\n  endian: be\n  bit-endian: be\n  \n  x-spec:\n    section: \"Section 5.3.2.1\"\n    page: 509\n    description: \"UE Link Negotiation Options TLV for LLDP\"\n  \n  x-packet:\n    layer: \"link\"",
              "truncated": false
            },
            "time": {
              "start": 1769122054285,
              "end": 1769122054374,
              "compacted": 1769125778427
            }
          }
        },
        {
          "id": "prt_be7e4408f001FckBOI0fPvJpmZ",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e416e4001aHQjzGd27pDeYF",
          "type": "tool",
          "callID": "toolu_01Hau3JTtaFUCUBYAZu7B8Jp",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/tss/security_header.ksy"
            },
            "output": "<file>\n00001| # TSS Security Header\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Table 3-90, Section 3.7.11, Page 441\n00004| #\n00005| # Transport Security Sublayer (TSS) Header for encryption.\n00006| \n00007| meta:\n00008|   id: tss_security_header\n00009|   title: TSS Security Header\n00010|   endian: be\n00011|   bit-endian: be\n00012|   doc: |\n00013|     Ultra Ethernet Transport (UET) Transport Security Sublayer (TSS) Header.\n00014|     \n00015|     The TSS header provides encryption and authentication for UET packets.\n00016|     It includes:\n00017|     - Secure Domain Identifier (SDI) - 24 bits\n00018|     - Source Identifier (SSI) - 32 bits (optional, when sp=1)\n00019|     - Time-Stamp Counter (TSC) - 64 bits (16-bit epoch + 48-bit counter)\n00020|     \n00021|     The TSS header is used with AES-GCM encryption to provide confidentiality\n00022|     and authentication. The IV (Initialization Vector) is constructed from\n00023|     SSI and TSC (or ip.src_addr and TSC) as defined in Table 3-91.\n00024|     \n00025|     Total Size: 16 bytes (128 bits) when sp=1 (SSI present)\n00026|                 12 bytes (96 bits) when sp=0 (SSI not present)\n00027|     \n00028|     Wire Format (bytes 0-15 when sp=1):\n00029|     - Byte 0: type(5) + sp(1) + r(1) + an(1)\n00030|     - Byte 1-3: sdi (24 bits)\n00031|     - Byte 4-7: ssi (32 bits, optional based on sp)\n00032|     - Byte 8-15: tsc (64 bits)\n00033|   \n00034|   doc-ref:\n00035|     - \"UE Specification v1.0.1, Table 3-90, Page 441\"\n00036|     - \"UE Specification v1.0.1, Section 3.7.11 (TSS)\"\n00037|     - \"UE Specification v1.0.1, Table 3-91 (IV Construction)\"\n00038|     - \"UE Specification v1.0.1, Figure 3-114\"\n00039|   \n00040|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00041|   ks-version: \"0.10\"\n00042| \n00043| x-spec:\n00044|   table: \"Table 3-90\"\n00045|   section: \"Section 3.7.11\"\n00046|   page: 441\n00047|   figure: \"Figure 3-114\"\n00048|   spec_version: \"1.0.1\"\n00049|   spec_date: \"2025-09-05\"\n00050| \n00051| x-packet:\n00052|   layer: \"transport\"\n00053|   sublayer: \"tss\"\n00054|   category: \"security_header\"\n00055|   size_bytes: 16\n00056|   size_bits: 128\n00057|   \n00058|   constraints:\n00059|     - \"type MUST be UET_TSS (1)\"\n00060|     - \"sp indicates if SSI header is present\"\n00061|     - \"TSC is 64-bit timestamp (16-bit epoch + 48-bit counter)\"\n00062|     - \"IV constructed from SSI+TSC or ip.src_addr+TSC\"\n00063|   \n00064|   usage:\n00065|     - \"Provides encryption and authentication\"\n00066|     - \"AES-GCM encryption\"\n00067|     - \"IV generation for crypto\"\n00068|     - \"Secure domain isolation\"\n00069|   \n00070|   related_packets:\n00071|     - \"prologue\"\n00072| \n00073| seq:\n00074|   # Byte 0: type(5) + sp(1) + r(1) + an(1)\n00075|   - id: header_type\n00076|     type: b5\n00077|     enum: tss_type_enum\n00078|     doc: |\n00079|       Header type (5 bits). MUST be set to UET_TSS (1).\n00080|       \n00081|       UE Spec: Table 3-90, field 'type'.\n00082|     x-required: true\n00083|     x-constraint: \"value == 1 (UET_TSS)\"\n00084|     x-spec-ref: \"Table 3-90, field 'type'\"\n00085|     valid:\n00086|       eq: 1\n00087|   \n00088|   - id: sp\n00089|     type: b1\n00090|     doc: |\n00091|       SSI Present flag (1 bit). Set if SSI header present in packet.\n00092|       \n00093|       When sp=1: SSI field is present (32 bits)\n00094|       When sp=0: SSI field is not present\n00095|       \n00096|       UE Spec: Table 3-90, field 'sp'.\n00097|     x-required: true\n00098|     x-spec-ref: \"Table 3-90, field 'sp'\"\n00099|   \n00100|   - id: reserved\n00101|     type: b1\n00102|     doc: |\n00103|       Reserved (1 bit). MUST be 0.\n00104|       \n00105|       UE Spec: Table 3-90, field 'r'.\n00106|     x-required: true\n00107|     x-constraint: \"value == 0\"\n00108|     x-spec-ref: \"Table 3-90, field 'r'\"\n00109|     valid:\n00110|       eq: 0\n00111|   \n00112|   - id: an\n00113|     type: b1\n00114|     doc: |\n00115|       Association Number (1 bit).\n00116|       \n00117|       UE Spec: Table 3-90, field 'an'.\n00118|     x-required: true\n00119|     x-spec-ref: \"Table 3-90, field 'an'\"\n00120|   \n00121|   # Bytes 1-3: sdi (24 bits)\n00122|   - id: sdi\n00123|     type: b24\n00124|     doc: |\n00125|       Secure Domain Identifier (24 bits). Identifies the secure domain.\n00126|       \n00127|       UE Spec: Table 3-90, field 'sdi'.\n00128|     x-required: true\n00129|     x-spec-ref: \"Table 3-90, field 'sdi'\"\n00130|   \n00131|   # Bytes 4-7: ssi (32 bits, optional based on sp)\n00132|   - id: ssi\n00133|     type: u4\n00134|     if: sp != 0\n00135|     doc: |\n00136|       Source Identifier (32 bits). Source identifier within a secure domain.\n00137|       \n00138|       Present only when sp=1.\n00139|       \n00140|       Used in IV construction (IV = ssi || tsc).\n00141|       \n00142|       UE Spec: Table 3-90, field 'ssi'.\n00143|     x-required: false\n00144|     x-constraint: \"Present only when sp=1\"\n00145|     x-spec-ref: \"Table 3-90, field 'ssi'\"\n00146|   \n00147|   # Bytes 8-15 (or 4-11 if sp=0): tsc (64 bits)\n00148|   - id: tsc\n00149|     type: u8\n00150|     doc: |\n00151|       Time-Stamp Counter (64 bits). Composed of 16-bit epoch and 48-bit counter.\n00152|       \n00153|       Structure: [epoch(16) || counter(48)]\n00154|       \n00155|       Used in IV construction along with SSI or ip.src_addr.\n00156|       \n00157|       UE Spec: Table 3-90, field 'tsc'.\n00158|     x-required: true\n00159|     x-spec-ref: \"Table 3-90, field 'tsc'\"\n00160| \n00161| instances:\n00162|   tsc_epoch:\n00163|     value: (tsc >> 48) & 0xFFFF\n00164|     doc: \"TSC epoch (16 bits, upper bits)\"\n00165|   \n00166|   tsc_counter:\n00167|     value: tsc & 0xFFFFFFFFFFFF\n00168|     doc: \"TSC counter (48 bits, lower bits)\"\n00169| \n00170| enums:\n00171|   tss_type_enum:\n00172|     1:\n00173|       id: uet_tss\n00174|       doc: \"UET TSS (Transport Security Sublayer) header\"\n00175| \n\n(End of file - total 175 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/tss/security_header.ksy",
            "metadata": {
              "preview": "# TSS Security Header\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Table 3-90, Section 3.7.11, Page 441\n#\n# Transport Security Sublayer (TSS) Header for encryption.\n\nmeta:\n  id: tss_security_header\n  title: TSS Security Header\n  endian: be\n  bit-endian: be\n  doc: |\n    Ultra Ethernet Transport (UET) Transport Security Sublayer (TSS) Header.\n    \n    The TSS header provides encryption and authentication for UET packets.\n    It includes:\n    - Secure Domain Identifier (SDI) - 24 bits\n    - Source Identifier (SSI) - 32 bits (optional, when sp=1)\n    - Time-Stamp Counter (TSC) - 64 bits (16-bit epoch + 48-bit counter)\n    ",
              "truncated": false
            },
            "time": {
              "start": 1769122054288,
              "end": 1769122054348,
              "compacted": 1769125778426
            }
          }
        },
        {
          "id": "prt_be7e44093001aQzZ5aE3FOfOKO",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e416e4001aHQjzGd27pDeYF",
          "type": "tool",
          "callID": "toolu_01GevFFgM5SW3aste6vvg75R",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/cms/ack_cc_state_nscc.ksy"
            },
            "output": "<file>\n00001| # GOLDEN REFERENCE: CMS ack_cc_state for NSCC\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Table 3-74, Section 3.6.9.2, Page 366\n00004| #\n00005| # This is a GOLDEN REFERENCE definition with EXTREME RIGOR for Congestion\n00006| # Management Sublayer (CMS) ACK congestion control state for NSCC.\n00007| #\n00008| # Quality Standards Applied:\n00009| # 1. Every field extracted with exact bit position and width from Table 3-74\n00010| # 2. All fields have x-required metadata (mandatory/optional per UE Spec)\n00011| # 3. Complete x-spec metadata (table, section, page) for traceability\n00012| # 4. All constraints captured (units, accuracy, wrapping, special values)\n00013| # 5. Byte-level and bit-level layout matches UE Spec exactly (8 bytes total)\n00014| # 6. All section references included for validation\n00015| #\n00016| # Leverages Cornelis IP:\n00017| # - Omni-Path congestion control patterns (network-signaled congestion)\n00018| # - InfiniBand congestion management concepts\n00019| \n00020| meta:\n00021|   id: cms_ack_cc_state_nscc\n00022|   title: CMS ack_cc_state for ACK_CC with CC_TYPE = CC_NSCC\n00023|   endian: be\n00024|   bit-endian: be\n00025|   doc: |\n00026|     Ultra Ethernet Congestion Management Sublayer (CMS) ack_cc_state field\n00027|     for NSCC (Network-Signaled Congestion Control).\n00028|     \n00029|     This 8-byte field is carried in the pds.ack_cc_state field of ACK_CC\n00030|     packets (Table 3-36) when pds.cc_type = CC_NSCC.\n00031|     \n00032|     NSCC uses network-signaled congestion control where the destination\n00033|     communicates congestion state back to the source via ACK packets.\n00034|     \n00035|     The ack_cc_state includes:\n00036|     - service_time: Destination service time (16 bits, units: 128 nsec)\n00037|     - rc: Restore cwnd flag (1 bit)\n00038|     - rcv_cwnd_pend: Destination congestion level (7 bits)\n00039|     - rcvd_bytes: Per-PDC received byte count (24 bits, units: 256 bytes)\n00040|     - ooo_count: Out-of-order packet count (16 bits)\n00041|     \n00042|     Total Size: 8 bytes (64 bits)\n00043|     \n00044|     Wire Format (bytes 0-7):\n00045|     - Byte 0-1: service_time (16 bits)\n00046|     - Byte 2: rc(1) + rcv_cwnd_pend(7)\n00047|     - Byte 3-5: rcvd_bytes (24 bits)\n00048|     - Byte 6-7: ooo_count (16 bits)\n00049|   \n00050|   doc-ref:\n00051|     - \"UE Specification v1.0.1, Table 3-74, Page 366\"\n00052|     - \"UE Specification v1.0.1, Section 3.6.9.2\"\n00053|     - \"UE Specification v1.0.1, Section 3.6.9.2.1 (rcvd_bytes)\"\n00054|     - \"UE Specification v1.0.1, Section 3.6.9.2.2 (rcv_cwnd_pend, rc)\"\n00055|     - \"UE Specification v1.0.1, Section 3.6.9.2.3 (ooo_count)\"\n00056|     - \"UE Specification v1.0.1, Section 3.6.9.2.4 (service_time)\"\n00057|     - \"UE Specification v1.0.1, Figure 3-100\"\n00058|   \n00059|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00060|   ks-version: \"0.10\"\n00061| \n00062| # UE Specification Traceability Metadata\n00063| x-spec:\n00064|   table: \"Table 3-74\"\n00065|   section: \"Section 3.6.9.2\"\n00066|   page: 366\n00067|   figure: \"Figure 3-100\"\n00068|   spec_version: \"1.0.1\"\n00069|   spec_date: \"2025-09-05\"\n00070| \n00071| # Packet-level metadata\n00072| x-packet:\n00073|   layer: \"transport\"\n00074|   sublayer: \"cms\"\n00075|   category: \"congestion_control_state\"\n00076|   size_bytes: 8\n00077|   size_bits: 64\n00078|   \n00079|   # Validation constraints\n00080|   constraints:\n00081|     - \"service_time units: 128 nsec, accuracy target: ~500 nsec\"\n00082|     - \"service_time 0xFFFF indicates exceeded 8.38848 ms\"\n00083|     - \"service_time 0x0 indicates not valid (MUST be ignored)\"\n00084|     - \"rcvd_bytes units: 256 bytes, wraps at 0xFFFFFF\"\n00085|     - \"ooo_count is instantaneous (not cumulative), does not wrap\"\n00086|     - \"ooo_count 0xFFFF indicates field is invalid\"\n00087|     - \"Carried in pds.ack_cc_state when pds.type=ACK_CC and pds.cc_type=CC_NSCC\"\n00088|   \n00089|   usage:\n00090|     - \"NSCC (Network-Signaled Congestion Control) algorithm\"\n00091|     - \"Destination to source congestion state communication\"\n00092|     - \"Service time for RTT adjustment\"\n00093|     - \"Congestion window management (rcv_cwnd_pend, rc)\"\n00094|     - \"Out-of-order detection for early loss detection\"\n00095|   \n00096|   related_packets:\n00097|     - \"ack_cc\"\n00098|     - \"req_cc_state\"\n00099|     - \"ack_cc_state_credit\"\n00100| \n00101| seq:\n00102|   # Bytes 0-1: service_time (16 bits)\n00103|   - id: service_time\n00104|     type: u2\n00105|     doc: |\n00106|       Service Time (16 bits). Service time at destination, measured from the\n00107|       time the PDS request packet arrives at the Ethernet MAC to the time a\n00108|       PDS ACK packet is transmitted by the Ethernet MAC.\n00109|       \n00110|       Units: 128 nsec\n00111|       Accuracy target: ~500 nsec\n00112|       \n00113|       Special values:\n00114|       - 0xFFFF: Service time exceeded 8.38848 ms\n00115|       - 0x0: Not valid (MUST be ignored)\n00116|       \n00117|       Service time is used to adjust the RTT calculation in NSCC, ensuring it\n00118|       accounts for processing delays at the destination FEP.\n00119|       \n00120|       Refer to Section 3.6.4.2 for usage of this field.\n00121|       \n00122|       UE Spec: Table 3-74, field 'service_time'; Section 3.6.9.2.4, Section 3.6.4.2\n00123|     x-required: true\n00124|     x-constraint: \"Units: 128 nsec, 0xFFFF = exceeded 8.38848 ms, 0x0 = invalid\"\n00125|     x-spec-ref: \"Table 3-74, field 'service_time'; Section 3.6.9.2.4\"\n00126|   \n00127|   # Byte 2: rc(1) + rcv_cwnd_pend(7)\n00128|   - id: restore_cwnd\n00129|     type: b1\n00130|     doc: |\n00131|       Restore Congestion Window flag (1 bit). Indicates cwnd should be restored\n00132|       after destination congestion ends.\n00133|       \n00134|       The rc (restore cwnd) field indicates whether the source should restore\n00135|       the original value of the congestion window when flow control ends.\n00136|       \n00137|       Use is described in Section 3.6.13.2.\n00138|       \n00139|       UE Spec: Table 3-74, field 'restore cwnd (rc)'; Section 3.6.9.2.2, Section 3.6.13.2\n00140|     x-required: true\n00141|     x-constraint: \"Boolean flag for cwnd restoration\"\n00142|     x-spec-ref: \"Table 3-74, field 'restore cwnd (rc)'; Section 3.6.9.2.2\"\n00143|   \n00144|   - id: rcv_cwnd_pend\n00145|     type: b7\n00146|     doc: |\n00147|       Receive Congestion Window Pending (7 bits). This field indicates the\n00148|       congestion level at the destination.\n00149|       \n00150|       The rcv_cwnd_pend field is used by the destination to request that the\n00151|       source reduces its congestion window because the destination is becoming\n00152|       backlogged.\n00153|       \n00154|       Use is described in Section 3.6.13.2.\n00155|       \n00156|       UE Spec: Table 3-74, field 'rcv_cwnd_pend'; Section 3.6.9.2.2, Section 3.6.13.2\n00157|     x-required: true\n00158|     x-constraint: \"7-bit congestion level indicator\"\n00159|     x-spec-ref: \"Table 3-74, field 'rcv_cwnd_pend'; Section 3.6.9.2.2\"\n00160|   \n00161|   # Bytes 3-5: rcvd_bytes (24 bits)\n00162|   - id: rcvd_bytes\n00163|     type: b24\n00164|     doc: |\n00165|       Received Bytes (24 bits). Per PDC received byte count, maintained at the\n00166|       destination and incremented when a network packet is accepted.\n00167|       \n00168|       Units: 256 bytes\n00169|       Wraps to 0x0 at 0xFFFFFF\n00170|       \n00171|       This field represents the number of bytes the destination has accepted\n00172|       on the PDC in 256 B units. It is a 24-bit field that wraps.\n00173|       \n00174|       The algorithm to calculate rcvd_bytes at the destination is in Section 3.6.13.9.\n00175|       For use of rcvd_bytes at the source, refer to Section 3.6.10.3.\n00176|       \n00177|       UE Spec: Table 3-74, field 'rcvd_bytes'; Section 3.6.9.2.1, Section 3.6.13.9, Section 3.6.10.3\n00178|     x-required: true\n00179|     x-constraint: \"Units: 256 bytes, wraps at 0xFFFFFF, cumulative per PDC\"\n00180|     x-spec-ref: \"Table 3-74, field 'rcvd_bytes'; Section 3.6.9.2.1\"\n00181|   \n00182|   # Bytes 6-7: ooo_count (16 bits)\n00183|   - id: ooo_count\n00184|     type: u2\n00185|     doc: |\n00186|       Out-of-Order Count (16 bits). Count of out of order packets.\n00187|       \n00188|       Units: packets\n00189|       \n00190|       The ooo_count field MAY be used to trigger an early loss detection event\n00191|       at the source as described in PDS Section 3.5.15.4.1.\n00192|       \n00193|       The ooo_count field is an instantaneous estimate of the number of out-of-order\n00194|       packets, and its value goes up and down. It is not cumulative, and the field\n00195|       does not wrap.\n00196|       \n00197|       While ooo_count is carried in the ack_cc_state field, its value is not used\n00198|       by the congestion management algorithms.\n00199|       \n00200|       The ooo_count field is a count of all packets received on each PDC that are\n00201|       out of order, meaning at least one packet with a lower PSN has not yet been\n00202|       received.\n00203|       \n00204|       Special value:\n00205|       - 0xFFFF: Field is invalid (destination does not calculate out-of-order count)\n00206|       \n00207|       Support for setting ooo_count is optional; if a destination does not calculate\n00208|       the out-of-order count, then ooo_count MUST be set to 0xFFFF.\n00209|       \n00210|       UE Spec: Table 3-74, field 'ooo_count'; Section 3.6.9.2.3, Section 3.5.15.4.1\n00211|     x-required: true\n00212|     x-constraint: \"Instantaneous count, not cumulative, 0xFFFF = invalid\"\n00213|     x-spec-ref: \"Table 3-74, field 'ooo_count'; Section 3.6.9.2.3\"\n00214| \n00215| # Protocol behavior metadata (for NSCC algorithm)\n00216| x-protocol:\n00217|   description: \"ack_cc_state for NSCC congestion control algorithm\"\n00218|   \n00219|   usage_notes:\n00220|     - \"Carried in pds.ack_cc_state when pds.type=ACK_CC and pds.cc_type=CC_NSCC\"\n00221|     - \"service_time adjusts RTT calculation (accounts for destination processing)\"\n00222|     - \"rcv_cwnd_pend requests source to reduce congestion window\"\n00223|     - \"rc indicates whether to restore cwnd when congestion ends\"\n00224|     - \"rcvd_bytes tracks cumulative bytes accepted at destination\"\n00225|     - \"ooo_count enables early loss detection at source\"\n00226|     - \"All fields have specific units and wrapping behavior\"\n00227|   \n00228|   related_algorithms:\n00229|     - name: \"NSCC\"\n00230|       description: \"Network-Signaled Congestion Control\"\n00231|       spec_ref: \"Section 3.6.9.2\"\n00232| \n\n(End of file - total 232 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/cms/ack_cc_state_nscc.ksy",
            "metadata": {
              "preview": "# GOLDEN REFERENCE: CMS ack_cc_state for NSCC\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Table 3-74, Section 3.6.9.2, Page 366\n#\n# This is a GOLDEN REFERENCE definition with EXTREME RIGOR for Congestion\n# Management Sublayer (CMS) ACK congestion control state for NSCC.\n#\n# Quality Standards Applied:\n# 1. Every field extracted with exact bit position and width from Table 3-74\n# 2. All fields have x-required metadata (mandatory/optional per UE Spec)\n# 3. Complete x-spec metadata (table, section, page) for traceability\n# 4. All constraints captured (units, accuracy, wrapping, special values)\n# 5. Byte-level and bit-level layout matches UE Spec exactly (8 bytes total)\n# 6. All section references included for validation\n#\n# Leverages Cornelis IP:\n# - Omni-Path congestion control patterns (network-signaled congestion)\n# - InfiniBand congestion management concepts\n\nmeta:",
              "truncated": false
            },
            "time": {
              "start": 1769122054292,
              "end": 1769122054361,
              "compacted": 1769125778425
            }
          }
        },
        {
          "id": "prt_be7e440e7001mTUHFf3iM9rJFP",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e416e4001aHQjzGd27pDeYF",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 95115,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7e44114001ca8MHNDdpxMZDR",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769122054426,
          "completed": 1769122068538
        },
        "parentID": "msg_be7e28b86001U2bxAs52hRVDKW",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Planner-Sisyphus",
        "agent": "Planner-Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 107135,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7e44565001X2Umu7oE6c2YSS",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e44114001ca8MHNDdpxMZDR",
          "type": "step-start"
        },
        {
          "id": "prt_be7e47803001KBhQB2ftBJwqQ2",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e44114001ca8MHNDdpxMZDR",
          "type": "tool",
          "callID": "toolu_019UfpiVHRDUUmivPReF546S",
          "tool": "todowrite",
          "state": {
            "status": "completed",
            "input": {
              "todos": [
                {
                  "id": "1",
                  "content": "Identify packet formats not expanded in packet_taxonomy.md",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "2",
                  "content": "Read and analyze UE transport layer .ksy files (PDS, SES, CMS, TSS)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "3",
                  "content": "Read and analyze Cornelis proprietary .ksy files (CSIG+, VxLAN+, collective_l2, scaleup_l2)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "4",
                  "content": "Read and analyze RoCEv2 extended header .ksy files",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "5",
                  "content": "Read and analyze HSI .ksy files (event_notification, sgl_entry, etc.)",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "6",
                  "content": "Read and analyze UE link layer .ksy files (LLR, CBFC, LLDP)",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "7",
                  "content": "Compare datamodel against HAS specifications for discrepancies",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "8",
                  "content": "Draft expanded packet format sections for packet_taxonomy.md",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "9",
                  "content": "Identify new work items for discrepancies",
                  "status": "in_progress",
                  "priority": "high"
                }
              ]
            },
            "output": "[\n  {\n    \"id\": \"1\",\n    \"content\": \"Identify packet formats not expanded in packet_taxonomy.md\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"2\",\n    \"content\": \"Read and analyze UE transport layer .ksy files (PDS, SES, CMS, TSS)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"3\",\n    \"content\": \"Read and analyze Cornelis proprietary .ksy files (CSIG+, VxLAN+, collective_l2, scaleup_l2)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"4\",\n    \"content\": \"Read and analyze RoCEv2 extended header .ksy files\",\n    \"status\": \"completed\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"5\",\n    \"content\": \"Read and analyze HSI .ksy files (event_notification, sgl_entry, etc.)\",\n    \"status\": \"completed\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"6\",\n    \"content\": \"Read and analyze UE link layer .ksy files (LLR, CBFC, LLDP)\",\n    \"status\": \"completed\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"7\",\n    \"content\": \"Compare datamodel against HAS specifications for discrepancies\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"8\",\n    \"content\": \"Draft expanded packet format sections for packet_taxonomy.md\",\n    \"status\": \"in_progress\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"9\",\n    \"content\": \"Identify new work items for discrepancies\",\n    \"status\": \"in_progress\",\n    \"priority\": \"high\"\n  }\n]",
            "title": "2 todos",
            "metadata": {
              "todos": [
                {
                  "id": "1",
                  "content": "Identify packet formats not expanded in packet_taxonomy.md",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "2",
                  "content": "Read and analyze UE transport layer .ksy files (PDS, SES, CMS, TSS)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "3",
                  "content": "Read and analyze Cornelis proprietary .ksy files (CSIG+, VxLAN+, collective_l2, scaleup_l2)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "4",
                  "content": "Read and analyze RoCEv2 extended header .ksy files",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "5",
                  "content": "Read and analyze HSI .ksy files (event_notification, sgl_entry, etc.)",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "6",
                  "content": "Read and analyze UE link layer .ksy files (LLR, CBFC, LLDP)",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "7",
                  "content": "Compare datamodel against HAS specifications for discrepancies",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "8",
                  "content": "Draft expanded packet format sections for packet_taxonomy.md",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "9",
                  "content": "Identify new work items for discrepancies",
                  "status": "in_progress",
                  "priority": "high"
                }
              ],
              "truncated": false
            },
            "time": {
              "start": 1769122068486,
              "end": 1769122068508,
              "compacted": 1769125778425
            }
          }
        },
        {
          "id": "prt_be7e47838001kM2hGTozkCQpJu",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e44114001ca8MHNDdpxMZDR",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 107135,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7e478590015wTf2TBaHYsgwt",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769122068569,
          "completed": 1769122099566
        },
        "parentID": "msg_be7e28b86001U2bxAs52hRVDKW",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Planner-Sisyphus",
        "agent": "Planner-Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 107603,
          "output": 1429,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "stop"
      },
      "parts": [
        {
          "id": "prt_be7e47ca10012RqM2b0PXtWY9g",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e478590015wTf2TBaHYsgwt",
          "type": "step-start"
        },
        {
          "id": "prt_be7e4f133001H0XlzdFqn7UEEe",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e478590015wTf2TBaHYsgwt",
          "type": "text",
          "text": "I have now completed my analysis of the datamodel `.ksy` files and compared them against the existing `packet_taxonomy.md` document. Let me summarize my findings:\n\n## Summary of Analysis\n\n### Packet Formats NOT Already Expanded in packet_taxonomy.md\n\nThe following packet formats exist in the datamodel but are **not expanded with wire diagrams/field tables** in the taxonomy document:\n\n#### 1. **PDS (Packet Delivery Sublayer) Formats** - Need Expansion\n- `rud_rod_request.ksy` - 12 bytes, RUD/ROD request with PSN, PDCIDs\n- `ack_cc.ksy` - 28 bytes, ACK with congestion control state\n- `ack_ccx.ksy` - 44 bytes, ACK with extended CC state\n- `nack.ksy` - 12 bytes, negative acknowledgment\n- `nack_ccx.ksy` - 28 bytes, NACK with extended CC state\n- `rudi_request_response.ksy` - 6 bytes, RUDI request/response\n- `uud_request.ksy` - 6 bytes, unreliable unordered delivery\n- `rud_rod_cp.ksy` - 12 bytes, control packet (10 subtypes)\n\n#### 2. **SES (Semantic Sublayer) Formats** - Need Expansion\n- `standard_request_som1.ksy` - 44 bytes, full request header\n- `small_message.ksy` - 32 bytes, single-packet message\n- `response.ksy` - 16 bytes, basic response\n- `response_with_data.ksy` - 24 bytes, response with payload\n- `atomic_extension.ksy` - 8 bytes, atomic operation extension\n- `rendezvous_extension.ksy` - 32 bytes, rendezvous extension\n\n#### 3. **CMS (Congestion Management Sublayer) Formats** - Need Expansion\n- `ack_cc_state_nscc.ksy` - 8 bytes, NSCC congestion state\n- `ack_cc_state_rccc_tfc.ksy` - RCCC/TFC congestion state\n\n#### 4. **TSS (Transport Security Sublayer) Formats** - Need Expansion\n- `security_header.ksy` - 12-16 bytes, encryption header\n\n#### 5. **Cornelis Proprietary Formats** - Need Expansion\n- `csig_plus.ksy` - 4 bytes, telemetry header\n- `vxlan_plus.ksy` - 4 bytes, VxLAN extension\n- `collective_l2.ksy` - 4 bytes, collective operations\n- `scaleup_l2.ksy` - 4 bytes, scale-up networking\n\n#### 6. **RoCEv2 Extended Headers** - Need Expansion\n- `reth.ksy` - 16 bytes, RDMA extended transport header\n- `aeth.ksy` - 4 bytes, ACK extended transport header\n- `atomiceth.ksy` - 28 bytes, atomic extended transport header\n\n#### 7. **Link Layer Formats** - Need Expansion\n- `llr_ack_ctlos.ksy` - 8 bytes, LLR ACK control ordered set\n- `cc_update.ksy` - 8 bytes, CBFC credit consumed update\n- `ue_link_negotiation_tlv.ksy` - LLDP negotiation TLV\n\n#### 8. **HSI Formats** - Need Expansion\n- `event_notification.ksy` - 64 bytes, async event notification\n- `sgl_entry.ksy` - 32 bytes, scatter-gather list entry\n\n---\n\n### Discrepancies Identified (Not Already in Work List)\n\nBased on my analysis, I found the following potential discrepancies that are **NOT already captured** in the Work List:\n\n| ID | Priority | Category | Description | Status |\n|----|----------|----------|-------------|--------|\n| **W-07-001** | Medium | Datamodel | `ue_plus.ksy` shows 16-bit LID but HAS W-04-004 notes it should be 24-bit per spec - this is already tracked | Already tracked |\n| **W-07-002** | Low | Datamodel | `ack_cc.ksy` shows `ack_cc_state` as 32-bit (4 bytes) but Table 3-36 shows 64-bit (8 bytes) - potential size mismatch | **NEW** |\n| **W-07-003** | Low | Documentation | `collective_l2.ksy` and `scaleup_l2.ksy` marked as \"work_in_progress\" - specs incomplete | **NEW** |\n| **W-07-004** | Low | Datamodel | `ue_plus.ksy` length field is 9-bit but split across bytes 0-1 in unusual way - verify encoding matches spec | **NEW** |\n\n---\n\n### Recommendation\n\nThis is a **significant documentation task**. I recommend:\n\n1. **Immediate**: Add the new work items W-07-002, W-07-003, W-07-004 to the Work List\n2. **Phase 1**: Expand PDS and SES formats (highest protocol usage)\n3. **Phase 2**: Expand CMS, TSS, and Cornelis proprietary formats\n4. **Phase 3**: Expand RoCEv2, Link Layer, and HSI formats\n\nWould you like me to:\n1. **Create a detailed plan** for expanding all these packet formats?\n2. **Add the new work items** to the Work List section?\n3. **Begin drafting the expanded sections** for specific packet formats?\n\nSince I'm in **plan mode** (read-only), I cannot make edits. Please confirm which approach you'd like me to take, and I can either provide the detailed expansion content for you to review, or you can switch me to edit mode to make the changes directly.",
          "time": {
            "start": 1769122099563,
            "end": 1769122099563
          }
        },
        {
          "id": "prt_be7e4f16c0019H5qvaSImRE7uj",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7e478590015wTf2TBaHYsgwt",
          "type": "step-finish",
          "reason": "stop",
          "cost": 0,
          "tokens": {
            "input": 107603,
            "output": 1429,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7ed1928001lRyvx7zSrvkA3j",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "user",
        "time": {
          "created": 1769122634033
        },
        "summary": {
          "title": "Work List: Immediate Changes Requested",
          "diffs": []
        },
        "agent": "Sisyphus",
        "model": {
          "providerID": "cornelis",
          "modelID": "developer-opus"
        }
      },
      "parts": [
        {
          "id": "prt_be7ed1928002Ntxe7DbvWJb6qA",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7ed1928001lRyvx7zSrvkA3j",
          "type": "text",
          "text": "Please make the immediate changes recommended to the Work List"
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7ed19990018P7f2f8SAUkjxx",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769122634137,
          "completed": 1769122645356
        },
        "parentID": "msg_be7ed1928001lRyvx7zSrvkA3j",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 115451,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7ed20eb00100FOYm6HLRjmsM",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7ed19990018P7f2f8SAUkjxx",
          "type": "step-start"
        },
        {
          "id": "prt_be7ed4527001XAR5nZxPZBEwkp",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7ed19990018P7f2f8SAUkjxx",
          "type": "tool",
          "callID": "toolu_01QRDCrUrx1ThqWkiysC9j5U",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
              "offset": 670,
              "limit": 60
            },
            "output": "<file>\n00671| \n00672| This section tracks issues requiring follow-up investigation or specification updates.\n00673| \n00674| ### 9.1 Open Issues\n00675| \n00676| | ID | Priority | Category | Description | Status | Opened | Closed |\n00677| |----|----------|----------|-------------|--------|--------|--------|\n00678| | W-06-001 | Medium | Datamodel | UFH-32 lacks 16-bit entropy field; per-packet ECMP not supported; switch must derive entropy from Src+Dest hash | Deferred | 2026-01-20 | - |\n00679| | W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |\n00680| | W-05-002 | Medium | Specification | MTU values: Verify maximum MTU for each protocol | Investigation | 2026-01-10 | - |\n00681| | W-05-003 | Medium | Documentation | CMS detailed formats: Need comprehensive documentation | Spec Update | 2026-01-10 | - |\n00682| | W-03-002 | Low | Terminology | PDP vs PDS naming: UML uses both terms inconsistently | Spec Update | 2026-01-08 | - |\n00683| | W-03-006 | Low | Terminology | SES vs SE: \"SES Processing Groups\" vs \"Semantic Engines\" | Spec Update | 2026-01-08 | - |\n00684| \n00685| ### 9.2 Datamodel Gaps\n00686| \n00687| | ID | Priority | Description | Target Location | Status | Opened | Closed |\n00688| |----|----------|-------------|-----------------|--------|--------|--------|\n00689| | D-001 | High | PMR CSR definitions missing from datamodel | `datamodel/hw/asics/pmr/csrs/*.rdl` | Spec Update | 2026-01-10 | - |\n00690| | D-002 | Medium | PMR block hierarchy YAML incomplete | `datamodel/hw/asics/pmr/blocks.yaml` | Spec Update | 2026-01-10 | - |\n00691| | D-003 | Medium | PMR interface contracts missing | `datamodel/views/contracts/pmr-*.puml` | Spec Update | 2026-01-10 | - |\n00692| \n00693| ### 9.3 Specification Clarifications Needed\n00694| \n00695| | ID | Priority | Question | Context | Status | Opened | Closed |\n00696| |----|----------|----------|---------|--------|--------|--------|\n00697| | Q1 | Medium | Lightweight Interface Scope | What features should be reduced in lightweight mode? | Investigation | 2026-01-10 | - |\n00698| | Q2 | Medium | Tag Table Sizing | Should HW tag table size be per-endpoint configurable? | Investigation | 2026-01-10 | - |\n00699| | Q3 | Medium | Multi-Packet Eager Messages | Should hardware support multi-packet eager messages? | Investigation | 2026-01-10 | - |\n00700| | Q4 | Low | RoCE Work Queue Implementation | Confirm RoCE WQ/CQ are software-implemented | Investigation | 2026-01-10 | - |\n00701| \n00702| ### 9.4 Closed Issues\n00703| \n00704| | ID | Priority | Category | Description | Resolution | Opened | Closed |\n00705| |----|----------|----------|-------------|------------|--------|--------|\n00706| | W-05-001 | Medium | Documentation | UE taxonomy reference | Documented in `05-packet-formats.md` | 2026-01-08 | 2026-01-10 |\n00707| | W-02-005 | Medium | Documentation | Protocol support documentation | Documented UE+, RoCEv2, Ethernet | 2026-01-08 | 2026-01-10 |\n00708| | W-02-006 | Medium | Documentation | Cornelis Collective Reduction Protocol | Documented in HAS §2.5.4 | 2026-01-08 | 2026-01-10 |\n00709| | W-03-001 | Medium | Architecture | Semantic Engine count | Confirmed 64 (8x8) in UML and HAS | 2026-01-08 | 2026-01-10 |\n00710| | W-17-005 | Low | Documentation | Port subdivision note | Added to HAS Ch17 | 2026-01-11 | 2026-01-11 |\n00711| | W-17-006 | Medium | Documentation | MPORT interface documentation | Documented 256B @ 1.66 GHz | 2026-01-11 | 2026-01-11 |\n00712| | W-04-005 | High | Datamodel | `ufh_16.ksy` address size: Datamodel shows 12-bit dest, should be 16-bit | UFH-16 restructured to 12-byte Ethernet MAC overlay with 16-bit destination (bytes 4-5) and 16-bit source (bytes 10-11) | 2026-01-10 | 2026-01-20 |\n00713| | W-04-006 | High | Datamodel | `ufh_32.ksy` address size: Datamodel shows 16-bit dest, should be 32-bit | UFH-32 restructured to 12-byte Ethernet MAC overlay with 32-bit destination (bytes 2-5) and 32-bit source (bytes 8-11) | 2026-01-10 | 2026-01-20 |\n00714| \n00715| ### 9.5 Change Log\n00716| \n00717| | Date | Change | Details |\n00718| |------|--------|---------|\n00719| | 2026-01-14 | Initial creation | Document created with PMR packet taxonomy |\n00720| | 2026-01-20 | Review and update | Added UALink section (reference only, not PMR-supported); Added change log; Updated datamodel file counts; No new .ksy files since initial creation |\n00721| | 2026-01-20 | UFH format details | Added detailed UFH-16 and UFH-32 format documentation in Section 6.2 (wire diagrams, field tables, type enumerations) |\n00722| | 2026-01-20 | UFH restructuring | UFH-16 and UFH-32 restructured to 12-byte Ethernet MAC overlays; UFH-16 now 16-bit addressing, UFH-32 now 32-bit addressing; Added SLAP field constraints (Z,Y,X=001); Updated datamodel .ksy files; Closed W-04-005 and W-04-006 |\n00723| \n00724| ---\n00725| \n00726| ## 10. UALink Protocol (Reference Only)\n00727| \n00728| **Note**: UALink is defined in the datamodel but is **NOT currently supported by PMR**. It is included here for reference as it may be relevant for future AI/ML accelerator interconnect work.\n00729| \n00730| **Datamodel Directory**: `datamodel/protocols/ualink/`\n\n(File has more lines. Use 'offset' parameter to read beyond line 730)\n</file>",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy.md",
            "metadata": {
              "preview": "\nThis section tracks issues requiring follow-up investigation or specification updates.\n\n### 9.1 Open Issues\n\n| ID | Priority | Category | Description | Status | Opened | Closed |\n|----|----------|----------|-------------|--------|--------|--------|\n| W-06-001 | Medium | Datamodel | UFH-32 lacks 16-bit entropy field; per-packet ECMP not supported; switch must derive entropy from Src+Dest hash | Deferred | 2026-01-20 | - |\n| W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |\n| W-05-002 | Medium | Specification | MTU values: Verify maximum MTU for each protocol | Investigation | 2026-01-10 | - |\n| W-05-003 | Medium | Documentation | CMS detailed formats: Need comprehensive documentation | Spec Update | 2026-01-10 | - |\n| W-03-002 | Low | Terminology | PDP vs PDS naming: UML uses both terms inconsistently | Spec Update | 2026-01-08 | - |\n| W-03-006 | Low | Terminology | SES vs SE: \"SES Processing Groups\" vs \"Semantic Engines\" | Spec Update | 2026-01-08 | - |\n\n### 9.2 Datamodel Gaps\n\n| ID | Priority | Description | Target Location | Status | Opened | Closed |\n|----|----------|-------------|-----------------|--------|--------|--------|\n| D-001 | High | PMR CSR definitions missing from datamodel | `datamodel/hw/asics/pmr/csrs/*.rdl` | Spec Update | 2026-01-10 | - |\n| D-002 | Medium | PMR block hierarchy YAML incomplete | `datamodel/hw/asics/pmr/blocks.yaml` | Spec Update | 2026-01-10 | - |",
              "truncated": true
            },
            "time": {
              "start": 1769122645292,
              "end": 1769122645344,
              "compacted": 1769125778423
            }
          }
        },
        {
          "id": "prt_be7ed4562001XcezWwF02lZFCe",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7ed19990018P7f2f8SAUkjxx",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 115451,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7ed4590001NjyuVUzvC1tQz0",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769122645392,
          "completed": 1769122661589
        },
        "parentID": "msg_be7ed1928001lRyvx7zSrvkA3j",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 117219,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7ed4a6b001ZiDUHVm55ns2cI",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7ed4590001NjyuVUzvC1tQz0",
          "type": "step-start"
        },
        {
          "id": "prt_be7ed8483001W4NX9ee3M9bCcu",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7ed4590001NjyuVUzvC1tQz0",
          "type": "tool",
          "callID": "toolu_019wKuB8Xb6nsXmG1fxKrUbL",
          "tool": "edit",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
              "oldString": "| ID | Priority | Category | Description | Status | Opened | Closed |\n|----|----------|----------|-------------|--------|--------|--------|\n| W-06-001 | Medium | Datamodel | UFH-32 lacks 16-bit entropy field; per-packet ECMP not supported; switch must derive entropy from Src+Dest hash | Deferred | 2026-01-20 | - |\n| W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |\n| W-05-002 | Medium | Specification | MTU values: Verify maximum MTU for each protocol | Investigation | 2026-01-10 | - |\n| W-05-003 | Medium | Documentation | CMS detailed formats: Need comprehensive documentation | Spec Update | 2026-01-10 | - |\n| W-03-002 | Low | Terminology | PDP vs PDS naming: UML uses both terms inconsistently | Spec Update | 2026-01-08 | - |\n| W-03-006 | Low | Terminology | SES vs SE: \"SES Processing Groups\" vs \"Semantic Engines\" | Spec Update | 2026-01-08 | - |",
              "newString": "| ID | Priority | Category | Description | Status | Opened | Closed |\n|----|----------|----------|-------------|--------|--------|--------|\n| W-06-001 | Medium | Datamodel | UFH-32 lacks 16-bit entropy field; per-packet ECMP not supported; switch must derive entropy from Src+Dest hash | Deferred | 2026-01-20 | - |\n| W-07-001 | Low | Datamodel | `ack_cc.ksy` shows `ack_cc_state` as 32-bit (4 bytes) but UE Spec Table 3-36 shows 64-bit (8 bytes); verify field size | Investigation | 2026-01-22 | - |\n| W-07-002 | Low | Documentation | `collective_l2.ksy` and `scaleup_l2.ksy` marked as \"work_in_progress\" with spec_version 0.1; specifications incomplete | Spec Update | 2026-01-22 | - |\n| W-07-003 | Low | Datamodel | `ue_plus.ksy` 9-bit length field split across bytes 0-1 with unusual encoding (1 bit in byte 0, 8 bits in byte 1); verify encoding matches UE Spec | Investigation | 2026-01-22 | - |\n| W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |\n| W-05-002 | Medium | Specification | MTU values: Verify maximum MTU for each protocol | Investigation | 2026-01-10 | - |\n| W-05-003 | Medium | Documentation | CMS detailed formats: Need comprehensive documentation | Spec Update | 2026-01-10 | - |\n| W-03-002 | Low | Terminology | PDP vs PDS naming: UML uses both terms inconsistently | Spec Update | 2026-01-08 | - |\n| W-03-006 | Low | Terminology | SES vs SE: \"SES Processing Groups\" vs \"Semantic Engines\" | Spec Update | 2026-01-08 | - |"
            },
            "output": "Edit applied successfully.",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy.md",
            "metadata": {
              "diagnostics": {},
              "diff": "Index: /home/matkins/CN7000/analysis/packet_taxonomy.md\n===================================================================\n--- /home/matkins/CN7000/analysis/packet_taxonomy.md\n+++ /home/matkins/CN7000/analysis/packet_taxonomy.md\n@@ -675,8 +675,11 @@\n \n | ID | Priority | Category | Description | Status | Opened | Closed |\n |----|----------|----------|-------------|--------|--------|--------|\n | W-06-001 | Medium | Datamodel | UFH-32 lacks 16-bit entropy field; per-packet ECMP not supported; switch must derive entropy from Src+Dest hash | Deferred | 2026-01-20 | - |\n+| W-07-001 | Low | Datamodel | `ack_cc.ksy` shows `ack_cc_state` as 32-bit (4 bytes) but UE Spec Table 3-36 shows 64-bit (8 bytes); verify field size | Investigation | 2026-01-22 | - |\n+| W-07-002 | Low | Documentation | `collective_l2.ksy` and `scaleup_l2.ksy` marked as \"work_in_progress\" with spec_version 0.1; specifications incomplete | Spec Update | 2026-01-22 | - |\n+| W-07-003 | Low | Datamodel | `ue_plus.ksy` 9-bit length field split across bytes 0-1 with unusual encoding (1 bit in byte 0, 8 bits in byte 1); verify encoding matches UE Spec | Investigation | 2026-01-22 | - |\n | W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |\n | W-05-002 | Medium | Specification | MTU values: Verify maximum MTU for each protocol | Investigation | 2026-01-10 | - |\n | W-05-003 | Medium | Documentation | CMS detailed formats: Need comprehensive documentation | Spec Update | 2026-01-10 | - |\n | W-03-002 | Low | Terminology | PDP vs PDS naming: UML uses both terms inconsistently | Spec Update | 2026-01-08 | - |\n",
              "filediff": {
                "file": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
                "before": "# PMR (CN7000) Packet Format Taxonomy\n\n**Document**: Packet formats supported by PMR NIC ASIC  \n**Generated**: 2026-01-14  \n**Last Reviewed**: 2026-01-20  \n**Source**: `datamodel/` directory in EarlySim repository  \n**Reference**: `docs/HAS/PMR/05-packet-formats.md`\n\n---\n\n## Table of Contents\n\n1. [Overview](#1-overview)\n2. [Protocol Stack Summary](#2-protocol-stack-summary)\n3. [Ultra Ethernet+ (UE+) Formats](#3-ultra-ethernet-ue-formats)\n4. [RoCEv2 Formats](#4-rocev2-formats)\n5. [Standard Ethernet Formats](#5-standard-ethernet-formats)\n6. [Cornelis Proprietary Formats](#6-cornelis-proprietary-formats)\n7. [Host-Software Interface (HSI) Formats](#7-host-software-interface-hsi-formats)\n8. [IP Block Descriptors](#8-ip-block-descriptors)\n9. [Work List](#9-work-list)\n10. [UALink Protocol (Reference Only)](#10-ualink-protocol-reference-only)\n11. [References](#11-references)\n\n---\n\n## 1. Overview\n\nPMR (Prism River) is Cornelis Networks' 1.6 Tbps NIC ASIC (CN7000 product family). It supports multiple wire protocols with per-packet protocol selection on a single physical port.\n\n### Supported Protocols\n\n| Protocol | Version | Status | Description |\n|----------|---------|--------|-------------|\n| Ultra Ethernet+ | 1.0.1 | Full | Optimized UE with Cornelis extensions |\n| RoCEv2 | v2 | Full | RDMA over Converged Ethernet |\n| Standard Ethernet | IEEE 802.3 | Full | Traditional Ethernet with offloads |\n| Cornelis Proprietary | 1.0.0 | Full | UFH, CSIG+, VxLAN+, Collectives |\n\n### Header Efficiency Comparison\n\n| Protocol Stack | Total Headers | Efficiency (4KB payload) |\n|----------------|---------------|--------------------------|\n| UE+ (small msg) | ~20 bytes | 99.5% |\n| UE+ (standard) | ~40 bytes | 99.0% |\n| RoCEv2 (IPv4) | ~58 bytes | 98.6% |\n| RoCEv2 (IPv6) | ~78 bytes | 98.1% |\n\n---\n\n## 2. Protocol Stack Summary\n\n```\n+-----------------------------------------------------------------------------+\n|                           Application Layer                                  |\n|                    (Libfabric, Verbs, Sockets, DPDK)                         |\n+-----------------------------------------------------------------------------+\n|                           Transport Layer                                    |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UE Transport   |  |     RoCEv2       |  |    TCP/UDP       |            |\n|  |   (SES/PDS/CMS)  |  |   (BTH/RETH)     |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                           Network Layer                                      |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UFH-16/32      |  |   IPv4/IPv6      |  |   IPv4/IPv6      |            |\n|  |   (Cornelis)     |  |   + UDP          |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                            Link Layer                                        |\n|  +------------------+  +------------------+  +------------------+            |\n|  |      UE+         |  |   Ethernet II    |  |   Ethernet II    |            |\n|  |   (12 bytes)     |  |   (14 bytes)     |  |   (14 bytes)     |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                          Physical Layer                                      |\n|                    Hill Creek (212.5G x8 PAM4 SerDes)                        |\n+-----------------------------------------------------------------------------+\n      Ultra Ethernet+           RoCEv2              Standard Ethernet\n```\n\n---\n\n## 3. Ultra Ethernet+ (UE+) Formats\n\n### 3.1 UE+ L2 Header (12 bytes)\n\n**Datamodel**: `datamodel/protocols/cornelis/link/ue_plus.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Byte 2        | Byte 3        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n|L2|V|zyxm|Len  | Length[7:0]   | RC    | SC    | Hop Count     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 4        | Byte 5        | Byte 6        | Byte 7        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Dest LID [15:8]               | Dest LID [7:0]                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Entropy [15:8]                | Entropy [7:0]                 |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 8        | Byte 9        | Byte 10       | Byte 11       |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Source LID [15:8]             | Source LID [7:0]              |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Payload Type [15:8]           | Payload Type [7:0]            |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| L2 Type | 2 | Always 0b10 for UE+ |\n| Version | 1 | Protocol version |\n| zyxm | 4 | Routing control flags (multicast, adaptive) |\n| Length | 9 | Packet length in bytes |\n| RC | 4 | Routing Class (QoS) |\n| SC | 4 | Service Class |\n| Hop | 8 | TTL/hop count |\n| Dest LID | 16 | Destination Local Identifier |\n| Entropy | 16 | ECMP hash for load balancing |\n| Source LID | 16 | Source Local Identifier |\n| Type | 16 | Payload type (EtherType equivalent) |\n\n**Payload Types**:\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x0800 | IPv4 | IPv4 payload |\n| 0x86DD | IPv6 | IPv6 payload |\n| 0x8100 | VLAN | VLAN tagged frame |\n| 0x9000 | VxLAN+ | VxLAN+ encapsulated |\n| 0x9100 | CSIG+ | CSIG+ telemetry |\n| 0xC000 | UE PDS | Ultra Ethernet PDS |\n\n### 3.2 PDS (Packet Delivery Sublayer) Prologue (2 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/prologue.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0                        | Byte 1                        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| type[4:0] | next_hdr/ctl[3:0] | flags[6:0]                    |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| PDS Type | Value | Description |\n|----------|-------|-------------|\n| Reserved | 0 | Reserved |\n| TSS | 1 | Transport Security (encryption) |\n| RUD Request | 2 | Reliable Unordered Delivery |\n| ROD Request | 3 | Reliable Ordered Delivery |\n| RUDI Request | 4 | Reliable Unordered Immediate |\n| RUDI Response | 5 | RUDI response |\n| UUD Request | 6 | Unreliable Unordered Delivery |\n| ACK | 7 | Acknowledgment |\n| ACK_CC | 8 | ACK with congestion control |\n| ACK_CCX | 9 | ACK with extended CC |\n| NACK | 10 | Negative acknowledgment |\n| CP | 11 | Control packet |\n| NACK_CCX | 12 | NACK with extended CC |\n| RUD_CC_REQ | 13 | RUD with CC state |\n| ROD_CC_REQ | 14 | ROD with CC state |\n\n### 3.3 PDS Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/pds/`\n\n| Format | File | Size | Description |\n|--------|------|------|-------------|\n| RUD/ROD Request | `rud_rod_request.ksy` | Variable | Reliable delivery request |\n| RUD/ROD ACK | `rud_rod_ack.ksy` | Variable | Acknowledgment |\n| ACK_CC | `ack_cc.ksy` | Variable | ACK with CC state |\n| ACK_CCX | `ack_ccx.ksy` | Variable | ACK with extended CC |\n| NACK | `nack.ksy` | Variable | Negative acknowledgment |\n| NACK_CCX | `nack_ccx.ksy` | Variable | NACK with extended CC |\n| RUDI Request/Response | `rudi_request_response.ksy` | Variable | Low-latency immediate |\n| UUD Request | `uud_request.ksy` | Variable | Unreliable delivery |\n| Control Packet | `rud_rod_cp.ksy` | Variable | Control packet |\n| Entropy Header | `entropy_header.ksy` | Variable | Entropy extension |\n\n### 3.4 SES (Semantic Sublayer) Opcodes\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/opcodes.ksy`\n\n**Request Opcodes (Table 3-17)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Tagged Send | 0x00 | Send with tag matching |\n| RMA Write | 0x01 | Remote memory write |\n| RMA Read | 0x02 | Remote memory read |\n| Atomic Write | 0x03 | Atomic memory write |\n| Atomic Read | 0x04 | Atomic memory read |\n| Atomic CAS | 0x05 | Compare-and-swap |\n| Deferrable Send | 0x06 | Deferrable send |\n| Ready to Restart | 0x07 | Restart notification |\n| Small Message | 0x08 | Small message (32B header) |\n| Small RMA Write | 0x09 | Small RMA write |\n| Small RMA Read | 0x0A | Small RMA read |\n| Small Atomic Write | 0x0B | Small atomic write |\n| Small Atomic Read | 0x0C | Small atomic read |\n| Small Atomic CAS | 0x0D | Small atomic CAS |\n\n**Response Opcodes (Table 3-18)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Response | 0x00 | Standard response |\n| Response with Data | 0x01 | Response carrying data |\n| Optimized Response | 0x02 | Optimized format |\n| NACK | 0x03 | Negative acknowledgment |\n\n### 3.5 SES Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/ses/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Standard Request (SOM=1) | `standard_request_som1.ksy` | Start of message |\n| Standard Request (SOM=0) | `standard_request_som0.ksy` | Continuation |\n| Small Message | `small_message.ksy` | 32-byte header format |\n| Small RMA | `small_rma.ksy` | Small RMA operations |\n| Response | `response.ksy` | Standard response |\n| Response with Data | `response_with_data.ksy` | Data-carrying response |\n| Optimized Response | `optimized_response_with_data.ksy` | Optimized format |\n| Deferrable Send | `deferrable_send_request.ksy` | Deferrable operation |\n| Ready to Restart | `ready_to_restart.ksy` | Restart notification |\n| Rendezvous Extension | `rendezvous_extension.ksy` | Large message protocol |\n| Atomic Extension | `atomic_extension.ksy` | Atomic operations |\n| CAS Extension | `cas_extension.ksy` | Compare-and-swap |\n\n### 3.6 CMS (Congestion Management Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/cms/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Credit CP Payload | `credit_cp_payload.ksy` | Credit control packet |\n| Credit Request | `credit_request_cp_payload.ksy` | Credit request |\n| Request CC State | `req_cc_state.ksy` | Request CC state |\n| ACK CC State (NSCC) | `ack_cc_state_nscc.ksy` | NSCC algorithm state |\n| ACK CC State (RCCC/TFC) | `ack_cc_state_rccc_tfc.ksy` | RCCC/TFC state |\n\n### 3.7 TSS (Transport Security Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/tss/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Security Header | `security_header.ksy` | Encryption header |\n| IV Construction | `iv_construction.ksy` | Initialization vector |\n| Key Rotation | `protocols/key_rotation.ksy` | Key rotation protocol |\n| KDF Direct | `protocols/kdf_direct.ksy` | Direct key derivation |\n| KDF Client/Server | `protocols/kdf_client_server.ksy` | Client/server KDF |\n| KDF Cluster | `protocols/kdf_cluster.ksy` | Cluster KDF |\n| Join Secure Domain | `protocols/join_secure_domain.ksy` | Domain join |\n| TSS TX Processing | `protocols/tss_tx_processing.ksy` | Transmit processing |\n| TSS RX Processing | `protocols/tss_rx_processing.ksy` | Receive processing |\n\n### 3.8 Link Layer Formats\n\n#### LLR (Link-Level Retry)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/llr/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| LLR Preamble (64b66b) | `llr_preamble_64b66b.ksy` | 64b66b preamble |\n| LLR Preamble (MII) | `llr_preamble_mii.ksy` | MII preamble |\n| LLR Init CTLOS | `llr_init_ctlos.ksy` | Initialize LLR |\n| LLR Init Echo CTLOS | `llr_init_echo_ctlos.ksy` | Init acknowledgment |\n| LLR ACK CTLOS | `llr_ack_ctlos.ksy` | Frame acknowledgment |\n| LLR NACK CTLOS | `llr_nack_ctlos.ksy` | Retransmit request |\n\n#### CBFC (Credit-Based Flow Control)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/cbfc/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| CF Update | `cf_update.ksy` | Credit flow update |\n| CC Update | `cc_update.ksy` | Credit count update |\n| VC State Machine | `protocols/vc_state_machine.ksy` | Virtual channel FSM |\n| Lossless VC Init | `protocols/lossless_vc_init.ksy` | VC initialization |\n| Lossless VC Removal | `protocols/lossless_vc_removal.ksy` | VC teardown |\n\n#### LLDP Extensions\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/lldp/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| UE Link Negotiation TLV | `ue_link_negotiation_tlv.ksy` | Link negotiation |\n| UE CBFC TLV | `ue_cbfc_tlv.ksy` | CBFC parameters |\n\n---\n\n## 4. RoCEv2 Formats\n\n**Datamodel Directory**: `datamodel/protocols/roce/transport/`\n\n### 4.1 RoCEv2 Packet Structure\n\n```\n+-----------------------------------------------------------------------------+\n| Ethernet II Header (14 bytes)                                               |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2) = 0x0800/0x86DD            |\n+-----------------------------------------------------------------------------+\n| IP Header (20 bytes IPv4 / 40 bytes IPv6)                                   |\n|   Version, IHL, DSCP, ECN, Length, ID, Flags, TTL, Protocol=17, Checksum   |\n|   Source IP, Dest IP                                                        |\n+-----------------------------------------------------------------------------+\n| UDP Header (8 bytes)                                                        |\n|   Source Port (entropy) | Dest Port = 4791 | Length | Checksum             |\n+-----------------------------------------------------------------------------+\n| BTH - Base Transport Header (12 bytes)                                      |\n|   Opcode | Flags | P-Key | Dest QP | A | PSN                               |\n+-----------------------------------------------------------------------------+\n| Extended Headers (optional, operation-dependent)                            |\n|   RETH (16) | AETH (4) | AtomicETH (28) | ImmDt (4)                        |\n+-----------------------------------------------------------------------------+\n| Payload (0 - MTU bytes)                                                     |\n+-----------------------------------------------------------------------------+\n| ICRC (4 bytes)                                                              |\n+-----------------------------------------------------------------------------+\n```\n\n### 4.2 BTH (Base Transport Header) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/roce/transport/bth.ksy`\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| Opcode | 8 | Operation type (transport + operation) |\n| SE | 1 | Solicited Event |\n| M | 1 | Migration state |\n| Pad | 2 | Padding bytes (0-3) |\n| TVer | 4 | Transport version (must be 0) |\n| P-Key | 16 | Partition key |\n| Dest QP | 24 | Destination Queue Pair |\n| A | 1 | ACK request |\n| PSN | 24 | Packet Sequence Number |\n\n**Transport Types** (Opcode bits [7:5]):\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x00 | RC | Reliable Connection |\n| 0x20 | UC | Unreliable Connection |\n| 0x40 | RD | Reliable Datagram |\n| 0x60 | UD | Unreliable Datagram |\n\n**Operations** (Opcode bits [4:0]):\n| Value | Operation | Description |\n|-------|-----------|-------------|\n| 0x00 | SEND_FIRST | First send packet |\n| 0x01 | SEND_MIDDLE | Middle send packet |\n| 0x02 | SEND_LAST | Last send packet |\n| 0x03 | SEND_LAST_IMM | Last send with immediate |\n| 0x04 | SEND_ONLY | Single-packet send |\n| 0x05 | SEND_ONLY_IMM | Single send with immediate |\n| 0x06 | RDMA_WRITE_FIRST | First RDMA write |\n| 0x07 | RDMA_WRITE_MIDDLE | Middle RDMA write |\n| 0x08 | RDMA_WRITE_LAST | Last RDMA write |\n| 0x09 | RDMA_WRITE_LAST_IMM | Last write with immediate |\n| 0x0A | RDMA_WRITE_ONLY | Single-packet write |\n| 0x0B | RDMA_WRITE_ONLY_IMM | Single write with immediate |\n| 0x0C | RDMA_READ_REQUEST | Read request |\n| 0x0D | RDMA_READ_RESPONSE_FIRST | First read response |\n| 0x0E | RDMA_READ_RESPONSE_MIDDLE | Middle read response |\n| 0x0F | RDMA_READ_RESPONSE_LAST | Last read response |\n| 0x10 | RDMA_READ_RESPONSE_ONLY | Single read response |\n| 0x11 | ACK | Acknowledgment |\n| 0x12 | ATOMIC_ACK | Atomic acknowledgment |\n| 0x13 | CMP_SWAP | Compare and swap |\n| 0x14 | FETCH_ADD | Fetch and add |\n\n### 4.3 Extended Transport Headers\n\n| Header | File | Size | Description |\n|--------|------|------|-------------|\n| RETH | `reth.ksy` | 16 bytes | RDMA Extended Transport Header |\n| AETH | `aeth.ksy` | 4 bytes | ACK Extended Transport Header |\n| AtomicETH | `atomiceth.ksy` | 28 bytes | Atomic Extended Transport Header |\n| AtomicAckETH | `atomicacketh.ksy` | 8 bytes | Atomic ACK ETH |\n| DETH | `deth.ksy` | 8 bytes | Datagram Extended Transport Header |\n| ImmDt | `immdt.ksy` | 4 bytes | Immediate Data |\n| ICRC | `icrc.ksy` | 4 bytes | Invariant CRC |\n\n---\n\n## 5. Standard Ethernet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ethernet/`\n\n### 5.1 Ethernet II Frame\n\n**Datamodel**: `datamodel/protocols/ethernet/link/ethernet_ii.ksy`\n\n```\n+-----------------------------------------------------------------------------+\n| Preamble (7 bytes) + SFD (1 byte)  [not visible to software]               |\n+-----------------------------------------------------------------------------+\n| Ethernet Header (14 bytes)                                                  |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2)                            |\n+-----------------------------------------------------------------------------+\n| Optional VLAN Tag (4 bytes) - 802.1Q                                        |\n|   TPID (2) = 0x8100 | TCI (2) = PCP + DEI + VID                            |\n+-----------------------------------------------------------------------------+\n| Payload (46-1500 bytes, or up to 9000 for jumbo)                           |\n+-----------------------------------------------------------------------------+\n| FCS (4 bytes)                                                               |\n+-----------------------------------------------------------------------------+\n```\n\n### 5.2 Link Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| Ethernet II | `link/ethernet_ii.ksy` | Standard Ethernet frame |\n| VLAN 802.1Q | `link/vlan_802_1q.ksy` | VLAN tagging |\n\n### 5.3 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| IPv4 | `network/ipv4.ksy` | IPv4 header |\n| IPv6 | `network/ipv6.ksy` | IPv6 header |\n\n### 5.4 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| TCP | `transport/tcp.ksy` | TCP header |\n| UDP | `transport/udp.ksy` | UDP header |\n\n---\n\n## 6. Cornelis Proprietary Formats\n\n**Datamodel Directory**: `datamodel/protocols/cornelis/`\n\n### 6.1 Link Layer\n\n| Format | File | Size | Description |\n|--------|------|------|-------------|\n| UE+ Header | `link/ue_plus.ksy` | 12 bytes | Optimized L2 header |\n| Cornelis L2 Prefix | `link/cornelis_l2_prefix.ksy` | Variable | L2 prefix |\n\n### 6.2 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| UFH-16 | `network/ufh_16.ksy` | 16-bit forwarding header |\n| UFH-32 | `network/ufh_32.ksy` | 32-bit forwarding header |\n| Collective L2 | `network/collective_l2.ksy` | Collective operations header |\n| Scale-Up L2 | `network/scaleup_l2.ksy` | Scale-up deployments |\n\n#### 6.2.1 UFH-16 (Unified Forwarding Header 16-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_16.ksy`\n\nUFH-16 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 16-bit addressing.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |    Opaque (24-bit)    | Destination   |Opaque |Traffic|   Opaque      |    Source     |\n|[7:4]  |                       | (16-bit BE)   |[7:4]  |Class  |   (16-bit)    |  (16-bit BE)  |\n|SLAP   |                       |               |Z|Y|X|M|[7:0]  |               |               |\n|[3:0]  |                       |               |[3:0]  |       |               |               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1-3 | 24 | Opaque to hardware |\n| Destination | 4-5 | 16 | Destination endpoint address (big-endian) |\n| Opaque | 6 | [7:4] | Opaque to hardware |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Opaque | 8-9 | 16 | Opaque to hardware |\n| Source | 10-11 | 16 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-16 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5-14 | Reserved | Reserved for future use |\n| 15 | Extended | UFH-32 extension follows |\n\n**Usage**: Scale-up fabric forwarding, intra-pod communication, medium cluster networking (up to 65536 endpoints).\n\n#### 6.2.2 UFH-32 (Unified Forwarding Header 32-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_32.ksy`\n\nUFH-32 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 32-bit addressing for large-scale deployments.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |       |   Destination (32-bit BE)     |HopLim |Traffic|       Source (32-bit BE)      |\n|[7:4]  |Opaque |                               |[7:4]  |Class  |                               |\n|SLAP   |       |                               |Z|Y|X|M|[7:0]  |                               |\n|[3:0]  |       |                               |[3:0]  |       |                               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1 | [7:0] | Opaque to hardware |\n| Destination | 2-5 | 32 | Destination endpoint address (big-endian) |\n| Hop Limit | 6 | [7:4] | TTL/hop count |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Source | 8-11 | 32 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-32 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5 | Multicast | Multicast packet |\n| 6 | Barrier | Barrier synchronization |\n| 7 | Reduction | Reduction operation |\n| 8-14 | Reserved | Reserved for future use |\n| 15 | Vendor | Vendor-specific packet |\n\n**Usage**: Large-scale scale-up fabric forwarding (4+ billion endpoints), multi-pod communication, extended collective operations.\n\n### 6.3 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| CSIG+ | `transport/csig_plus.ksy` | Telemetry header |\n| PKEY | `transport/pkey.ksy` | Partition key |\n\n### 6.4 Encapsulation\n\n| Format | File | Description |\n|--------|------|-------------|\n| VxLAN+ | `encapsulation/vxlan_plus.ksy` | Extended VxLAN overlay |\n\n---\n\n## 7. Host-Software Interface (HSI) Formats\n\n**Datamodel Directory**: `datamodel/hw/asics/pmr/interfaces/host_interface/`\n\n### 7.1 Command Queue Segment (64 bytes)\n\n**Datamodel**: `command_queue_segment.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Bytes 2-3     | Bytes 4-7     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Opcode        | Flags         | Payload Len   | Reserved      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 8-15                    | Bytes 16-23                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Tag (64 bits)                 | Dest (64 bits)                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 24-31                   | Bytes 32-63                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Metadata (64 bits)            | Inline Data or SGL Entry      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n**Opcode Encoding**:\n| Bits | Field | Values |\n|------|-------|--------|\n| [7:4] | Family | MSG=0x1, TAGGED=0x2, RMA=0x3, ATOMIC=0x4 |\n| [3:2] | Variant | SEND=0, RECV=1, INJECT=2 |\n| [1] | Reserved | Must be 0 |\n| [0] | Data Source | INLINE=0, SGL=1 |\n\n### 7.2 Notification Formats\n\n| Format | File | Type | Size | Description |\n|--------|------|------|------|-------------|\n| Receive Notification | `receive_notification.ksy` | 0x00 | 64 bytes | Received message |\n| Send Completion | `send_completion.ksy` | 0x01 | 64 bytes | Send completed |\n| Event Notification | `event_notification.ksy` | 0x02 | 64 bytes | Async event |\n| Notification Entry | `notification_entry.ksy` | - | 64 bytes | Generic entry |\n| QW Violation Event | `qw_violation_event.ksy` | - | 64 bytes | QW alignment error |\n\n### 7.3 Receive Notification (64 bytes)\n\n**Datamodel**: `receive_notification.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x00 for receive |\n| flags | 1 | 1 | FI_INLINE, continuation |\n| status | 2 | 2 | Completion status |\n| src_id | 4 | 4 | Source endpoint ID |\n| tag | 8 | 8 | Tag value |\n| total_length | 16 | 4 | Payload length |\n| buffer_id_0 | 20 | 2 | First buffer ID |\n| buffer_id_1 | 22 | 2 | Second buffer ID |\n| buffer_offset | 24 | 2 | Offset in buffer |\n| reserved | 26 | 2 | Reserved |\n| inline_data | 28 | 35 | Inline payload |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.4 Send Completion (64 bytes)\n\n**Datamodel**: `send_completion.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x01 for send |\n| flags | 1 | 1 | Completion flags |\n| status | 2 | 2 | Completion status |\n| reserved_0 | 4 | 4 | Reserved |\n| op_context | 8 | 8 | Operation context |\n| bytes_sent | 16 | 4 | Bytes transferred |\n| reserved_1 | 20 | 43 | Reserved |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.5 Other HSI Formats\n\n| Format | File | Description |\n|--------|------|-------------|\n| SGL Entry | `sgl_entry.ksy` | Scatter-gather list entry |\n| PCIe Descriptors | `pcie/descriptors.ksy` | PCIe interface descriptors |\n\n---\n\n## 8. IP Block Descriptors\n\n**Datamodel Directory**: `datamodel/hw/ip/cornelis/`\n\n### 8.1 Collectives Engine (CE)\n\n**Datamodel**: `ce/descriptors.ksy`\n\nThe Collectives Engine uses RISC-V vector cores (VLEN=512) for hardware-accelerated collective operations.\n\n### 8.2 Electric Creek (EC)\n\n**Datamodel**: `ec/descriptors.ksy`\n\nElectric Creek is the management complex shared between PMR NIC and LNR Switch.\n\n---\n\n## 9. Work List\n\nThis section tracks issues requiring follow-up investigation or specification updates.\n\n### 9.1 Open Issues\n\n| ID | Priority | Category | Description | Status | Opened | Closed |\n|----|----------|----------|-------------|--------|--------|--------|\n| W-06-001 | Medium | Datamodel | UFH-32 lacks 16-bit entropy field; per-packet ECMP not supported; switch must derive entropy from Src+Dest hash | Deferred | 2026-01-20 | - |\n| W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |\n| W-05-002 | Medium | Specification | MTU values: Verify maximum MTU for each protocol | Investigation | 2026-01-10 | - |\n| W-05-003 | Medium | Documentation | CMS detailed formats: Need comprehensive documentation | Spec Update | 2026-01-10 | - |\n| W-03-002 | Low | Terminology | PDP vs PDS naming: UML uses both terms inconsistently | Spec Update | 2026-01-08 | - |\n| W-03-006 | Low | Terminology | SES vs SE: \"SES Processing Groups\" vs \"Semantic Engines\" | Spec Update | 2026-01-08 | - |\n\n### 9.2 Datamodel Gaps\n\n| ID | Priority | Description | Target Location | Status | Opened | Closed |\n|----|----------|-------------|-----------------|--------|--------|--------|\n| D-001 | High | PMR CSR definitions missing from datamodel | `datamodel/hw/asics/pmr/csrs/*.rdl` | Spec Update | 2026-01-10 | - |\n| D-002 | Medium | PMR block hierarchy YAML incomplete | `datamodel/hw/asics/pmr/blocks.yaml` | Spec Update | 2026-01-10 | - |\n| D-003 | Medium | PMR interface contracts missing | `datamodel/views/contracts/pmr-*.puml` | Spec Update | 2026-01-10 | - |\n\n### 9.3 Specification Clarifications Needed\n\n| ID | Priority | Question | Context | Status | Opened | Closed |\n|----|----------|----------|---------|--------|--------|--------|\n| Q1 | Medium | Lightweight Interface Scope | What features should be reduced in lightweight mode? | Investigation | 2026-01-10 | - |\n| Q2 | Medium | Tag Table Sizing | Should HW tag table size be per-endpoint configurable? | Investigation | 2026-01-10 | - |\n| Q3 | Medium | Multi-Packet Eager Messages | Should hardware support multi-packet eager messages? | Investigation | 2026-01-10 | - |\n| Q4 | Low | RoCE Work Queue Implementation | Confirm RoCE WQ/CQ are software-implemented | Investigation | 2026-01-10 | - |\n\n### 9.4 Closed Issues\n\n| ID | Priority | Category | Description | Resolution | Opened | Closed |\n|----|----------|----------|-------------|------------|--------|--------|\n| W-05-001 | Medium | Documentation | UE taxonomy reference | Documented in `05-packet-formats.md` | 2026-01-08 | 2026-01-10 |\n| W-02-005 | Medium | Documentation | Protocol support documentation | Documented UE+, RoCEv2, Ethernet | 2026-01-08 | 2026-01-10 |\n| W-02-006 | Medium | Documentation | Cornelis Collective Reduction Protocol | Documented in HAS §2.5.4 | 2026-01-08 | 2026-01-10 |\n| W-03-001 | Medium | Architecture | Semantic Engine count | Confirmed 64 (8x8) in UML and HAS | 2026-01-08 | 2026-01-10 |\n| W-17-005 | Low | Documentation | Port subdivision note | Added to HAS Ch17 | 2026-01-11 | 2026-01-11 |\n| W-17-006 | Medium | Documentation | MPORT interface documentation | Documented 256B @ 1.66 GHz | 2026-01-11 | 2026-01-11 |\n| W-04-005 | High | Datamodel | `ufh_16.ksy` address size: Datamodel shows 12-bit dest, should be 16-bit | UFH-16 restructured to 12-byte Ethernet MAC overlay with 16-bit destination (bytes 4-5) and 16-bit source (bytes 10-11) | 2026-01-10 | 2026-01-20 |\n| W-04-006 | High | Datamodel | `ufh_32.ksy` address size: Datamodel shows 16-bit dest, should be 32-bit | UFH-32 restructured to 12-byte Ethernet MAC overlay with 32-bit destination (bytes 2-5) and 32-bit source (bytes 8-11) | 2026-01-10 | 2026-01-20 |\n\n### 9.5 Change Log\n\n| Date | Change | Details |\n|------|--------|---------|\n| 2026-01-14 | Initial creation | Document created with PMR packet taxonomy |\n| 2026-01-20 | Review and update | Added UALink section (reference only, not PMR-supported); Added change log; Updated datamodel file counts; No new .ksy files since initial creation |\n| 2026-01-20 | UFH format details | Added detailed UFH-16 and UFH-32 format documentation in Section 6.2 (wire diagrams, field tables, type enumerations) |\n| 2026-01-20 | UFH restructuring | UFH-16 and UFH-32 restructured to 12-byte Ethernet MAC overlays; UFH-16 now 16-bit addressing, UFH-32 now 32-bit addressing; Added SLAP field constraints (Z,Y,X=001); Updated datamodel .ksy files; Closed W-04-005 and W-04-006 |\n\n---\n\n## 10. UALink Protocol (Reference Only)\n\n**Note**: UALink is defined in the datamodel but is **NOT currently supported by PMR**. It is included here for reference as it may be relevant for future AI/ML accelerator interconnect work.\n\n**Datamodel Directory**: `datamodel/protocols/ualink/`\n\n### 10.1 UALink Overview\n\nUALink is an AI/ML accelerator interconnect protocol with 38 packet definitions across all OSI layers.\n\n| Layer | Count | Key Formats |\n|-------|-------|-------------|\n| UPLI (Upper Protocol Layer Interface) | 8 | commands.ksy, request_channel.ksy, status_codes.ksy |\n| Transaction | 9 | tl_flit.ksy, control_half_flit.ksy, data_half_flit.ksy |\n| Data Link | 12 | dl_flit.ksy, segment_header.ksy, crc.ksy, control_messages.ksy |\n| Physical | 4 | alignment_markers.ksy, control_ordered_sets.ksy, link_training.ksy |\n| Security | 5 | authentication.ksy, encryption.ksy, key_derivation.ksy |\n\n### 10.2 UALink Packet Formats\n\n#### UPLI Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Commands | `upli/commands.ksy` | UPLI command definitions |\n| Request Channel | `upli/request_channel.ksy` | Request channel format |\n| Originator Data | `upli/originator_data_channel.ksy` | Originator data channel |\n| Read Response | `upli/read_response_channel.ksy` | Read response channel |\n| Write Response | `upli/write_response_channel.ksy` | Write response channel |\n| Status Codes | `upli/status_codes.ksy` | Status code definitions |\n| Connection Handshake | `upli/protocols/connection_handshake.ksy` | Connection setup |\n| Flow Control | `upli/protocols/flow_control.ksy` | Flow control protocol |\n\n#### Transaction Layer\n| Format | File | Description |\n|--------|------|-------------|\n| TL Flit | `transaction/tl_flit.ksy` | Transaction layer flit |\n| Control Half Flit | `transaction/control_half_flit.ksy` | Control half flit |\n| Data Half Flit | `transaction/data_half_flit.ksy` | Data half flit |\n| Message Half Flit | `transaction/message_half_flit.ksy` | Message half flit |\n| Request Field | `transaction/request_field.ksy` | Request field format |\n| Response Field | `transaction/response_field.ksy` | Response field format |\n| Flow Control Field | `transaction/flow_control_field.ksy` | Flow control field |\n| Compression | `transaction/protocols/compression.ksy` | Data compression |\n| Address Cache | `transaction/protocols/address_cache.ksy` | Address caching |\n\n#### Data Link Layer\n| Format | File | Description |\n|--------|------|-------------|\n| DL Flit | `datalink/dl_flit.ksy` | Data link flit |\n| Flit Header | `datalink/flit_header.ksy` | Flit header format |\n| Segment Header | `datalink/segment_header.ksy` | Segment header |\n| CRC | `datalink/crc.ksy` | CRC calculation |\n| Control Messages | `datalink/messages/control_messages.ksy` | Control messages |\n| Basic Messages | `datalink/messages/basic_messages.ksy` | Basic messages |\n| UART Messages | `datalink/messages/uart_messages.ksy` | UART messages |\n| Vendor Defined | `datalink/messages/vendor_defined.ksy` | Vendor extensions |\n| Link Resiliency | `datalink/protocols/link_resiliency.ksy` | Link resiliency |\n| Link Level Replay | `datalink/protocols/link_level_replay.ksy` | Replay protocol |\n| Link State | `datalink/protocols/link_state.ksy` | Link state machine |\n| Link Folding | `datalink/protocols/link_folding.ksy` | Link folding |\n\n#### Physical Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Alignment Markers | `physical/alignment_markers.ksy` | Lane alignment |\n| Control Ordered Sets | `physical/control_ordered_sets.ksy` | Control sequences |\n| Reconciliation Sublayer | `physical/reconciliation_sublayer.ksy` | RS sublayer |\n| Link Training | `physical/protocols/link_training.ksy` | Link training |\n\n#### Security Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Authentication | `security/authentication.ksy` | Authentication |\n| Encryption | `security/encryption.ksy` | Encryption format |\n| IV Format | `security/iv_format.ksy` | Initialization vector |\n| Key Derivation | `security/protocols/key_derivation.ksy` | Key derivation |\n| Key Rotation | `security/protocols/key_rotation.ksy` | Key rotation |\n\n---\n\n## 11. References\n\n### Internal Documents\n- `docs/HAS/PMR/05-packet-formats.md` - PMR HAS Chapter 5\n- `docs/HAS/PMR/WORK.md` - PMR HAS Work Tracking\n- `.specify/memory/constitution.md` - Project Constitution\n\n### Datamodel Locations\n- `datamodel/protocols/ue/` - Ultra Ethernet protocols (94 .ksy files)\n- `datamodel/protocols/roce/` - RoCEv2 protocols (8 .ksy files)\n- `datamodel/protocols/ethernet/` - Standard Ethernet (6 .ksy files)\n- `datamodel/protocols/cornelis/` - Cornelis proprietary (9 .ksy files)\n- `datamodel/protocols/ualink/` - UALink protocols (38 .ksy files) - NOT supported by PMR\n- `datamodel/hw/asics/pmr/` - PMR ASIC definitions\n\n### External Specifications\n- [Ultra Ethernet Specification v1.0.1](https://ultraethernet.org/)\n- [InfiniBand Architecture Specification](https://www.infinibandta.org/)\n- IEEE 802.3 Ethernet Standard\n- UALink Specification (Ultra Accelerator Link)\n",
                "after": "# PMR (CN7000) Packet Format Taxonomy\n\n**Document**: Packet formats supported by PMR NIC ASIC  \n**Generated**: 2026-01-14  \n**Last Reviewed**: 2026-01-20  \n**Source**: `datamodel/` directory in EarlySim repository  \n**Reference**: `docs/HAS/PMR/05-packet-formats.md`\n\n---\n\n## Table of Contents\n\n1. [Overview](#1-overview)\n2. [Protocol Stack Summary](#2-protocol-stack-summary)\n3. [Ultra Ethernet+ (UE+) Formats](#3-ultra-ethernet-ue-formats)\n4. [RoCEv2 Formats](#4-rocev2-formats)\n5. [Standard Ethernet Formats](#5-standard-ethernet-formats)\n6. [Cornelis Proprietary Formats](#6-cornelis-proprietary-formats)\n7. [Host-Software Interface (HSI) Formats](#7-host-software-interface-hsi-formats)\n8. [IP Block Descriptors](#8-ip-block-descriptors)\n9. [Work List](#9-work-list)\n10. [UALink Protocol (Reference Only)](#10-ualink-protocol-reference-only)\n11. [References](#11-references)\n\n---\n\n## 1. Overview\n\nPMR (Prism River) is Cornelis Networks' 1.6 Tbps NIC ASIC (CN7000 product family). It supports multiple wire protocols with per-packet protocol selection on a single physical port.\n\n### Supported Protocols\n\n| Protocol | Version | Status | Description |\n|----------|---------|--------|-------------|\n| Ultra Ethernet+ | 1.0.1 | Full | Optimized UE with Cornelis extensions |\n| RoCEv2 | v2 | Full | RDMA over Converged Ethernet |\n| Standard Ethernet | IEEE 802.3 | Full | Traditional Ethernet with offloads |\n| Cornelis Proprietary | 1.0.0 | Full | UFH, CSIG+, VxLAN+, Collectives |\n\n### Header Efficiency Comparison\n\n| Protocol Stack | Total Headers | Efficiency (4KB payload) |\n|----------------|---------------|--------------------------|\n| UE+ (small msg) | ~20 bytes | 99.5% |\n| UE+ (standard) | ~40 bytes | 99.0% |\n| RoCEv2 (IPv4) | ~58 bytes | 98.6% |\n| RoCEv2 (IPv6) | ~78 bytes | 98.1% |\n\n---\n\n## 2. Protocol Stack Summary\n\n```\n+-----------------------------------------------------------------------------+\n|                           Application Layer                                  |\n|                    (Libfabric, Verbs, Sockets, DPDK)                         |\n+-----------------------------------------------------------------------------+\n|                           Transport Layer                                    |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UE Transport   |  |     RoCEv2       |  |    TCP/UDP       |            |\n|  |   (SES/PDS/CMS)  |  |   (BTH/RETH)     |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                           Network Layer                                      |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UFH-16/32      |  |   IPv4/IPv6      |  |   IPv4/IPv6      |            |\n|  |   (Cornelis)     |  |   + UDP          |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                            Link Layer                                        |\n|  +------------------+  +------------------+  +------------------+            |\n|  |      UE+         |  |   Ethernet II    |  |   Ethernet II    |            |\n|  |   (12 bytes)     |  |   (14 bytes)     |  |   (14 bytes)     |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                          Physical Layer                                      |\n|                    Hill Creek (212.5G x8 PAM4 SerDes)                        |\n+-----------------------------------------------------------------------------+\n      Ultra Ethernet+           RoCEv2              Standard Ethernet\n```\n\n---\n\n## 3. Ultra Ethernet+ (UE+) Formats\n\n### 3.1 UE+ L2 Header (12 bytes)\n\n**Datamodel**: `datamodel/protocols/cornelis/link/ue_plus.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Byte 2        | Byte 3        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n|L2|V|zyxm|Len  | Length[7:0]   | RC    | SC    | Hop Count     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 4        | Byte 5        | Byte 6        | Byte 7        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Dest LID [15:8]               | Dest LID [7:0]                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Entropy [15:8]                | Entropy [7:0]                 |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 8        | Byte 9        | Byte 10       | Byte 11       |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Source LID [15:8]             | Source LID [7:0]              |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Payload Type [15:8]           | Payload Type [7:0]            |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| L2 Type | 2 | Always 0b10 for UE+ |\n| Version | 1 | Protocol version |\n| zyxm | 4 | Routing control flags (multicast, adaptive) |\n| Length | 9 | Packet length in bytes |\n| RC | 4 | Routing Class (QoS) |\n| SC | 4 | Service Class |\n| Hop | 8 | TTL/hop count |\n| Dest LID | 16 | Destination Local Identifier |\n| Entropy | 16 | ECMP hash for load balancing |\n| Source LID | 16 | Source Local Identifier |\n| Type | 16 | Payload type (EtherType equivalent) |\n\n**Payload Types**:\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x0800 | IPv4 | IPv4 payload |\n| 0x86DD | IPv6 | IPv6 payload |\n| 0x8100 | VLAN | VLAN tagged frame |\n| 0x9000 | VxLAN+ | VxLAN+ encapsulated |\n| 0x9100 | CSIG+ | CSIG+ telemetry |\n| 0xC000 | UE PDS | Ultra Ethernet PDS |\n\n### 3.2 PDS (Packet Delivery Sublayer) Prologue (2 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/prologue.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0                        | Byte 1                        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| type[4:0] | next_hdr/ctl[3:0] | flags[6:0]                    |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| PDS Type | Value | Description |\n|----------|-------|-------------|\n| Reserved | 0 | Reserved |\n| TSS | 1 | Transport Security (encryption) |\n| RUD Request | 2 | Reliable Unordered Delivery |\n| ROD Request | 3 | Reliable Ordered Delivery |\n| RUDI Request | 4 | Reliable Unordered Immediate |\n| RUDI Response | 5 | RUDI response |\n| UUD Request | 6 | Unreliable Unordered Delivery |\n| ACK | 7 | Acknowledgment |\n| ACK_CC | 8 | ACK with congestion control |\n| ACK_CCX | 9 | ACK with extended CC |\n| NACK | 10 | Negative acknowledgment |\n| CP | 11 | Control packet |\n| NACK_CCX | 12 | NACK with extended CC |\n| RUD_CC_REQ | 13 | RUD with CC state |\n| ROD_CC_REQ | 14 | ROD with CC state |\n\n### 3.3 PDS Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/pds/`\n\n| Format | File | Size | Description |\n|--------|------|------|-------------|\n| RUD/ROD Request | `rud_rod_request.ksy` | Variable | Reliable delivery request |\n| RUD/ROD ACK | `rud_rod_ack.ksy` | Variable | Acknowledgment |\n| ACK_CC | `ack_cc.ksy` | Variable | ACK with CC state |\n| ACK_CCX | `ack_ccx.ksy` | Variable | ACK with extended CC |\n| NACK | `nack.ksy` | Variable | Negative acknowledgment |\n| NACK_CCX | `nack_ccx.ksy` | Variable | NACK with extended CC |\n| RUDI Request/Response | `rudi_request_response.ksy` | Variable | Low-latency immediate |\n| UUD Request | `uud_request.ksy` | Variable | Unreliable delivery |\n| Control Packet | `rud_rod_cp.ksy` | Variable | Control packet |\n| Entropy Header | `entropy_header.ksy` | Variable | Entropy extension |\n\n### 3.4 SES (Semantic Sublayer) Opcodes\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/opcodes.ksy`\n\n**Request Opcodes (Table 3-17)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Tagged Send | 0x00 | Send with tag matching |\n| RMA Write | 0x01 | Remote memory write |\n| RMA Read | 0x02 | Remote memory read |\n| Atomic Write | 0x03 | Atomic memory write |\n| Atomic Read | 0x04 | Atomic memory read |\n| Atomic CAS | 0x05 | Compare-and-swap |\n| Deferrable Send | 0x06 | Deferrable send |\n| Ready to Restart | 0x07 | Restart notification |\n| Small Message | 0x08 | Small message (32B header) |\n| Small RMA Write | 0x09 | Small RMA write |\n| Small RMA Read | 0x0A | Small RMA read |\n| Small Atomic Write | 0x0B | Small atomic write |\n| Small Atomic Read | 0x0C | Small atomic read |\n| Small Atomic CAS | 0x0D | Small atomic CAS |\n\n**Response Opcodes (Table 3-18)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Response | 0x00 | Standard response |\n| Response with Data | 0x01 | Response carrying data |\n| Optimized Response | 0x02 | Optimized format |\n| NACK | 0x03 | Negative acknowledgment |\n\n### 3.5 SES Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/ses/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Standard Request (SOM=1) | `standard_request_som1.ksy` | Start of message |\n| Standard Request (SOM=0) | `standard_request_som0.ksy` | Continuation |\n| Small Message | `small_message.ksy` | 32-byte header format |\n| Small RMA | `small_rma.ksy` | Small RMA operations |\n| Response | `response.ksy` | Standard response |\n| Response with Data | `response_with_data.ksy` | Data-carrying response |\n| Optimized Response | `optimized_response_with_data.ksy` | Optimized format |\n| Deferrable Send | `deferrable_send_request.ksy` | Deferrable operation |\n| Ready to Restart | `ready_to_restart.ksy` | Restart notification |\n| Rendezvous Extension | `rendezvous_extension.ksy` | Large message protocol |\n| Atomic Extension | `atomic_extension.ksy` | Atomic operations |\n| CAS Extension | `cas_extension.ksy` | Compare-and-swap |\n\n### 3.6 CMS (Congestion Management Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/cms/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Credit CP Payload | `credit_cp_payload.ksy` | Credit control packet |\n| Credit Request | `credit_request_cp_payload.ksy` | Credit request |\n| Request CC State | `req_cc_state.ksy` | Request CC state |\n| ACK CC State (NSCC) | `ack_cc_state_nscc.ksy` | NSCC algorithm state |\n| ACK CC State (RCCC/TFC) | `ack_cc_state_rccc_tfc.ksy` | RCCC/TFC state |\n\n### 3.7 TSS (Transport Security Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/tss/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Security Header | `security_header.ksy` | Encryption header |\n| IV Construction | `iv_construction.ksy` | Initialization vector |\n| Key Rotation | `protocols/key_rotation.ksy` | Key rotation protocol |\n| KDF Direct | `protocols/kdf_direct.ksy` | Direct key derivation |\n| KDF Client/Server | `protocols/kdf_client_server.ksy` | Client/server KDF |\n| KDF Cluster | `protocols/kdf_cluster.ksy` | Cluster KDF |\n| Join Secure Domain | `protocols/join_secure_domain.ksy` | Domain join |\n| TSS TX Processing | `protocols/tss_tx_processing.ksy` | Transmit processing |\n| TSS RX Processing | `protocols/tss_rx_processing.ksy` | Receive processing |\n\n### 3.8 Link Layer Formats\n\n#### LLR (Link-Level Retry)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/llr/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| LLR Preamble (64b66b) | `llr_preamble_64b66b.ksy` | 64b66b preamble |\n| LLR Preamble (MII) | `llr_preamble_mii.ksy` | MII preamble |\n| LLR Init CTLOS | `llr_init_ctlos.ksy` | Initialize LLR |\n| LLR Init Echo CTLOS | `llr_init_echo_ctlos.ksy` | Init acknowledgment |\n| LLR ACK CTLOS | `llr_ack_ctlos.ksy` | Frame acknowledgment |\n| LLR NACK CTLOS | `llr_nack_ctlos.ksy` | Retransmit request |\n\n#### CBFC (Credit-Based Flow Control)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/cbfc/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| CF Update | `cf_update.ksy` | Credit flow update |\n| CC Update | `cc_update.ksy` | Credit count update |\n| VC State Machine | `protocols/vc_state_machine.ksy` | Virtual channel FSM |\n| Lossless VC Init | `protocols/lossless_vc_init.ksy` | VC initialization |\n| Lossless VC Removal | `protocols/lossless_vc_removal.ksy` | VC teardown |\n\n#### LLDP Extensions\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/lldp/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| UE Link Negotiation TLV | `ue_link_negotiation_tlv.ksy` | Link negotiation |\n| UE CBFC TLV | `ue_cbfc_tlv.ksy` | CBFC parameters |\n\n---\n\n## 4. RoCEv2 Formats\n\n**Datamodel Directory**: `datamodel/protocols/roce/transport/`\n\n### 4.1 RoCEv2 Packet Structure\n\n```\n+-----------------------------------------------------------------------------+\n| Ethernet II Header (14 bytes)                                               |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2) = 0x0800/0x86DD            |\n+-----------------------------------------------------------------------------+\n| IP Header (20 bytes IPv4 / 40 bytes IPv6)                                   |\n|   Version, IHL, DSCP, ECN, Length, ID, Flags, TTL, Protocol=17, Checksum   |\n|   Source IP, Dest IP                                                        |\n+-----------------------------------------------------------------------------+\n| UDP Header (8 bytes)                                                        |\n|   Source Port (entropy) | Dest Port = 4791 | Length | Checksum             |\n+-----------------------------------------------------------------------------+\n| BTH - Base Transport Header (12 bytes)                                      |\n|   Opcode | Flags | P-Key | Dest QP | A | PSN                               |\n+-----------------------------------------------------------------------------+\n| Extended Headers (optional, operation-dependent)                            |\n|   RETH (16) | AETH (4) | AtomicETH (28) | ImmDt (4)                        |\n+-----------------------------------------------------------------------------+\n| Payload (0 - MTU bytes)                                                     |\n+-----------------------------------------------------------------------------+\n| ICRC (4 bytes)                                                              |\n+-----------------------------------------------------------------------------+\n```\n\n### 4.2 BTH (Base Transport Header) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/roce/transport/bth.ksy`\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| Opcode | 8 | Operation type (transport + operation) |\n| SE | 1 | Solicited Event |\n| M | 1 | Migration state |\n| Pad | 2 | Padding bytes (0-3) |\n| TVer | 4 | Transport version (must be 0) |\n| P-Key | 16 | Partition key |\n| Dest QP | 24 | Destination Queue Pair |\n| A | 1 | ACK request |\n| PSN | 24 | Packet Sequence Number |\n\n**Transport Types** (Opcode bits [7:5]):\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x00 | RC | Reliable Connection |\n| 0x20 | UC | Unreliable Connection |\n| 0x40 | RD | Reliable Datagram |\n| 0x60 | UD | Unreliable Datagram |\n\n**Operations** (Opcode bits [4:0]):\n| Value | Operation | Description |\n|-------|-----------|-------------|\n| 0x00 | SEND_FIRST | First send packet |\n| 0x01 | SEND_MIDDLE | Middle send packet |\n| 0x02 | SEND_LAST | Last send packet |\n| 0x03 | SEND_LAST_IMM | Last send with immediate |\n| 0x04 | SEND_ONLY | Single-packet send |\n| 0x05 | SEND_ONLY_IMM | Single send with immediate |\n| 0x06 | RDMA_WRITE_FIRST | First RDMA write |\n| 0x07 | RDMA_WRITE_MIDDLE | Middle RDMA write |\n| 0x08 | RDMA_WRITE_LAST | Last RDMA write |\n| 0x09 | RDMA_WRITE_LAST_IMM | Last write with immediate |\n| 0x0A | RDMA_WRITE_ONLY | Single-packet write |\n| 0x0B | RDMA_WRITE_ONLY_IMM | Single write with immediate |\n| 0x0C | RDMA_READ_REQUEST | Read request |\n| 0x0D | RDMA_READ_RESPONSE_FIRST | First read response |\n| 0x0E | RDMA_READ_RESPONSE_MIDDLE | Middle read response |\n| 0x0F | RDMA_READ_RESPONSE_LAST | Last read response |\n| 0x10 | RDMA_READ_RESPONSE_ONLY | Single read response |\n| 0x11 | ACK | Acknowledgment |\n| 0x12 | ATOMIC_ACK | Atomic acknowledgment |\n| 0x13 | CMP_SWAP | Compare and swap |\n| 0x14 | FETCH_ADD | Fetch and add |\n\n### 4.3 Extended Transport Headers\n\n| Header | File | Size | Description |\n|--------|------|------|-------------|\n| RETH | `reth.ksy` | 16 bytes | RDMA Extended Transport Header |\n| AETH | `aeth.ksy` | 4 bytes | ACK Extended Transport Header |\n| AtomicETH | `atomiceth.ksy` | 28 bytes | Atomic Extended Transport Header |\n| AtomicAckETH | `atomicacketh.ksy` | 8 bytes | Atomic ACK ETH |\n| DETH | `deth.ksy` | 8 bytes | Datagram Extended Transport Header |\n| ImmDt | `immdt.ksy` | 4 bytes | Immediate Data |\n| ICRC | `icrc.ksy` | 4 bytes | Invariant CRC |\n\n---\n\n## 5. Standard Ethernet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ethernet/`\n\n### 5.1 Ethernet II Frame\n\n**Datamodel**: `datamodel/protocols/ethernet/link/ethernet_ii.ksy`\n\n```\n+-----------------------------------------------------------------------------+\n| Preamble (7 bytes) + SFD (1 byte)  [not visible to software]               |\n+-----------------------------------------------------------------------------+\n| Ethernet Header (14 bytes)                                                  |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2)                            |\n+-----------------------------------------------------------------------------+\n| Optional VLAN Tag (4 bytes) - 802.1Q                                        |\n|   TPID (2) = 0x8100 | TCI (2) = PCP + DEI + VID                            |\n+-----------------------------------------------------------------------------+\n| Payload (46-1500 bytes, or up to 9000 for jumbo)                           |\n+-----------------------------------------------------------------------------+\n| FCS (4 bytes)                                                               |\n+-----------------------------------------------------------------------------+\n```\n\n### 5.2 Link Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| Ethernet II | `link/ethernet_ii.ksy` | Standard Ethernet frame |\n| VLAN 802.1Q | `link/vlan_802_1q.ksy` | VLAN tagging |\n\n### 5.3 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| IPv4 | `network/ipv4.ksy` | IPv4 header |\n| IPv6 | `network/ipv6.ksy` | IPv6 header |\n\n### 5.4 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| TCP | `transport/tcp.ksy` | TCP header |\n| UDP | `transport/udp.ksy` | UDP header |\n\n---\n\n## 6. Cornelis Proprietary Formats\n\n**Datamodel Directory**: `datamodel/protocols/cornelis/`\n\n### 6.1 Link Layer\n\n| Format | File | Size | Description |\n|--------|------|------|-------------|\n| UE+ Header | `link/ue_plus.ksy` | 12 bytes | Optimized L2 header |\n| Cornelis L2 Prefix | `link/cornelis_l2_prefix.ksy` | Variable | L2 prefix |\n\n### 6.2 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| UFH-16 | `network/ufh_16.ksy` | 16-bit forwarding header |\n| UFH-32 | `network/ufh_32.ksy` | 32-bit forwarding header |\n| Collective L2 | `network/collective_l2.ksy` | Collective operations header |\n| Scale-Up L2 | `network/scaleup_l2.ksy` | Scale-up deployments |\n\n#### 6.2.1 UFH-16 (Unified Forwarding Header 16-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_16.ksy`\n\nUFH-16 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 16-bit addressing.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |    Opaque (24-bit)    | Destination   |Opaque |Traffic|   Opaque      |    Source     |\n|[7:4]  |                       | (16-bit BE)   |[7:4]  |Class  |   (16-bit)    |  (16-bit BE)  |\n|SLAP   |                       |               |Z|Y|X|M|[7:0]  |               |               |\n|[3:0]  |                       |               |[3:0]  |       |               |               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1-3 | 24 | Opaque to hardware |\n| Destination | 4-5 | 16 | Destination endpoint address (big-endian) |\n| Opaque | 6 | [7:4] | Opaque to hardware |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Opaque | 8-9 | 16 | Opaque to hardware |\n| Source | 10-11 | 16 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-16 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5-14 | Reserved | Reserved for future use |\n| 15 | Extended | UFH-32 extension follows |\n\n**Usage**: Scale-up fabric forwarding, intra-pod communication, medium cluster networking (up to 65536 endpoints).\n\n#### 6.2.2 UFH-32 (Unified Forwarding Header 32-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_32.ksy`\n\nUFH-32 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 32-bit addressing for large-scale deployments.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |       |   Destination (32-bit BE)     |HopLim |Traffic|       Source (32-bit BE)      |\n|[7:4]  |Opaque |                               |[7:4]  |Class  |                               |\n|SLAP   |       |                               |Z|Y|X|M|[7:0]  |                               |\n|[3:0]  |       |                               |[3:0]  |       |                               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1 | [7:0] | Opaque to hardware |\n| Destination | 2-5 | 32 | Destination endpoint address (big-endian) |\n| Hop Limit | 6 | [7:4] | TTL/hop count |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Source | 8-11 | 32 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-32 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5 | Multicast | Multicast packet |\n| 6 | Barrier | Barrier synchronization |\n| 7 | Reduction | Reduction operation |\n| 8-14 | Reserved | Reserved for future use |\n| 15 | Vendor | Vendor-specific packet |\n\n**Usage**: Large-scale scale-up fabric forwarding (4+ billion endpoints), multi-pod communication, extended collective operations.\n\n### 6.3 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| CSIG+ | `transport/csig_plus.ksy` | Telemetry header |\n| PKEY | `transport/pkey.ksy` | Partition key |\n\n### 6.4 Encapsulation\n\n| Format | File | Description |\n|--------|------|-------------|\n| VxLAN+ | `encapsulation/vxlan_plus.ksy` | Extended VxLAN overlay |\n\n---\n\n## 7. Host-Software Interface (HSI) Formats\n\n**Datamodel Directory**: `datamodel/hw/asics/pmr/interfaces/host_interface/`\n\n### 7.1 Command Queue Segment (64 bytes)\n\n**Datamodel**: `command_queue_segment.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Bytes 2-3     | Bytes 4-7     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Opcode        | Flags         | Payload Len   | Reserved      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 8-15                    | Bytes 16-23                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Tag (64 bits)                 | Dest (64 bits)                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 24-31                   | Bytes 32-63                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Metadata (64 bits)            | Inline Data or SGL Entry      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n**Opcode Encoding**:\n| Bits | Field | Values |\n|------|-------|--------|\n| [7:4] | Family | MSG=0x1, TAGGED=0x2, RMA=0x3, ATOMIC=0x4 |\n| [3:2] | Variant | SEND=0, RECV=1, INJECT=2 |\n| [1] | Reserved | Must be 0 |\n| [0] | Data Source | INLINE=0, SGL=1 |\n\n### 7.2 Notification Formats\n\n| Format | File | Type | Size | Description |\n|--------|------|------|------|-------------|\n| Receive Notification | `receive_notification.ksy` | 0x00 | 64 bytes | Received message |\n| Send Completion | `send_completion.ksy` | 0x01 | 64 bytes | Send completed |\n| Event Notification | `event_notification.ksy` | 0x02 | 64 bytes | Async event |\n| Notification Entry | `notification_entry.ksy` | - | 64 bytes | Generic entry |\n| QW Violation Event | `qw_violation_event.ksy` | - | 64 bytes | QW alignment error |\n\n### 7.3 Receive Notification (64 bytes)\n\n**Datamodel**: `receive_notification.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x00 for receive |\n| flags | 1 | 1 | FI_INLINE, continuation |\n| status | 2 | 2 | Completion status |\n| src_id | 4 | 4 | Source endpoint ID |\n| tag | 8 | 8 | Tag value |\n| total_length | 16 | 4 | Payload length |\n| buffer_id_0 | 20 | 2 | First buffer ID |\n| buffer_id_1 | 22 | 2 | Second buffer ID |\n| buffer_offset | 24 | 2 | Offset in buffer |\n| reserved | 26 | 2 | Reserved |\n| inline_data | 28 | 35 | Inline payload |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.4 Send Completion (64 bytes)\n\n**Datamodel**: `send_completion.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x01 for send |\n| flags | 1 | 1 | Completion flags |\n| status | 2 | 2 | Completion status |\n| reserved_0 | 4 | 4 | Reserved |\n| op_context | 8 | 8 | Operation context |\n| bytes_sent | 16 | 4 | Bytes transferred |\n| reserved_1 | 20 | 43 | Reserved |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.5 Other HSI Formats\n\n| Format | File | Description |\n|--------|------|-------------|\n| SGL Entry | `sgl_entry.ksy` | Scatter-gather list entry |\n| PCIe Descriptors | `pcie/descriptors.ksy` | PCIe interface descriptors |\n\n---\n\n## 8. IP Block Descriptors\n\n**Datamodel Directory**: `datamodel/hw/ip/cornelis/`\n\n### 8.1 Collectives Engine (CE)\n\n**Datamodel**: `ce/descriptors.ksy`\n\nThe Collectives Engine uses RISC-V vector cores (VLEN=512) for hardware-accelerated collective operations.\n\n### 8.2 Electric Creek (EC)\n\n**Datamodel**: `ec/descriptors.ksy`\n\nElectric Creek is the management complex shared between PMR NIC and LNR Switch.\n\n---\n\n## 9. Work List\n\nThis section tracks issues requiring follow-up investigation or specification updates.\n\n### 9.1 Open Issues\n\n| ID | Priority | Category | Description | Status | Opened | Closed |\n|----|----------|----------|-------------|--------|--------|--------|\n| W-06-001 | Medium | Datamodel | UFH-32 lacks 16-bit entropy field; per-packet ECMP not supported; switch must derive entropy from Src+Dest hash | Deferred | 2026-01-20 | - |\n| W-07-001 | Low | Datamodel | `ack_cc.ksy` shows `ack_cc_state` as 32-bit (4 bytes) but UE Spec Table 3-36 shows 64-bit (8 bytes); verify field size | Investigation | 2026-01-22 | - |\n| W-07-002 | Low | Documentation | `collective_l2.ksy` and `scaleup_l2.ksy` marked as \"work_in_progress\" with spec_version 0.1; specifications incomplete | Spec Update | 2026-01-22 | - |\n| W-07-003 | Low | Datamodel | `ue_plus.ksy` 9-bit length field split across bytes 0-1 with unusual encoding (1 bit in byte 0, 8 bits in byte 1); verify encoding matches UE Spec | Investigation | 2026-01-22 | - |\n| W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |\n| W-05-002 | Medium | Specification | MTU values: Verify maximum MTU for each protocol | Investigation | 2026-01-10 | - |\n| W-05-003 | Medium | Documentation | CMS detailed formats: Need comprehensive documentation | Spec Update | 2026-01-10 | - |\n| W-03-002 | Low | Terminology | PDP vs PDS naming: UML uses both terms inconsistently | Spec Update | 2026-01-08 | - |\n| W-03-006 | Low | Terminology | SES vs SE: \"SES Processing Groups\" vs \"Semantic Engines\" | Spec Update | 2026-01-08 | - |\n\n### 9.2 Datamodel Gaps\n\n| ID | Priority | Description | Target Location | Status | Opened | Closed |\n|----|----------|-------------|-----------------|--------|--------|--------|\n| D-001 | High | PMR CSR definitions missing from datamodel | `datamodel/hw/asics/pmr/csrs/*.rdl` | Spec Update | 2026-01-10 | - |\n| D-002 | Medium | PMR block hierarchy YAML incomplete | `datamodel/hw/asics/pmr/blocks.yaml` | Spec Update | 2026-01-10 | - |\n| D-003 | Medium | PMR interface contracts missing | `datamodel/views/contracts/pmr-*.puml` | Spec Update | 2026-01-10 | - |\n\n### 9.3 Specification Clarifications Needed\n\n| ID | Priority | Question | Context | Status | Opened | Closed |\n|----|----------|----------|---------|--------|--------|--------|\n| Q1 | Medium | Lightweight Interface Scope | What features should be reduced in lightweight mode? | Investigation | 2026-01-10 | - |\n| Q2 | Medium | Tag Table Sizing | Should HW tag table size be per-endpoint configurable? | Investigation | 2026-01-10 | - |\n| Q3 | Medium | Multi-Packet Eager Messages | Should hardware support multi-packet eager messages? | Investigation | 2026-01-10 | - |\n| Q4 | Low | RoCE Work Queue Implementation | Confirm RoCE WQ/CQ are software-implemented | Investigation | 2026-01-10 | - |\n\n### 9.4 Closed Issues\n\n| ID | Priority | Category | Description | Resolution | Opened | Closed |\n|----|----------|----------|-------------|------------|--------|--------|\n| W-05-001 | Medium | Documentation | UE taxonomy reference | Documented in `05-packet-formats.md` | 2026-01-08 | 2026-01-10 |\n| W-02-005 | Medium | Documentation | Protocol support documentation | Documented UE+, RoCEv2, Ethernet | 2026-01-08 | 2026-01-10 |\n| W-02-006 | Medium | Documentation | Cornelis Collective Reduction Protocol | Documented in HAS §2.5.4 | 2026-01-08 | 2026-01-10 |\n| W-03-001 | Medium | Architecture | Semantic Engine count | Confirmed 64 (8x8) in UML and HAS | 2026-01-08 | 2026-01-10 |\n| W-17-005 | Low | Documentation | Port subdivision note | Added to HAS Ch17 | 2026-01-11 | 2026-01-11 |\n| W-17-006 | Medium | Documentation | MPORT interface documentation | Documented 256B @ 1.66 GHz | 2026-01-11 | 2026-01-11 |\n| W-04-005 | High | Datamodel | `ufh_16.ksy` address size: Datamodel shows 12-bit dest, should be 16-bit | UFH-16 restructured to 12-byte Ethernet MAC overlay with 16-bit destination (bytes 4-5) and 16-bit source (bytes 10-11) | 2026-01-10 | 2026-01-20 |\n| W-04-006 | High | Datamodel | `ufh_32.ksy` address size: Datamodel shows 16-bit dest, should be 32-bit | UFH-32 restructured to 12-byte Ethernet MAC overlay with 32-bit destination (bytes 2-5) and 32-bit source (bytes 8-11) | 2026-01-10 | 2026-01-20 |\n\n### 9.5 Change Log\n\n| Date | Change | Details |\n|------|--------|---------|\n| 2026-01-14 | Initial creation | Document created with PMR packet taxonomy |\n| 2026-01-20 | Review and update | Added UALink section (reference only, not PMR-supported); Added change log; Updated datamodel file counts; No new .ksy files since initial creation |\n| 2026-01-20 | UFH format details | Added detailed UFH-16 and UFH-32 format documentation in Section 6.2 (wire diagrams, field tables, type enumerations) |\n| 2026-01-20 | UFH restructuring | UFH-16 and UFH-32 restructured to 12-byte Ethernet MAC overlays; UFH-16 now 16-bit addressing, UFH-32 now 32-bit addressing; Added SLAP field constraints (Z,Y,X=001); Updated datamodel .ksy files; Closed W-04-005 and W-04-006 |\n\n---\n\n## 10. UALink Protocol (Reference Only)\n\n**Note**: UALink is defined in the datamodel but is **NOT currently supported by PMR**. It is included here for reference as it may be relevant for future AI/ML accelerator interconnect work.\n\n**Datamodel Directory**: `datamodel/protocols/ualink/`\n\n### 10.1 UALink Overview\n\nUALink is an AI/ML accelerator interconnect protocol with 38 packet definitions across all OSI layers.\n\n| Layer | Count | Key Formats |\n|-------|-------|-------------|\n| UPLI (Upper Protocol Layer Interface) | 8 | commands.ksy, request_channel.ksy, status_codes.ksy |\n| Transaction | 9 | tl_flit.ksy, control_half_flit.ksy, data_half_flit.ksy |\n| Data Link | 12 | dl_flit.ksy, segment_header.ksy, crc.ksy, control_messages.ksy |\n| Physical | 4 | alignment_markers.ksy, control_ordered_sets.ksy, link_training.ksy |\n| Security | 5 | authentication.ksy, encryption.ksy, key_derivation.ksy |\n\n### 10.2 UALink Packet Formats\n\n#### UPLI Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Commands | `upli/commands.ksy` | UPLI command definitions |\n| Request Channel | `upli/request_channel.ksy` | Request channel format |\n| Originator Data | `upli/originator_data_channel.ksy` | Originator data channel |\n| Read Response | `upli/read_response_channel.ksy` | Read response channel |\n| Write Response | `upli/write_response_channel.ksy` | Write response channel |\n| Status Codes | `upli/status_codes.ksy` | Status code definitions |\n| Connection Handshake | `upli/protocols/connection_handshake.ksy` | Connection setup |\n| Flow Control | `upli/protocols/flow_control.ksy` | Flow control protocol |\n\n#### Transaction Layer\n| Format | File | Description |\n|--------|------|-------------|\n| TL Flit | `transaction/tl_flit.ksy` | Transaction layer flit |\n| Control Half Flit | `transaction/control_half_flit.ksy` | Control half flit |\n| Data Half Flit | `transaction/data_half_flit.ksy` | Data half flit |\n| Message Half Flit | `transaction/message_half_flit.ksy` | Message half flit |\n| Request Field | `transaction/request_field.ksy` | Request field format |\n| Response Field | `transaction/response_field.ksy` | Response field format |\n| Flow Control Field | `transaction/flow_control_field.ksy` | Flow control field |\n| Compression | `transaction/protocols/compression.ksy` | Data compression |\n| Address Cache | `transaction/protocols/address_cache.ksy` | Address caching |\n\n#### Data Link Layer\n| Format | File | Description |\n|--------|------|-------------|\n| DL Flit | `datalink/dl_flit.ksy` | Data link flit |\n| Flit Header | `datalink/flit_header.ksy` | Flit header format |\n| Segment Header | `datalink/segment_header.ksy` | Segment header |\n| CRC | `datalink/crc.ksy` | CRC calculation |\n| Control Messages | `datalink/messages/control_messages.ksy` | Control messages |\n| Basic Messages | `datalink/messages/basic_messages.ksy` | Basic messages |\n| UART Messages | `datalink/messages/uart_messages.ksy` | UART messages |\n| Vendor Defined | `datalink/messages/vendor_defined.ksy` | Vendor extensions |\n| Link Resiliency | `datalink/protocols/link_resiliency.ksy` | Link resiliency |\n| Link Level Replay | `datalink/protocols/link_level_replay.ksy` | Replay protocol |\n| Link State | `datalink/protocols/link_state.ksy` | Link state machine |\n| Link Folding | `datalink/protocols/link_folding.ksy` | Link folding |\n\n#### Physical Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Alignment Markers | `physical/alignment_markers.ksy` | Lane alignment |\n| Control Ordered Sets | `physical/control_ordered_sets.ksy` | Control sequences |\n| Reconciliation Sublayer | `physical/reconciliation_sublayer.ksy` | RS sublayer |\n| Link Training | `physical/protocols/link_training.ksy` | Link training |\n\n#### Security Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Authentication | `security/authentication.ksy` | Authentication |\n| Encryption | `security/encryption.ksy` | Encryption format |\n| IV Format | `security/iv_format.ksy` | Initialization vector |\n| Key Derivation | `security/protocols/key_derivation.ksy` | Key derivation |\n| Key Rotation | `security/protocols/key_rotation.ksy` | Key rotation |\n\n---\n\n## 11. References\n\n### Internal Documents\n- `docs/HAS/PMR/05-packet-formats.md` - PMR HAS Chapter 5\n- `docs/HAS/PMR/WORK.md` - PMR HAS Work Tracking\n- `.specify/memory/constitution.md` - Project Constitution\n\n### Datamodel Locations\n- `datamodel/protocols/ue/` - Ultra Ethernet protocols (94 .ksy files)\n- `datamodel/protocols/roce/` - RoCEv2 protocols (8 .ksy files)\n- `datamodel/protocols/ethernet/` - Standard Ethernet (6 .ksy files)\n- `datamodel/protocols/cornelis/` - Cornelis proprietary (9 .ksy files)\n- `datamodel/protocols/ualink/` - UALink protocols (38 .ksy files) - NOT supported by PMR\n- `datamodel/hw/asics/pmr/` - PMR ASIC definitions\n\n### External Specifications\n- [Ultra Ethernet Specification v1.0.1](https://ultraethernet.org/)\n- [InfiniBand Architecture Specification](https://www.infinibandta.org/)\n- IEEE 802.3 Ethernet Standard\n- UALink Specification (Ultra Accelerator Link)\n",
                "additions": 3,
                "deletions": 0
              },
              "truncated": false
            },
            "time": {
              "start": 1769122661510,
              "end": 1769122661583,
              "compacted": 1769125778420
            }
          }
        },
        {
          "id": "prt_be7ed84d2001No8VWhmxre1mVa",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7ed4590001NjyuVUzvC1tQz0",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 117219,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7ed84f90014QZKiIGliEtKLG",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769122661625,
          "completed": 1769122674303
        },
        "parentID": "msg_be7ed1928001lRyvx7zSrvkA3j",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 117227,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7ed89500019cQNrhV93Odrbq",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7ed84f90014QZKiIGliEtKLG",
          "type": "step-start"
        },
        {
          "id": "prt_be7edb63d0018WQ9pZflUhL2ff",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7ed84f90014QZKiIGliEtKLG",
          "type": "tool",
          "callID": "toolu_012DkpBVoegFqphHuYhvp6rF",
          "tool": "edit",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
              "oldString": "| Date | Change | Details |\n|------|--------|---------|\n| 2026-01-14 | Initial creation | Document created with PMR packet taxonomy |\n| 2026-01-20 | Review and update | Added UALink section (reference only, not PMR-supported); Added change log; Updated datamodel file counts; No new .ksy files since initial creation |\n| 2026-01-20 | UFH format details | Added detailed UFH-16 and UFH-32 format documentation in Section 6.2 (wire diagrams, field tables, type enumerations) |\n| 2026-01-20 | UFH restructuring | UFH-16 and UFH-32 restructured to 12-byte Ethernet MAC overlays; UFH-16 now 16-bit addressing, UFH-32 now 32-bit addressing; Added SLAP field constraints (Z,Y,X=001); Updated datamodel .ksy files; Closed W-04-005 and W-04-006 |",
              "newString": "| Date | Change | Details |\n|------|--------|---------|\n| 2026-01-14 | Initial creation | Document created with PMR packet taxonomy |\n| 2026-01-20 | Review and update | Added UALink section (reference only, not PMR-supported); Added change log; Updated datamodel file counts; No new .ksy files since initial creation |\n| 2026-01-20 | UFH format details | Added detailed UFH-16 and UFH-32 format documentation in Section 6.2 (wire diagrams, field tables, type enumerations) |\n| 2026-01-20 | UFH restructuring | UFH-16 and UFH-32 restructured to 12-byte Ethernet MAC overlays; UFH-16 now 16-bit addressing, UFH-32 now 32-bit addressing; Added SLAP field constraints (Z,Y,X=001); Updated datamodel .ksy files; Closed W-04-005 and W-04-006 |\n| 2026-01-22 | Datamodel review | Added W-07-001 (ack_cc_state size mismatch), W-07-002 (collective/scaleup specs incomplete), W-07-003 (ue_plus length encoding); Identified 30+ packet formats requiring expansion |"
            },
            "output": "Edit applied successfully.",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy.md",
            "metadata": {
              "diagnostics": {},
              "diff": "Index: /home/matkins/CN7000/analysis/packet_taxonomy.md\n===================================================================\n--- /home/matkins/CN7000/analysis/packet_taxonomy.md\n+++ /home/matkins/CN7000/analysis/packet_taxonomy.md\n@@ -722,8 +722,9 @@\n | 2026-01-14 | Initial creation | Document created with PMR packet taxonomy |\n | 2026-01-20 | Review and update | Added UALink section (reference only, not PMR-supported); Added change log; Updated datamodel file counts; No new .ksy files since initial creation |\n | 2026-01-20 | UFH format details | Added detailed UFH-16 and UFH-32 format documentation in Section 6.2 (wire diagrams, field tables, type enumerations) |\n | 2026-01-20 | UFH restructuring | UFH-16 and UFH-32 restructured to 12-byte Ethernet MAC overlays; UFH-16 now 16-bit addressing, UFH-32 now 32-bit addressing; Added SLAP field constraints (Z,Y,X=001); Updated datamodel .ksy files; Closed W-04-005 and W-04-006 |\n+| 2026-01-22 | Datamodel review | Added W-07-001 (ack_cc_state size mismatch), W-07-002 (collective/scaleup specs incomplete), W-07-003 (ue_plus length encoding); Identified 30+ packet formats requiring expansion |\n \n ---\n \n ## 10. UALink Protocol (Reference Only)\n",
              "filediff": {
                "file": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
                "before": "# PMR (CN7000) Packet Format Taxonomy\n\n**Document**: Packet formats supported by PMR NIC ASIC  \n**Generated**: 2026-01-14  \n**Last Reviewed**: 2026-01-20  \n**Source**: `datamodel/` directory in EarlySim repository  \n**Reference**: `docs/HAS/PMR/05-packet-formats.md`\n\n---\n\n## Table of Contents\n\n1. [Overview](#1-overview)\n2. [Protocol Stack Summary](#2-protocol-stack-summary)\n3. [Ultra Ethernet+ (UE+) Formats](#3-ultra-ethernet-ue-formats)\n4. [RoCEv2 Formats](#4-rocev2-formats)\n5. [Standard Ethernet Formats](#5-standard-ethernet-formats)\n6. [Cornelis Proprietary Formats](#6-cornelis-proprietary-formats)\n7. [Host-Software Interface (HSI) Formats](#7-host-software-interface-hsi-formats)\n8. [IP Block Descriptors](#8-ip-block-descriptors)\n9. [Work List](#9-work-list)\n10. [UALink Protocol (Reference Only)](#10-ualink-protocol-reference-only)\n11. [References](#11-references)\n\n---\n\n## 1. Overview\n\nPMR (Prism River) is Cornelis Networks' 1.6 Tbps NIC ASIC (CN7000 product family). It supports multiple wire protocols with per-packet protocol selection on a single physical port.\n\n### Supported Protocols\n\n| Protocol | Version | Status | Description |\n|----------|---------|--------|-------------|\n| Ultra Ethernet+ | 1.0.1 | Full | Optimized UE with Cornelis extensions |\n| RoCEv2 | v2 | Full | RDMA over Converged Ethernet |\n| Standard Ethernet | IEEE 802.3 | Full | Traditional Ethernet with offloads |\n| Cornelis Proprietary | 1.0.0 | Full | UFH, CSIG+, VxLAN+, Collectives |\n\n### Header Efficiency Comparison\n\n| Protocol Stack | Total Headers | Efficiency (4KB payload) |\n|----------------|---------------|--------------------------|\n| UE+ (small msg) | ~20 bytes | 99.5% |\n| UE+ (standard) | ~40 bytes | 99.0% |\n| RoCEv2 (IPv4) | ~58 bytes | 98.6% |\n| RoCEv2 (IPv6) | ~78 bytes | 98.1% |\n\n---\n\n## 2. Protocol Stack Summary\n\n```\n+-----------------------------------------------------------------------------+\n|                           Application Layer                                  |\n|                    (Libfabric, Verbs, Sockets, DPDK)                         |\n+-----------------------------------------------------------------------------+\n|                           Transport Layer                                    |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UE Transport   |  |     RoCEv2       |  |    TCP/UDP       |            |\n|  |   (SES/PDS/CMS)  |  |   (BTH/RETH)     |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                           Network Layer                                      |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UFH-16/32      |  |   IPv4/IPv6      |  |   IPv4/IPv6      |            |\n|  |   (Cornelis)     |  |   + UDP          |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                            Link Layer                                        |\n|  +------------------+  +------------------+  +------------------+            |\n|  |      UE+         |  |   Ethernet II    |  |   Ethernet II    |            |\n|  |   (12 bytes)     |  |   (14 bytes)     |  |   (14 bytes)     |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                          Physical Layer                                      |\n|                    Hill Creek (212.5G x8 PAM4 SerDes)                        |\n+-----------------------------------------------------------------------------+\n      Ultra Ethernet+           RoCEv2              Standard Ethernet\n```\n\n---\n\n## 3. Ultra Ethernet+ (UE+) Formats\n\n### 3.1 UE+ L2 Header (12 bytes)\n\n**Datamodel**: `datamodel/protocols/cornelis/link/ue_plus.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Byte 2        | Byte 3        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n|L2|V|zyxm|Len  | Length[7:0]   | RC    | SC    | Hop Count     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 4        | Byte 5        | Byte 6        | Byte 7        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Dest LID [15:8]               | Dest LID [7:0]                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Entropy [15:8]                | Entropy [7:0]                 |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 8        | Byte 9        | Byte 10       | Byte 11       |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Source LID [15:8]             | Source LID [7:0]              |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Payload Type [15:8]           | Payload Type [7:0]            |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| L2 Type | 2 | Always 0b10 for UE+ |\n| Version | 1 | Protocol version |\n| zyxm | 4 | Routing control flags (multicast, adaptive) |\n| Length | 9 | Packet length in bytes |\n| RC | 4 | Routing Class (QoS) |\n| SC | 4 | Service Class |\n| Hop | 8 | TTL/hop count |\n| Dest LID | 16 | Destination Local Identifier |\n| Entropy | 16 | ECMP hash for load balancing |\n| Source LID | 16 | Source Local Identifier |\n| Type | 16 | Payload type (EtherType equivalent) |\n\n**Payload Types**:\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x0800 | IPv4 | IPv4 payload |\n| 0x86DD | IPv6 | IPv6 payload |\n| 0x8100 | VLAN | VLAN tagged frame |\n| 0x9000 | VxLAN+ | VxLAN+ encapsulated |\n| 0x9100 | CSIG+ | CSIG+ telemetry |\n| 0xC000 | UE PDS | Ultra Ethernet PDS |\n\n### 3.2 PDS (Packet Delivery Sublayer) Prologue (2 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/prologue.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0                        | Byte 1                        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| type[4:0] | next_hdr/ctl[3:0] | flags[6:0]                    |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| PDS Type | Value | Description |\n|----------|-------|-------------|\n| Reserved | 0 | Reserved |\n| TSS | 1 | Transport Security (encryption) |\n| RUD Request | 2 | Reliable Unordered Delivery |\n| ROD Request | 3 | Reliable Ordered Delivery |\n| RUDI Request | 4 | Reliable Unordered Immediate |\n| RUDI Response | 5 | RUDI response |\n| UUD Request | 6 | Unreliable Unordered Delivery |\n| ACK | 7 | Acknowledgment |\n| ACK_CC | 8 | ACK with congestion control |\n| ACK_CCX | 9 | ACK with extended CC |\n| NACK | 10 | Negative acknowledgment |\n| CP | 11 | Control packet |\n| NACK_CCX | 12 | NACK with extended CC |\n| RUD_CC_REQ | 13 | RUD with CC state |\n| ROD_CC_REQ | 14 | ROD with CC state |\n\n### 3.3 PDS Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/pds/`\n\n| Format | File | Size | Description |\n|--------|------|------|-------------|\n| RUD/ROD Request | `rud_rod_request.ksy` | Variable | Reliable delivery request |\n| RUD/ROD ACK | `rud_rod_ack.ksy` | Variable | Acknowledgment |\n| ACK_CC | `ack_cc.ksy` | Variable | ACK with CC state |\n| ACK_CCX | `ack_ccx.ksy` | Variable | ACK with extended CC |\n| NACK | `nack.ksy` | Variable | Negative acknowledgment |\n| NACK_CCX | `nack_ccx.ksy` | Variable | NACK with extended CC |\n| RUDI Request/Response | `rudi_request_response.ksy` | Variable | Low-latency immediate |\n| UUD Request | `uud_request.ksy` | Variable | Unreliable delivery |\n| Control Packet | `rud_rod_cp.ksy` | Variable | Control packet |\n| Entropy Header | `entropy_header.ksy` | Variable | Entropy extension |\n\n### 3.4 SES (Semantic Sublayer) Opcodes\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/opcodes.ksy`\n\n**Request Opcodes (Table 3-17)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Tagged Send | 0x00 | Send with tag matching |\n| RMA Write | 0x01 | Remote memory write |\n| RMA Read | 0x02 | Remote memory read |\n| Atomic Write | 0x03 | Atomic memory write |\n| Atomic Read | 0x04 | Atomic memory read |\n| Atomic CAS | 0x05 | Compare-and-swap |\n| Deferrable Send | 0x06 | Deferrable send |\n| Ready to Restart | 0x07 | Restart notification |\n| Small Message | 0x08 | Small message (32B header) |\n| Small RMA Write | 0x09 | Small RMA write |\n| Small RMA Read | 0x0A | Small RMA read |\n| Small Atomic Write | 0x0B | Small atomic write |\n| Small Atomic Read | 0x0C | Small atomic read |\n| Small Atomic CAS | 0x0D | Small atomic CAS |\n\n**Response Opcodes (Table 3-18)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Response | 0x00 | Standard response |\n| Response with Data | 0x01 | Response carrying data |\n| Optimized Response | 0x02 | Optimized format |\n| NACK | 0x03 | Negative acknowledgment |\n\n### 3.5 SES Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/ses/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Standard Request (SOM=1) | `standard_request_som1.ksy` | Start of message |\n| Standard Request (SOM=0) | `standard_request_som0.ksy` | Continuation |\n| Small Message | `small_message.ksy` | 32-byte header format |\n| Small RMA | `small_rma.ksy` | Small RMA operations |\n| Response | `response.ksy` | Standard response |\n| Response with Data | `response_with_data.ksy` | Data-carrying response |\n| Optimized Response | `optimized_response_with_data.ksy` | Optimized format |\n| Deferrable Send | `deferrable_send_request.ksy` | Deferrable operation |\n| Ready to Restart | `ready_to_restart.ksy` | Restart notification |\n| Rendezvous Extension | `rendezvous_extension.ksy` | Large message protocol |\n| Atomic Extension | `atomic_extension.ksy` | Atomic operations |\n| CAS Extension | `cas_extension.ksy` | Compare-and-swap |\n\n### 3.6 CMS (Congestion Management Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/cms/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Credit CP Payload | `credit_cp_payload.ksy` | Credit control packet |\n| Credit Request | `credit_request_cp_payload.ksy` | Credit request |\n| Request CC State | `req_cc_state.ksy` | Request CC state |\n| ACK CC State (NSCC) | `ack_cc_state_nscc.ksy` | NSCC algorithm state |\n| ACK CC State (RCCC/TFC) | `ack_cc_state_rccc_tfc.ksy` | RCCC/TFC state |\n\n### 3.7 TSS (Transport Security Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/tss/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Security Header | `security_header.ksy` | Encryption header |\n| IV Construction | `iv_construction.ksy` | Initialization vector |\n| Key Rotation | `protocols/key_rotation.ksy` | Key rotation protocol |\n| KDF Direct | `protocols/kdf_direct.ksy` | Direct key derivation |\n| KDF Client/Server | `protocols/kdf_client_server.ksy` | Client/server KDF |\n| KDF Cluster | `protocols/kdf_cluster.ksy` | Cluster KDF |\n| Join Secure Domain | `protocols/join_secure_domain.ksy` | Domain join |\n| TSS TX Processing | `protocols/tss_tx_processing.ksy` | Transmit processing |\n| TSS RX Processing | `protocols/tss_rx_processing.ksy` | Receive processing |\n\n### 3.8 Link Layer Formats\n\n#### LLR (Link-Level Retry)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/llr/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| LLR Preamble (64b66b) | `llr_preamble_64b66b.ksy` | 64b66b preamble |\n| LLR Preamble (MII) | `llr_preamble_mii.ksy` | MII preamble |\n| LLR Init CTLOS | `llr_init_ctlos.ksy` | Initialize LLR |\n| LLR Init Echo CTLOS | `llr_init_echo_ctlos.ksy` | Init acknowledgment |\n| LLR ACK CTLOS | `llr_ack_ctlos.ksy` | Frame acknowledgment |\n| LLR NACK CTLOS | `llr_nack_ctlos.ksy` | Retransmit request |\n\n#### CBFC (Credit-Based Flow Control)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/cbfc/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| CF Update | `cf_update.ksy` | Credit flow update |\n| CC Update | `cc_update.ksy` | Credit count update |\n| VC State Machine | `protocols/vc_state_machine.ksy` | Virtual channel FSM |\n| Lossless VC Init | `protocols/lossless_vc_init.ksy` | VC initialization |\n| Lossless VC Removal | `protocols/lossless_vc_removal.ksy` | VC teardown |\n\n#### LLDP Extensions\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/lldp/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| UE Link Negotiation TLV | `ue_link_negotiation_tlv.ksy` | Link negotiation |\n| UE CBFC TLV | `ue_cbfc_tlv.ksy` | CBFC parameters |\n\n---\n\n## 4. RoCEv2 Formats\n\n**Datamodel Directory**: `datamodel/protocols/roce/transport/`\n\n### 4.1 RoCEv2 Packet Structure\n\n```\n+-----------------------------------------------------------------------------+\n| Ethernet II Header (14 bytes)                                               |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2) = 0x0800/0x86DD            |\n+-----------------------------------------------------------------------------+\n| IP Header (20 bytes IPv4 / 40 bytes IPv6)                                   |\n|   Version, IHL, DSCP, ECN, Length, ID, Flags, TTL, Protocol=17, Checksum   |\n|   Source IP, Dest IP                                                        |\n+-----------------------------------------------------------------------------+\n| UDP Header (8 bytes)                                                        |\n|   Source Port (entropy) | Dest Port = 4791 | Length | Checksum             |\n+-----------------------------------------------------------------------------+\n| BTH - Base Transport Header (12 bytes)                                      |\n|   Opcode | Flags | P-Key | Dest QP | A | PSN                               |\n+-----------------------------------------------------------------------------+\n| Extended Headers (optional, operation-dependent)                            |\n|   RETH (16) | AETH (4) | AtomicETH (28) | ImmDt (4)                        |\n+-----------------------------------------------------------------------------+\n| Payload (0 - MTU bytes)                                                     |\n+-----------------------------------------------------------------------------+\n| ICRC (4 bytes)                                                              |\n+-----------------------------------------------------------------------------+\n```\n\n### 4.2 BTH (Base Transport Header) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/roce/transport/bth.ksy`\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| Opcode | 8 | Operation type (transport + operation) |\n| SE | 1 | Solicited Event |\n| M | 1 | Migration state |\n| Pad | 2 | Padding bytes (0-3) |\n| TVer | 4 | Transport version (must be 0) |\n| P-Key | 16 | Partition key |\n| Dest QP | 24 | Destination Queue Pair |\n| A | 1 | ACK request |\n| PSN | 24 | Packet Sequence Number |\n\n**Transport Types** (Opcode bits [7:5]):\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x00 | RC | Reliable Connection |\n| 0x20 | UC | Unreliable Connection |\n| 0x40 | RD | Reliable Datagram |\n| 0x60 | UD | Unreliable Datagram |\n\n**Operations** (Opcode bits [4:0]):\n| Value | Operation | Description |\n|-------|-----------|-------------|\n| 0x00 | SEND_FIRST | First send packet |\n| 0x01 | SEND_MIDDLE | Middle send packet |\n| 0x02 | SEND_LAST | Last send packet |\n| 0x03 | SEND_LAST_IMM | Last send with immediate |\n| 0x04 | SEND_ONLY | Single-packet send |\n| 0x05 | SEND_ONLY_IMM | Single send with immediate |\n| 0x06 | RDMA_WRITE_FIRST | First RDMA write |\n| 0x07 | RDMA_WRITE_MIDDLE | Middle RDMA write |\n| 0x08 | RDMA_WRITE_LAST | Last RDMA write |\n| 0x09 | RDMA_WRITE_LAST_IMM | Last write with immediate |\n| 0x0A | RDMA_WRITE_ONLY | Single-packet write |\n| 0x0B | RDMA_WRITE_ONLY_IMM | Single write with immediate |\n| 0x0C | RDMA_READ_REQUEST | Read request |\n| 0x0D | RDMA_READ_RESPONSE_FIRST | First read response |\n| 0x0E | RDMA_READ_RESPONSE_MIDDLE | Middle read response |\n| 0x0F | RDMA_READ_RESPONSE_LAST | Last read response |\n| 0x10 | RDMA_READ_RESPONSE_ONLY | Single read response |\n| 0x11 | ACK | Acknowledgment |\n| 0x12 | ATOMIC_ACK | Atomic acknowledgment |\n| 0x13 | CMP_SWAP | Compare and swap |\n| 0x14 | FETCH_ADD | Fetch and add |\n\n### 4.3 Extended Transport Headers\n\n| Header | File | Size | Description |\n|--------|------|------|-------------|\n| RETH | `reth.ksy` | 16 bytes | RDMA Extended Transport Header |\n| AETH | `aeth.ksy` | 4 bytes | ACK Extended Transport Header |\n| AtomicETH | `atomiceth.ksy` | 28 bytes | Atomic Extended Transport Header |\n| AtomicAckETH | `atomicacketh.ksy` | 8 bytes | Atomic ACK ETH |\n| DETH | `deth.ksy` | 8 bytes | Datagram Extended Transport Header |\n| ImmDt | `immdt.ksy` | 4 bytes | Immediate Data |\n| ICRC | `icrc.ksy` | 4 bytes | Invariant CRC |\n\n---\n\n## 5. Standard Ethernet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ethernet/`\n\n### 5.1 Ethernet II Frame\n\n**Datamodel**: `datamodel/protocols/ethernet/link/ethernet_ii.ksy`\n\n```\n+-----------------------------------------------------------------------------+\n| Preamble (7 bytes) + SFD (1 byte)  [not visible to software]               |\n+-----------------------------------------------------------------------------+\n| Ethernet Header (14 bytes)                                                  |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2)                            |\n+-----------------------------------------------------------------------------+\n| Optional VLAN Tag (4 bytes) - 802.1Q                                        |\n|   TPID (2) = 0x8100 | TCI (2) = PCP + DEI + VID                            |\n+-----------------------------------------------------------------------------+\n| Payload (46-1500 bytes, or up to 9000 for jumbo)                           |\n+-----------------------------------------------------------------------------+\n| FCS (4 bytes)                                                               |\n+-----------------------------------------------------------------------------+\n```\n\n### 5.2 Link Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| Ethernet II | `link/ethernet_ii.ksy` | Standard Ethernet frame |\n| VLAN 802.1Q | `link/vlan_802_1q.ksy` | VLAN tagging |\n\n### 5.3 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| IPv4 | `network/ipv4.ksy` | IPv4 header |\n| IPv6 | `network/ipv6.ksy` | IPv6 header |\n\n### 5.4 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| TCP | `transport/tcp.ksy` | TCP header |\n| UDP | `transport/udp.ksy` | UDP header |\n\n---\n\n## 6. Cornelis Proprietary Formats\n\n**Datamodel Directory**: `datamodel/protocols/cornelis/`\n\n### 6.1 Link Layer\n\n| Format | File | Size | Description |\n|--------|------|------|-------------|\n| UE+ Header | `link/ue_plus.ksy` | 12 bytes | Optimized L2 header |\n| Cornelis L2 Prefix | `link/cornelis_l2_prefix.ksy` | Variable | L2 prefix |\n\n### 6.2 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| UFH-16 | `network/ufh_16.ksy` | 16-bit forwarding header |\n| UFH-32 | `network/ufh_32.ksy` | 32-bit forwarding header |\n| Collective L2 | `network/collective_l2.ksy` | Collective operations header |\n| Scale-Up L2 | `network/scaleup_l2.ksy` | Scale-up deployments |\n\n#### 6.2.1 UFH-16 (Unified Forwarding Header 16-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_16.ksy`\n\nUFH-16 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 16-bit addressing.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |    Opaque (24-bit)    | Destination   |Opaque |Traffic|   Opaque      |    Source     |\n|[7:4]  |                       | (16-bit BE)   |[7:4]  |Class  |   (16-bit)    |  (16-bit BE)  |\n|SLAP   |                       |               |Z|Y|X|M|[7:0]  |               |               |\n|[3:0]  |                       |               |[3:0]  |       |               |               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1-3 | 24 | Opaque to hardware |\n| Destination | 4-5 | 16 | Destination endpoint address (big-endian) |\n| Opaque | 6 | [7:4] | Opaque to hardware |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Opaque | 8-9 | 16 | Opaque to hardware |\n| Source | 10-11 | 16 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-16 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5-14 | Reserved | Reserved for future use |\n| 15 | Extended | UFH-32 extension follows |\n\n**Usage**: Scale-up fabric forwarding, intra-pod communication, medium cluster networking (up to 65536 endpoints).\n\n#### 6.2.2 UFH-32 (Unified Forwarding Header 32-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_32.ksy`\n\nUFH-32 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 32-bit addressing for large-scale deployments.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |       |   Destination (32-bit BE)     |HopLim |Traffic|       Source (32-bit BE)      |\n|[7:4]  |Opaque |                               |[7:4]  |Class  |                               |\n|SLAP   |       |                               |Z|Y|X|M|[7:0]  |                               |\n|[3:0]  |       |                               |[3:0]  |       |                               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1 | [7:0] | Opaque to hardware |\n| Destination | 2-5 | 32 | Destination endpoint address (big-endian) |\n| Hop Limit | 6 | [7:4] | TTL/hop count |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Source | 8-11 | 32 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-32 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5 | Multicast | Multicast packet |\n| 6 | Barrier | Barrier synchronization |\n| 7 | Reduction | Reduction operation |\n| 8-14 | Reserved | Reserved for future use |\n| 15 | Vendor | Vendor-specific packet |\n\n**Usage**: Large-scale scale-up fabric forwarding (4+ billion endpoints), multi-pod communication, extended collective operations.\n\n### 6.3 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| CSIG+ | `transport/csig_plus.ksy` | Telemetry header |\n| PKEY | `transport/pkey.ksy` | Partition key |\n\n### 6.4 Encapsulation\n\n| Format | File | Description |\n|--------|------|-------------|\n| VxLAN+ | `encapsulation/vxlan_plus.ksy` | Extended VxLAN overlay |\n\n---\n\n## 7. Host-Software Interface (HSI) Formats\n\n**Datamodel Directory**: `datamodel/hw/asics/pmr/interfaces/host_interface/`\n\n### 7.1 Command Queue Segment (64 bytes)\n\n**Datamodel**: `command_queue_segment.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Bytes 2-3     | Bytes 4-7     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Opcode        | Flags         | Payload Len   | Reserved      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 8-15                    | Bytes 16-23                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Tag (64 bits)                 | Dest (64 bits)                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 24-31                   | Bytes 32-63                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Metadata (64 bits)            | Inline Data or SGL Entry      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n**Opcode Encoding**:\n| Bits | Field | Values |\n|------|-------|--------|\n| [7:4] | Family | MSG=0x1, TAGGED=0x2, RMA=0x3, ATOMIC=0x4 |\n| [3:2] | Variant | SEND=0, RECV=1, INJECT=2 |\n| [1] | Reserved | Must be 0 |\n| [0] | Data Source | INLINE=0, SGL=1 |\n\n### 7.2 Notification Formats\n\n| Format | File | Type | Size | Description |\n|--------|------|------|------|-------------|\n| Receive Notification | `receive_notification.ksy` | 0x00 | 64 bytes | Received message |\n| Send Completion | `send_completion.ksy` | 0x01 | 64 bytes | Send completed |\n| Event Notification | `event_notification.ksy` | 0x02 | 64 bytes | Async event |\n| Notification Entry | `notification_entry.ksy` | - | 64 bytes | Generic entry |\n| QW Violation Event | `qw_violation_event.ksy` | - | 64 bytes | QW alignment error |\n\n### 7.3 Receive Notification (64 bytes)\n\n**Datamodel**: `receive_notification.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x00 for receive |\n| flags | 1 | 1 | FI_INLINE, continuation |\n| status | 2 | 2 | Completion status |\n| src_id | 4 | 4 | Source endpoint ID |\n| tag | 8 | 8 | Tag value |\n| total_length | 16 | 4 | Payload length |\n| buffer_id_0 | 20 | 2 | First buffer ID |\n| buffer_id_1 | 22 | 2 | Second buffer ID |\n| buffer_offset | 24 | 2 | Offset in buffer |\n| reserved | 26 | 2 | Reserved |\n| inline_data | 28 | 35 | Inline payload |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.4 Send Completion (64 bytes)\n\n**Datamodel**: `send_completion.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x01 for send |\n| flags | 1 | 1 | Completion flags |\n| status | 2 | 2 | Completion status |\n| reserved_0 | 4 | 4 | Reserved |\n| op_context | 8 | 8 | Operation context |\n| bytes_sent | 16 | 4 | Bytes transferred |\n| reserved_1 | 20 | 43 | Reserved |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.5 Other HSI Formats\n\n| Format | File | Description |\n|--------|------|-------------|\n| SGL Entry | `sgl_entry.ksy` | Scatter-gather list entry |\n| PCIe Descriptors | `pcie/descriptors.ksy` | PCIe interface descriptors |\n\n---\n\n## 8. IP Block Descriptors\n\n**Datamodel Directory**: `datamodel/hw/ip/cornelis/`\n\n### 8.1 Collectives Engine (CE)\n\n**Datamodel**: `ce/descriptors.ksy`\n\nThe Collectives Engine uses RISC-V vector cores (VLEN=512) for hardware-accelerated collective operations.\n\n### 8.2 Electric Creek (EC)\n\n**Datamodel**: `ec/descriptors.ksy`\n\nElectric Creek is the management complex shared between PMR NIC and LNR Switch.\n\n---\n\n## 9. Work List\n\nThis section tracks issues requiring follow-up investigation or specification updates.\n\n### 9.1 Open Issues\n\n| ID | Priority | Category | Description | Status | Opened | Closed |\n|----|----------|----------|-------------|--------|--------|--------|\n| W-06-001 | Medium | Datamodel | UFH-32 lacks 16-bit entropy field; per-packet ECMP not supported; switch must derive entropy from Src+Dest hash | Deferred | 2026-01-20 | - |\n| W-07-001 | Low | Datamodel | `ack_cc.ksy` shows `ack_cc_state` as 32-bit (4 bytes) but UE Spec Table 3-36 shows 64-bit (8 bytes); verify field size | Investigation | 2026-01-22 | - |\n| W-07-002 | Low | Documentation | `collective_l2.ksy` and `scaleup_l2.ksy` marked as \"work_in_progress\" with spec_version 0.1; specifications incomplete | Spec Update | 2026-01-22 | - |\n| W-07-003 | Low | Datamodel | `ue_plus.ksy` 9-bit length field split across bytes 0-1 with unusual encoding (1 bit in byte 0, 8 bits in byte 1); verify encoding matches UE Spec | Investigation | 2026-01-22 | - |\n| W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |\n| W-05-002 | Medium | Specification | MTU values: Verify maximum MTU for each protocol | Investigation | 2026-01-10 | - |\n| W-05-003 | Medium | Documentation | CMS detailed formats: Need comprehensive documentation | Spec Update | 2026-01-10 | - |\n| W-03-002 | Low | Terminology | PDP vs PDS naming: UML uses both terms inconsistently | Spec Update | 2026-01-08 | - |\n| W-03-006 | Low | Terminology | SES vs SE: \"SES Processing Groups\" vs \"Semantic Engines\" | Spec Update | 2026-01-08 | - |\n\n### 9.2 Datamodel Gaps\n\n| ID | Priority | Description | Target Location | Status | Opened | Closed |\n|----|----------|-------------|-----------------|--------|--------|--------|\n| D-001 | High | PMR CSR definitions missing from datamodel | `datamodel/hw/asics/pmr/csrs/*.rdl` | Spec Update | 2026-01-10 | - |\n| D-002 | Medium | PMR block hierarchy YAML incomplete | `datamodel/hw/asics/pmr/blocks.yaml` | Spec Update | 2026-01-10 | - |\n| D-003 | Medium | PMR interface contracts missing | `datamodel/views/contracts/pmr-*.puml` | Spec Update | 2026-01-10 | - |\n\n### 9.3 Specification Clarifications Needed\n\n| ID | Priority | Question | Context | Status | Opened | Closed |\n|----|----------|----------|---------|--------|--------|--------|\n| Q1 | Medium | Lightweight Interface Scope | What features should be reduced in lightweight mode? | Investigation | 2026-01-10 | - |\n| Q2 | Medium | Tag Table Sizing | Should HW tag table size be per-endpoint configurable? | Investigation | 2026-01-10 | - |\n| Q3 | Medium | Multi-Packet Eager Messages | Should hardware support multi-packet eager messages? | Investigation | 2026-01-10 | - |\n| Q4 | Low | RoCE Work Queue Implementation | Confirm RoCE WQ/CQ are software-implemented | Investigation | 2026-01-10 | - |\n\n### 9.4 Closed Issues\n\n| ID | Priority | Category | Description | Resolution | Opened | Closed |\n|----|----------|----------|-------------|------------|--------|--------|\n| W-05-001 | Medium | Documentation | UE taxonomy reference | Documented in `05-packet-formats.md` | 2026-01-08 | 2026-01-10 |\n| W-02-005 | Medium | Documentation | Protocol support documentation | Documented UE+, RoCEv2, Ethernet | 2026-01-08 | 2026-01-10 |\n| W-02-006 | Medium | Documentation | Cornelis Collective Reduction Protocol | Documented in HAS §2.5.4 | 2026-01-08 | 2026-01-10 |\n| W-03-001 | Medium | Architecture | Semantic Engine count | Confirmed 64 (8x8) in UML and HAS | 2026-01-08 | 2026-01-10 |\n| W-17-005 | Low | Documentation | Port subdivision note | Added to HAS Ch17 | 2026-01-11 | 2026-01-11 |\n| W-17-006 | Medium | Documentation | MPORT interface documentation | Documented 256B @ 1.66 GHz | 2026-01-11 | 2026-01-11 |\n| W-04-005 | High | Datamodel | `ufh_16.ksy` address size: Datamodel shows 12-bit dest, should be 16-bit | UFH-16 restructured to 12-byte Ethernet MAC overlay with 16-bit destination (bytes 4-5) and 16-bit source (bytes 10-11) | 2026-01-10 | 2026-01-20 |\n| W-04-006 | High | Datamodel | `ufh_32.ksy` address size: Datamodel shows 16-bit dest, should be 32-bit | UFH-32 restructured to 12-byte Ethernet MAC overlay with 32-bit destination (bytes 2-5) and 32-bit source (bytes 8-11) | 2026-01-10 | 2026-01-20 |\n\n### 9.5 Change Log\n\n| Date | Change | Details |\n|------|--------|---------|\n| 2026-01-14 | Initial creation | Document created with PMR packet taxonomy |\n| 2026-01-20 | Review and update | Added UALink section (reference only, not PMR-supported); Added change log; Updated datamodel file counts; No new .ksy files since initial creation |\n| 2026-01-20 | UFH format details | Added detailed UFH-16 and UFH-32 format documentation in Section 6.2 (wire diagrams, field tables, type enumerations) |\n| 2026-01-20 | UFH restructuring | UFH-16 and UFH-32 restructured to 12-byte Ethernet MAC overlays; UFH-16 now 16-bit addressing, UFH-32 now 32-bit addressing; Added SLAP field constraints (Z,Y,X=001); Updated datamodel .ksy files; Closed W-04-005 and W-04-006 |\n\n---\n\n## 10. UALink Protocol (Reference Only)\n\n**Note**: UALink is defined in the datamodel but is **NOT currently supported by PMR**. It is included here for reference as it may be relevant for future AI/ML accelerator interconnect work.\n\n**Datamodel Directory**: `datamodel/protocols/ualink/`\n\n### 10.1 UALink Overview\n\nUALink is an AI/ML accelerator interconnect protocol with 38 packet definitions across all OSI layers.\n\n| Layer | Count | Key Formats |\n|-------|-------|-------------|\n| UPLI (Upper Protocol Layer Interface) | 8 | commands.ksy, request_channel.ksy, status_codes.ksy |\n| Transaction | 9 | tl_flit.ksy, control_half_flit.ksy, data_half_flit.ksy |\n| Data Link | 12 | dl_flit.ksy, segment_header.ksy, crc.ksy, control_messages.ksy |\n| Physical | 4 | alignment_markers.ksy, control_ordered_sets.ksy, link_training.ksy |\n| Security | 5 | authentication.ksy, encryption.ksy, key_derivation.ksy |\n\n### 10.2 UALink Packet Formats\n\n#### UPLI Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Commands | `upli/commands.ksy` | UPLI command definitions |\n| Request Channel | `upli/request_channel.ksy` | Request channel format |\n| Originator Data | `upli/originator_data_channel.ksy` | Originator data channel |\n| Read Response | `upli/read_response_channel.ksy` | Read response channel |\n| Write Response | `upli/write_response_channel.ksy` | Write response channel |\n| Status Codes | `upli/status_codes.ksy` | Status code definitions |\n| Connection Handshake | `upli/protocols/connection_handshake.ksy` | Connection setup |\n| Flow Control | `upli/protocols/flow_control.ksy` | Flow control protocol |\n\n#### Transaction Layer\n| Format | File | Description |\n|--------|------|-------------|\n| TL Flit | `transaction/tl_flit.ksy` | Transaction layer flit |\n| Control Half Flit | `transaction/control_half_flit.ksy` | Control half flit |\n| Data Half Flit | `transaction/data_half_flit.ksy` | Data half flit |\n| Message Half Flit | `transaction/message_half_flit.ksy` | Message half flit |\n| Request Field | `transaction/request_field.ksy` | Request field format |\n| Response Field | `transaction/response_field.ksy` | Response field format |\n| Flow Control Field | `transaction/flow_control_field.ksy` | Flow control field |\n| Compression | `transaction/protocols/compression.ksy` | Data compression |\n| Address Cache | `transaction/protocols/address_cache.ksy` | Address caching |\n\n#### Data Link Layer\n| Format | File | Description |\n|--------|------|-------------|\n| DL Flit | `datalink/dl_flit.ksy` | Data link flit |\n| Flit Header | `datalink/flit_header.ksy` | Flit header format |\n| Segment Header | `datalink/segment_header.ksy` | Segment header |\n| CRC | `datalink/crc.ksy` | CRC calculation |\n| Control Messages | `datalink/messages/control_messages.ksy` | Control messages |\n| Basic Messages | `datalink/messages/basic_messages.ksy` | Basic messages |\n| UART Messages | `datalink/messages/uart_messages.ksy` | UART messages |\n| Vendor Defined | `datalink/messages/vendor_defined.ksy` | Vendor extensions |\n| Link Resiliency | `datalink/protocols/link_resiliency.ksy` | Link resiliency |\n| Link Level Replay | `datalink/protocols/link_level_replay.ksy` | Replay protocol |\n| Link State | `datalink/protocols/link_state.ksy` | Link state machine |\n| Link Folding | `datalink/protocols/link_folding.ksy` | Link folding |\n\n#### Physical Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Alignment Markers | `physical/alignment_markers.ksy` | Lane alignment |\n| Control Ordered Sets | `physical/control_ordered_sets.ksy` | Control sequences |\n| Reconciliation Sublayer | `physical/reconciliation_sublayer.ksy` | RS sublayer |\n| Link Training | `physical/protocols/link_training.ksy` | Link training |\n\n#### Security Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Authentication | `security/authentication.ksy` | Authentication |\n| Encryption | `security/encryption.ksy` | Encryption format |\n| IV Format | `security/iv_format.ksy` | Initialization vector |\n| Key Derivation | `security/protocols/key_derivation.ksy` | Key derivation |\n| Key Rotation | `security/protocols/key_rotation.ksy` | Key rotation |\n\n---\n\n## 11. References\n\n### Internal Documents\n- `docs/HAS/PMR/05-packet-formats.md` - PMR HAS Chapter 5\n- `docs/HAS/PMR/WORK.md` - PMR HAS Work Tracking\n- `.specify/memory/constitution.md` - Project Constitution\n\n### Datamodel Locations\n- `datamodel/protocols/ue/` - Ultra Ethernet protocols (94 .ksy files)\n- `datamodel/protocols/roce/` - RoCEv2 protocols (8 .ksy files)\n- `datamodel/protocols/ethernet/` - Standard Ethernet (6 .ksy files)\n- `datamodel/protocols/cornelis/` - Cornelis proprietary (9 .ksy files)\n- `datamodel/protocols/ualink/` - UALink protocols (38 .ksy files) - NOT supported by PMR\n- `datamodel/hw/asics/pmr/` - PMR ASIC definitions\n\n### External Specifications\n- [Ultra Ethernet Specification v1.0.1](https://ultraethernet.org/)\n- [InfiniBand Architecture Specification](https://www.infinibandta.org/)\n- IEEE 802.3 Ethernet Standard\n- UALink Specification (Ultra Accelerator Link)\n",
                "after": "# PMR (CN7000) Packet Format Taxonomy\n\n**Document**: Packet formats supported by PMR NIC ASIC  \n**Generated**: 2026-01-14  \n**Last Reviewed**: 2026-01-20  \n**Source**: `datamodel/` directory in EarlySim repository  \n**Reference**: `docs/HAS/PMR/05-packet-formats.md`\n\n---\n\n## Table of Contents\n\n1. [Overview](#1-overview)\n2. [Protocol Stack Summary](#2-protocol-stack-summary)\n3. [Ultra Ethernet+ (UE+) Formats](#3-ultra-ethernet-ue-formats)\n4. [RoCEv2 Formats](#4-rocev2-formats)\n5. [Standard Ethernet Formats](#5-standard-ethernet-formats)\n6. [Cornelis Proprietary Formats](#6-cornelis-proprietary-formats)\n7. [Host-Software Interface (HSI) Formats](#7-host-software-interface-hsi-formats)\n8. [IP Block Descriptors](#8-ip-block-descriptors)\n9. [Work List](#9-work-list)\n10. [UALink Protocol (Reference Only)](#10-ualink-protocol-reference-only)\n11. [References](#11-references)\n\n---\n\n## 1. Overview\n\nPMR (Prism River) is Cornelis Networks' 1.6 Tbps NIC ASIC (CN7000 product family). It supports multiple wire protocols with per-packet protocol selection on a single physical port.\n\n### Supported Protocols\n\n| Protocol | Version | Status | Description |\n|----------|---------|--------|-------------|\n| Ultra Ethernet+ | 1.0.1 | Full | Optimized UE with Cornelis extensions |\n| RoCEv2 | v2 | Full | RDMA over Converged Ethernet |\n| Standard Ethernet | IEEE 802.3 | Full | Traditional Ethernet with offloads |\n| Cornelis Proprietary | 1.0.0 | Full | UFH, CSIG+, VxLAN+, Collectives |\n\n### Header Efficiency Comparison\n\n| Protocol Stack | Total Headers | Efficiency (4KB payload) |\n|----------------|---------------|--------------------------|\n| UE+ (small msg) | ~20 bytes | 99.5% |\n| UE+ (standard) | ~40 bytes | 99.0% |\n| RoCEv2 (IPv4) | ~58 bytes | 98.6% |\n| RoCEv2 (IPv6) | ~78 bytes | 98.1% |\n\n---\n\n## 2. Protocol Stack Summary\n\n```\n+-----------------------------------------------------------------------------+\n|                           Application Layer                                  |\n|                    (Libfabric, Verbs, Sockets, DPDK)                         |\n+-----------------------------------------------------------------------------+\n|                           Transport Layer                                    |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UE Transport   |  |     RoCEv2       |  |    TCP/UDP       |            |\n|  |   (SES/PDS/CMS)  |  |   (BTH/RETH)     |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                           Network Layer                                      |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UFH-16/32      |  |   IPv4/IPv6      |  |   IPv4/IPv6      |            |\n|  |   (Cornelis)     |  |   + UDP          |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                            Link Layer                                        |\n|  +------------------+  +------------------+  +------------------+            |\n|  |      UE+         |  |   Ethernet II    |  |   Ethernet II    |            |\n|  |   (12 bytes)     |  |   (14 bytes)     |  |   (14 bytes)     |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                          Physical Layer                                      |\n|                    Hill Creek (212.5G x8 PAM4 SerDes)                        |\n+-----------------------------------------------------------------------------+\n      Ultra Ethernet+           RoCEv2              Standard Ethernet\n```\n\n---\n\n## 3. Ultra Ethernet+ (UE+) Formats\n\n### 3.1 UE+ L2 Header (12 bytes)\n\n**Datamodel**: `datamodel/protocols/cornelis/link/ue_plus.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Byte 2        | Byte 3        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n|L2|V|zyxm|Len  | Length[7:0]   | RC    | SC    | Hop Count     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 4        | Byte 5        | Byte 6        | Byte 7        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Dest LID [15:8]               | Dest LID [7:0]                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Entropy [15:8]                | Entropy [7:0]                 |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 8        | Byte 9        | Byte 10       | Byte 11       |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Source LID [15:8]             | Source LID [7:0]              |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Payload Type [15:8]           | Payload Type [7:0]            |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| L2 Type | 2 | Always 0b10 for UE+ |\n| Version | 1 | Protocol version |\n| zyxm | 4 | Routing control flags (multicast, adaptive) |\n| Length | 9 | Packet length in bytes |\n| RC | 4 | Routing Class (QoS) |\n| SC | 4 | Service Class |\n| Hop | 8 | TTL/hop count |\n| Dest LID | 16 | Destination Local Identifier |\n| Entropy | 16 | ECMP hash for load balancing |\n| Source LID | 16 | Source Local Identifier |\n| Type | 16 | Payload type (EtherType equivalent) |\n\n**Payload Types**:\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x0800 | IPv4 | IPv4 payload |\n| 0x86DD | IPv6 | IPv6 payload |\n| 0x8100 | VLAN | VLAN tagged frame |\n| 0x9000 | VxLAN+ | VxLAN+ encapsulated |\n| 0x9100 | CSIG+ | CSIG+ telemetry |\n| 0xC000 | UE PDS | Ultra Ethernet PDS |\n\n### 3.2 PDS (Packet Delivery Sublayer) Prologue (2 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/prologue.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0                        | Byte 1                        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| type[4:0] | next_hdr/ctl[3:0] | flags[6:0]                    |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| PDS Type | Value | Description |\n|----------|-------|-------------|\n| Reserved | 0 | Reserved |\n| TSS | 1 | Transport Security (encryption) |\n| RUD Request | 2 | Reliable Unordered Delivery |\n| ROD Request | 3 | Reliable Ordered Delivery |\n| RUDI Request | 4 | Reliable Unordered Immediate |\n| RUDI Response | 5 | RUDI response |\n| UUD Request | 6 | Unreliable Unordered Delivery |\n| ACK | 7 | Acknowledgment |\n| ACK_CC | 8 | ACK with congestion control |\n| ACK_CCX | 9 | ACK with extended CC |\n| NACK | 10 | Negative acknowledgment |\n| CP | 11 | Control packet |\n| NACK_CCX | 12 | NACK with extended CC |\n| RUD_CC_REQ | 13 | RUD with CC state |\n| ROD_CC_REQ | 14 | ROD with CC state |\n\n### 3.3 PDS Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/pds/`\n\n| Format | File | Size | Description |\n|--------|------|------|-------------|\n| RUD/ROD Request | `rud_rod_request.ksy` | Variable | Reliable delivery request |\n| RUD/ROD ACK | `rud_rod_ack.ksy` | Variable | Acknowledgment |\n| ACK_CC | `ack_cc.ksy` | Variable | ACK with CC state |\n| ACK_CCX | `ack_ccx.ksy` | Variable | ACK with extended CC |\n| NACK | `nack.ksy` | Variable | Negative acknowledgment |\n| NACK_CCX | `nack_ccx.ksy` | Variable | NACK with extended CC |\n| RUDI Request/Response | `rudi_request_response.ksy` | Variable | Low-latency immediate |\n| UUD Request | `uud_request.ksy` | Variable | Unreliable delivery |\n| Control Packet | `rud_rod_cp.ksy` | Variable | Control packet |\n| Entropy Header | `entropy_header.ksy` | Variable | Entropy extension |\n\n### 3.4 SES (Semantic Sublayer) Opcodes\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/opcodes.ksy`\n\n**Request Opcodes (Table 3-17)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Tagged Send | 0x00 | Send with tag matching |\n| RMA Write | 0x01 | Remote memory write |\n| RMA Read | 0x02 | Remote memory read |\n| Atomic Write | 0x03 | Atomic memory write |\n| Atomic Read | 0x04 | Atomic memory read |\n| Atomic CAS | 0x05 | Compare-and-swap |\n| Deferrable Send | 0x06 | Deferrable send |\n| Ready to Restart | 0x07 | Restart notification |\n| Small Message | 0x08 | Small message (32B header) |\n| Small RMA Write | 0x09 | Small RMA write |\n| Small RMA Read | 0x0A | Small RMA read |\n| Small Atomic Write | 0x0B | Small atomic write |\n| Small Atomic Read | 0x0C | Small atomic read |\n| Small Atomic CAS | 0x0D | Small atomic CAS |\n\n**Response Opcodes (Table 3-18)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Response | 0x00 | Standard response |\n| Response with Data | 0x01 | Response carrying data |\n| Optimized Response | 0x02 | Optimized format |\n| NACK | 0x03 | Negative acknowledgment |\n\n### 3.5 SES Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/ses/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Standard Request (SOM=1) | `standard_request_som1.ksy` | Start of message |\n| Standard Request (SOM=0) | `standard_request_som0.ksy` | Continuation |\n| Small Message | `small_message.ksy` | 32-byte header format |\n| Small RMA | `small_rma.ksy` | Small RMA operations |\n| Response | `response.ksy` | Standard response |\n| Response with Data | `response_with_data.ksy` | Data-carrying response |\n| Optimized Response | `optimized_response_with_data.ksy` | Optimized format |\n| Deferrable Send | `deferrable_send_request.ksy` | Deferrable operation |\n| Ready to Restart | `ready_to_restart.ksy` | Restart notification |\n| Rendezvous Extension | `rendezvous_extension.ksy` | Large message protocol |\n| Atomic Extension | `atomic_extension.ksy` | Atomic operations |\n| CAS Extension | `cas_extension.ksy` | Compare-and-swap |\n\n### 3.6 CMS (Congestion Management Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/cms/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Credit CP Payload | `credit_cp_payload.ksy` | Credit control packet |\n| Credit Request | `credit_request_cp_payload.ksy` | Credit request |\n| Request CC State | `req_cc_state.ksy` | Request CC state |\n| ACK CC State (NSCC) | `ack_cc_state_nscc.ksy` | NSCC algorithm state |\n| ACK CC State (RCCC/TFC) | `ack_cc_state_rccc_tfc.ksy` | RCCC/TFC state |\n\n### 3.7 TSS (Transport Security Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/tss/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Security Header | `security_header.ksy` | Encryption header |\n| IV Construction | `iv_construction.ksy` | Initialization vector |\n| Key Rotation | `protocols/key_rotation.ksy` | Key rotation protocol |\n| KDF Direct | `protocols/kdf_direct.ksy` | Direct key derivation |\n| KDF Client/Server | `protocols/kdf_client_server.ksy` | Client/server KDF |\n| KDF Cluster | `protocols/kdf_cluster.ksy` | Cluster KDF |\n| Join Secure Domain | `protocols/join_secure_domain.ksy` | Domain join |\n| TSS TX Processing | `protocols/tss_tx_processing.ksy` | Transmit processing |\n| TSS RX Processing | `protocols/tss_rx_processing.ksy` | Receive processing |\n\n### 3.8 Link Layer Formats\n\n#### LLR (Link-Level Retry)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/llr/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| LLR Preamble (64b66b) | `llr_preamble_64b66b.ksy` | 64b66b preamble |\n| LLR Preamble (MII) | `llr_preamble_mii.ksy` | MII preamble |\n| LLR Init CTLOS | `llr_init_ctlos.ksy` | Initialize LLR |\n| LLR Init Echo CTLOS | `llr_init_echo_ctlos.ksy` | Init acknowledgment |\n| LLR ACK CTLOS | `llr_ack_ctlos.ksy` | Frame acknowledgment |\n| LLR NACK CTLOS | `llr_nack_ctlos.ksy` | Retransmit request |\n\n#### CBFC (Credit-Based Flow Control)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/cbfc/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| CF Update | `cf_update.ksy` | Credit flow update |\n| CC Update | `cc_update.ksy` | Credit count update |\n| VC State Machine | `protocols/vc_state_machine.ksy` | Virtual channel FSM |\n| Lossless VC Init | `protocols/lossless_vc_init.ksy` | VC initialization |\n| Lossless VC Removal | `protocols/lossless_vc_removal.ksy` | VC teardown |\n\n#### LLDP Extensions\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/lldp/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| UE Link Negotiation TLV | `ue_link_negotiation_tlv.ksy` | Link negotiation |\n| UE CBFC TLV | `ue_cbfc_tlv.ksy` | CBFC parameters |\n\n---\n\n## 4. RoCEv2 Formats\n\n**Datamodel Directory**: `datamodel/protocols/roce/transport/`\n\n### 4.1 RoCEv2 Packet Structure\n\n```\n+-----------------------------------------------------------------------------+\n| Ethernet II Header (14 bytes)                                               |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2) = 0x0800/0x86DD            |\n+-----------------------------------------------------------------------------+\n| IP Header (20 bytes IPv4 / 40 bytes IPv6)                                   |\n|   Version, IHL, DSCP, ECN, Length, ID, Flags, TTL, Protocol=17, Checksum   |\n|   Source IP, Dest IP                                                        |\n+-----------------------------------------------------------------------------+\n| UDP Header (8 bytes)                                                        |\n|   Source Port (entropy) | Dest Port = 4791 | Length | Checksum             |\n+-----------------------------------------------------------------------------+\n| BTH - Base Transport Header (12 bytes)                                      |\n|   Opcode | Flags | P-Key | Dest QP | A | PSN                               |\n+-----------------------------------------------------------------------------+\n| Extended Headers (optional, operation-dependent)                            |\n|   RETH (16) | AETH (4) | AtomicETH (28) | ImmDt (4)                        |\n+-----------------------------------------------------------------------------+\n| Payload (0 - MTU bytes)                                                     |\n+-----------------------------------------------------------------------------+\n| ICRC (4 bytes)                                                              |\n+-----------------------------------------------------------------------------+\n```\n\n### 4.2 BTH (Base Transport Header) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/roce/transport/bth.ksy`\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| Opcode | 8 | Operation type (transport + operation) |\n| SE | 1 | Solicited Event |\n| M | 1 | Migration state |\n| Pad | 2 | Padding bytes (0-3) |\n| TVer | 4 | Transport version (must be 0) |\n| P-Key | 16 | Partition key |\n| Dest QP | 24 | Destination Queue Pair |\n| A | 1 | ACK request |\n| PSN | 24 | Packet Sequence Number |\n\n**Transport Types** (Opcode bits [7:5]):\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x00 | RC | Reliable Connection |\n| 0x20 | UC | Unreliable Connection |\n| 0x40 | RD | Reliable Datagram |\n| 0x60 | UD | Unreliable Datagram |\n\n**Operations** (Opcode bits [4:0]):\n| Value | Operation | Description |\n|-------|-----------|-------------|\n| 0x00 | SEND_FIRST | First send packet |\n| 0x01 | SEND_MIDDLE | Middle send packet |\n| 0x02 | SEND_LAST | Last send packet |\n| 0x03 | SEND_LAST_IMM | Last send with immediate |\n| 0x04 | SEND_ONLY | Single-packet send |\n| 0x05 | SEND_ONLY_IMM | Single send with immediate |\n| 0x06 | RDMA_WRITE_FIRST | First RDMA write |\n| 0x07 | RDMA_WRITE_MIDDLE | Middle RDMA write |\n| 0x08 | RDMA_WRITE_LAST | Last RDMA write |\n| 0x09 | RDMA_WRITE_LAST_IMM | Last write with immediate |\n| 0x0A | RDMA_WRITE_ONLY | Single-packet write |\n| 0x0B | RDMA_WRITE_ONLY_IMM | Single write with immediate |\n| 0x0C | RDMA_READ_REQUEST | Read request |\n| 0x0D | RDMA_READ_RESPONSE_FIRST | First read response |\n| 0x0E | RDMA_READ_RESPONSE_MIDDLE | Middle read response |\n| 0x0F | RDMA_READ_RESPONSE_LAST | Last read response |\n| 0x10 | RDMA_READ_RESPONSE_ONLY | Single read response |\n| 0x11 | ACK | Acknowledgment |\n| 0x12 | ATOMIC_ACK | Atomic acknowledgment |\n| 0x13 | CMP_SWAP | Compare and swap |\n| 0x14 | FETCH_ADD | Fetch and add |\n\n### 4.3 Extended Transport Headers\n\n| Header | File | Size | Description |\n|--------|------|------|-------------|\n| RETH | `reth.ksy` | 16 bytes | RDMA Extended Transport Header |\n| AETH | `aeth.ksy` | 4 bytes | ACK Extended Transport Header |\n| AtomicETH | `atomiceth.ksy` | 28 bytes | Atomic Extended Transport Header |\n| AtomicAckETH | `atomicacketh.ksy` | 8 bytes | Atomic ACK ETH |\n| DETH | `deth.ksy` | 8 bytes | Datagram Extended Transport Header |\n| ImmDt | `immdt.ksy` | 4 bytes | Immediate Data |\n| ICRC | `icrc.ksy` | 4 bytes | Invariant CRC |\n\n---\n\n## 5. Standard Ethernet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ethernet/`\n\n### 5.1 Ethernet II Frame\n\n**Datamodel**: `datamodel/protocols/ethernet/link/ethernet_ii.ksy`\n\n```\n+-----------------------------------------------------------------------------+\n| Preamble (7 bytes) + SFD (1 byte)  [not visible to software]               |\n+-----------------------------------------------------------------------------+\n| Ethernet Header (14 bytes)                                                  |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2)                            |\n+-----------------------------------------------------------------------------+\n| Optional VLAN Tag (4 bytes) - 802.1Q                                        |\n|   TPID (2) = 0x8100 | TCI (2) = PCP + DEI + VID                            |\n+-----------------------------------------------------------------------------+\n| Payload (46-1500 bytes, or up to 9000 for jumbo)                           |\n+-----------------------------------------------------------------------------+\n| FCS (4 bytes)                                                               |\n+-----------------------------------------------------------------------------+\n```\n\n### 5.2 Link Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| Ethernet II | `link/ethernet_ii.ksy` | Standard Ethernet frame |\n| VLAN 802.1Q | `link/vlan_802_1q.ksy` | VLAN tagging |\n\n### 5.3 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| IPv4 | `network/ipv4.ksy` | IPv4 header |\n| IPv6 | `network/ipv6.ksy` | IPv6 header |\n\n### 5.4 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| TCP | `transport/tcp.ksy` | TCP header |\n| UDP | `transport/udp.ksy` | UDP header |\n\n---\n\n## 6. Cornelis Proprietary Formats\n\n**Datamodel Directory**: `datamodel/protocols/cornelis/`\n\n### 6.1 Link Layer\n\n| Format | File | Size | Description |\n|--------|------|------|-------------|\n| UE+ Header | `link/ue_plus.ksy` | 12 bytes | Optimized L2 header |\n| Cornelis L2 Prefix | `link/cornelis_l2_prefix.ksy` | Variable | L2 prefix |\n\n### 6.2 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| UFH-16 | `network/ufh_16.ksy` | 16-bit forwarding header |\n| UFH-32 | `network/ufh_32.ksy` | 32-bit forwarding header |\n| Collective L2 | `network/collective_l2.ksy` | Collective operations header |\n| Scale-Up L2 | `network/scaleup_l2.ksy` | Scale-up deployments |\n\n#### 6.2.1 UFH-16 (Unified Forwarding Header 16-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_16.ksy`\n\nUFH-16 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 16-bit addressing.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |    Opaque (24-bit)    | Destination   |Opaque |Traffic|   Opaque      |    Source     |\n|[7:4]  |                       | (16-bit BE)   |[7:4]  |Class  |   (16-bit)    |  (16-bit BE)  |\n|SLAP   |                       |               |Z|Y|X|M|[7:0]  |               |               |\n|[3:0]  |                       |               |[3:0]  |       |               |               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1-3 | 24 | Opaque to hardware |\n| Destination | 4-5 | 16 | Destination endpoint address (big-endian) |\n| Opaque | 6 | [7:4] | Opaque to hardware |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Opaque | 8-9 | 16 | Opaque to hardware |\n| Source | 10-11 | 16 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-16 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5-14 | Reserved | Reserved for future use |\n| 15 | Extended | UFH-32 extension follows |\n\n**Usage**: Scale-up fabric forwarding, intra-pod communication, medium cluster networking (up to 65536 endpoints).\n\n#### 6.2.2 UFH-32 (Unified Forwarding Header 32-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_32.ksy`\n\nUFH-32 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 32-bit addressing for large-scale deployments.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |       |   Destination (32-bit BE)     |HopLim |Traffic|       Source (32-bit BE)      |\n|[7:4]  |Opaque |                               |[7:4]  |Class  |                               |\n|SLAP   |       |                               |Z|Y|X|M|[7:0]  |                               |\n|[3:0]  |       |                               |[3:0]  |       |                               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1 | [7:0] | Opaque to hardware |\n| Destination | 2-5 | 32 | Destination endpoint address (big-endian) |\n| Hop Limit | 6 | [7:4] | TTL/hop count |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Source | 8-11 | 32 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-32 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5 | Multicast | Multicast packet |\n| 6 | Barrier | Barrier synchronization |\n| 7 | Reduction | Reduction operation |\n| 8-14 | Reserved | Reserved for future use |\n| 15 | Vendor | Vendor-specific packet |\n\n**Usage**: Large-scale scale-up fabric forwarding (4+ billion endpoints), multi-pod communication, extended collective operations.\n\n### 6.3 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| CSIG+ | `transport/csig_plus.ksy` | Telemetry header |\n| PKEY | `transport/pkey.ksy` | Partition key |\n\n### 6.4 Encapsulation\n\n| Format | File | Description |\n|--------|------|-------------|\n| VxLAN+ | `encapsulation/vxlan_plus.ksy` | Extended VxLAN overlay |\n\n---\n\n## 7. Host-Software Interface (HSI) Formats\n\n**Datamodel Directory**: `datamodel/hw/asics/pmr/interfaces/host_interface/`\n\n### 7.1 Command Queue Segment (64 bytes)\n\n**Datamodel**: `command_queue_segment.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Bytes 2-3     | Bytes 4-7     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Opcode        | Flags         | Payload Len   | Reserved      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 8-15                    | Bytes 16-23                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Tag (64 bits)                 | Dest (64 bits)                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 24-31                   | Bytes 32-63                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Metadata (64 bits)            | Inline Data or SGL Entry      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n**Opcode Encoding**:\n| Bits | Field | Values |\n|------|-------|--------|\n| [7:4] | Family | MSG=0x1, TAGGED=0x2, RMA=0x3, ATOMIC=0x4 |\n| [3:2] | Variant | SEND=0, RECV=1, INJECT=2 |\n| [1] | Reserved | Must be 0 |\n| [0] | Data Source | INLINE=0, SGL=1 |\n\n### 7.2 Notification Formats\n\n| Format | File | Type | Size | Description |\n|--------|------|------|------|-------------|\n| Receive Notification | `receive_notification.ksy` | 0x00 | 64 bytes | Received message |\n| Send Completion | `send_completion.ksy` | 0x01 | 64 bytes | Send completed |\n| Event Notification | `event_notification.ksy` | 0x02 | 64 bytes | Async event |\n| Notification Entry | `notification_entry.ksy` | - | 64 bytes | Generic entry |\n| QW Violation Event | `qw_violation_event.ksy` | - | 64 bytes | QW alignment error |\n\n### 7.3 Receive Notification (64 bytes)\n\n**Datamodel**: `receive_notification.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x00 for receive |\n| flags | 1 | 1 | FI_INLINE, continuation |\n| status | 2 | 2 | Completion status |\n| src_id | 4 | 4 | Source endpoint ID |\n| tag | 8 | 8 | Tag value |\n| total_length | 16 | 4 | Payload length |\n| buffer_id_0 | 20 | 2 | First buffer ID |\n| buffer_id_1 | 22 | 2 | Second buffer ID |\n| buffer_offset | 24 | 2 | Offset in buffer |\n| reserved | 26 | 2 | Reserved |\n| inline_data | 28 | 35 | Inline payload |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.4 Send Completion (64 bytes)\n\n**Datamodel**: `send_completion.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x01 for send |\n| flags | 1 | 1 | Completion flags |\n| status | 2 | 2 | Completion status |\n| reserved_0 | 4 | 4 | Reserved |\n| op_context | 8 | 8 | Operation context |\n| bytes_sent | 16 | 4 | Bytes transferred |\n| reserved_1 | 20 | 43 | Reserved |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.5 Other HSI Formats\n\n| Format | File | Description |\n|--------|------|-------------|\n| SGL Entry | `sgl_entry.ksy` | Scatter-gather list entry |\n| PCIe Descriptors | `pcie/descriptors.ksy` | PCIe interface descriptors |\n\n---\n\n## 8. IP Block Descriptors\n\n**Datamodel Directory**: `datamodel/hw/ip/cornelis/`\n\n### 8.1 Collectives Engine (CE)\n\n**Datamodel**: `ce/descriptors.ksy`\n\nThe Collectives Engine uses RISC-V vector cores (VLEN=512) for hardware-accelerated collective operations.\n\n### 8.2 Electric Creek (EC)\n\n**Datamodel**: `ec/descriptors.ksy`\n\nElectric Creek is the management complex shared between PMR NIC and LNR Switch.\n\n---\n\n## 9. Work List\n\nThis section tracks issues requiring follow-up investigation or specification updates.\n\n### 9.1 Open Issues\n\n| ID | Priority | Category | Description | Status | Opened | Closed |\n|----|----------|----------|-------------|--------|--------|--------|\n| W-06-001 | Medium | Datamodel | UFH-32 lacks 16-bit entropy field; per-packet ECMP not supported; switch must derive entropy from Src+Dest hash | Deferred | 2026-01-20 | - |\n| W-07-001 | Low | Datamodel | `ack_cc.ksy` shows `ack_cc_state` as 32-bit (4 bytes) but UE Spec Table 3-36 shows 64-bit (8 bytes); verify field size | Investigation | 2026-01-22 | - |\n| W-07-002 | Low | Documentation | `collective_l2.ksy` and `scaleup_l2.ksy` marked as \"work_in_progress\" with spec_version 0.1; specifications incomplete | Spec Update | 2026-01-22 | - |\n| W-07-003 | Low | Datamodel | `ue_plus.ksy` 9-bit length field split across bytes 0-1 with unusual encoding (1 bit in byte 0, 8 bits in byte 1); verify encoding matches UE Spec | Investigation | 2026-01-22 | - |\n| W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |\n| W-05-002 | Medium | Specification | MTU values: Verify maximum MTU for each protocol | Investigation | 2026-01-10 | - |\n| W-05-003 | Medium | Documentation | CMS detailed formats: Need comprehensive documentation | Spec Update | 2026-01-10 | - |\n| W-03-002 | Low | Terminology | PDP vs PDS naming: UML uses both terms inconsistently | Spec Update | 2026-01-08 | - |\n| W-03-006 | Low | Terminology | SES vs SE: \"SES Processing Groups\" vs \"Semantic Engines\" | Spec Update | 2026-01-08 | - |\n\n### 9.2 Datamodel Gaps\n\n| ID | Priority | Description | Target Location | Status | Opened | Closed |\n|----|----------|-------------|-----------------|--------|--------|--------|\n| D-001 | High | PMR CSR definitions missing from datamodel | `datamodel/hw/asics/pmr/csrs/*.rdl` | Spec Update | 2026-01-10 | - |\n| D-002 | Medium | PMR block hierarchy YAML incomplete | `datamodel/hw/asics/pmr/blocks.yaml` | Spec Update | 2026-01-10 | - |\n| D-003 | Medium | PMR interface contracts missing | `datamodel/views/contracts/pmr-*.puml` | Spec Update | 2026-01-10 | - |\n\n### 9.3 Specification Clarifications Needed\n\n| ID | Priority | Question | Context | Status | Opened | Closed |\n|----|----------|----------|---------|--------|--------|--------|\n| Q1 | Medium | Lightweight Interface Scope | What features should be reduced in lightweight mode? | Investigation | 2026-01-10 | - |\n| Q2 | Medium | Tag Table Sizing | Should HW tag table size be per-endpoint configurable? | Investigation | 2026-01-10 | - |\n| Q3 | Medium | Multi-Packet Eager Messages | Should hardware support multi-packet eager messages? | Investigation | 2026-01-10 | - |\n| Q4 | Low | RoCE Work Queue Implementation | Confirm RoCE WQ/CQ are software-implemented | Investigation | 2026-01-10 | - |\n\n### 9.4 Closed Issues\n\n| ID | Priority | Category | Description | Resolution | Opened | Closed |\n|----|----------|----------|-------------|------------|--------|--------|\n| W-05-001 | Medium | Documentation | UE taxonomy reference | Documented in `05-packet-formats.md` | 2026-01-08 | 2026-01-10 |\n| W-02-005 | Medium | Documentation | Protocol support documentation | Documented UE+, RoCEv2, Ethernet | 2026-01-08 | 2026-01-10 |\n| W-02-006 | Medium | Documentation | Cornelis Collective Reduction Protocol | Documented in HAS §2.5.4 | 2026-01-08 | 2026-01-10 |\n| W-03-001 | Medium | Architecture | Semantic Engine count | Confirmed 64 (8x8) in UML and HAS | 2026-01-08 | 2026-01-10 |\n| W-17-005 | Low | Documentation | Port subdivision note | Added to HAS Ch17 | 2026-01-11 | 2026-01-11 |\n| W-17-006 | Medium | Documentation | MPORT interface documentation | Documented 256B @ 1.66 GHz | 2026-01-11 | 2026-01-11 |\n| W-04-005 | High | Datamodel | `ufh_16.ksy` address size: Datamodel shows 12-bit dest, should be 16-bit | UFH-16 restructured to 12-byte Ethernet MAC overlay with 16-bit destination (bytes 4-5) and 16-bit source (bytes 10-11) | 2026-01-10 | 2026-01-20 |\n| W-04-006 | High | Datamodel | `ufh_32.ksy` address size: Datamodel shows 16-bit dest, should be 32-bit | UFH-32 restructured to 12-byte Ethernet MAC overlay with 32-bit destination (bytes 2-5) and 32-bit source (bytes 8-11) | 2026-01-10 | 2026-01-20 |\n\n### 9.5 Change Log\n\n| Date | Change | Details |\n|------|--------|---------|\n| 2026-01-14 | Initial creation | Document created with PMR packet taxonomy |\n| 2026-01-20 | Review and update | Added UALink section (reference only, not PMR-supported); Added change log; Updated datamodel file counts; No new .ksy files since initial creation |\n| 2026-01-20 | UFH format details | Added detailed UFH-16 and UFH-32 format documentation in Section 6.2 (wire diagrams, field tables, type enumerations) |\n| 2026-01-20 | UFH restructuring | UFH-16 and UFH-32 restructured to 12-byte Ethernet MAC overlays; UFH-16 now 16-bit addressing, UFH-32 now 32-bit addressing; Added SLAP field constraints (Z,Y,X=001); Updated datamodel .ksy files; Closed W-04-005 and W-04-006 |\n| 2026-01-22 | Datamodel review | Added W-07-001 (ack_cc_state size mismatch), W-07-002 (collective/scaleup specs incomplete), W-07-003 (ue_plus length encoding); Identified 30+ packet formats requiring expansion |\n\n---\n\n## 10. UALink Protocol (Reference Only)\n\n**Note**: UALink is defined in the datamodel but is **NOT currently supported by PMR**. It is included here for reference as it may be relevant for future AI/ML accelerator interconnect work.\n\n**Datamodel Directory**: `datamodel/protocols/ualink/`\n\n### 10.1 UALink Overview\n\nUALink is an AI/ML accelerator interconnect protocol with 38 packet definitions across all OSI layers.\n\n| Layer | Count | Key Formats |\n|-------|-------|-------------|\n| UPLI (Upper Protocol Layer Interface) | 8 | commands.ksy, request_channel.ksy, status_codes.ksy |\n| Transaction | 9 | tl_flit.ksy, control_half_flit.ksy, data_half_flit.ksy |\n| Data Link | 12 | dl_flit.ksy, segment_header.ksy, crc.ksy, control_messages.ksy |\n| Physical | 4 | alignment_markers.ksy, control_ordered_sets.ksy, link_training.ksy |\n| Security | 5 | authentication.ksy, encryption.ksy, key_derivation.ksy |\n\n### 10.2 UALink Packet Formats\n\n#### UPLI Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Commands | `upli/commands.ksy` | UPLI command definitions |\n| Request Channel | `upli/request_channel.ksy` | Request channel format |\n| Originator Data | `upli/originator_data_channel.ksy` | Originator data channel |\n| Read Response | `upli/read_response_channel.ksy` | Read response channel |\n| Write Response | `upli/write_response_channel.ksy` | Write response channel |\n| Status Codes | `upli/status_codes.ksy` | Status code definitions |\n| Connection Handshake | `upli/protocols/connection_handshake.ksy` | Connection setup |\n| Flow Control | `upli/protocols/flow_control.ksy` | Flow control protocol |\n\n#### Transaction Layer\n| Format | File | Description |\n|--------|------|-------------|\n| TL Flit | `transaction/tl_flit.ksy` | Transaction layer flit |\n| Control Half Flit | `transaction/control_half_flit.ksy` | Control half flit |\n| Data Half Flit | `transaction/data_half_flit.ksy` | Data half flit |\n| Message Half Flit | `transaction/message_half_flit.ksy` | Message half flit |\n| Request Field | `transaction/request_field.ksy` | Request field format |\n| Response Field | `transaction/response_field.ksy` | Response field format |\n| Flow Control Field | `transaction/flow_control_field.ksy` | Flow control field |\n| Compression | `transaction/protocols/compression.ksy` | Data compression |\n| Address Cache | `transaction/protocols/address_cache.ksy` | Address caching |\n\n#### Data Link Layer\n| Format | File | Description |\n|--------|------|-------------|\n| DL Flit | `datalink/dl_flit.ksy` | Data link flit |\n| Flit Header | `datalink/flit_header.ksy` | Flit header format |\n| Segment Header | `datalink/segment_header.ksy` | Segment header |\n| CRC | `datalink/crc.ksy` | CRC calculation |\n| Control Messages | `datalink/messages/control_messages.ksy` | Control messages |\n| Basic Messages | `datalink/messages/basic_messages.ksy` | Basic messages |\n| UART Messages | `datalink/messages/uart_messages.ksy` | UART messages |\n| Vendor Defined | `datalink/messages/vendor_defined.ksy` | Vendor extensions |\n| Link Resiliency | `datalink/protocols/link_resiliency.ksy` | Link resiliency |\n| Link Level Replay | `datalink/protocols/link_level_replay.ksy` | Replay protocol |\n| Link State | `datalink/protocols/link_state.ksy` | Link state machine |\n| Link Folding | `datalink/protocols/link_folding.ksy` | Link folding |\n\n#### Physical Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Alignment Markers | `physical/alignment_markers.ksy` | Lane alignment |\n| Control Ordered Sets | `physical/control_ordered_sets.ksy` | Control sequences |\n| Reconciliation Sublayer | `physical/reconciliation_sublayer.ksy` | RS sublayer |\n| Link Training | `physical/protocols/link_training.ksy` | Link training |\n\n#### Security Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Authentication | `security/authentication.ksy` | Authentication |\n| Encryption | `security/encryption.ksy` | Encryption format |\n| IV Format | `security/iv_format.ksy` | Initialization vector |\n| Key Derivation | `security/protocols/key_derivation.ksy` | Key derivation |\n| Key Rotation | `security/protocols/key_rotation.ksy` | Key rotation |\n\n---\n\n## 11. References\n\n### Internal Documents\n- `docs/HAS/PMR/05-packet-formats.md` - PMR HAS Chapter 5\n- `docs/HAS/PMR/WORK.md` - PMR HAS Work Tracking\n- `.specify/memory/constitution.md` - Project Constitution\n\n### Datamodel Locations\n- `datamodel/protocols/ue/` - Ultra Ethernet protocols (94 .ksy files)\n- `datamodel/protocols/roce/` - RoCEv2 protocols (8 .ksy files)\n- `datamodel/protocols/ethernet/` - Standard Ethernet (6 .ksy files)\n- `datamodel/protocols/cornelis/` - Cornelis proprietary (9 .ksy files)\n- `datamodel/protocols/ualink/` - UALink protocols (38 .ksy files) - NOT supported by PMR\n- `datamodel/hw/asics/pmr/` - PMR ASIC definitions\n\n### External Specifications\n- [Ultra Ethernet Specification v1.0.1](https://ultraethernet.org/)\n- [InfiniBand Architecture Specification](https://www.infinibandta.org/)\n- IEEE 802.3 Ethernet Standard\n- UALink Specification (Ultra Accelerator Link)\n",
                "additions": 1,
                "deletions": 0
              },
              "truncated": false
            },
            "time": {
              "start": 1769122674239,
              "end": 1769122674297,
              "compacted": 1769125778418
            }
          }
        },
        {
          "id": "prt_be7edb67a001eX5Nzllr66xmoS",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7ed84f90014QZKiIGliEtKLG",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 117227,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7edb6a1001kCi0Wh2sjiTqUj",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769122674337,
          "completed": 1769122687844
        },
        "parentID": "msg_be7ed1928001lRyvx7zSrvkA3j",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 117236,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7edbb02001sOCIweqwSO17e2",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7edb6a1001kCi0Wh2sjiTqUj",
          "type": "step-start"
        },
        {
          "id": "prt_be7edeb1e001WJJ0hGFlPtSKiI",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7edb6a1001kCi0Wh2sjiTqUj",
          "type": "tool",
          "callID": "toolu_01A2FxhztvULL4UXsshtd6q2",
          "tool": "todowrite",
          "state": {
            "status": "completed",
            "input": {
              "todos": [
                {
                  "id": "1",
                  "content": "Identify packet formats not expanded in packet_taxonomy.md",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "2",
                  "content": "Read and analyze UE transport layer .ksy files (PDS, SES, CMS, TSS)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "3",
                  "content": "Read and analyze Cornelis proprietary .ksy files (CSIG+, VxLAN+, collective_l2, scaleup_l2)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "4",
                  "content": "Read and analyze RoCEv2 extended header .ksy files",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "5",
                  "content": "Read and analyze HSI .ksy files (event_notification, sgl_entry, etc.)",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "6",
                  "content": "Read and analyze UE link layer .ksy files (LLR, CBFC, LLDP)",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "7",
                  "content": "Compare datamodel against HAS specifications for discrepancies",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "8",
                  "content": "Draft expanded packet format sections for packet_taxonomy.md",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "9",
                  "content": "Identify new work items for discrepancies",
                  "status": "completed",
                  "priority": "high"
                }
              ]
            },
            "output": "[\n  {\n    \"id\": \"1\",\n    \"content\": \"Identify packet formats not expanded in packet_taxonomy.md\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"2\",\n    \"content\": \"Read and analyze UE transport layer .ksy files (PDS, SES, CMS, TSS)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"3\",\n    \"content\": \"Read and analyze Cornelis proprietary .ksy files (CSIG+, VxLAN+, collective_l2, scaleup_l2)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"4\",\n    \"content\": \"Read and analyze RoCEv2 extended header .ksy files\",\n    \"status\": \"completed\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"5\",\n    \"content\": \"Read and analyze HSI .ksy files (event_notification, sgl_entry, etc.)\",\n    \"status\": \"completed\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"6\",\n    \"content\": \"Read and analyze UE link layer .ksy files (LLR, CBFC, LLDP)\",\n    \"status\": \"completed\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"7\",\n    \"content\": \"Compare datamodel against HAS specifications for discrepancies\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"8\",\n    \"content\": \"Draft expanded packet format sections for packet_taxonomy.md\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"9\",\n    \"content\": \"Identify new work items for discrepancies\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  }\n]",
            "title": "0 todos",
            "metadata": {
              "todos": [
                {
                  "id": "1",
                  "content": "Identify packet formats not expanded in packet_taxonomy.md",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "2",
                  "content": "Read and analyze UE transport layer .ksy files (PDS, SES, CMS, TSS)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "3",
                  "content": "Read and analyze Cornelis proprietary .ksy files (CSIG+, VxLAN+, collective_l2, scaleup_l2)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "4",
                  "content": "Read and analyze RoCEv2 extended header .ksy files",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "5",
                  "content": "Read and analyze HSI .ksy files (event_notification, sgl_entry, etc.)",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "6",
                  "content": "Read and analyze UE link layer .ksy files (LLR, CBFC, LLDP)",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "7",
                  "content": "Compare datamodel against HAS specifications for discrepancies",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "8",
                  "content": "Draft expanded packet format sections for packet_taxonomy.md",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "9",
                  "content": "Identify new work items for discrepancies",
                  "status": "completed",
                  "priority": "high"
                }
              ],
              "truncated": false
            },
            "time": {
              "start": 1769122687777,
              "end": 1769122687832,
              "compacted": 1769125778417
            }
          }
        },
        {
          "id": "prt_be7edeb5a001JpE3h9SWiBYRE5",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7edb6a1001kCi0Wh2sjiTqUj",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 117236,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7edeb8e0011H3p4SK0RkeBXs",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769122687886,
          "completed": 1769122701052
        },
        "parentID": "msg_be7ed1928001lRyvx7zSrvkA3j",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 117703,
          "output": 280,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "stop"
      },
      "parts": [
        {
          "id": "prt_be7edefb9001mbvdJyXIPKLM6G",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7edeb8e0011H3p4SK0RkeBXs",
          "type": "step-start"
        },
        {
          "id": "prt_be7ee1ed00011R63yFQW44UjP7",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7edeb8e0011H3p4SK0RkeBXs",
          "type": "text",
          "text": "Done. I've added three new work items to the Open Issues section (9.1) of `analysis/packet_taxonomy.md`:\n\n| ID | Priority | Category | Description |\n|----|----------|----------|-------------|\n| **W-07-001** | Low | Datamodel | `ack_cc.ksy` shows `ack_cc_state` as 32-bit (4 bytes) but UE Spec Table 3-36 shows 64-bit (8 bytes); verify field size |\n| **W-07-002** | Low | Documentation | `collective_l2.ksy` and `scaleup_l2.ksy` marked as \"work_in_progress\" with spec_version 0.1; specifications incomplete |\n| **W-07-003** | Low | Datamodel | `ue_plus.ksy` 9-bit length field split across bytes 0-1 with unusual encoding (1 bit in byte 0, 8 bits in byte 1); verify encoding matches UE Spec |\n\nI also added a change log entry for 2026-01-22 documenting this review and noting that 30+ packet formats were identified as requiring expansion.",
          "time": {
            "start": 1769122701041,
            "end": 1769122701041
          }
        },
        {
          "id": "prt_be7ee1ef20012qmCEWljtXfYuN",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7edeb8e0011H3p4SK0RkeBXs",
          "type": "step-finish",
          "reason": "stop",
          "cost": 0,
          "tokens": {
            "input": 117703,
            "output": 280,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7f204b6001vdaO0SIm7P9H73",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "user",
        "time": {
          "created": 1769122956483
        },
        "summary": {
          "title": "Phase 1 planning for review\n\n",
          "diffs": []
        },
        "agent": "Planner-Sisyphus",
        "model": {
          "providerID": "cornelis",
          "modelID": "developer-opus"
        }
      },
      "parts": [
        {
          "id": "prt_be7f204b6002y8LepsX9eo5RsG",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7f204b6001vdaO0SIm7P9H73",
          "type": "text",
          "text": "Please plan out phase 1 for review"
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7f20530001PmGX62XRve0Rvv",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769122956592,
          "completed": 1769123003177
        },
        "parentID": "msg_be7f204b6001vdaO0SIm7P9H73",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Planner-Sisyphus",
        "agent": "Planner-Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 111734,
          "output": 2250,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "stop"
      },
      "parts": [
        {
          "id": "prt_be7f20cd6001yzRKhIkNl5pC17",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7f20530001PmGX62XRve0Rvv",
          "type": "step-start"
        },
        {
          "id": "prt_be7f2baf9001IPfmM3A35D69eW",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7f20530001PmGX62XRve0Rvv",
          "type": "text",
          "text": "## Phase 1 Plan: Expand PDS and SES Packet Formats\n\n### Objective\nAdd detailed wire diagrams and field tables for the highest-usage UE transport layer packet formats (PDS and SES) to `analysis/packet_taxonomy.md`.\n\n---\n\n### Scope\n\n#### PDS Formats to Expand (8 packets)\n\n| Format | Size | Priority | Rationale |\n|--------|------|----------|-----------|\n| RUD/ROD Request | 12 bytes | High | Primary reliable delivery request format |\n| RUD/ROD ACK | 12 bytes | High | Primary acknowledgment format |\n| ACK_CC | 28 bytes | High | Congestion control feedback (NSCC) |\n| ACK_CCX | 44 bytes | Medium | Extended CC state for future algorithms |\n| NACK | 12 bytes | High | Loss detection and retransmission |\n| NACK_CCX | 28 bytes | Medium | Extended NACK with CC state |\n| RUDI Request/Response | 6 bytes | Medium | Idempotent operations |\n| UUD Request | 6 bytes | Medium | Unreliable delivery |\n| Control Packet (CP) | 12 bytes | High | 10 subtypes for PDC management |\n\n#### SES Formats to Expand (8 packets)\n\n| Format | Size | Priority | Rationale |\n|--------|------|----------|-----------|\n| Standard Request (SOM=1) | 44 bytes | High | Primary request header format |\n| Standard Request (SOM=0) | 16 bytes | High | Continuation packets |\n| Small Message | 32 bytes | High | Single-packet optimized format |\n| Small RMA | 24 bytes | Medium | Single-packet RMA operations |\n| Response | 16 bytes | High | Basic response format |\n| Response with Data | 24 bytes | High | Read/atomic responses |\n| Atomic Extension | 8 bytes | Medium | Atomic operation parameters |\n| Rendezvous Extension | 32 bytes | Medium | Large message protocol |\n\n---\n\n### Deliverables\n\nFor each packet format, add to Section 3 (UE+ Formats):\n\n1. **Wire Diagram** - ASCII art showing byte-level layout\n2. **Field Table** - All fields with bits, description, constraints\n3. **Enumerations** - Any enum values (opcodes, types, flags)\n4. **Usage Notes** - When/how the format is used\n5. **Spec References** - UE Spec table/section/page\n\n---\n\n### Document Structure Changes\n\n```\n## 3. Ultra Ethernet+ (UE+) Formats\n   ### 3.1 UE+ L2 Header (existing)\n   ### 3.2 PDS Prologue (existing)\n   ### 3.3 PDS Packet Formats (existing table only)\n   \n   ### 3.3.1 RUD/ROD Request (12 bytes)        <-- NEW\n   ### 3.3.2 RUD/ROD ACK (12 bytes)            <-- NEW\n   ### 3.3.3 ACK_CC (28 bytes)                 <-- NEW\n   ### 3.3.4 ACK_CCX (44 bytes)                <-- NEW\n   ### 3.3.5 NACK (12 bytes)                   <-- NEW\n   ### 3.3.6 NACK_CCX (28 bytes)               <-- NEW\n   ### 3.3.7 RUDI Request/Response (6 bytes)   <-- NEW\n   ### 3.3.8 UUD Request (6 bytes)             <-- NEW\n   ### 3.3.9 Control Packet (12 bytes)         <-- NEW\n   \n   ### 3.4 SES Opcodes (existing)\n   ### 3.5 SES Packet Formats (existing table only)\n   \n   ### 3.5.1 Standard Request SOM=1 (44 bytes) <-- NEW\n   ### 3.5.2 Standard Request SOM=0 (16 bytes) <-- NEW\n   ### 3.5.3 Small Message (32 bytes)          <-- NEW\n   ### 3.5.4 Small RMA (24 bytes)              <-- NEW\n   ### 3.5.5 Response (16 bytes)               <-- NEW\n   ### 3.5.6 Response with Data (24 bytes)     <-- NEW\n   ### 3.5.7 Atomic Extension (8 bytes)        <-- NEW\n   ### 3.5.8 Rendezvous Extension (32 bytes)   <-- NEW\n```\n\n---\n\n### Example Output Format\n\nFor each packet, the expansion will follow this template:\n\n```markdown\n#### 3.3.1 RUD/ROD Request (12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_request.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Byte 2        | Byte 3        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n|type[4:0]|nxt[3:0]|  flags[6:0] | Clear PSN Offset [15:0]       |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 4        | Byte 5        | Byte 6        | Byte 7        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| PSN [31:24]   | PSN [23:16]   | PSN [15:8]    | PSN [7:0]     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 8        | Byte 9        | Byte 10       | Byte 11       |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Source PDCID [15:0]           | Dest PDCID / {pdc_info, psn_offset} |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| type | 5 | PDS type: 0x02=RUD, 0x03=ROD |\n| next_hdr | 4 | SES header type (Table 3-16) |\n| flags.rsvd | 2 | Reserved, must be 0 |\n| flags.retx | 1 | Retransmit indicator |\n| flags.ar | 1 | ACK request |\n| flags.syn | 1 | PDC establishment |\n| flags.rsvd | 2 | Reserved, must be 0 |\n| clear_psn_offset | 16 | CLEAR_PSN relative to PSN |\n| psn | 32 | Packet Sequence Number |\n| spdcid | 16 | Source PDCID |\n| dpdcid | 16 | Dest PDCID (or pdc_info+psn_offset when syn=1) |\n\n**Flags Detail**:\n- `retx`: Set when packet is a retransmission\n- `ar`: Request ACK generation at receiver\n- `syn`: PDC establishment request; changes interpretation of last 16 bits\n\n**Reference**: UE Spec v1.0.1, Table 3-33, Section 3.5.10.3, Page 256\n```\n\n---\n\n### Estimated Effort\n\n| Task | Packets | Est. Lines | Complexity |\n|------|---------|------------|------------|\n| PDS formats | 9 | ~600 | Medium (field overloading, flags) |\n| SES formats | 8 | ~700 | High (44-byte headers, many fields) |\n| Review/validation | - | - | Cross-check against .ksy files |\n| **Total** | **17** | **~1300** | |\n\n---\n\n### Dependencies\n\n1. **Source of Truth**: `.ksy` files in `earlysim/datamodel/protocols/ue/transport/`\n2. **Validation**: Cross-reference against UE Spec v1.0.1 (tables cited in .ksy metadata)\n3. **Existing Content**: Must integrate with current Section 3 structure\n\n---\n\n### Risks & Mitigations\n\n| Risk | Impact | Mitigation |\n|------|--------|------------|\n| .ksy files may have errors vs spec | Medium | Flag discrepancies as new work items |\n| Document becomes too long | Low | Consider splitting into sub-documents later |\n| Field overloading complexity | Medium | Use clear conditional documentation |\n\n---\n\n### Success Criteria\n\n1. All 17 packet formats have wire diagrams and field tables\n2. All fields match .ksy definitions\n3. Spec references (table, section, page) included for each\n4. Any discrepancies logged as work items\n5. Change log updated\n\n---\n\n### Questions for Review\n\n1. **Ordering**: Should packets be ordered by type value, frequency of use, or complexity?\n2. **Depth**: Should we include protocol behavior notes (e.g., state machine references) or keep strictly to format?\n3. **Cross-references**: Should each format link to related formats (e.g., Request → ACK)?\n\nPlease confirm this plan or provide feedback before I proceed with implementation.",
          "time": {
            "start": 1769123003170,
            "end": 1769123003170
          }
        },
        {
          "id": "prt_be7f2bb23001HHCF3DYL1n6vUa",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7f20530001PmGX62XRve0Rvv",
          "type": "step-finish",
          "reason": "stop",
          "cost": 0,
          "tokens": {
            "input": 111734,
            "output": 2250,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7f609d00013fuoorvrgw1xZ9",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "user",
        "time": {
          "created": 1769123219933
        },
        "summary": {
          "title": "Packet ordering, protocol notes, related formats linkage",
          "diffs": []
        },
        "agent": "Planner-Sisyphus",
        "model": {
          "providerID": "cornelis",
          "modelID": "developer-opus"
        }
      },
      "parts": [
        {
          "id": "prt_be7f609d00023MMcNpUkDCEIUu",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7f609d00013fuoorvrgw1xZ9",
          "type": "text",
          "text": "1. packets should be ordered by type value  2.  include protocol behavior notes 3. please link related formats"
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7f60a47001IjBIPoXjWTLPsZ",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769123220039,
          "completed": 1769123262440
        },
        "parentID": "msg_be7f609d00013fuoorvrgw1xZ9",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Planner-Sisyphus",
        "agent": "Planner-Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 61388,
          "output": 2601,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "stop"
      },
      "parts": [
        {
          "id": "prt_be7f60fa7001rJPSeqhNcxSK5U",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7f60a47001IjBIPoXjWTLPsZ",
          "type": "step-start"
        },
        {
          "id": "prt_be7f6afdb001Nps7kzklkTIPUn",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7f60a47001IjBIPoXjWTLPsZ",
          "type": "text",
          "text": "## Phase 1 Plan: Expand PDS and SES Packet Formats (Revised)\n\n### Confirmed Requirements\n\n| # | Requirement | Decision |\n|---|-------------|----------|\n| 1 | Packet ordering | By type value (ascending) |\n| 2 | Protocol behavior | Include state machine references, timing, usage context |\n| 3 | Cross-references | Link related formats (Request ↔ ACK, etc.) |\n\n---\n\n### Revised Document Structure\n\n#### PDS Formats (Section 3.3.x) - Ordered by Type Value\n\n| Type | Format | Size | Subsection |\n|------|--------|------|------------|\n| 0x00 | UUD Request | 6 bytes | 3.3.1 |\n| 0x01 | RUDI Request/Response | 6 bytes | 3.3.2 |\n| 0x02 | RUD Request | 12 bytes | 3.3.3 |\n| 0x03 | ROD Request | 12 bytes | 3.3.4 |\n| 0x04 | RUD/ROD Control Packet | 12 bytes | 3.3.5 |\n| 0x08 | ACK | 12 bytes | 3.3.6 |\n| 0x09 | ACK_CC | 28 bytes | 3.3.7 |\n| 0x0A | ACK_CCX | 44 bytes | 3.3.8 |\n| 0x0C | NACK | 12 bytes | 3.3.9 |\n| 0x0D | NACK_CCX | 28 bytes | 3.3.10 |\n\n#### SES Formats (Section 3.5.x) - Ordered by Table/Figure Number\n\n| Table/Figure | Format | Size | Subsection |\n|--------------|--------|------|------------|\n| Table 3-8 | Standard Request (SOM=1) | 44 bytes | 3.5.1 |\n| Table 3-9 | Standard Request (SOM=0) | 16 bytes | 3.5.2 |\n| Table 3-11 | Response | 16 bytes | 3.5.3 |\n| Table 3-12 | Response with Data | 24 bytes | 3.5.4 |\n| Figure 3-13 | Optimized Response with Data | 16 bytes | 3.5.5 |\n| Figure 3-14 | Small Message | 32 bytes | 3.5.6 |\n| Figure 3-15 | Rendezvous Extension | 32 bytes | 3.5.7 |\n| Figure 3-16 | Atomic Extension | 8 bytes | 3.5.8 |\n\n---\n\n### Enhanced Template with Protocol Behavior\n\n```markdown\n#### 3.3.3 RUD Request (Type 0x02, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_request.ksy`  \n**Related Formats**: [ACK (3.3.6)](#336-ack-type-0x08-12-bytes) | [NACK (3.3.9)](#339-nack-type-0x0c-12-bytes) | [Control Packet (3.3.5)](#335-rudrod-control-packet-type-0x04-12-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type|nxt|  flags  | clear_psn_offset  |         PSN [31:0]    →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x02 (RUD) | Must be 0x02 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| rsvd | 2 | 1[6:5] | Reserved | Must be 0 |\n| retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| ar | 1 | 1[3] | ACK request | 0=no ACK, 1=request ACK |\n| syn | 1 | 1[2] | PDC establishment | 0=normal, 1=SYN |\n| rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n| clear_psn_offset | 16 | 2-3 | CLEAR_PSN relative to PSN | Unsigned offset |\n| psn | 32 | 4-7 | Packet Sequence Number | 32-bit, wraps |\n| spdcid | 16 | 8-9 | Source PDCID | Valid PDCID |\n| dpdcid | 16 | 10-11 | Destination PDCID | See note below |\n\n##### Field Notes\n\n**dpdcid Interpretation** (depends on `syn` flag):\n- `syn=0`: Destination PDCID for established PDC\n- `syn=1`: `{pdc_info[7:0], psn_offset[7:0]}` for PDC establishment\n\n**clear_psn_offset**: Computed as `CLEAR_PSN = PSN - clear_psn_offset`. Indicates the highest PSN that has been delivered to SES at the source.\n\n##### Protocol Behavior\n\n**State Machine**: RUD operates within the PDC (Packet Delivery Channel) state machine defined in Section 3.5.7.\n\n**Transmission Rules**:\n1. Source assigns monotonically increasing PSN to each packet\n2. `ar` flag SHOULD be set periodically (per `ack_request_interval`)\n3. `retx` flag set when retransmitting due to timeout or NACK\n4. `syn` flag set only for first packet establishing new PDC\n\n**Receiver Processing**:\n1. Validate PDCID and PSN\n2. If PSN is expected: deliver to SES, advance expected PSN\n3. If PSN is duplicate: discard, optionally send ACK\n4. If PSN is out-of-order: buffer or discard per implementation\n5. If `ar=1`: generate ACK or ACK_CC response\n\n**Timing Constraints**:\n- Retransmit timeout: Implementation-defined (typically RTT-based)\n- ACK coalescing: Up to `ack_coalesce_count` packets\n\n**Reference**: UE Spec v1.0.1, Table 3-33, Section 3.5.10.3, Page 256\n```\n\n---\n\n### Cross-Reference Map\n\n```\nPDS Request/Response Relationships:\n┌─────────────────────────────────────────────────────────────────┐\n│                                                                 │\n│  UUD Request (0x00) ──────────────────────→ (no response)       │\n│                                                                 │\n│  RUDI Request (0x01) ─────────────────────→ RUDI Response (0x01)│\n│                                                                 │\n│  RUD Request (0x02) ──┬───────────────────→ ACK (0x08)          │\n│                       ├───────────────────→ ACK_CC (0x09)       │\n│                       ├───────────────────→ ACK_CCX (0x0A)      │\n│                       ├───────────────────→ NACK (0x0C)         │\n│                       └───────────────────→ NACK_CCX (0x0D)     │\n│                                                                 │\n│  ROD Request (0x03) ──┬───────────────────→ ACK (0x08)          │\n│                       ├───────────────────→ ACK_CC (0x09)       │\n│                       └───────────────────→ (same as RUD)       │\n│                                                                 │\n│  Control Packet (0x04) ───────────────────→ (varies by subtype) │\n│                                                                 │\n└─────────────────────────────────────────────────────────────────┘\n\nSES Request/Response Relationships:\n┌─────────────────────────────────────────────────────────────────┐\n│                                                                 │\n│  Standard Request ────┬───────────────────→ Response            │\n│  (SOM=1, 44B)         └───────────────────→ Response w/Data     │\n│       │                                                         │\n│       └──→ Continuation (SOM=0, 16B)                            │\n│                                                                 │\n│  Small Message (32B) ─────────────────────→ Response            │\n│                                                                 │\n│  + Atomic Extension (8B) ─────────────────→ Response w/Data     │\n│                                             (for fetching ops)  │\n│                                                                 │\n│  + Rendezvous Extension (32B) ────────────→ (target pulls data) │\n│                                                                 │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n---\n\n### Updated Effort Estimate\n\n| Task | Packets | Est. Lines | Notes |\n|------|---------|------------|-------|\n| PDS formats (with behavior) | 10 | ~900 | +50% for protocol notes |\n| SES formats (with behavior) | 8 | ~850 | +20% for protocol notes |\n| Cross-reference diagrams | 2 | ~60 | ASCII relationship maps |\n| Navigation links | - | ~40 | Markdown anchor links |\n| **Total** | **18** | **~1850** | |\n\n---\n\n### Implementation Order\n\n1. **PDS formats** (3.3.1 - 3.3.10) - Foundation layer\n2. **SES formats** (3.5.1 - 3.5.8) - Semantic layer\n3. **Cross-reference diagrams** - Add to section headers\n4. **Navigation links** - Add Related Formats to each subsection\n5. **Validation pass** - Verify against .ksy files\n6. **Update change log**\n\n---\n\n### Ready to Proceed?\n\nPlease confirm this revised plan and I will begin implementation with:\n1. PDS Type 0x00 (UUD Request) \n2. PDS Type 0x01 (RUDI Request/Response)\n3. Continue through all formats in type order",
          "time": {
            "start": 1769123262429,
            "end": 1769123262429
          }
        },
        {
          "id": "prt_be7f6afe1001xho6kiKNC62M9y",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7f60a47001IjBIPoXjWTLPsZ",
          "type": "step-finish",
          "reason": "stop",
          "cost": 0,
          "tokens": {
            "input": 61388,
            "output": 2601,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7faadd7001qnhXPM5tKghXUR",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "user",
        "time": {
          "created": 1769123524064
        },
        "summary": {
          "title": "Revised plan implementation",
          "diffs": []
        },
        "agent": "Sisyphus",
        "model": {
          "providerID": "cornelis",
          "modelID": "developer-opus"
        }
      },
      "parts": [
        {
          "id": "prt_be7faadd8001AA93D9vbTstQt1",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7faadd7001qnhXPM5tKghXUR",
          "type": "text",
          "text": "Please implement the revised plan"
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7faae5a001MYA2mEEIkVrZRU",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769123524186,
          "completed": 1769123538534
        },
        "parentID": "msg_be7faadd7001qnhXPM5tKghXUR",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 70399,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7fab543001FFhJajItA7hxsE",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7faae5a001MYA2mEEIkVrZRU",
          "type": "step-start"
        },
        {
          "id": "prt_be7fae6170014TXoQLwzvCgKXo",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7faae5a001MYA2mEEIkVrZRU",
          "type": "tool",
          "callID": "toolu_016DVnv28zpSptv4BAQXXEnY",
          "tool": "todowrite",
          "state": {
            "status": "completed",
            "input": {
              "todos": [
                {
                  "id": "p1-1",
                  "content": "Read current packet_taxonomy.md Section 3 structure",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "p1-2",
                  "content": "Expand PDS 3.3.1 UUD Request (Type 0x00)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-3",
                  "content": "Expand PDS 3.3.2 RUDI Request/Response (Type 0x01)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-4",
                  "content": "Expand PDS 3.3.3 RUD Request (Type 0x02)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-5",
                  "content": "Expand PDS 3.3.4 ROD Request (Type 0x03)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-6",
                  "content": "Expand PDS 3.3.5 Control Packet (Type 0x04)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-7",
                  "content": "Expand PDS 3.3.6 ACK (Type 0x08)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-8",
                  "content": "Expand PDS 3.3.7 ACK_CC (Type 0x09)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-9",
                  "content": "Expand PDS 3.3.8 ACK_CCX (Type 0x0A)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-10",
                  "content": "Expand PDS 3.3.9 NACK (Type 0x0C)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-11",
                  "content": "Expand PDS 3.3.10 NACK_CCX (Type 0x0D)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-12",
                  "content": "Expand SES 3.5.1 Standard Request SOM=1 (Table 3-8)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-13",
                  "content": "Expand SES 3.5.2 Standard Request SOM=0 (Table 3-9)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-14",
                  "content": "Expand SES 3.5.3 Response (Table 3-11)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-15",
                  "content": "Expand SES 3.5.4 Response with Data (Table 3-12)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-16",
                  "content": "Expand SES 3.5.5 Optimized Response with Data (Figure 3-13)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p1-17",
                  "content": "Expand SES 3.5.6 Small Message (Figure 3-14)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-18",
                  "content": "Expand SES 3.5.7 Rendezvous Extension (Figure 3-15)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p1-19",
                  "content": "Expand SES 3.5.8 Atomic Extension (Figure 3-16)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p1-20",
                  "content": "Add cross-reference diagrams to section headers",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p1-21",
                  "content": "Validation pass against .ksy files",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-22",
                  "content": "Update change log",
                  "status": "pending",
                  "priority": "medium"
                }
              ]
            },
            "output": "[\n  {\n    \"id\": \"p1-1\",\n    \"content\": \"Read current packet_taxonomy.md Section 3 structure\",\n    \"status\": \"in_progress\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-2\",\n    \"content\": \"Expand PDS 3.3.1 UUD Request (Type 0x00)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-3\",\n    \"content\": \"Expand PDS 3.3.2 RUDI Request/Response (Type 0x01)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-4\",\n    \"content\": \"Expand PDS 3.3.3 RUD Request (Type 0x02)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-5\",\n    \"content\": \"Expand PDS 3.3.4 ROD Request (Type 0x03)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-6\",\n    \"content\": \"Expand PDS 3.3.5 Control Packet (Type 0x04)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-7\",\n    \"content\": \"Expand PDS 3.3.6 ACK (Type 0x08)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-8\",\n    \"content\": \"Expand PDS 3.3.7 ACK_CC (Type 0x09)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-9\",\n    \"content\": \"Expand PDS 3.3.8 ACK_CCX (Type 0x0A)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-10\",\n    \"content\": \"Expand PDS 3.3.9 NACK (Type 0x0C)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-11\",\n    \"content\": \"Expand PDS 3.3.10 NACK_CCX (Type 0x0D)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-12\",\n    \"content\": \"Expand SES 3.5.1 Standard Request SOM=1 (Table 3-8)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-13\",\n    \"content\": \"Expand SES 3.5.2 Standard Request SOM=0 (Table 3-9)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-14\",\n    \"content\": \"Expand SES 3.5.3 Response (Table 3-11)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-15\",\n    \"content\": \"Expand SES 3.5.4 Response with Data (Table 3-12)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-16\",\n    \"content\": \"Expand SES 3.5.5 Optimized Response with Data (Figure 3-13)\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p1-17\",\n    \"content\": \"Expand SES 3.5.6 Small Message (Figure 3-14)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-18\",\n    \"content\": \"Expand SES 3.5.7 Rendezvous Extension (Figure 3-15)\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p1-19\",\n    \"content\": \"Expand SES 3.5.8 Atomic Extension (Figure 3-16)\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p1-20\",\n    \"content\": \"Add cross-reference diagrams to section headers\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p1-21\",\n    \"content\": \"Validation pass against .ksy files\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-22\",\n    \"content\": \"Update change log\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  }\n]",
            "title": "22 todos",
            "metadata": {
              "todos": [
                {
                  "id": "p1-1",
                  "content": "Read current packet_taxonomy.md Section 3 structure",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "p1-2",
                  "content": "Expand PDS 3.3.1 UUD Request (Type 0x00)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-3",
                  "content": "Expand PDS 3.3.2 RUDI Request/Response (Type 0x01)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-4",
                  "content": "Expand PDS 3.3.3 RUD Request (Type 0x02)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-5",
                  "content": "Expand PDS 3.3.4 ROD Request (Type 0x03)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-6",
                  "content": "Expand PDS 3.3.5 Control Packet (Type 0x04)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-7",
                  "content": "Expand PDS 3.3.6 ACK (Type 0x08)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-8",
                  "content": "Expand PDS 3.3.7 ACK_CC (Type 0x09)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-9",
                  "content": "Expand PDS 3.3.8 ACK_CCX (Type 0x0A)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-10",
                  "content": "Expand PDS 3.3.9 NACK (Type 0x0C)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-11",
                  "content": "Expand PDS 3.3.10 NACK_CCX (Type 0x0D)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-12",
                  "content": "Expand SES 3.5.1 Standard Request SOM=1 (Table 3-8)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-13",
                  "content": "Expand SES 3.5.2 Standard Request SOM=0 (Table 3-9)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-14",
                  "content": "Expand SES 3.5.3 Response (Table 3-11)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-15",
                  "content": "Expand SES 3.5.4 Response with Data (Table 3-12)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-16",
                  "content": "Expand SES 3.5.5 Optimized Response with Data (Figure 3-13)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p1-17",
                  "content": "Expand SES 3.5.6 Small Message (Figure 3-14)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-18",
                  "content": "Expand SES 3.5.7 Rendezvous Extension (Figure 3-15)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p1-19",
                  "content": "Expand SES 3.5.8 Atomic Extension (Figure 3-16)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p1-20",
                  "content": "Add cross-reference diagrams to section headers",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p1-21",
                  "content": "Validation pass against .ksy files",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-22",
                  "content": "Update change log",
                  "status": "pending",
                  "priority": "medium"
                }
              ],
              "truncated": false
            },
            "time": {
              "start": 1769123538460,
              "end": 1769123538521,
              "compacted": 1769125778417
            }
          }
        },
        {
          "id": "prt_be7fae65b001iLGl86jKUR1N4K",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7faae5a001MYA2mEEIkVrZRU",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 70399,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7fae6970012gqMUi1dnRHDh5",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769123538583,
          "completed": 1769123544040
        },
        "parentID": "msg_be7faadd7001qnhXPM5tKghXUR",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 71406,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7faeafd001Rq8eIbu9Iy72vh",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fae6970012gqMUi1dnRHDh5",
          "type": "step-start"
        },
        {
          "id": "prt_be7fafbab001GvS7LRNo83TEzF",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fae6970012gqMUi1dnRHDh5",
          "type": "tool",
          "callID": "toolu_01YcEqrdSg4VzksVMcrDQZ1P",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
              "offset": 0,
              "limit": 150
            },
            "output": "<file>\n00001| # PMR (CN7000) Packet Format Taxonomy\n00002| \n00003| **Document**: Packet formats supported by PMR NIC ASIC  \n00004| **Generated**: 2026-01-14  \n00005| **Last Reviewed**: 2026-01-20  \n00006| **Source**: `datamodel/` directory in EarlySim repository  \n00007| **Reference**: `docs/HAS/PMR/05-packet-formats.md`\n00008| \n00009| ---\n00010| \n00011| ## Table of Contents\n00012| \n00013| 1. [Overview](#1-overview)\n00014| 2. [Protocol Stack Summary](#2-protocol-stack-summary)\n00015| 3. [Ultra Ethernet+ (UE+) Formats](#3-ultra-ethernet-ue-formats)\n00016| 4. [RoCEv2 Formats](#4-rocev2-formats)\n00017| 5. [Standard Ethernet Formats](#5-standard-ethernet-formats)\n00018| 6. [Cornelis Proprietary Formats](#6-cornelis-proprietary-formats)\n00019| 7. [Host-Software Interface (HSI) Formats](#7-host-software-interface-hsi-formats)\n00020| 8. [IP Block Descriptors](#8-ip-block-descriptors)\n00021| 9. [Work List](#9-work-list)\n00022| 10. [UALink Protocol (Reference Only)](#10-ualink-protocol-reference-only)\n00023| 11. [References](#11-references)\n00024| \n00025| ---\n00026| \n00027| ## 1. Overview\n00028| \n00029| PMR (Prism River) is Cornelis Networks' 1.6 Tbps NIC ASIC (CN7000 product family). It supports multiple wire protocols with per-packet protocol selection on a single physical port.\n00030| \n00031| ### Supported Protocols\n00032| \n00033| | Protocol | Version | Status | Description |\n00034| |----------|---------|--------|-------------|\n00035| | Ultra Ethernet+ | 1.0.1 | Full | Optimized UE with Cornelis extensions |\n00036| | RoCEv2 | v2 | Full | RDMA over Converged Ethernet |\n00037| | Standard Ethernet | IEEE 802.3 | Full | Traditional Ethernet with offloads |\n00038| | Cornelis Proprietary | 1.0.0 | Full | UFH, CSIG+, VxLAN+, Collectives |\n00039| \n00040| ### Header Efficiency Comparison\n00041| \n00042| | Protocol Stack | Total Headers | Efficiency (4KB payload) |\n00043| |----------------|---------------|--------------------------|\n00044| | UE+ (small msg) | ~20 bytes | 99.5% |\n00045| | UE+ (standard) | ~40 bytes | 99.0% |\n00046| | RoCEv2 (IPv4) | ~58 bytes | 98.6% |\n00047| | RoCEv2 (IPv6) | ~78 bytes | 98.1% |\n00048| \n00049| ---\n00050| \n00051| ## 2. Protocol Stack Summary\n00052| \n00053| ```\n00054| +-----------------------------------------------------------------------------+\n00055| |                           Application Layer                                  |\n00056| |                    (Libfabric, Verbs, Sockets, DPDK)                         |\n00057| +-----------------------------------------------------------------------------+\n00058| |                           Transport Layer                                    |\n00059| |  +------------------+  +------------------+  +------------------+            |\n00060| |  |   UE Transport   |  |     RoCEv2       |  |    TCP/UDP       |            |\n00061| |  |   (SES/PDS/CMS)  |  |   (BTH/RETH)     |  |                  |            |\n00062| |  +------------------+  +------------------+  +------------------+            |\n00063| +-----------------------------------------------------------------------------+\n00064| |                           Network Layer                                      |\n00065| |  +------------------+  +------------------+  +------------------+            |\n00066| |  |   UFH-16/32      |  |   IPv4/IPv6      |  |   IPv4/IPv6      |            |\n00067| |  |   (Cornelis)     |  |   + UDP          |  |                  |            |\n00068| |  +------------------+  +------------------+  +------------------+            |\n00069| +-----------------------------------------------------------------------------+\n00070| |                            Link Layer                                        |\n00071| |  +------------------+  +------------------+  +------------------+            |\n00072| |  |      UE+         |  |   Ethernet II    |  |   Ethernet II    |            |\n00073| |  |   (12 bytes)     |  |   (14 bytes)     |  |   (14 bytes)     |            |\n00074| |  +------------------+  +------------------+  +------------------+            |\n00075| +-----------------------------------------------------------------------------+\n00076| |                          Physical Layer                                      |\n00077| |                    Hill Creek (212.5G x8 PAM4 SerDes)                        |\n00078| +-----------------------------------------------------------------------------+\n00079|       Ultra Ethernet+           RoCEv2              Standard Ethernet\n00080| ```\n00081| \n00082| ---\n00083| \n00084| ## 3. Ultra Ethernet+ (UE+) Formats\n00085| \n00086| ### 3.1 UE+ L2 Header (12 bytes)\n00087| \n00088| **Datamodel**: `datamodel/protocols/cornelis/link/ue_plus.ksy`\n00089| \n00090| ```\n00091| +-------+-------+-------+-------+-------+-------+-------+-------+\n00092| | Byte 0        | Byte 1        | Byte 2        | Byte 3        |\n00093| +-------+-------+-------+-------+-------+-------+-------+-------+\n00094| |L2|V|zyxm|Len  | Length[7:0]   | RC    | SC    | Hop Count     |\n00095| +-------+-------+-------+-------+-------+-------+-------+-------+\n00096| | Byte 4        | Byte 5        | Byte 6        | Byte 7        |\n00097| +-------+-------+-------+-------+-------+-------+-------+-------+\n00098| | Dest LID [15:8]               | Dest LID [7:0]                |\n00099| +-------+-------+-------+-------+-------+-------+-------+-------+\n00100| | Entropy [15:8]                | Entropy [7:0]                 |\n00101| +-------+-------+-------+-------+-------+-------+-------+-------+\n00102| | Byte 8        | Byte 9        | Byte 10       | Byte 11       |\n00103| +-------+-------+-------+-------+-------+-------+-------+-------+\n00104| | Source LID [15:8]             | Source LID [7:0]              |\n00105| +-------+-------+-------+-------+-------+-------+-------+-------+\n00106| | Payload Type [15:8]           | Payload Type [7:0]            |\n00107| +-------+-------+-------+-------+-------+-------+-------+-------+\n00108| ```\n00109| \n00110| | Field | Bits | Description |\n00111| |-------|------|-------------|\n00112| | L2 Type | 2 | Always 0b10 for UE+ |\n00113| | Version | 1 | Protocol version |\n00114| | zyxm | 4 | Routing control flags (multicast, adaptive) |\n00115| | Length | 9 | Packet length in bytes |\n00116| | RC | 4 | Routing Class (QoS) |\n00117| | SC | 4 | Service Class |\n00118| | Hop | 8 | TTL/hop count |\n00119| | Dest LID | 16 | Destination Local Identifier |\n00120| | Entropy | 16 | ECMP hash for load balancing |\n00121| | Source LID | 16 | Source Local Identifier |\n00122| | Type | 16 | Payload type (EtherType equivalent) |\n00123| \n00124| **Payload Types**:\n00125| | Value | Type | Description |\n00126| |-------|------|-------------|\n00127| | 0x0800 | IPv4 | IPv4 payload |\n00128| | 0x86DD | IPv6 | IPv6 payload |\n00129| | 0x8100 | VLAN | VLAN tagged frame |\n00130| | 0x9000 | VxLAN+ | VxLAN+ encapsulated |\n00131| | 0x9100 | CSIG+ | CSIG+ telemetry |\n00132| | 0xC000 | UE PDS | Ultra Ethernet PDS |\n00133| \n00134| ### 3.2 PDS (Packet Delivery Sublayer) Prologue (2 bytes)\n00135| \n00136| **Datamodel**: `datamodel/protocols/ue/transport/pds/prologue.ksy`\n00137| \n00138| ```\n00139| +-------+-------+-------+-------+-------+-------+-------+-------+\n00140| | Byte 0                        | Byte 1                        |\n00141| +-------+-------+-------+-------+-------+-------+-------+-------+\n00142| | type[4:0] | next_hdr/ctl[3:0] | flags[6:0]                    |\n00143| +-------+-------+-------+-------+-------+-------+-------+-------+\n00144| ```\n00145| \n00146| | PDS Type | Value | Description |\n00147| |----------|-------|-------------|\n00148| | Reserved | 0 | Reserved |\n00149| | TSS | 1 | Transport Security (encryption) |\n00150| | RUD Request | 2 | Reliable Unordered Delivery |\n\n(File has more lines. Use 'offset' parameter to read beyond line 150)\n</file>",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy.md",
            "metadata": {
              "preview": "# PMR (CN7000) Packet Format Taxonomy\n\n**Document**: Packet formats supported by PMR NIC ASIC  \n**Generated**: 2026-01-14  \n**Last Reviewed**: 2026-01-20  \n**Source**: `datamodel/` directory in EarlySim repository  \n**Reference**: `docs/HAS/PMR/05-packet-formats.md`\n\n---\n\n## Table of Contents\n\n1. [Overview](#1-overview)\n2. [Protocol Stack Summary](#2-protocol-stack-summary)\n3. [Ultra Ethernet+ (UE+) Formats](#3-ultra-ethernet-ue-formats)\n4. [RoCEv2 Formats](#4-rocev2-formats)\n5. [Standard Ethernet Formats](#5-standard-ethernet-formats)\n6. [Cornelis Proprietary Formats](#6-cornelis-proprietary-formats)\n7. [Host-Software Interface (HSI) Formats](#7-host-software-interface-hsi-formats)\n8. [IP Block Descriptors](#8-ip-block-descriptors)",
              "truncated": true
            },
            "time": {
              "start": 1769123543982,
              "end": 1769123544031,
              "compacted": 1769125778416
            }
          }
        },
        {
          "id": "prt_be7fafbe1001iDqBGDAtTUtBi7",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fae6970012gqMUi1dnRHDh5",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 71406,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7fafc18001kiIKA3s2S8uO6V",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769123544088,
          "completed": 1769123548894
        },
        "parentID": "msg_be7faadd7001qnhXPM5tKghXUR",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 74013,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7fb001c001seLzjj1T3kx2JF",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fafc18001kiIKA3s2S8uO6V",
          "type": "step-start"
        },
        {
          "id": "prt_be7fb0ea3001zrZIkYly12zZc3",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fafc18001kiIKA3s2S8uO6V",
          "type": "tool",
          "callID": "toolu_01DKzXjN2TUHYcxfD6y5Mc85",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
              "offset": 150,
              "limit": 150
            },
            "output": "<file>\n00151| | ROD Request | 3 | Reliable Ordered Delivery |\n00152| | RUDI Request | 4 | Reliable Unordered Immediate |\n00153| | RUDI Response | 5 | RUDI response |\n00154| | UUD Request | 6 | Unreliable Unordered Delivery |\n00155| | ACK | 7 | Acknowledgment |\n00156| | ACK_CC | 8 | ACK with congestion control |\n00157| | ACK_CCX | 9 | ACK with extended CC |\n00158| | NACK | 10 | Negative acknowledgment |\n00159| | CP | 11 | Control packet |\n00160| | NACK_CCX | 12 | NACK with extended CC |\n00161| | RUD_CC_REQ | 13 | RUD with CC state |\n00162| | ROD_CC_REQ | 14 | ROD with CC state |\n00163| \n00164| ### 3.3 PDS Packet Formats\n00165| \n00166| **Datamodel Directory**: `datamodel/protocols/ue/transport/pds/`\n00167| \n00168| | Format | File | Size | Description |\n00169| |--------|------|------|-------------|\n00170| | RUD/ROD Request | `rud_rod_request.ksy` | Variable | Reliable delivery request |\n00171| | RUD/ROD ACK | `rud_rod_ack.ksy` | Variable | Acknowledgment |\n00172| | ACK_CC | `ack_cc.ksy` | Variable | ACK with CC state |\n00173| | ACK_CCX | `ack_ccx.ksy` | Variable | ACK with extended CC |\n00174| | NACK | `nack.ksy` | Variable | Negative acknowledgment |\n00175| | NACK_CCX | `nack_ccx.ksy` | Variable | NACK with extended CC |\n00176| | RUDI Request/Response | `rudi_request_response.ksy` | Variable | Low-latency immediate |\n00177| | UUD Request | `uud_request.ksy` | Variable | Unreliable delivery |\n00178| | Control Packet | `rud_rod_cp.ksy` | Variable | Control packet |\n00179| | Entropy Header | `entropy_header.ksy` | Variable | Entropy extension |\n00180| \n00181| ### 3.4 SES (Semantic Sublayer) Opcodes\n00182| \n00183| **Datamodel**: `datamodel/protocols/ue/transport/ses/opcodes.ksy`\n00184| \n00185| **Request Opcodes (Table 3-17)**:\n00186| \n00187| | Opcode | Value | Description |\n00188| |--------|-------|-------------|\n00189| | Tagged Send | 0x00 | Send with tag matching |\n00190| | RMA Write | 0x01 | Remote memory write |\n00191| | RMA Read | 0x02 | Remote memory read |\n00192| | Atomic Write | 0x03 | Atomic memory write |\n00193| | Atomic Read | 0x04 | Atomic memory read |\n00194| | Atomic CAS | 0x05 | Compare-and-swap |\n00195| | Deferrable Send | 0x06 | Deferrable send |\n00196| | Ready to Restart | 0x07 | Restart notification |\n00197| | Small Message | 0x08 | Small message (32B header) |\n00198| | Small RMA Write | 0x09 | Small RMA write |\n00199| | Small RMA Read | 0x0A | Small RMA read |\n00200| | Small Atomic Write | 0x0B | Small atomic write |\n00201| | Small Atomic Read | 0x0C | Small atomic read |\n00202| | Small Atomic CAS | 0x0D | Small atomic CAS |\n00203| \n00204| **Response Opcodes (Table 3-18)**:\n00205| \n00206| | Opcode | Value | Description |\n00207| |--------|-------|-------------|\n00208| | Response | 0x00 | Standard response |\n00209| | Response with Data | 0x01 | Response carrying data |\n00210| | Optimized Response | 0x02 | Optimized format |\n00211| | NACK | 0x03 | Negative acknowledgment |\n00212| \n00213| ### 3.5 SES Packet Formats\n00214| \n00215| **Datamodel Directory**: `datamodel/protocols/ue/transport/ses/`\n00216| \n00217| | Format | File | Description |\n00218| |--------|------|-------------|\n00219| | Standard Request (SOM=1) | `standard_request_som1.ksy` | Start of message |\n00220| | Standard Request (SOM=0) | `standard_request_som0.ksy` | Continuation |\n00221| | Small Message | `small_message.ksy` | 32-byte header format |\n00222| | Small RMA | `small_rma.ksy` | Small RMA operations |\n00223| | Response | `response.ksy` | Standard response |\n00224| | Response with Data | `response_with_data.ksy` | Data-carrying response |\n00225| | Optimized Response | `optimized_response_with_data.ksy` | Optimized format |\n00226| | Deferrable Send | `deferrable_send_request.ksy` | Deferrable operation |\n00227| | Ready to Restart | `ready_to_restart.ksy` | Restart notification |\n00228| | Rendezvous Extension | `rendezvous_extension.ksy` | Large message protocol |\n00229| | Atomic Extension | `atomic_extension.ksy` | Atomic operations |\n00230| | CAS Extension | `cas_extension.ksy` | Compare-and-swap |\n00231| \n00232| ### 3.6 CMS (Congestion Management Sublayer)\n00233| \n00234| **Datamodel Directory**: `datamodel/protocols/ue/transport/cms/`\n00235| \n00236| | Format | File | Description |\n00237| |--------|------|-------------|\n00238| | Credit CP Payload | `credit_cp_payload.ksy` | Credit control packet |\n00239| | Credit Request | `credit_request_cp_payload.ksy` | Credit request |\n00240| | Request CC State | `req_cc_state.ksy` | Request CC state |\n00241| | ACK CC State (NSCC) | `ack_cc_state_nscc.ksy` | NSCC algorithm state |\n00242| | ACK CC State (RCCC/TFC) | `ack_cc_state_rccc_tfc.ksy` | RCCC/TFC state |\n00243| \n00244| ### 3.7 TSS (Transport Security Sublayer)\n00245| \n00246| **Datamodel Directory**: `datamodel/protocols/ue/transport/tss/`\n00247| \n00248| | Format | File | Description |\n00249| |--------|------|-------------|\n00250| | Security Header | `security_header.ksy` | Encryption header |\n00251| | IV Construction | `iv_construction.ksy` | Initialization vector |\n00252| | Key Rotation | `protocols/key_rotation.ksy` | Key rotation protocol |\n00253| | KDF Direct | `protocols/kdf_direct.ksy` | Direct key derivation |\n00254| | KDF Client/Server | `protocols/kdf_client_server.ksy` | Client/server KDF |\n00255| | KDF Cluster | `protocols/kdf_cluster.ksy` | Cluster KDF |\n00256| | Join Secure Domain | `protocols/join_secure_domain.ksy` | Domain join |\n00257| | TSS TX Processing | `protocols/tss_tx_processing.ksy` | Transmit processing |\n00258| | TSS RX Processing | `protocols/tss_rx_processing.ksy` | Receive processing |\n00259| \n00260| ### 3.8 Link Layer Formats\n00261| \n00262| #### LLR (Link-Level Retry)\n00263| \n00264| **Datamodel Directory**: `datamodel/protocols/ue/link/llr/`\n00265| \n00266| | Format | File | Description |\n00267| |--------|------|-------------|\n00268| | LLR Preamble (64b66b) | `llr_preamble_64b66b.ksy` | 64b66b preamble |\n00269| | LLR Preamble (MII) | `llr_preamble_mii.ksy` | MII preamble |\n00270| | LLR Init CTLOS | `llr_init_ctlos.ksy` | Initialize LLR |\n00271| | LLR Init Echo CTLOS | `llr_init_echo_ctlos.ksy` | Init acknowledgment |\n00272| | LLR ACK CTLOS | `llr_ack_ctlos.ksy` | Frame acknowledgment |\n00273| | LLR NACK CTLOS | `llr_nack_ctlos.ksy` | Retransmit request |\n00274| \n00275| #### CBFC (Credit-Based Flow Control)\n00276| \n00277| **Datamodel Directory**: `datamodel/protocols/ue/link/cbfc/`\n00278| \n00279| | Format | File | Description |\n00280| |--------|------|-------------|\n00281| | CF Update | `cf_update.ksy` | Credit flow update |\n00282| | CC Update | `cc_update.ksy` | Credit count update |\n00283| | VC State Machine | `protocols/vc_state_machine.ksy` | Virtual channel FSM |\n00284| | Lossless VC Init | `protocols/lossless_vc_init.ksy` | VC initialization |\n00285| | Lossless VC Removal | `protocols/lossless_vc_removal.ksy` | VC teardown |\n00286| \n00287| #### LLDP Extensions\n00288| \n00289| **Datamodel Directory**: `datamodel/protocols/ue/link/lldp/`\n00290| \n00291| | Format | File | Description |\n00292| |--------|------|-------------|\n00293| | UE Link Negotiation TLV | `ue_link_negotiation_tlv.ksy` | Link negotiation |\n00294| | UE CBFC TLV | `ue_cbfc_tlv.ksy` | CBFC parameters |\n00295| \n00296| ---\n00297| \n00298| ## 4. RoCEv2 Formats\n00299| \n00300| **Datamodel Directory**: `datamodel/protocols/roce/transport/`\n\n(File has more lines. Use 'offset' parameter to read beyond line 300)\n</file>",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy.md",
            "metadata": {
              "preview": "| ROD Request | 3 | Reliable Ordered Delivery |\n| RUDI Request | 4 | Reliable Unordered Immediate |\n| RUDI Response | 5 | RUDI response |\n| UUD Request | 6 | Unreliable Unordered Delivery |\n| ACK | 7 | Acknowledgment |\n| ACK_CC | 8 | ACK with congestion control |\n| ACK_CCX | 9 | ACK with extended CC |\n| NACK | 10 | Negative acknowledgment |\n| CP | 11 | Control packet |\n| NACK_CCX | 12 | NACK with extended CC |\n| RUD_CC_REQ | 13 | RUD with CC state |\n| ROD_CC_REQ | 14 | ROD with CC state |\n\n### 3.3 PDS Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/pds/`\n\n| Format | File | Size | Description |\n|--------|------|------|-------------|\n| RUD/ROD Request | `rud_rod_request.ksy` | Variable | Reliable delivery request |",
              "truncated": true
            },
            "time": {
              "start": 1769123548837,
              "end": 1769123548884,
              "compacted": 1769125778416
            }
          }
        },
        {
          "id": "prt_be7fb0ed5001vJqang0NqaY77z",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fafc18001kiIKA3s2S8uO6V",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 74013,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7fb0f05001tIu70RM61Atzt6",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769123548933,
          "completed": 1769123558617
        },
        "parentID": "msg_be7faadd7001qnhXPM5tKghXUR",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 76486,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7fb132d001qusVWrcR399m7B",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fb0f05001tIu70RM61Atzt6",
          "type": "step-start"
        },
        {
          "id": "prt_be7fb3478001DVwjDLdMwgiYem",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fb0f05001tIu70RM61Atzt6",
          "type": "tool",
          "callID": "toolu_01TpqtVLnHuS4MwwH4ScpXgf",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/uud_request.ksy"
            },
            "output": "<file>\n00001| # PDS UUD Request Header\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Table 3-42, Section 3.5.10.12, Page 265\n00004| #\n00005| # UUD (Unreliable Unordered Delivery) Request Header.\n00006| \n00007| meta:\n00008|   id: pds_uud_request\n00009|   title: PDS UUD Request Header\n00010|   endian: be\n00011|   bit-endian: be\n00012|   doc: |\n00013|     Ultra Ethernet Transport (UET) Packet Delivery Sublayer (PDS) UUD\n00014|     (Unreliable Unordered Delivery) Request Header Format.\n00015|     \n00016|     UUD provides unreliable, unordered delivery with no acknowledgements or\n00017|     retransmissions. This is the simplest delivery mode, suitable for best-effort\n00018|     traffic where packet loss is acceptable.\n00019|     \n00020|     UUD uses a packet identifier (pkt_id) similar to RUDI, but without reliability\n00021|     guarantees. No PDC is used, and no ACKs/NACKs are generated.\n00022|     \n00023|     Total Size: 6 bytes (48 bits) - Same size as RUDI\n00024|     \n00025|     Wire Format (bytes 0-5):\n00026|     - Byte 0-1: Prologue (type(5)=6, next_hdr(4), flags(7))\n00027|     - Byte 2-5: pkt_id (32 bits)\n00028|   \n00029|   doc-ref:\n00030|     - \"UE Specification v1.0.1, Table 3-42, Page 265\"\n00031|     - \"UE Specification v1.0.1, Section 3.5.10.12\"\n00032|     - \"UE Specification v1.0.1, Section 3.5.7.4 (UUD Delivery)\"\n00033|     - \"UE Specification v1.0.1, Figure 3-61\"\n00034|   \n00035|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00036|   ks-version: \"0.10\"\n00037| \n00038| x-spec:\n00039|   table: \"Table 3-42\"\n00040|   section: \"Section 3.5.10.12\"\n00041|   page: 265\n00042|   figure: \"Figure 3-61\"\n00043|   spec_version: \"1.0.1\"\n00044|   spec_date: \"2025-09-05\"\n00045| \n00046| x-packet:\n00047|   layer: \"transport\"\n00048|   sublayer: \"pds\"\n00049|   category: \"request_header\"\n00050|   size_bytes: 6\n00051|   size_bits: 48\n00052|   \n00053|   constraints:\n00054|     - \"Reserved fields MUST be 0\"\n00055|     - \"pds.type MUST be 6 (UUD Request)\"\n00056|     - \"pkt_id is locally unique on source\"\n00057|     - \"No PDC, no ACKs, no NACKs\"\n00058|   \n00059|   usage:\n00060|     - \"Unreliable Unordered Delivery (best-effort)\"\n00061|     - \"No reliability guarantees\"\n00062|     - \"No acknowledgements or retransmissions\"\n00063|     - \"Suitable for loss-tolerant traffic\"\n00064|   \n00065|   related_packets:\n00066|     - \"rudi_request_response\"\n00067|     - \"rud_rod_request\"\n00068|     - \"prologue\"\n00069| \n00070| seq:\n00071|   # Bytes 0-1: PDS Prologue\n00072|   - id: pds_type\n00073|     type: b5\n00074|     enum: pds_type_enum\n00075|     doc: |\n00076|       PDS Packet Type (5 bits). MUST be 6 (UUD Request).\n00077|       \n00078|       UE Spec: Table 3-42, field 'type'.\n00079|     x-required: true\n00080|     x-constraint: \"value == 6 (UUD Request)\"\n00081|     x-spec-ref: \"Table 3-42, field 'type'\"\n00082|     valid:\n00083|       eq: 6\n00084|   \n00085|   - id: next_hdr\n00086|     type: b4\n00087|     doc: |\n00088|       Next Header (4 bits). Encoding identifying UET Semantic type.\n00089|       \n00090|       Refer to SES Section 3.4.2.6 for encodings.\n00091|       \n00092|       UE Spec: Table 3-42, field 'next_hdr'; Section 3.4.2.6\n00093|     x-required: true\n00094|     x-spec-ref: \"Table 3-42, field 'next_hdr'; Section 3.4.2.6\"\n00095|   \n00096|   # Flags: [rsvd(7)]\n00097|   - id: rsvd_flags\n00098|     type: b7\n00099|     doc: |\n00100|       Reserved flags (7 bits). MUST be 0.\n00101|       \n00102|       UE Spec: Table 3-42, pds.flags, field 'rsvd'.\n00103|     x-required: true\n00104|     x-constraint: \"value == 0\"\n00105|     x-spec-ref: \"Table 3-42, pds.flags, field 'rsvd'\"\n00106|     valid:\n00107|       eq: 0\n00108|   \n00109|   # Bytes 2-5: pkt_id (32 bits)\n00110|   - id: pkt_id\n00111|     type: u4\n00112|     doc: |\n00113|       UUD Packet Identifier (32 bits). Locally unique on source.\n00114|       \n00115|       Similar to RUDI, UUD uses packet identifiers instead of sequence numbers.\n00116|       However, unlike RUDI, UUD provides no reliability guarantees.\n00117|       \n00118|       UE Spec: Table 3-42, field 'pkt_id'.\n00119|     x-required: true\n00120|     x-spec-ref: \"Table 3-42, field 'pkt_id'\"\n00121| \n00122| enums:\n00123|   pds_type_enum:\n00124|     6:\n00125|       id: uud_request\n00126|       doc: \"UUD Request (Unreliable Unordered Delivery)\"\n00127| \n\n(End of file - total 127 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/uud_request.ksy",
            "metadata": {
              "preview": "# PDS UUD Request Header\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Table 3-42, Section 3.5.10.12, Page 265\n#\n# UUD (Unreliable Unordered Delivery) Request Header.\n\nmeta:\n  id: pds_uud_request\n  title: PDS UUD Request Header\n  endian: be\n  bit-endian: be\n  doc: |\n    Ultra Ethernet Transport (UET) Packet Delivery Sublayer (PDS) UUD\n    (Unreliable Unordered Delivery) Request Header Format.\n    \n    UUD provides unreliable, unordered delivery with no acknowledgements or\n    retransmissions. This is the simplest delivery mode, suitable for best-effort\n    traffic where packet loss is acceptable.\n    \n    UUD uses a packet identifier (pkt_id) similar to RUDI, but without reliability",
              "truncated": false
            },
            "time": {
              "start": 1769123558526,
              "end": 1769123558607,
              "compacted": 1769125778415
            }
          }
        },
        {
          "id": "prt_be7fb3481001itrALSmqJRKgWB",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fb0f05001tIu70RM61Atzt6",
          "type": "tool",
          "callID": "toolu_015jAVpbDnMfjDYPQYDWEFvb",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/rudi_request_response.ksy"
            },
            "output": "<file>\n00001| # PDS RUDI Request/Response Header\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Table 3-39, Section 3.5.10.9, Page 262\n00004| #\n00005| # RUDI Request/Response Header for Reliable Unordered Delivery with Idempotence.\n00006| \n00007| meta:\n00008|   id: pds_rudi_request_response\n00009|   title: PDS RUDI Request/Response Header\n00010|   endian: be\n00011|   bit-endian: be\n00012|   doc: |\n00013|     Ultra Ethernet Transport (UET) Packet Delivery Sublayer (PDS) RUDI\n00014|     (Reliable Unordered Delivery with Idempotence) Request/Response Header Format.\n00015|     \n00016|     RUDI uses a packet identifier (pkt_id) instead of a sequence number. The\n00017|     pkt_id is locally unique on the source and is not a sequence number.\n00018|     See Section 3.5.22 for RUDI details.\n00019|     \n00020|     This header format is used for both RUDI requests (pds.type = 4) and\n00021|     RUDI responses (pds.type = 5).\n00022|     \n00023|     For RUDI Requests: pds.flags.m is reserved\n00024|     For RUDI Responses: pds.flags.m indicates ECN marking\n00025|     \n00026|     Total Size: 6 bytes (48 bits) - Note: Smaller than RUD/ROD headers\n00027|     \n00028|     Wire Format (bytes 0-5):\n00029|     - Byte 0-1: Prologue (type(5), next_hdr(4), flags(7))\n00030|     - Byte 2-5: pkt_id (32 bits)\n00031|   \n00032|   doc-ref:\n00033|     - \"UE Specification v1.0.1, Table 3-39, Page 262\"\n00034|     - \"UE Specification v1.0.1, Section 3.5.10.9\"\n00035|     - \"UE Specification v1.0.1, Section 3.5.22 (RUDI details)\"\n00036|     - \"UE Specification v1.0.1, Figure 3-58\"\n00037|   \n00038|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00039|   ks-version: \"0.10\"\n00040| \n00041| x-spec:\n00042|   table: \"Table 3-39\"\n00043|   section: \"Section 3.5.10.9\"\n00044|   page: 262\n00045|   figure: \"Figure 3-58\"\n00046|   spec_version: \"1.0.1\"\n00047|   spec_date: \"2025-09-05\"\n00048| \n00049| x-packet:\n00050|   layer: \"transport\"\n00051|   sublayer: \"pds\"\n00052|   category: \"request_response_header\"\n00053|   size_bytes: 6\n00054|   size_bits: 48\n00055|   \n00056|   constraints:\n00057|     - \"Reserved fields MUST be 0\"\n00058|     - \"pds.type MUST be 4 (RUDI Request) or 5 (RUDI Response)\"\n00059|     - \"pkt_id is locally unique on source (not a sequence number)\"\n00060|     - \"No PDCIDs (RUDI doesn't use PDC)\"\n00061|   \n00062|   usage:\n00063|     - \"Reliable Unordered Delivery with Idempotence\"\n00064|     - \"Uses packet ID instead of sequence number\"\n00065|     - \"Idempotent operations (safe to retry)\"\n00066|     - \"No connection context (PDC) required\"\n00067|   \n00068|   related_packets:\n00069|     - \"rud_rod_request\"\n00070|     - \"nack\"\n00071|     - \"prologue\"\n00072| \n00073| seq:\n00074|   # Bytes 0-1: PDS Prologue\n00075|   - id: pds_type\n00076|     type: b5\n00077|     enum: pds_type_enum\n00078|     doc: |\n00079|       PDS Packet Type (5 bits). MUST be 4 (RUDI Request) or 5 (RUDI Response).\n00080|       \n00081|       UE Spec: Table 3-39, field 'type'.\n00082|     x-required: true\n00083|     x-constraint: \"value in {4, 5}\"\n00084|     x-spec-ref: \"Table 3-39, field 'type'\"\n00085|   \n00086|   - id: next_hdr\n00087|     type: b4\n00088|     doc: |\n00089|       Next Header (4 bits). Encoding identifying UET Semantic type.\n00090|       \n00091|       Refer to SES Section 3.4.2.6 for encodings.\n00092|       \n00093|       UE Spec: Table 3-39, field 'next_hdr'; Section 3.4.2.6\n00094|     x-required: true\n00095|     x-spec-ref: \"Table 3-39, field 'next_hdr'; Section 3.4.2.6\"\n00096|   \n00097|   # Flags: [rsvd(1), rsvd_or_m(1), retx(1), rsvd(4)]\n00098|   - id: rsvd_flag_0\n00099|     type: b1\n00100|     doc: |\n00101|       Reserved flag (1 bit). MUST be 0.\n00102|       \n00103|       UE Spec: Table 3-39, pds.flags, field 'rsvd'.\n00104|     x-required: true\n00105|     x-constraint: \"value == 0\"\n00106|     x-spec-ref: \"Table 3-39, pds.flags, field 'rsvd'\"\n00107|     valid:\n00108|       eq: 0\n00109|   \n00110|   - id: rsvd_or_ecn_marked\n00111|     type: b1\n00112|     doc: |\n00113|       Reserved or ECN Marked flag (1 bit). Interpretation depends on packet type.\n00114|       \n00115|       For RUDI Requests (pds.type = 4): Reserved, MUST be 0\n00116|       For RUDI Responses (pds.type = 5): ECN marked flag (m)\n00117|         Set to 1 if associated request packet was ECN marked\n00118|       \n00119|       UE Spec: Table 3-39, pds.flags, field 'rsvd / m'.\n00120|     x-required: true\n00121|     x-spec-ref: \"Table 3-39, pds.flags, field 'rsvd / m'\"\n00122|   \n00123|   - id: retx\n00124|     type: b1\n00125|     doc: |\n00126|       Retransmit flag (1 bit). Set to 1 if this is a request/response for a\n00127|       retransmitted packet.\n00128|       \n00129|       UE Spec: Table 3-39, pds.flags, field 'retx'.\n00130|     x-required: true\n00131|     x-spec-ref: \"Table 3-39, pds.flags, field 'retx'\"\n00132|   \n00133|   - id: rsvd_flag_1\n00134|     type: b4\n00135|     doc: |\n00136|       Reserved flags (4 bits). MUST be 0.\n00137|       \n00138|       UE Spec: Table 3-39, pds.flags, field 'rsvd'.\n00139|     x-required: true\n00140|     x-constraint: \"value == 0\"\n00141|     x-spec-ref: \"Table 3-39, pds.flags, field 'rsvd'\"\n00142|     valid:\n00143|       eq: 0\n00144|   \n00145|   # Bytes 2-5: pkt_id (32 bits)\n00146|   - id: pkt_id\n00147|     type: u4\n00148|     doc: |\n00149|       RUDI Packet Identifier (32 bits). Locally unique on source.\n00150|       \n00151|       This is NOT a sequence number. RUDI uses packet identifiers instead of\n00152|       sequence numbers to enable idempotent operations.\n00153|       \n00154|       See Section 3.5.22 for RUDI details.\n00155|       \n00156|       UE Spec: Table 3-39, field 'pkt_id'; Section 3.5.22\n00157|     x-required: true\n00158|     x-spec-ref: \"Table 3-39, field 'pkt_id'; Section 3.5.22\"\n00159| \n00160| enums:\n00161|   pds_type_enum:\n00162|     4:\n00163|       id: rudi_request\n00164|       doc: \"RUDI Request\"\n00165|     5:\n00166|       id: rudi_response\n00167|       doc: \"RUDI Response\"\n00168| \n\n(End of file - total 168 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/rudi_request_response.ksy",
            "metadata": {
              "preview": "# PDS RUDI Request/Response Header\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Table 3-39, Section 3.5.10.9, Page 262\n#\n# RUDI Request/Response Header for Reliable Unordered Delivery with Idempotence.\n\nmeta:\n  id: pds_rudi_request_response\n  title: PDS RUDI Request/Response Header\n  endian: be\n  bit-endian: be\n  doc: |\n    Ultra Ethernet Transport (UET) Packet Delivery Sublayer (PDS) RUDI\n    (Reliable Unordered Delivery with Idempotence) Request/Response Header Format.\n    \n    RUDI uses a packet identifier (pkt_id) instead of a sequence number. The\n    pkt_id is locally unique on the source and is not a sequence number.\n    See Section 3.5.22 for RUDI details.\n    \n    This header format is used for both RUDI requests (pds.type = 4) and",
              "truncated": false
            },
            "time": {
              "start": 1769123558530,
              "end": 1769123558593,
              "compacted": 1769125778414
            }
          }
        },
        {
          "id": "prt_be7fb3483001tQn6YpuW2av2fP",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fb0f05001tIu70RM61Atzt6",
          "type": "tool",
          "callID": "toolu_01KRFYYZFAeWnPCcTrmK69Ek",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/rud_rod_request.ksy"
            },
            "output": "<file>\n00001| # GOLDEN REFERENCE: PDS RUD/ROD Request Header\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Table 3-33, Section 3.5.10.3, Page 256\n00004| #\n00005| # This is a GOLDEN REFERENCE definition for PDS (Packet Delivery Sublayer) headers.\n00006| # Demonstrates PDS packet format with delivery mode flags, sequence numbers, and\n00007| # PDC (Packet Delivery Context) identifiers.\n00008| #\n00009| # Quality Standards Applied:\n00010| # 1. Every field extracted with exact bit position from Table 3-33\n00011| # 2. All fields have x-required metadata\n00012| # 3. Complete x-spec metadata for traceability\n00013| # 4. All constraints captured (reserved bits, flag meanings, field overloading)\n00014| # 5. Byte-level layout matches UE Spec exactly (12 bytes total)\n00015| # 6. Field overloading documented (dpdcid vs pdc_info/psn_offset)\n00016| #\n00017| # Leverages Cornelis IP: OPA packet format rigor, PDS reliability patterns\n00018| \n00019| meta:\n00020|   id: pds_rud_rod_request\n00021|   title: PDS RUD/ROD Request Header\n00022|   endian: be\n00023|   bit-endian: be\n00024|   doc: |\n00025|     Ultra Ethernet Packet Delivery Sublayer (PDS) Request Header for\n00026|     RUD (Reliable Unordered Delivery) and ROD (Reliable Ordered Delivery) modes.\n00027|     \n00028|     This 12-byte header provides packet delivery context, sequence numbers,\n00029|     and delivery mode flags. It sits between the UET Entropy Header/PDS Prologue\n00030|     and the SES (Semantic) header.\n00031|     \n00032|     Total Size: 12 bytes (96 bits)\n00033|     \n00034|     Wire Format (bytes 0-11):\n00035|     - Byte 0-1: Type, next_hdr, flags (16 bits)\n00036|     - Byte 2-3: Clear PSN Offset (16 bits)\n00037|     - Byte 4-7: PSN (Packet Sequence Number) (32 bits)\n00038|     - Byte 8-9: Source PDCID (16 bits)\n00039|     - Byte 10-11: Destination PDCID or {pdc_info, psn_offset} (16 bits, overloaded)\n00040|   \n00041|   doc-ref:\n00042|     - \"UE Specification v1.0.1, Table 3-33, Page 256\"\n00043|     - \"UE Specification v1.0.1, Section 3.5.10.3 (RUD/ROD Request)\"\n00044|     - \"UE Specification v1.0.1, Figure 3-52 (RUD/ROD Request Header Format)\"\n00045|   \n00046|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00047|   ks-version: \"0.10\"\n00048| \n00049| x-spec:\n00050|   table: \"Table 3-33\"\n00051|   section: \"Section 3.5.10.3\"\n00052|   page: 256\n00053|   figure: \"Figure 3-52\"\n00054|   spec_version: \"1.0.1\"\n00055|   spec_date: \"2025-09-05\"\n00056| \n00057| x-packet:\n00058|   layer: \"transport\"\n00059|   sublayer: \"pds\"\n00060|   category: \"request_header\"\n00061|   delivery_modes: [\"RUD\", \"ROD\"]\n00062|   size_bytes: 12\n00063|   size_bits: 96\n00064|   \n00065|   constraints:\n00066|     - \"Reserved fields MUST be 0\"\n00067|     - \"type MUST be ROD Request or RUD Request\"\n00068|     - \"next_hdr identifies SES semantic type per Section 3.4.2.6\"\n00069|     - \"Last 16 bits overloaded: dpdcid when syn=0, {pdc_info, psn_offset} when syn=1\"\n00070| \n00071| seq:\n00072|   # Byte 0-1: Type, Next Header, Flags (16 bits total)\n00073|   # Bit layout: type(5) | next_hdr(4) | flags(7)\n00074|   \n00075|   - id: type\n00076|     type: b5\n00077|     enum: pds_type_enum\n00078|     doc: |\n00079|       Packet Type (5 bits). Identifies this as ROD Request or RUD Request.\n00080|       \n00081|       Values:\n00082|       - ROD Request: Reliable Ordered Delivery\n00083|       - RUD Request: Reliable Unordered Delivery\n00084|       \n00085|       UE Spec: Table 3-33, field 'type'\n00086|     x-required: true\n00087|     x-constraint: \"ROD Request or RUD Request\"\n00088|     x-spec-ref: \"Table 3-33, field 'type'\"\n00089|   \n00090|   - id: next_hdr\n00091|     type: b4\n00092|     enum: next_hdr_enum\n00093|     doc: |\n00094|       Next Header (4 bits). Encoding identifying UET Semantic type.\n00095|       Indicates the type of SES header that follows this PDS header.\n00096|       \n00097|       Refer to SES Section 3.4.2.6 and Table 3-16 for next header enumeration.\n00098|       \n00099|       UE Spec: Table 3-33, field 'next_hdr'; Section 3.4.2.6; Table 3-16\n00100|     x-required: true\n00101|     x-constraint: \"Valid next_hdr value per Table 3-16\"\n00102|     x-spec-ref: \"Table 3-33, field 'next_hdr'; Section 3.4.2.6; Table 3-16\"\n00103|   \n00104|   # Flags (7 bits): rsvd(2) | retx(1) | ar(1) | syn(1) | rsvd(2)\n00105|   \n00106|   - id: flags_rsvd_high\n00107|     type: b2\n00108|     doc: |\n00109|       Reserved bits (2 bits, high). MUST be 0.\n00110|       UE Spec: Table 3-33, pds.flags[6:5] reserved.\n00111|     x-required: true\n00112|     x-constraint: \"value == 0\"\n00113|     x-spec-ref: \"Table 3-33, field 'flags.rsvd'\"\n00114|   \n00115|   - id: flags_retx\n00116|     type: b1\n00117|     doc: |\n00118|       Retransmit flag (1 bit). When set to 1, indicates this packet is a retransmit.\n00119|       \n00120|       Retransmitted packets are handled specially for loss detection and\n00121|       congestion control purposes.\n00122|       \n00123|       UE Spec: Table 3-33, pds.flags.retx; Section 3.5.11.8.4\n00124|     x-required: true\n00125|     x-spec-ref: \"Table 3-33, field 'flags.retx'; Section 3.5.11.8.4\"\n00126|   \n00127|   - id: flags_ar\n00128|     type: b1\n00129|     doc: |\n00130|       ACK Request flag (1 bit). When set to 1, an ACK is requested to be sent\n00131|       for this packet.\n00132|       \n00133|       Used to trigger ACK generation at the receiver for flow control and\n00134|       reliability purposes.\n00135|       \n00136|       UE Spec: Table 3-33, pds.flags.ar; Section 3.5.12.2\n00137|     x-required: true\n00138|     x-spec-ref: \"Table 3-33, field 'flags.ar'; Section 3.5.12.2\"\n00139|   \n00140|   - id: flags_syn\n00141|     type: b1\n00142|     doc: |\n00143|       SYN flag (1 bit). When set to 1, indicates PDC (Packet Delivery Context)\n00144|       establishment request.\n00145|       \n00146|       When syn=1, the last 16 bits of the header are interpreted as\n00147|       {pdc_info, psn_offset} instead of dpdcid.\n00148|       \n00149|       UE Spec: Table 3-33, pds.flags.syn; Section 3.5.8.2\n00150|     x-required: true\n00151|     x-spec-ref: \"Table 3-33, field 'flags.syn'; Section 3.5.8.2\"\n00152|   \n00153|   - id: flags_rsvd_low\n00154|     type: b2\n00155|     doc: |\n00156|       Reserved bits (2 bits, low). MUST be 0.\n00157|       UE Spec: Table 3-33, pds.flags[1:0] reserved.\n00158|     x-required: true\n00159|     x-constraint: \"value == 0\"\n00160|     x-spec-ref: \"Table 3-33, field 'flags.rsvd'\"\n00161|   \n00162|   # Byte 2-3: Clear PSN Offset (16 bits)\n00163|   \n00164|   - id: clear_psn_offset\n00165|     type: u2\n00166|     doc: |\n00167|       Clear PSN Offset (16 bits). Encoding of CLEAR_PSN relative to PSN.\n00168|       \n00169|       This field is a sequence number used to acknowledge reception of PDS ACKs.\n00170|       It indicates which ACKs have been received and processed by the sender.\n00171|       \n00172|       UE Spec: Table 3-33, field 'clear_psn_offset'\n00173|     x-required: true\n00174|     x-spec-ref: \"Table 3-33, field 'clear_psn_offset'\"\n00175|   \n00176|   # Byte 4-7: PSN (32 bits)\n00177|   \n00178|   - id: psn\n00179|     type: u4\n00180|     doc: |\n00181|       Packet Sequence Number (32 bits). Sequence number assigned to this PDS Request.\n00182|       \n00183|       PSN is used for:\n00184|       - Ordering (ROD mode)\n00185|       - Loss detection\n00186|       - ACK/NACK generation\n00187|       - Duplicate detection\n00188|       \n00189|       PSN wraps at 2^32.\n00190|       \n00191|       UE Spec: Table 3-33, field 'psn'\n00192|     x-required: true\n00193|     x-spec-ref: \"Table 3-33, field 'psn'\"\n00194|   \n00195|   # Byte 8-9: Source PDCID (16 bits)\n00196|   \n00197|   - id: spdcid\n00198|     type: u2\n00199|     doc: |\n00200|       Source PDCID (16 bits). Packet Delivery Context ID assigned by the FEP\n00201|       that is the source of the packet.\n00202|       \n00203|       PDCID identifies the delivery context for this packet stream.\n00204|       \n00205|       UE Spec: Table 3-33, field 'spdcid'\n00206|     x-required: true\n00207|     x-spec-ref: \"Table 3-33, field 'spdcid'\"\n00208|   \n00209|   # Byte 10-11: Destination PDCID or {pdc_info, psn_offset} (16 bits, OVERLOADED)\n00210|   # Interpretation depends on flags.syn value\n00211|   \n00212|   - id: dpdcid_or_pdc_info\n00213|     type: u2\n00214|     doc: |\n00215|       Destination PDCID or {pdc_info, psn_offset} (16 bits). OVERLOADED FIELD.\n00216|       \n00217|       Interpretation depends on pds.flags.syn:\n00218|       \n00219|       WHEN pds.flags.syn = 0 (normal operation):\n00220|         This field contains dpdcid (Destination PDCID, 16 bits).\n00221|         Destination PDCID assigned by FEP that is the destination of the packet.\n00222|       \n00223|       WHEN pds.flags.syn = 1 (PDC establishment):\n00224|         This field contains {pdc_info, psn_offset}:\n00225|         - pdc_info (4 bits, high): PDC information\n00226|           - Bit 0: use_rsv_pdc (1 = use PDC from reserved pool, 0 = global shared pool)\n00227|           - Bits 3:1: Reserved\n00228|         - psn_offset (12 bits, low): Numerical difference between PSN in this packet\n00229|           and Start_PSN on the PDC (refer to Section 3.5.8.2)\n00230|       \n00231|       UE Spec: Table 3-33, field 'dpdcid' or '{pdc_info, psn_offset}'; Section 3.5.8.2\n00232|     x-required: true\n00233|     x-spec-ref: \"Table 3-33, field 'dpdcid' or '{pdc_info, psn_offset}'; Section 3.5.8.2\"\n00234|     x-overloaded: true\n00235|     x-interpretation:\n00236|       - condition: \"flags.syn == 0\"\n00237|         meaning: \"dpdcid (Destination PDCID, 16 bits)\"\n00238|       - condition: \"flags.syn == 1\"\n00239|         meaning: \"{pdc_info (4 bits), psn_offset (12 bits)}\"\n00240| \n00241| enums:\n00242|   pds_type_enum:\n00243|     # PDS packet types (5-bit encoding)\n00244|     # Full enumeration would include all types from UE Spec\n00245|     0x01: rud_request\n00246|     0x02: rod_request\n00247|     0x03: rud_request_cc\n00248|     0x04: rod_request_cc\n00249|     0x05: rud_rod_ack\n00250|     0x06: ack_cc\n00251|     0x07: ack_ccx\n00252|     0x08: rud_rod_cp\n00253|     0x09: rudi_request\n00254|     0x0a: rudi_response\n00255|     0x0b: nack\n00256|     0x0c: nack_ccx\n00257|     0x0d: uud_request\n00258|   \n00259|   next_hdr_enum:\n00260|     # Next header enumeration (4-bit encoding)\n00261|     # From Table 3-16 (Next Header Enumeration)\n00262|     0x0: standard_header_som1\n00263|     0x1: standard_header_som0\n00264|     0x2: optimized_non_matching\n00265|     0x3: small_message_small_rma\n00266|     0x4: response\n00267|     0x5: response_with_data\n00268|     0x6: optimized_response_with_data\n00269|     # Additional values from Table 3-16\n00270| \n00271| # Validation Notes:\n00272| # \n00273| # 1. Total header size MUST be exactly 12 bytes (96 bits)\n00274| # 2. All reserved fields MUST be 0\n00275| # 3. type MUST be RUD Request or ROD Request\n00276| # 4. next_hdr MUST be valid per Table 3-16\n00277| # 5. Last 16 bits are OVERLOADED:\n00278| #    - When flags.syn = 0: dpdcid (16 bits)\n00279| #    - When flags.syn = 1: {pdc_info (4 bits), psn_offset (12 bits)}\n00280| # 6. Field dependencies:\n00281| #    - flags.syn determines interpretation of last 16 bits\n00282| #    - flags.ar triggers ACK generation at receiver\n00283| #    - flags.retx indicates retransmitted packet\n00284| #\n00285| # Reference: ue-taxonomy/reference/field_definitions/pds_rud_rod_request.yaml\n00286| \n\n(End of file - total 286 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/rud_rod_request.ksy",
            "metadata": {
              "preview": "# GOLDEN REFERENCE: PDS RUD/ROD Request Header\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Table 3-33, Section 3.5.10.3, Page 256\n#\n# This is a GOLDEN REFERENCE definition for PDS (Packet Delivery Sublayer) headers.\n# Demonstrates PDS packet format with delivery mode flags, sequence numbers, and\n# PDC (Packet Delivery Context) identifiers.\n#\n# Quality Standards Applied:\n# 1. Every field extracted with exact bit position from Table 3-33\n# 2. All fields have x-required metadata\n# 3. Complete x-spec metadata for traceability\n# 4. All constraints captured (reserved bits, flag meanings, field overloading)\n# 5. Byte-level layout matches UE Spec exactly (12 bytes total)\n# 6. Field overloading documented (dpdcid vs pdc_info/psn_offset)\n#\n# Leverages Cornelis IP: OPA packet format rigor, PDS reliability patterns\n\nmeta:\n  id: pds_rud_rod_request",
              "truncated": false
            },
            "time": {
              "start": 1769123558532,
              "end": 1769123558600,
              "compacted": 1769125778413
            }
          }
        },
        {
          "id": "prt_be7fb34d00012Wz3qKSjnEvoRB",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fb0f05001tIu70RM61Atzt6",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 76486,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7fb350d00119oLbigI5Ehoq6",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769123558669,
          "completed": 1769123566458
        },
        "parentID": "msg_be7faadd7001qnhXPM5tKghXUR",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 83778,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7fb39fd001xP6oapk6DBlQ0K",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fb350d00119oLbigI5Ehoq6",
          "type": "step-start"
        },
        {
          "id": "prt_be7fb5316001nS6NWe87IiGv2K",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fb350d00119oLbigI5Ehoq6",
          "type": "tool",
          "callID": "toolu_01BFqr3ZSEmECsmjZVPY7uyU",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/rud_rod_cp.ksy"
            },
            "output": "<file>\n00001| # PDS RUD/ROD Control Packet\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Table 3-38, Section 3.5.10.8, Page 261\n00004| #\n00005| # RUD/ROD Control Packet with 10 subtypes.\n00006| \n00007| meta:\n00008|   id: pds_rud_rod_cp\n00009|   title: PDS RUD/ROD Control Packet Header\n00010|   endian: be\n00011|   bit-endian: be\n00012|   doc: |\n00013|     Ultra Ethernet Transport (UET) Packet Delivery Sublayer (PDS) RUD/ROD\n00014|     Control Packet (CP) Header Format.\n00015|     \n00016|     Control Packets are used for various control operations in RUD/ROD delivery:\n00017|     - NOOP (0): No operation\n00018|     - ACK Request (1): Source requesting ACK for specific PSN\n00019|     - Clear Command (2): Initiator to target to clear guaranteed delivery state\n00020|     - Clear Request (3): Target requests source to send clear\n00021|     - Close Command (4): Initiator indicating PDC is being closed\n00022|     - Close Request (5): Target request to initiator to close PDC\n00023|     - Probe (6): Source to destination to request PDS ACK\n00024|     - Credit (7): Destination to source carrying congestion control credit\n00025|     - Credit Request (8): Source to destination requesting credit\n00026|     - Negotiation (9): PDC negotiation\n00027|     - Reserved (10-15)\n00028|     \n00029|     The ctl_type field (in prologue) identifies the specific CP subtype.\n00030|     \n00031|     Total Size: 12 bytes (96 bits)\n00032|     \n00033|     Wire Format (bytes 0-11):\n00034|     - Byte 0-1: Prologue (type(5)=11, ctl_type(4), flags(7))\n00035|     - Byte 2-3: probe_opaque (16 bits)\n00036|     - Byte 4-7: psn (32 bits)\n00037|     - Byte 8-11: spdcid and dpdcid or {pdc_info, psn_offset} (32 bits)\n00038|   \n00039|   doc-ref:\n00040|     - \"UE Specification v1.0.1, Table 3-38, Page 261\"\n00041|     - \"UE Specification v1.0.1, Section 3.5.10.8\"\n00042|     - \"UE Specification v1.0.1, Section 3.5.16 (CP details)\"\n00043|     - \"UE Specification v1.0.1, Figure 3-57\"\n00044|   \n00045|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00046|   ks-version: \"0.10\"\n00047| \n00048| x-spec:\n00049|   table: \"Table 3-38\"\n00050|   section: \"Section 3.5.10.8\"\n00051|   page: 261\n00052|   figure: \"Figure 3-57\"\n00053|   spec_version: \"1.0.1\"\n00054|   spec_date: \"2025-09-05\"\n00055| \n00056| x-packet:\n00057|   layer: \"transport\"\n00058|   sublayer: \"pds\"\n00059|   category: \"control_packet\"\n00060|   size_bytes: 12\n00061|   size_bits: 96\n00062|   \n00063|   constraints:\n00064|     - \"Reserved fields MUST be 0\"\n00065|     - \"pds.type MUST be 11 (CP)\"\n00066|     - \"ctl_type identifies CP subtype (10 defined subtypes)\"\n00067|     - \"Some CPs consume a new PSN (see Section 3.5.16)\"\n00068|   \n00069|   usage:\n00070|     - \"Various control operations for RUD/ROD\"\n00071|     - \"PDC management (close, clear)\"\n00072|     - \"ACK/Probe requests\"\n00073|     - \"Credit management\"\n00074|     - \"Negotiation\"\n00075|   \n00076|   related_packets:\n00077|     - \"rud_rod_request\"\n00078|     - \"rud_rod_ack\"\n00079|     - \"prologue\"\n00080| \n00081| seq:\n00082|   # Bytes 0-1: PDS Prologue\n00083|   - id: pds_type\n00084|     type: b5\n00085|     enum: pds_type_enum\n00086|     doc: |\n00087|       PDS Packet Type (5 bits). MUST be 11 (CP).\n00088|       \n00089|       UE Spec: Table 3-38, field 'type'.\n00090|     x-required: true\n00091|     x-constraint: \"value == 11 (CP)\"\n00092|     x-spec-ref: \"Table 3-38, field 'type'\"\n00093|     valid:\n00094|       eq: 11\n00095|   \n00096|   - id: ctl_type\n00097|     type: b4\n00098|     enum: ctl_type_enum\n00099|     doc: |\n00100|       Control Type (4 bits). Identifies type of CP.\n00101|       \n00102|       See Section 3.5.16 for CP details.\n00103|       \n00104|       Subtypes:\n00105|       - 0: NOOP\n00106|       - 1: ACK Request\n00107|       - 2: Clear Command\n00108|       - 3: Clear Request\n00109|       - 4: Close Command\n00110|       - 5: Close Request\n00111|       - 6: Probe\n00112|       - 7: Credit\n00113|       - 8: Credit Request\n00114|       - 9: Negotiation\n00115|       - 10-15: Reserved\n00116|       \n00117|       UE Spec: Table 3-38, field 'ctl_type'; Section 3.5.16\n00118|     x-required: true\n00119|     x-constraint: \"value in {0..9} or reserved\"\n00120|     x-spec-ref: \"Table 3-38, field 'ctl_type'; Section 3.5.16\"\n00121|   \n00122|   # Flags: [rsvd(1), rsvd_or_isrod(1), retx(1), ar(1), syn(1), rsvd(2)]\n00123|   - id: rsvd_flag_0\n00124|     type: b1\n00125|     doc: |\n00126|       Reserved flag (1 bit). MUST be 0.\n00127|       UE Spec: Table 3-38, pds.flags.\n00128|     x-required: true\n00129|     x-constraint: \"value == 0\"\n00130|     x-spec-ref: \"Table 3-38, pds.flags, field 'rsvd'\"\n00131|     valid:\n00132|       eq: 0\n00133|   \n00134|   - id: rsvd_or_isrod\n00135|     type: b1\n00136|     doc: |\n00137|       Reserved or IsROD flag (1 bit). Context-dependent.\n00138|       \n00139|       For NOOP and Negotiation: 1 => PDC is ROD, 0 => PDC is RUD\n00140|       For other delivery modes: Reserved\n00141|       \n00142|       UE Spec: Table 3-38, pds.flags, field 'rsvd/isrod'.\n00143|     x-required: true\n00144|     x-spec-ref: \"Table 3-38, pds.flags, field 'rsvd/isrod'\"\n00145|   \n00146|   - id: retx\n00147|     type: b1\n00148|     doc: |\n00149|       Retransmit flag (1 bit). Set to 1 if this CP is a retransmit.\n00150|       UE Spec: Table 3-38, pds.flags, field 'retx'.\n00151|     x-required: true\n00152|     x-spec-ref: \"Table 3-38, pds.flags, field 'retx'\"\n00153|   \n00154|   - id: ar\n00155|     type: b1\n00156|     doc: |\n00157|       ACK Request flag (1 bit). Set to 1 to request ACK.\n00158|       UE Spec: Table 3-38, pds.flags, field 'ar'.\n00159|     x-required: true\n00160|     x-spec-ref: \"Table 3-38, pds.flags, field 'ar'\"\n00161|   \n00162|   - id: syn\n00163|     type: b1\n00164|     doc: |\n00165|       SYN flag (1 bit). Set to 1 for PDC establishment request.\n00166|       UE Spec: Table 3-38, pds.flags, field 'syn'.\n00167|     x-required: true\n00168|     x-spec-ref: \"Table 3-38, pds.flags, field 'syn'\"\n00169|   \n00170|   - id: rsvd_flag_1\n00171|     type: b2\n00172|     doc: |\n00173|       Reserved flags (2 bits). MUST be 0.\n00174|       UE Spec: Table 3-38, pds.flags.\n00175|     x-required: true\n00176|     x-constraint: \"value == 0\"\n00177|     x-spec-ref: \"Table 3-38, pds.flags, field 'rsvd'\"\n00178|     valid:\n00179|       eq: 0\n00180|   \n00181|   # Bytes 2-3: probe_opaque (16 bits)\n00182|   - id: probe_opaque\n00183|     type: u2\n00184|     doc: |\n00185|       Probe Opaque (16 bits). Same as ACK.\n00186|       \n00187|       UE Spec: Table 3-38, field 'probe_opaque'.\n00188|     x-required: true\n00189|     x-spec-ref: \"Table 3-38, field 'probe_opaque'\"\n00190|   \n00191|   # Bytes 4-7: psn (32 bits)\n00192|   - id: psn\n00193|     type: u4\n00194|     doc: |\n00195|       Packet Sequence Number (32 bits). PSN assigned to the PDS CP.\n00196|       \n00197|       Some CPs consume a new PSN; refer to Section 3.5.16 for specifics.\n00198|       \n00199|       UE Spec: Table 3-38, field 'psn'; Section 3.5.16\n00200|     x-required: true\n00201|     x-spec-ref: \"Table 3-38, field 'psn'; Section 3.5.16\"\n00202|   \n00203|   # Bytes 8-9: spdcid (16 bits)\n00204|   - id: spdcid\n00205|     type: u2\n00206|     doc: |\n00207|       Source PDCID (16 bits). Same as ACK.\n00208|       \n00209|       UE Spec: Table 3-38, field 'spdcid'.\n00210|     x-required: true\n00211|     x-spec-ref: \"Table 3-38, field 'spdcid'\"\n00212|   \n00213|   # Bytes 10-11: dpdcid or {pdc_info, psn_offset} (16 bits)\n00214|   - id: dpdcid_or_pdc_info\n00215|     type: u2\n00216|     doc: |\n00217|       Destination PDCID or PDC Info/PSN Offset (16 bits). Same as ACK.\n00218|       \n00219|       UE Spec: Table 3-38, field '{dpdcid} or {pdc_info, psn_offset}'.\n00220|     x-required: true\n00221|     x-spec-ref: \"Table 3-38, field '{dpdcid} or {pdc_info, psn_offset}'\"\n00222| \n00223| enums:\n00224|   pds_type_enum:\n00225|     11:\n00226|       id: cp\n00227|       doc: \"CP (Control Packet)\"\n00228|   \n00229|   ctl_type_enum:\n00230|     0:\n00231|       id: noop\n00232|       doc: \"NOOP - No operation\"\n00233|     1:\n00234|       id: ack_request\n00235|       doc: \"ACK Request - Source requesting ACK for specific PSN\"\n00236|     2:\n00237|       id: clear_command\n00238|       doc: \"Clear Command - Initiator to target to clear guaranteed delivery state\"\n00239|     3:\n00240|       id: clear_request\n00241|       doc: \"Clear Request - Target requests source to send clear\"\n00242|     4:\n00243|       id: close_command\n00244|       doc: \"Close Command - Initiator indicating PDC is being closed\"\n00245|     5:\n00246|       id: close_request\n00247|       doc: \"Close Request - Target request to initiator to close PDC\"\n00248|     6:\n00249|       id: probe\n00250|       doc: \"Probe - Source to destination to request PDS ACK\"\n00251|     7:\n00252|       id: credit\n00253|       doc: \"Credit - Destination to source carrying congestion control credit\"\n00254|     8:\n00255|       id: credit_request\n00256|       doc: \"Credit Request - Source to destination requesting credit\"\n00257|     9:\n00258|       id: negotiation\n00259|       doc: \"Negotiation - PDC negotiation\"\n00260| \n\n(End of file - total 260 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/rud_rod_cp.ksy",
            "metadata": {
              "preview": "# PDS RUD/ROD Control Packet\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Table 3-38, Section 3.5.10.8, Page 261\n#\n# RUD/ROD Control Packet with 10 subtypes.\n\nmeta:\n  id: pds_rud_rod_cp\n  title: PDS RUD/ROD Control Packet Header\n  endian: be\n  bit-endian: be\n  doc: |\n    Ultra Ethernet Transport (UET) Packet Delivery Sublayer (PDS) RUD/ROD\n    Control Packet (CP) Header Format.\n    \n    Control Packets are used for various control operations in RUD/ROD delivery:\n    - NOOP (0): No operation\n    - ACK Request (1): Source requesting ACK for specific PSN\n    - Clear Command (2): Initiator to target to clear guaranteed delivery state\n    - Clear Request (3): Target requests source to send clear",
              "truncated": false
            },
            "time": {
              "start": 1769123566362,
              "end": 1769123566447,
              "compacted": 1769125778412
            }
          }
        },
        {
          "id": "prt_be7fb531d001Vz5Irg3lkJ3nko",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fb350d00119oLbigI5Ehoq6",
          "type": "tool",
          "callID": "toolu_01F573iqZWLa1ZXZr8YBA7Yk",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/ack_cc.ksy"
            },
            "output": "<file>\n00001| # GOLDEN REFERENCE: PDS ACK_CC (ACK with Congestion Control State)\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Table 3-36, Section 3.5.10.6, Page 259\n00004| #\n00005| # This is a GOLDEN REFERENCE definition for PDS ACK with congestion control state.\n00006| # Demonstrates complex PDS packet with embedded CC state, SACK bitmap, and\n00007| # congestion management integration.\n00008| #\n00009| # Quality Standards Applied:\n00010| # 1. Every field extracted with exact bit position from Table 3-36\n00011| # 2. All fields have x-required metadata\n00012| # 3. Complete x-spec metadata for traceability\n00013| # 4. First 12 bytes identical to PDS ACK (Table 3-35) with type=ACK_CC\n00014| # 5. Additional 16 bytes for CC state, SACK bitmap, and CC parameters\n00015| # 6. Total 28 bytes matching UE Spec exactly\n00016| #\n00017| # Leverages Cornelis IP: OPA reliability + congestion control patterns\n00018| \n00019| meta:\n00020|   id: pds_ack_cc\n00021|   title: PDS ACK_CC (ACK with Congestion Control State)\n00022|   endian: be\n00023|   bit-endian: be\n00024|   doc: |\n00025|     Ultra Ethernet Packet Delivery Sublayer (PDS) ACK with Congestion Control State.\n00026|     \n00027|     This 28-byte header extends the basic PDS ACK (12 bytes) with congestion control\n00028|     state information for NSCC (Network Signal-based Congestion Control) and other\n00029|     CC algorithms. It includes SACK (Selective ACK) bitmap and CC state fields.\n00030|     \n00031|     Total Size: 28 bytes (224 bits)\n00032|     - First 12 bytes: Identical to PDS ACK (Table 3-35) with type=ACK_CC\n00033|     - Next 16 bytes: CC type, flags, MPR, SACK bitmap, CC state\n00034|     \n00035|     Wire Format (bytes 0-27):\n00036|     - Byte 0-11: PDS ACK header (type, next_hdr, flags, ack_psn_offset, probe_opaque, cack_psn, spdcid, dpdcid)\n00037|     - Byte 12: CC type and CC flags (8 bits)\n00038|     - Byte 13: MPR (Maximum PSN Range) (8 bits)\n00039|     - Byte 14-15: SACK PSN Offset (16 bits)\n00040|     - Byte 16-23: SACK Bitmap (64 bits)\n00041|     - Byte 24-27: ACK CC State (64 bits)\n00042|   \n00043|   doc-ref:\n00044|     - \"UE Specification v1.0.1, Table 3-36, Page 259\"\n00045|     - \"UE Specification v1.0.1, Section 3.5.10.6 (RUD/ROD ACK_CC)\"\n00046|     - \"UE Specification v1.0.1, Figure 3-55 (ACK_CC Format)\"\n00047|     - \"UE Specification v1.0.1, Section 3.6.9 (CMS CC State Definitions)\"\n00048|   \n00049|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00050|   ks-version: \"0.10\"\n00051| \n00052| x-spec:\n00053|   table: \"Table 3-36\"\n00054|   section: \"Section 3.5.10.6\"\n00055|   page: 259\n00056|   figure: \"Figure 3-55\"\n00057|   spec_version: \"1.0.1\"\n00058|   spec_date: \"2025-09-05\"\n00059| \n00060| x-packet:\n00061|   layer: \"transport\"\n00062|   sublayer: \"pds\"\n00063|   category: \"ack_header\"\n00064|   congestion_control: true\n00065|   size_bytes: 28\n00066|   size_bits: 224\n00067|   \n00068|   constraints:\n00069|     - \"First 12 bytes identical to PDS ACK (Table 3-35) with type=ACK_CC\"\n00070|     - \"Reserved fields MUST be 0\"\n00071|     - \"cc_type defines contents of ack_cc_state per Section 3.6.9\"\n00072|     - \"SACK bitmap: 1 = ACK, 0 = not ACKed\"\n00073|     - \"When NSCC used, ACK_CC and/or ACK_CCX MUST be used\"\n00074| \n00075| seq:\n00076|   # Bytes 0-11: First 12 bytes identical to PDS ACK (Table 3-35)\n00077|   # Note: Table 3-36 states \"Identical to PDS ACK header but with pds.type set to ACK_CC\"\n00078|   # For brevity in golden reference, we document the structure without repeating all ACK fields\n00079|   # In production, these would be fully expanded or use Kaitai type inheritance\n00080|   \n00081|   - id: pds_ack_header\n00082|     size: 12\n00083|     doc: |\n00084|       First 12 bytes (96 bits). Identical to PDS ACK header (Table 3-35) but with\n00085|       pds.type set to ACK_CC.\n00086|       \n00087|       Contains:\n00088|       - type (5 bits): ACK_CC\n00089|       - next_hdr (4 bits): UET Semantic type\n00090|       - flags (7 bits): [rsvd, m, retx, p, req, rsvd]\n00091|       - ack_psn_offset (16 bits): Offset from CACK_PSN to ACK_PSN\n00092|       - probe_opaque (16 bits): Copied from Probe CP\n00093|       - cack_psn (32 bits): Cumulative ACK PSN\n00094|       - spdcid (16 bits): Source PDCID\n00095|       - dpdcid (16 bits): Destination PDCID\n00096|       \n00097|       UE Spec: Table 3-36, \"First 12 bytes\"; Table 3-35 for field details\n00098|     x-required: true\n00099|     x-spec-ref: \"Table 3-36, 'First 12 bytes'; Table 3-35\"\n00100|     x-note: \"In production taxonomy, expand to individual fields or use type inheritance\"\n00101|   \n00102|   # Byte 12: CC Type and CC Flags (8 bits)\n00103|   \n00104|   - id: cc_type\n00105|     type: b4\n00106|     enum: cc_type_enum\n00107|     doc: |\n00108|       CC Type (4 bits). Defines the contents of pds.ack_cc_state field used to\n00109|       support congestion control algorithms.\n00110|       \n00111|       Defined in CMS Section 3.6.9. Values:\n00112|       - CC_NSCC: NSCC (Network Signal-based CC) state\n00113|       - CC_CREDIT: RCCC/TFC credit-based CC state\n00114|       \n00115|       UE Spec: Table 3-36, field 'cc_type'; Section 3.6.9\n00116|     x-required: true\n00117|     x-constraint: \"Valid cc_type per Section 3.6.9\"\n00118|     x-spec-ref: \"Table 3-36, field 'cc_type'; Section 3.6.9\"\n00119|   \n00120|   - id: cc_flags_rsvd\n00121|     type: b4\n00122|     doc: |\n00123|       CC Flags Reserved (4 bits). MUST be 0.\n00124|       UE Spec: Table 3-36, pds.cc_flags.rsvd\n00125|     x-required: true\n00126|     x-constraint: \"value == 0\"\n00127|     x-spec-ref: \"Table 3-36, field 'cc_flags.rsvd'\"\n00128|   \n00129|   # Byte 13: MPR (8 bits)\n00130|   \n00131|   - id: mpr\n00132|     type: u1\n00133|     doc: |\n00134|       Maximum PSN Range (8 bits). Used to set a maximum window on source PDC.\n00135|       Defines the maximum number of outstanding (not yet cleared) packets tracked\n00136|       at destination.\n00137|       \n00138|       This provides flow control by limiting the sender's window size based on\n00139|       receiver capacity.\n00140|       \n00141|       UE Spec: Table 3-36, field 'mpr'\n00142|     x-required: true\n00143|     x-spec-ref: \"Table 3-36, field 'mpr'\"\n00144|   \n00145|   # Byte 14-15: SACK PSN Offset (16 bits)\n00146|   \n00147|   - id: sack_psn_offset\n00148|     type: u2\n00149|     doc: |\n00150|       SACK PSN Offset (16 bits). Signed representation of the offset from CACK_PSN\n00151|       to SACK_PSN. Reduces field size from 32 bits to 16 bits.\n00152|       \n00153|       Base SACK_PSN defines the lowest PSN in the SACK bitmap.\n00154|       SACK_PSN = CACK_PSN + sack_psn_offset (signed arithmetic)\n00155|       \n00156|       UE Spec: Table 3-36, field 'sack_psn_offset'\n00157|     x-required: true\n00158|     x-spec-ref: \"Table 3-36, field 'sack_psn_offset'\"\n00159|   \n00160|   # Byte 16-23: SACK Bitmap (64 bits)\n00161|   \n00162|   - id: sack_bitmap\n00163|     type: u8\n00164|     doc: |\n00165|       Selective ACK Bitmap (64 bits). Each bit represents one PSN in the range\n00166|       [SACK_PSN ... SACK_PSN+63].\n00167|       \n00168|       Bit value:\n00169|       - 1: PSN is ACKed (received successfully)\n00170|       - 0: PSN is not ACKed (not received or lost)\n00171|       \n00172|       This allows selective acknowledgement of out-of-order packets for\n00173|       efficient loss recovery.\n00174|       \n00175|       UE Spec: Table 3-36, field 'sack_bitmap'\n00176|     x-required: true\n00177|     x-spec-ref: \"Table 3-36, field 'sack_bitmap'\"\n00178|   \n00179|   # Byte 24-27: ACK CC State (32 bits)\n00180|   \n00181|   - id: ack_cc_state\n00182|     type: u4\n00183|     doc: |\n00184|       ACK CC State (32 bits). Congestion control state generated at the destination\n00185|       and carried to the source.\n00186|       \n00187|       Content is defined by pds.cc_type field:\n00188|       - When cc_type = CC_NSCC: Contains NSCC state (Table 3-74)\n00189|       - When cc_type = CC_CREDIT: Contains RCCC/TFC state (Table 3-75)\n00190|       \n00191|       This state is used by the source to adjust its sending rate based on\n00192|       network congestion signals from the destination.\n00193|       \n00194|       UE Spec: Table 3-36, field 'ack_cc_state (32b)'; Section 3.6.9\n00195|     x-required: true\n00196|     x-spec-ref: \"Table 3-36, field 'ack_cc_state (64b)'; Section 3.6.9\"\n00197|     x-interpretation:\n00198|       - condition: \"cc_type == CC_NSCC\"\n00199|         meaning: \"NSCC state per Table 3-74\"\n00200|       - condition: \"cc_type == CC_CREDIT\"\n00201|         meaning: \"RCCC/TFC state per Table 3-75\"\n00202| \n00203| enums:\n00204|   cc_type_enum:\n00205|     0x0: cc_nscc\n00206|     0x1: cc_credit\n00207|     # Additional CC types may be defined in future versions\n00208|   \n00209|   pds_type_enum:\n00210|     0x06: ack_cc\n00211| \n00212| # Validation Notes:\n00213| # \n00214| # 1. Total header size MUST be exactly 28 bytes (224 bits)\n00215| # 2. First 12 bytes MUST match PDS ACK structure (Table 3-35) with type=ACK_CC\n00216| # 3. All reserved fields MUST be 0\n00217| # 4. cc_type determines interpretation of ack_cc_state (64 bits)\n00218| # 5. SACK bitmap provides selective acknowledgement for 64 PSNs\n00219| # 6. MPR provides flow control (limits sender window)\n00220| # 7. When NSCC is used, ACK_CC and/or ACK_CCX MUST be used\n00221| #\n00222| # Reference: ue-taxonomy/reference/field_definitions/pds_ack_cc.yaml\n00223| \n\n(End of file - total 223 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/ack_cc.ksy",
            "metadata": {
              "preview": "# GOLDEN REFERENCE: PDS ACK_CC (ACK with Congestion Control State)\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Table 3-36, Section 3.5.10.6, Page 259\n#\n# This is a GOLDEN REFERENCE definition for PDS ACK with congestion control state.\n# Demonstrates complex PDS packet with embedded CC state, SACK bitmap, and\n# congestion management integration.\n#\n# Quality Standards Applied:\n# 1. Every field extracted with exact bit position from Table 3-36\n# 2. All fields have x-required metadata\n# 3. Complete x-spec metadata for traceability\n# 4. First 12 bytes identical to PDS ACK (Table 3-35) with type=ACK_CC\n# 5. Additional 16 bytes for CC state, SACK bitmap, and CC parameters\n# 6. Total 28 bytes matching UE Spec exactly\n#\n# Leverages Cornelis IP: OPA reliability + congestion control patterns\n\nmeta:\n  id: pds_ack_cc",
              "truncated": false
            },
            "time": {
              "start": 1769123566365,
              "end": 1769123566440
            }
          }
        },
        {
          "id": "prt_be7fb532200194P4XMXbCravcW",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fb350d00119oLbigI5Ehoq6",
          "type": "tool",
          "callID": "toolu_014awMDvJ1Ef9s8LgPS7iCGA",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/nack.ksy"
            },
            "output": "<file>\n00001| # PDS NACK Header\n00002| # Feature: 003-ue-packet-taxonomy\n00003| # UE Specification: v1.0.1, Table 3-40, Section 3.5.10.10, Page 263\n00004| #\n00005| # NACK Header for negative acknowledgements.\n00006| \n00007| meta:\n00008|   id: pds_nack\n00009|   title: PDS NACK Header\n00010|   endian: be\n00011|   bit-endian: be\n00012|   doc: |\n00013|     Ultra Ethernet Transport (UET) Packet Delivery Sublayer (PDS) NACK Header Format.\n00014|     \n00015|     This 12-byte header is used for negative acknowledgements (NACKs) indicating\n00016|     packet loss, errors, or other conditions requiring retransmission or error handling.\n00017|     \n00018|     The NACK includes:\n00019|     - nack_code: Reason for NACK (enumerated in Section 3.5.12.7)\n00020|     - nack_psn or nack_pkt_id: PSN of packet that triggered NACK (or packet ID for RUDI)\n00021|     - spdcid/dpdcid: PDCIDs (cleared to 0 for RUDI or PDC establishment failures)\n00022|     - payload: NACK-code-specific payload (32 bits)\n00023|     \n00024|     Total Size: 12 bytes (96 bits)\n00025|     \n00026|     Wire Format (bytes 0-11):\n00027|     - Byte 0-1: Prologue (type(5)=10, next_hdr(4), flags(7))\n00028|     - Byte 2: nack_code (8 bits)\n00029|     - Byte 3: vendor_code (8 bits)\n00030|     - Byte 4-7: nack_psn or nack_pkt_id (32 bits)\n00031|     - Byte 8-9: spdcid (16 bits, 0 if nt=1 or PDC failure)\n00032|     - Byte 10-11: dpdcid (16 bits, 0 if nt=1)\n00033|   \n00034|   doc-ref:\n00035|     - \"UE Specification v1.0.1, Table 3-40, Page 263\"\n00036|     - \"UE Specification v1.0.1, Section 3.5.10.10\"\n00037|     - \"UE Specification v1.0.1, Section 3.5.12.7 (NACK Codes)\"\n00038|     - \"UE Specification v1.0.1, Figure 3-59\"\n00039|   \n00040|   license: \"Derived from UE Specification v1.0.1 (CC BY-ND 4.0)\"\n00041|   ks-version: \"0.10\"\n00042| \n00043| x-spec:\n00044|   table: \"Table 3-40\"\n00045|   section: \"Section 3.5.10.10\"\n00046|   page: 263\n00047|   figure: \"Figure 3-59\"\n00048|   spec_version: \"1.0.1\"\n00049|   spec_date: \"2025-09-05\"\n00050| \n00051| x-packet:\n00052|   layer: \"transport\"\n00053|   sublayer: \"pds\"\n00054|   category: \"nack_header\"\n00055|   size_bytes: 12\n00056|   size_bits: 96\n00057|   \n00058|   constraints:\n00059|     - \"Reserved fields MUST be 0\"\n00060|     - \"pds.type MUST be 10 (NACK)\"\n00061|     - \"next_hdr MUST be UET_HDR_NONE for NACKs\"\n00062|     - \"spdcid/dpdcid cleared to 0 for RUDI (nt=1) or PDC failures\"\n00063|   \n00064|   usage:\n00065|     - \"Indicates packet loss or errors\"\n00066|     - \"Triggers retransmission\"\n00067|     - \"Carries NACK code and vendor-specific info\"\n00068|   \n00069|   related_packets:\n00070|     - \"rud_rod_request\"\n00071|     - \"rud_rod_ack\"\n00072|     - \"nack_ccx\"\n00073| \n00074| seq:\n00075|   # Bytes 0-1: PDS Prologue\n00076|   - id: pds_type\n00077|     type: b5\n00078|     enum: pds_type_enum\n00079|     doc: |\n00080|       PDS Packet Type (5 bits). MUST be 10 (NACK).\n00081|       \n00082|       UE Spec: Table 3-40, field 'type'.\n00083|     x-required: true\n00084|     x-constraint: \"value == 10 (NACK)\"\n00085|     x-spec-ref: \"Table 3-40, field 'type'\"\n00086|     valid:\n00087|       eq: 10\n00088|   \n00089|   - id: next_hdr\n00090|     type: b4\n00091|     doc: |\n00092|       Next Header (4 bits). Always set to UET_HDR_NONE for NACKs.\n00093|       \n00094|       UE Spec: Table 3-40, field 'next_hdr'; Section 3.4.2.6\n00095|     x-required: true\n00096|     x-constraint: \"value == UET_HDR_NONE\"\n00097|     x-spec-ref: \"Table 3-40, field 'next_hdr'\"\n00098|   \n00099|   # Flags: [rsvd(1), m(1), retx(1), nt(1), rsvd(3)]\n00100|   - id: rsvd_flag_0\n00101|     type: b1\n00102|     doc: |\n00103|       Reserved flag (1 bit). MUST be 0.\n00104|       \n00105|       UE Spec: Table 3-40, pds.flags, field 'rsvd'.\n00106|     x-required: true\n00107|     x-constraint: \"value == 0\"\n00108|     x-spec-ref: \"Table 3-40, pds.flags, field 'rsvd'\"\n00109|     valid:\n00110|       eq: 0\n00111|   \n00112|   - id: ecn_marked\n00113|     type: b1\n00114|     doc: |\n00115|       ECN Marked flag (1 bit). Set to 1 if associated request packet was ECN marked.\n00116|       \n00117|       UE Spec: Table 3-40, pds.flags, field 'm'.\n00118|     x-required: true\n00119|     x-spec-ref: \"Table 3-40, pds.flags, field 'm'\"\n00120|   \n00121|   - id: retx\n00122|     type: b1\n00123|     doc: |\n00124|       Retransmit flag (1 bit). Set to 1 if the NACK'd packet was a retransmit.\n00125|       \n00126|       Refer to Section 3.5.11.8.4.\n00127|       \n00128|       UE Spec: Table 3-40, pds.flags, field 'retx'.\n00129|     x-required: true\n00130|     x-spec-ref: \"Table 3-40, pds.flags, field 'retx'; Section 3.5.11.8.4\"\n00131|   \n00132|   - id: nack_type\n00133|     type: b1\n00134|     doc: |\n00135|       NACK Type flag (1 bit). Indicates packet type being NACK'd.\n00136|       \n00137|       0 => RUD/ROD\n00138|       1 => RUDI\n00139|       \n00140|       When set to 1, nack_psn field is interpreted as nack_pkt_id, and\n00141|       spdcid/dpdcid fields are not valid (cleared to 0).\n00142|       \n00143|       UE Spec: Table 3-40, pds.flags, field 'nt'.\n00144|     x-required: true\n00145|     x-spec-ref: \"Table 3-40, pds.flags, field 'nt'\"\n00146|   \n00147|   - id: rsvd_flag_1\n00148|     type: b3\n00149|     doc: |\n00150|       Reserved flags (3 bits). MUST be 0.\n00151|       \n00152|       UE Spec: Table 3-40, pds.flags, field 'rsvd'.\n00153|     x-required: true\n00154|     x-constraint: \"value == 0\"\n00155|     x-spec-ref: \"Table 3-40, pds.flags, field 'rsvd'\"\n00156|     valid:\n00157|       eq: 0\n00158|   \n00159|   # Byte 2: nack_code (8 bits)\n00160|   - id: nack_code\n00161|     type: u1\n00162|     enum: nack_code_enum\n00163|     doc: |\n00164|       NACK Code (8 bits). Field indicating why the NACK was transmitted.\n00165|       \n00166|       Enumerated in Section 3.5.12.7 (Table 3-59).\n00167|       \n00168|       UE Spec: Table 3-40, field 'nack_code'; Section 3.5.12.7\n00169|     x-required: true\n00170|     x-constraint: \"value in Table 3-59 (PDS NACK Codes)\"\n00171|     x-spec-ref: \"Table 3-40, field 'nack_code'; Section 3.5.12.7\"\n00172|   \n00173|   # Byte 3: vendor_code (8 bits)\n00174|   - id: vendor_code\n00175|     type: u1\n00176|     doc: |\n00177|       Vendor Code (8 bits). Vendor-specific field for statistics collection.\n00178|       \n00179|       No processing requirements and no interop required. This field may be\n00180|       ignored. Interpretation is outside the scope of the UE Specification.\n00181|       \n00182|       UE Spec: Table 3-40, field 'vendor_code'.\n00183|     x-required: false\n00184|     x-spec-ref: \"Table 3-40, field 'vendor_code'\"\n00185|   \n00186|   # Bytes 4-7: nack_psn or nack_pkt_id (32 bits)\n00187|   - id: nack_psn_or_pkt_id\n00188|     type: u4\n00189|     doc: |\n00190|       NACK PSN or Packet ID (32 bits). Interpretation depends on nack_type flag.\n00191|       \n00192|       When nack_type = 0 (RUD/ROD):\n00193|         Packet sequence number associated with the received packet that triggered\n00194|         the generation of the NACK packet.\n00195|       \n00196|       When nack_type = 1 (RUDI):\n00197|         This field is pds.nack_pkt_id - the NACK'd packet was a RUDI packet.\n00198|         The pds.spdcid and pds.dpdcid fields are not valid.\n00199|       \n00200|       UE Spec: Table 3-40, field 'nack_psn' or 'nack_pkt_id'.\n00201|     x-required: true\n00202|     x-spec-ref: \"Table 3-40, field 'nack_psn' or 'nack_pkt_id'\"\n00203|   \n00204|   # Bytes 8-9: spdcid (16 bits)\n00205|   - id: spdcid\n00206|     type: u2\n00207|     doc: |\n00208|       Source PDCID (16 bits). Source Packet Delivery Context ID.\n00209|       \n00210|       If pds.nack_code indicates PDC establishment failure (e.g., out of PDC\n00211|       resources), this field is cleared to 0 and is not valid.\n00212|       \n00213|       Cleared to 0x0 if pds.flags.nt is set (RUDI NACK).\n00214|       \n00215|       UE Spec: Table 3-40, field 'spdcid'.\n00216|     x-required: true\n00217|     x-spec-ref: \"Table 3-40, field 'spdcid'\"\n00218|   \n00219|   # Bytes 10-11: dpdcid (16 bits)\n00220|   - id: dpdcid\n00221|     type: u2\n00222|     doc: |\n00223|       Destination PDCID (16 bits). Destination Packet Delivery Context ID.\n00224|       \n00225|       Cleared to 0x0 if pds.flags.nt is set (RUDI NACK).\n00226|       \n00227|       UE Spec: Table 3-40, field 'dpdcid'.\n00228|     x-required: true\n00229|     x-spec-ref: \"Table 3-40, field 'dpdcid'\"\n00230| \n00231| enums:\n00232|   pds_type_enum:\n00233|     10:\n00234|       id: nack\n00235|       doc: \"NACK packet type\"\n00236|   \n00237|   nack_code_enum:\n00238|     0x00:\n00239|       id: uet_no_pkt_buf\n00240|       doc: \"No packet buffer available\"\n00241|     0x01:\n00242|       id: uet_trimmed\n00243|       doc: \"Packet was trimmed\"\n00244|     0x02:\n00245|       id: uet_no_pdc_avail\n00246|       doc: \"No PDC resources available\"\n00247|     0x03:\n00248|       id: uet_inv_dpdcid\n00249|       doc: \"Invalid destination PDCID\"\n00250|     0x04:\n00251|       id: uet_pdc_hdr_mismatch\n00252|       doc: \"PDC header mismatch\"\n00253|     0x05:\n00254|       id: uet_psn_oor_window\n00255|       doc: \"PSN outside expected window\"\n00256|     0x06:\n00257|       id: uet_psn_gap\n00258|       doc: \"PSN gap detected (packet loss)\"\n00259| \n\n(End of file - total 259 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/ue/transport/pds/nack.ksy",
            "metadata": {
              "preview": "# PDS NACK Header\n# Feature: 003-ue-packet-taxonomy\n# UE Specification: v1.0.1, Table 3-40, Section 3.5.10.10, Page 263\n#\n# NACK Header for negative acknowledgements.\n\nmeta:\n  id: pds_nack\n  title: PDS NACK Header\n  endian: be\n  bit-endian: be\n  doc: |\n    Ultra Ethernet Transport (UET) Packet Delivery Sublayer (PDS) NACK Header Format.\n    \n    This 12-byte header is used for negative acknowledgements (NACKs) indicating\n    packet loss, errors, or other conditions requiring retransmission or error handling.\n    \n    The NACK includes:\n    - nack_code: Reason for NACK (enumerated in Section 3.5.12.7)\n    - nack_psn or nack_pkt_id: PSN of packet that triggered NACK (or packet ID for RUDI)",
              "truncated": false
            },
            "time": {
              "start": 1769123566371,
              "end": 1769123566432
            }
          }
        },
        {
          "id": "prt_be7fb5370001hVYjzwrE0sARb2",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fb350d00119oLbigI5Ehoq6",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 83778,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7fb53ad001At7o2Ky63gl448",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769123566509,
          "completed": 1769123582673
        },
        "parentID": "msg_be7faadd7001qnhXPM5tKghXUR",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 93065,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7fb58040015wPxbSJ3g71sno",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fb53ad001At7o2Ky63gl448",
          "type": "step-start"
        },
        {
          "id": "prt_be7fb9290001dTtrJmEiEjHUHn",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fb53ad001At7o2Ky63gl448",
          "type": "tool",
          "callID": "toolu_01J7uBCU1wyUCEDfP8KJfBEi",
          "tool": "todowrite",
          "state": {
            "status": "completed",
            "input": {
              "todos": [
                {
                  "id": "p1-1",
                  "content": "Read current packet_taxonomy.md Section 3 structure",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-2",
                  "content": "Expand PDS 3.3.1 UUD Request (Type 0x00)",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "p1-3",
                  "content": "Expand PDS 3.3.2 RUDI Request/Response (Type 0x01)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-4",
                  "content": "Expand PDS 3.3.3 RUD Request (Type 0x02)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-5",
                  "content": "Expand PDS 3.3.4 ROD Request (Type 0x03)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-6",
                  "content": "Expand PDS 3.3.5 Control Packet (Type 0x04)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-7",
                  "content": "Expand PDS 3.3.6 ACK (Type 0x08)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-8",
                  "content": "Expand PDS 3.3.7 ACK_CC (Type 0x09)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-9",
                  "content": "Expand PDS 3.3.8 ACK_CCX (Type 0x0A)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-10",
                  "content": "Expand PDS 3.3.9 NACK (Type 0x0C)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-11",
                  "content": "Expand PDS 3.3.10 NACK_CCX (Type 0x0D)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-12",
                  "content": "Expand SES 3.5.1 Standard Request SOM=1 (Table 3-8)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-13",
                  "content": "Expand SES 3.5.2 Standard Request SOM=0 (Table 3-9)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-14",
                  "content": "Expand SES 3.5.3 Response (Table 3-11)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-15",
                  "content": "Expand SES 3.5.4 Response with Data (Table 3-12)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-16",
                  "content": "Expand SES 3.5.5 Optimized Response with Data (Figure 3-13)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p1-17",
                  "content": "Expand SES 3.5.6 Small Message (Figure 3-14)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-18",
                  "content": "Expand SES 3.5.7 Rendezvous Extension (Figure 3-15)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p1-19",
                  "content": "Expand SES 3.5.8 Atomic Extension (Figure 3-16)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p1-20",
                  "content": "Add cross-reference diagrams to section headers",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p1-21",
                  "content": "Validation pass against .ksy files",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-22",
                  "content": "Update change log",
                  "status": "pending",
                  "priority": "medium"
                }
              ]
            },
            "output": "[\n  {\n    \"id\": \"p1-1\",\n    \"content\": \"Read current packet_taxonomy.md Section 3 structure\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-2\",\n    \"content\": \"Expand PDS 3.3.1 UUD Request (Type 0x00)\",\n    \"status\": \"in_progress\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-3\",\n    \"content\": \"Expand PDS 3.3.2 RUDI Request/Response (Type 0x01)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-4\",\n    \"content\": \"Expand PDS 3.3.3 RUD Request (Type 0x02)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-5\",\n    \"content\": \"Expand PDS 3.3.4 ROD Request (Type 0x03)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-6\",\n    \"content\": \"Expand PDS 3.3.5 Control Packet (Type 0x04)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-7\",\n    \"content\": \"Expand PDS 3.3.6 ACK (Type 0x08)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-8\",\n    \"content\": \"Expand PDS 3.3.7 ACK_CC (Type 0x09)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-9\",\n    \"content\": \"Expand PDS 3.3.8 ACK_CCX (Type 0x0A)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-10\",\n    \"content\": \"Expand PDS 3.3.9 NACK (Type 0x0C)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-11\",\n    \"content\": \"Expand PDS 3.3.10 NACK_CCX (Type 0x0D)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-12\",\n    \"content\": \"Expand SES 3.5.1 Standard Request SOM=1 (Table 3-8)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-13\",\n    \"content\": \"Expand SES 3.5.2 Standard Request SOM=0 (Table 3-9)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-14\",\n    \"content\": \"Expand SES 3.5.3 Response (Table 3-11)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-15\",\n    \"content\": \"Expand SES 3.5.4 Response with Data (Table 3-12)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-16\",\n    \"content\": \"Expand SES 3.5.5 Optimized Response with Data (Figure 3-13)\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p1-17\",\n    \"content\": \"Expand SES 3.5.6 Small Message (Figure 3-14)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-18\",\n    \"content\": \"Expand SES 3.5.7 Rendezvous Extension (Figure 3-15)\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p1-19\",\n    \"content\": \"Expand SES 3.5.8 Atomic Extension (Figure 3-16)\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p1-20\",\n    \"content\": \"Add cross-reference diagrams to section headers\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p1-21\",\n    \"content\": \"Validation pass against .ksy files\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-22\",\n    \"content\": \"Update change log\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  }\n]",
            "title": "21 todos",
            "metadata": {
              "todos": [
                {
                  "id": "p1-1",
                  "content": "Read current packet_taxonomy.md Section 3 structure",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-2",
                  "content": "Expand PDS 3.3.1 UUD Request (Type 0x00)",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "p1-3",
                  "content": "Expand PDS 3.3.2 RUDI Request/Response (Type 0x01)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-4",
                  "content": "Expand PDS 3.3.3 RUD Request (Type 0x02)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-5",
                  "content": "Expand PDS 3.3.4 ROD Request (Type 0x03)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-6",
                  "content": "Expand PDS 3.3.5 Control Packet (Type 0x04)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-7",
                  "content": "Expand PDS 3.3.6 ACK (Type 0x08)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-8",
                  "content": "Expand PDS 3.3.7 ACK_CC (Type 0x09)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-9",
                  "content": "Expand PDS 3.3.8 ACK_CCX (Type 0x0A)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-10",
                  "content": "Expand PDS 3.3.9 NACK (Type 0x0C)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-11",
                  "content": "Expand PDS 3.3.10 NACK_CCX (Type 0x0D)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-12",
                  "content": "Expand SES 3.5.1 Standard Request SOM=1 (Table 3-8)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-13",
                  "content": "Expand SES 3.5.2 Standard Request SOM=0 (Table 3-9)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-14",
                  "content": "Expand SES 3.5.3 Response (Table 3-11)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-15",
                  "content": "Expand SES 3.5.4 Response with Data (Table 3-12)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-16",
                  "content": "Expand SES 3.5.5 Optimized Response with Data (Figure 3-13)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p1-17",
                  "content": "Expand SES 3.5.6 Small Message (Figure 3-14)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-18",
                  "content": "Expand SES 3.5.7 Rendezvous Extension (Figure 3-15)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p1-19",
                  "content": "Expand SES 3.5.8 Atomic Extension (Figure 3-16)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p1-20",
                  "content": "Add cross-reference diagrams to section headers",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p1-21",
                  "content": "Validation pass against .ksy files",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-22",
                  "content": "Update change log",
                  "status": "pending",
                  "priority": "medium"
                }
              ],
              "truncated": false
            },
            "time": {
              "start": 1769123582610,
              "end": 1769123582663
            }
          }
        },
        {
          "id": "prt_be7fb92c80017CP2gxur3Jf5mn",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fb53ad001At7o2Ky63gl448",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 93065,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7fb9301001yf5axy2QpM8ISq",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769123582721,
          "completed": 1769123705781
        },
        "parentID": "msg_be7faadd7001qnhXPM5tKghXUR",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 94073,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7fb9756001sDJLiFY0GP39br",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fb9301001yf5axy2QpM8ISq",
          "type": "step-start"
        },
        {
          "id": "prt_be7fd7274001w44u5GVwPCzfAx",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fb9301001yf5axy2QpM8ISq",
          "type": "tool",
          "callID": "toolu_01RDUEFKkFjWEbcQrdCwhG1e",
          "tool": "edit",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
              "oldString": "### 3.3 PDS Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/pds/`\n\n| Format | File | Size | Description |\n|--------|------|------|-------------|\n| RUD/ROD Request | `rud_rod_request.ksy` | Variable | Reliable delivery request |\n| RUD/ROD ACK | `rud_rod_ack.ksy` | Variable | Acknowledgment |\n| ACK_CC | `ack_cc.ksy` | Variable | ACK with CC state |\n| ACK_CCX | `ack_ccx.ksy` | Variable | ACK with extended CC |\n| NACK | `nack.ksy` | Variable | Negative acknowledgment |\n| NACK_CCX | `nack_ccx.ksy` | Variable | NACK with extended CC |\n| RUDI Request/Response | `rudi_request_response.ksy` | Variable | Low-latency immediate |\n| UUD Request | `uud_request.ksy` | Variable | Unreliable delivery |\n| Control Packet | `rud_rod_cp.ksy` | Variable | Control packet |\n| Entropy Header | `entropy_header.ksy` | Variable | Entropy extension |",
              "newString": "### 3.3 PDS Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/pds/`\n\n```\nPDS Request/Response Relationships:\n┌─────────────────────────────────────────────────────────────────┐\n│                                                                 │\n│  UUD Request (0x06) ──────────────────────→ (no response)       │\n│                                                                 │\n│  RUDI Request (0x04) ─────────────────────→ RUDI Response (0x05)│\n│                       └───────────────────→ NACK (0x0A)         │\n│                                                                 │\n│  RUD Request (0x01) ──┬───────────────────→ ACK (0x07)          │\n│                       ├───────────────────→ ACK_CC (0x08)       │\n│                       ├───────────────────→ ACK_CCX (0x09)      │\n│                       ├───────────────────→ NACK (0x0A)         │\n│                       └───────────────────→ NACK_CCX (0x0C)     │\n│                                                                 │\n│  ROD Request (0x02) ──┴───────────────────→ (same as RUD)       │\n│                                                                 │\n│  Control Packet (0x0B) ───────────────────→ (varies by subtype) │\n│                                                                 │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n| Type | Format | File | Size | Description |\n|------|--------|------|------|-------------|\n| 0x01 | RUD Request | `rud_rod_request.ksy` | 12 bytes | Reliable Unordered Delivery |\n| 0x02 | ROD Request | `rud_rod_request.ksy` | 12 bytes | Reliable Ordered Delivery |\n| 0x04 | RUDI Request | `rudi_request_response.ksy` | 6 bytes | Reliable Unordered Immediate |\n| 0x05 | RUDI Response | `rudi_request_response.ksy` | 6 bytes | RUDI response |\n| 0x06 | UUD Request | `uud_request.ksy` | 6 bytes | Unreliable Unordered Delivery |\n| 0x07 | ACK | `rud_rod_ack.ksy` | 12 bytes | Acknowledgment |\n| 0x08 | ACK_CC | `ack_cc.ksy` | 28 bytes | ACK with CC state |\n| 0x09 | ACK_CCX | `ack_ccx.ksy` | 44 bytes | ACK with extended CC |\n| 0x0A | NACK | `nack.ksy` | 12 bytes | Negative acknowledgment |\n| 0x0B | CP | `rud_rod_cp.ksy` | 12 bytes | Control packet (10 subtypes) |\n| 0x0C | NACK_CCX | `nack_ccx.ksy` | 28 bytes | NACK with extended CC |\n\n#### 3.3.1 RUD Request (Type 0x01, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_request.ksy`  \n**Related Formats**: [ROD Request (3.3.2)](#332-rod-request-type-0x02-12-bytes) | [ACK (3.3.6)](#336-ack-type-0x07-12-bytes) | [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |nxt|flg|       clear_psn_offset |         PSN [31:0]    →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|r|a|s|rsvd|\n       | (5 bits)|(4 bit)| (2) |t|r|y|(2) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x01 (RUD) | Must be 0x01 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 2 | 1[6:5] | Reserved | Must be 0 |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.ar | 1 | 1[3] | ACK request | 0=no ACK, 1=request ACK |\n| flags.syn | 1 | 1[2] | PDC establishment | 0=normal, 1=SYN |\n| flags.rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n| clear_psn_offset | 16 | 2-3 | CLEAR_PSN relative to PSN | Unsigned offset |\n| psn | 32 | 4-7 | Packet Sequence Number | 32-bit, wraps |\n| spdcid | 16 | 8-9 | Source PDCID | Valid PDCID |\n| dpdcid | 16 | 10-11 | Destination PDCID | See note below |\n\n##### Field Notes\n\n**dpdcid Interpretation** (depends on `syn` flag):\n- `syn=0`: Destination PDCID for established PDC\n- `syn=1`: `{pdc_info[3:0], psn_offset[11:0]}` for PDC establishment\n  - `pdc_info[0]`: use_rsv_pdc (1=reserved pool, 0=shared pool)\n  - `pdc_info[3:1]`: Reserved\n  - `psn_offset[11:0]`: Difference between PSN and Start_PSN\n\n**clear_psn_offset**: Computed as `CLEAR_PSN = PSN - clear_psn_offset`. Indicates the highest PSN that has been delivered to SES at the source.\n\n##### Protocol Behavior\n\n**Delivery Mode**: RUD (Reliable Unordered Delivery) provides reliable packet delivery without ordering guarantees. Packets may be delivered to SES out of order.\n\n**State Machine**: RUD operates within the PDC (Packet Delivery Channel) state machine defined in Section 3.5.7.\n\n**Transmission Rules**:\n1. Source assigns monotonically increasing PSN to each packet\n2. `ar` flag SHOULD be set periodically (per `ack_request_interval`)\n3. `retx` flag set when retransmitting due to timeout or NACK\n4. `syn` flag set only for first packet establishing new PDC\n\n**Receiver Processing**:\n1. Validate PDCID and PSN\n2. If PSN is new: deliver to SES immediately (no ordering)\n3. If PSN is duplicate: discard, optionally send ACK\n4. If `ar=1`: generate ACK, ACK_CC, or ACK_CCX response\n\n**Timing Constraints**:\n- Retransmit timeout: Implementation-defined (typically RTT-based)\n- ACK coalescing: Up to `ack_coalesce_count` packets\n\n**Reference**: UE Spec v1.0.1, Table 3-33, Section 3.5.10.3, Page 256\n\n---\n\n#### 3.3.2 ROD Request (Type 0x02, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_request.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [ACK (3.3.6)](#336-ack-type-0x07-12-bytes) | [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\nIdentical to RUD Request (Section 3.3.1) with `type = 0x02`.\n\n##### Field Definitions\n\nSame as RUD Request. Only `type` field differs.\n\n##### Protocol Behavior\n\n**Delivery Mode**: ROD (Reliable Ordered Delivery) provides reliable packet delivery with strict ordering guarantees. Packets are delivered to SES in PSN order.\n\n**Key Difference from RUD**: ROD receiver MUST buffer out-of-order packets and deliver to SES only when all preceding PSNs have been received.\n\n**Ordering Guarantee**:\n- Receiver maintains expected PSN\n- Out-of-order packets are buffered (not delivered)\n- When gap is filled, buffered packets delivered in order\n- Head-of-line blocking possible if packet lost\n\n**Use Cases**:\n- Multi-packet messages requiring in-order delivery\n- Streaming data with ordering requirements\n- Operations where partial delivery is not acceptable\n\n**Reference**: UE Spec v1.0.1, Table 3-33, Section 3.5.10.3, Page 256\n\n---\n\n#### 3.3.3 RUDI Request (Type 0x04, 6 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rudi_request_response.ksy`  \n**Related Formats**: [RUDI Response (3.3.4)](#334-rudi-response-type-0x05-6-bytes) | [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5\n     +-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  |         pkt_id [31:0]     |\n     +-------+-------+-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|r|retx|rsvd|\n       | (5 bits)|(4 bit)| (1) |m| (1)|(4) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x04 (RUDI Request) | Must be 0x04 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.rsvd_m | 1 | 1[5] | Reserved (m for response) | Must be 0 for request |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.rsvd | 4 | 1[3:0] | Reserved | Must be 0 |\n| pkt_id | 32 | 2-5 | Packet Identifier | Locally unique |\n\n##### Protocol Behavior\n\n**Delivery Mode**: RUDI (Reliable Unordered Delivery with Idempotence) provides reliable delivery for idempotent operations without PDC context.\n\n**Key Characteristics**:\n- Uses packet ID instead of sequence number\n- No PDC (Packet Delivery Context) required\n- Idempotent: safe to retry without side effects\n- Smaller header (6 bytes vs 12 bytes for RUD/ROD)\n\n**Idempotence Guarantee**:\n- Receiver tracks recently processed pkt_ids\n- Duplicate pkt_ids are detected and response re-sent\n- No state corruption from retransmissions\n\n**Use Cases**:\n- Small, self-contained operations\n- Stateless request/response patterns\n- Operations where retry is safe (reads, idempotent writes)\n\n**Reference**: UE Spec v1.0.1, Table 3-39, Section 3.5.10.9, Page 262\n\n---\n\n#### 3.3.4 RUDI Response (Type 0x05, 6 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rudi_request_response.ksy`  \n**Related Formats**: [RUDI Request (3.3.3)](#333-rudi-request-type-0x04-6-bytes)\n\n##### Wire Format\n\nIdentical to RUDI Request with `type = 0x05` and `flags.m` valid.\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x05 (RUDI Response) | Must be 0x05 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.m | 1 | 1[5] | ECN marked | 1 if request was ECN marked |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.rsvd | 4 | 1[3:0] | Reserved | Must be 0 |\n| pkt_id | 32 | 2-5 | Packet Identifier | Echoed from request |\n\n##### Protocol Behavior\n\n**Response Generation**:\n1. Receiver processes RUDI Request\n2. Generates RUDI Response with same pkt_id\n3. Sets `m` flag if request packet was ECN marked\n\n**Reference**: UE Spec v1.0.1, Table 3-39, Section 3.5.10.9, Page 262\n\n---\n\n#### 3.3.5 UUD Request (Type 0x06, 6 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/uud_request.ksy`  \n**Related Formats**: None (no response generated)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5\n     +-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  |         pkt_id [31:0]     |\n     +-------+-------+-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr|     rsvd (7)    |\n       | (5 bits)|(4 bit)|                 |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x06 (UUD) | Must be 0x06 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 7 | 1[6:0] | Reserved | Must be 0 |\n| pkt_id | 32 | 2-5 | Packet Identifier | Locally unique |\n\n##### Protocol Behavior\n\n**Delivery Mode**: UUD (Unreliable Unordered Delivery) provides best-effort delivery with no reliability guarantees.\n\n**Key Characteristics**:\n- No ACKs or NACKs generated\n- No retransmissions\n- Packet loss is acceptable\n- Lowest overhead delivery mode\n\n**Use Cases**:\n- Loss-tolerant traffic (video streaming, telemetry)\n- High-frequency updates where latest value matters\n- Multicast/broadcast scenarios\n\n**Reference**: UE Spec v1.0.1, Table 3-42, Section 3.5.10.12, Page 265\n\n---\n\n#### 3.3.6 ACK (Type 0x07, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_ack.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [ACK_CC (3.3.7)](#337-ack_cc-type-0x08-28-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  |   ack_psn_offset  |    probe_opaque     →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |   cack_psn    |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|m|r|p|req|rsvd|\n       | (5 bits)|(4 bit)| (1) | |t| |   |(1) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x07 (ACK) | Must be 0x07 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | UET_HDR_NONE |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.m | 1 | 1[5] | ECN marked | 1 if any ACK'd packet was ECN marked |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.p | 1 | 1[3] | Probe response | 1 if responding to Probe CP |\n| flags.req | 2 | 1[2:1] | Request type | 0=RUD, 1=ROD |\n| flags.rsvd | 1 | 1[0] | Reserved | Must be 0 |\n| ack_psn_offset | 16 | 2-3 | Offset from CACK_PSN to ACK_PSN | Signed |\n| probe_opaque | 16 | 4-5 | Copied from Probe CP | Opaque value |\n| cack_psn | 32 | 6-9 | Cumulative ACK PSN | Highest in-order PSN |\n| spdcid | 16 | 10-11 | Source PDCID | Swapped from request |\n| dpdcid | 16 | 12-13 | Destination PDCID | Swapped from request |\n\n**Note**: Wire format shows 12 bytes but field table shows 14 bytes. Verify against spec - likely cack_psn is 16 bits or spdcid/dpdcid share bytes 10-11.\n\n##### Protocol Behavior\n\n**ACK Generation**:\n1. Receiver tracks highest in-order PSN received (CACK_PSN)\n2. ACK generated when `ar` flag set in request, or periodically\n3. `m` flag set if any ACK'd packet had ECN marking\n\n**Cumulative ACK**:\n- `cack_psn` acknowledges all PSNs ≤ this value\n- Sender can free buffers for acknowledged packets\n- Enables sliding window flow control\n\n**Reference**: UE Spec v1.0.1, Table 3-35, Section 3.5.10.5, Page 258\n\n---\n\n#### 3.3.7 ACK_CC (Type 0x08, 28 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/ack_cc.ksy`  \n**Related Formats**: [ACK (3.3.6)](#336-ack-type-0x07-12-bytes) | [ACK_CCX (3.3.8)](#338-ack_ccx-type-0x09-44-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |                    ACK Header (12 bytes)                      |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |  (ACK cont'd) |cc_typ|cc_flg|  mpr  | sack_psn_offset       →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |              sack_bitmap [63:0]                               |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        24      25      26      27\n     +-------+-------+-------+-------+\n     |       ack_cc_state [63:0]     |\n     +-------+-------+-------+-------+\n```\n\n##### Field Definitions (CC Extension, bytes 12-27)\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| cc_type | 4 | 12[7:4] | CC algorithm type | Per Section 3.6.9 |\n| cc_flags | 4 | 12[3:0] | CC flags | Reserved, must be 0 |\n| mpr | 8 | 13 | Maximum PSN Range | Flow control window |\n| sack_psn_offset | 16 | 14-15 | Offset to SACK base PSN | Signed |\n| sack_bitmap | 64 | 16-23 | Selective ACK bitmap | 1=ACK'd, 0=not ACK'd |\n| ack_cc_state | 64 | 24-27 | CC state (per cc_type) | See Section 3.6.9 |\n\n##### CC Type Values\n\n| Value | Name | Description |\n|-------|------|-------------|\n| 0x0 | CC_NSCC | Network-Signaled Congestion Control |\n| 0x1 | CC_CREDIT | RCCC/TFC Credit-based CC |\n\n##### Protocol Behavior\n\n**Selective ACK (SACK)**:\n- `sack_bitmap` covers 64 PSNs starting at `CACK_PSN + sack_psn_offset`\n- Bit N = 1 means PSN (base + N) received\n- Enables efficient loss recovery without full retransmit\n\n**Congestion Control State**:\n- `ack_cc_state` interpretation depends on `cc_type`\n- For NSCC: Contains service_time, rcv_cwnd_pend, rcvd_bytes, ooo_count\n- For CREDIT: Contains credit information\n\n**Reference**: UE Spec v1.0.1, Table 3-36, Section 3.5.10.6, Page 259\n\n---\n\n#### 3.3.8 ACK_CCX (Type 0x09, 44 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/ack_ccx.ksy`  \n**Related Formats**: [ACK_CC (3.3.7)](#337-ack_cc-type-0x08-28-bytes)\n\n##### Wire Format\n\nACK_CCX extends ACK_CC with additional 16 bytes for extended CC state.\n\n```\nBytes 0-27:  ACK_CC header (28 bytes)\nBytes 28-43: Extended CC state (16 bytes)\n```\n\n##### Additional Fields (bytes 28-43)\n\n| Field | Bits | Offset | Description |\n|-------|------|--------|-------------|\n| ack_ccx_state | 128 | 28-43 | Extended CC state |\n\n##### Protocol Behavior\n\n**Extended State**: ACK_CCX provides additional CC state for algorithms requiring more than 64 bits of feedback.\n\n**Reference**: UE Spec v1.0.1, Table 3-37, Section 3.5.10.7, Page 260\n\n---\n\n#### 3.3.9 NACK (Type 0x0A, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/nack.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [NACK_CCX (3.3.10)](#3310-nack_ccx-type-0x0c-28-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  | nack_code |vendor_code|   nack_psn [31:0] →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|m|r|nt|rsvd|\n       | (5 bits)|(4 bit)| (1) | |t|  |(3) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x0A (NACK) | Must be 0x0A |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | UET_HDR_NONE |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.m | 1 | 1[5] | ECN marked | 1 if request was ECN marked |\n| flags.retx | 1 | 1[4] | Retransmit indicator | From request |\n| flags.nt | 1 | 1[3] | NACK type | 0=RUD/ROD, 1=RUDI |\n| flags.rsvd | 3 | 1[2:0] | Reserved | Must be 0 |\n| nack_code | 8 | 2 | NACK reason code | Per Table 3-59 |\n| vendor_code | 8 | 3 | Vendor-specific code | Optional |\n| nack_psn | 32 | 4-7 | NACK'd PSN or pkt_id | Depends on nt flag |\n| spdcid | 16 | 8-9 | Source PDCID | 0 if nt=1 or PDC failure |\n| dpdcid | 16 | 10-11 | Destination PDCID | 0 if nt=1 |\n\n##### NACK Codes (Table 3-59)\n\n| Code | Name | Description |\n|------|------|-------------|\n| 0x00 | UET_NO_PKT_BUF | No packet buffer available |\n| 0x01 | UET_TRIMMED | Packet was trimmed |\n| 0x02 | UET_NO_PDC_AVAIL | No PDC resources available |\n| 0x03 | UET_INV_DPDCID | Invalid destination PDCID |\n| 0x04 | UET_PDC_HDR_MISMATCH | PDC header mismatch |\n| 0x05 | UET_PSN_OOR_WINDOW | PSN outside expected window |\n| 0x06 | UET_PSN_GAP | PSN gap detected (packet loss) |\n\n##### Protocol Behavior\n\n**NACK Generation**:\n1. Receiver detects error condition (loss, resource exhaustion, etc.)\n2. Generates NACK with appropriate nack_code\n3. Sender receives NACK and takes corrective action\n\n**Sender Response to NACK**:\n- `UET_PSN_GAP`: Retransmit missing packets\n- `UET_NO_PKT_BUF`: Back off, retry later\n- `UET_NO_PDC_AVAIL`: PDC establishment failed, retry or abort\n\n**Reference**: UE Spec v1.0.1, Table 3-40, Section 3.5.10.10, Page 263\n\n---\n\n#### 3.3.10 NACK_CCX (Type 0x0C, 28 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/nack_ccx.ksy`  \n**Related Formats**: [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\nNACK_CCX extends NACK with 16 bytes of CC state (similar to ACK_CC extension).\n\n```\nBytes 0-11:  NACK header (12 bytes)\nBytes 12-27: CC extension (16 bytes)\n```\n\n##### Protocol Behavior\n\n**Extended NACK**: NACK_CCX provides congestion control feedback along with the negative acknowledgment, enabling the sender to adjust its rate while handling the error.\n\n**Reference**: UE Spec v1.0.1, Table 3-41, Section 3.5.10.11, Page 264\n\n---\n\n#### 3.3.11 Control Packet (Type 0x0B, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_cp.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [ACK (3.3.6)](#336-ack-type-0x07-12-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |ctl|  flags  |   probe_opaque    |         PSN [31:0]  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |ctl_typ| rsvd|i|r|a|s|rsvd|\n       | (5 bits)|(4 bit)| (1) |r|t|r|y|(2) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x0B (CP) | Must be 0x0B |\n| ctl_type | 4 | 0[2:0]+1[7] | Control packet subtype | 0-9 defined |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.isrod | 1 | 1[5] | ROD indicator | 1=ROD, 0=RUD (for NOOP/Negotiation) |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.ar | 1 | 1[3] | ACK request | 0=no ACK, 1=request ACK |\n| flags.syn | 1 | 1[2] | PDC establishment | 0=normal, 1=SYN |\n| flags.rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n| probe_opaque | 16 | 2-3 | Opaque value for Probe | Echoed in ACK |\n| psn | 32 | 4-7 | Packet Sequence Number | Some CPs consume PSN |\n| spdcid | 16 | 8-9 | Source PDCID | Valid PDCID |\n| dpdcid | 16 | 10-11 | Destination PDCID | Or {pdc_info, psn_offset} |\n\n##### Control Packet Subtypes\n\n| ctl_type | Name | Direction | Description |\n|----------|------|-----------|-------------|\n| 0 | NOOP | Either | No operation |\n| 1 | ACK_REQUEST | Src→Dst | Request ACK for specific PSN |\n| 2 | CLEAR_COMMAND | Init→Tgt | Clear guaranteed delivery state |\n| 3 | CLEAR_REQUEST | Tgt→Init | Request initiator to send clear |\n| 4 | CLOSE_COMMAND | Init→Tgt | PDC is being closed |\n| 5 | CLOSE_REQUEST | Tgt→Init | Request initiator to close PDC |\n| 6 | PROBE | Src→Dst | Request PDS ACK |\n| 7 | CREDIT | Dst→Src | Carry CC credit |\n| 8 | CREDIT_REQUEST | Src→Dst | Request credit |\n| 9 | NEGOTIATION | Either | PDC negotiation |\n\n##### Protocol Behavior\n\n**PDC Lifecycle**:\n- `CLOSE_COMMAND/REQUEST`: Graceful PDC teardown\n- `CLEAR_COMMAND/REQUEST`: Clear delivery state without closing\n\n**Flow Control**:\n- `CREDIT/CREDIT_REQUEST`: Credit-based flow control\n- `PROBE`: Solicit ACK for RTT measurement or liveness check\n\n**Reference**: UE Spec v1.0.1, Table 3-38, Section 3.5.10.8, Page 261"
            },
            "output": "Edit applied successfully.",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy.md",
            "metadata": {
              "diagnostics": {},
              "diff": "Index: /home/matkins/CN7000/analysis/packet_taxonomy.md\n===================================================================\n--- /home/matkins/CN7000/analysis/packet_taxonomy.md\n+++ /home/matkins/CN7000/analysis/packet_taxonomy.md\n@@ -164,21 +164,592 @@\n ### 3.3 PDS Packet Formats\n \n **Datamodel Directory**: `datamodel/protocols/ue/transport/pds/`\n \n-| Format | File | Size | Description |\n-|--------|------|------|-------------|\n-| RUD/ROD Request | `rud_rod_request.ksy` | Variable | Reliable delivery request |\n-| RUD/ROD ACK | `rud_rod_ack.ksy` | Variable | Acknowledgment |\n-| ACK_CC | `ack_cc.ksy` | Variable | ACK with CC state |\n-| ACK_CCX | `ack_ccx.ksy` | Variable | ACK with extended CC |\n-| NACK | `nack.ksy` | Variable | Negative acknowledgment |\n-| NACK_CCX | `nack_ccx.ksy` | Variable | NACK with extended CC |\n-| RUDI Request/Response | `rudi_request_response.ksy` | Variable | Low-latency immediate |\n-| UUD Request | `uud_request.ksy` | Variable | Unreliable delivery |\n-| Control Packet | `rud_rod_cp.ksy` | Variable | Control packet |\n-| Entropy Header | `entropy_header.ksy` | Variable | Entropy extension |\n+```\n+PDS Request/Response Relationships:\n+┌─────────────────────────────────────────────────────────────────┐\n+│                                                                 │\n+│  UUD Request (0x06) ──────────────────────→ (no response)       │\n+│                                                                 │\n+│  RUDI Request (0x04) ─────────────────────→ RUDI Response (0x05)│\n+│                       └───────────────────→ NACK (0x0A)         │\n+│                                                                 │\n+│  RUD Request (0x01) ──┬───────────────────→ ACK (0x07)          │\n+│                       ├───────────────────→ ACK_CC (0x08)       │\n+│                       ├───────────────────→ ACK_CCX (0x09)      │\n+│                       ├───────────────────→ NACK (0x0A)         │\n+│                       └───────────────────→ NACK_CCX (0x0C)     │\n+│                                                                 │\n+│  ROD Request (0x02) ──┴───────────────────→ (same as RUD)       │\n+│                                                                 │\n+│  Control Packet (0x0B) ───────────────────→ (varies by subtype) │\n+│                                                                 │\n+└─────────────────────────────────────────────────────────────────┘\n+```\n \n+| Type | Format | File | Size | Description |\n+|------|--------|------|------|-------------|\n+| 0x01 | RUD Request | `rud_rod_request.ksy` | 12 bytes | Reliable Unordered Delivery |\n+| 0x02 | ROD Request | `rud_rod_request.ksy` | 12 bytes | Reliable Ordered Delivery |\n+| 0x04 | RUDI Request | `rudi_request_response.ksy` | 6 bytes | Reliable Unordered Immediate |\n+| 0x05 | RUDI Response | `rudi_request_response.ksy` | 6 bytes | RUDI response |\n+| 0x06 | UUD Request | `uud_request.ksy` | 6 bytes | Unreliable Unordered Delivery |\n+| 0x07 | ACK | `rud_rod_ack.ksy` | 12 bytes | Acknowledgment |\n+| 0x08 | ACK_CC | `ack_cc.ksy` | 28 bytes | ACK with CC state |\n+| 0x09 | ACK_CCX | `ack_ccx.ksy` | 44 bytes | ACK with extended CC |\n+| 0x0A | NACK | `nack.ksy` | 12 bytes | Negative acknowledgment |\n+| 0x0B | CP | `rud_rod_cp.ksy` | 12 bytes | Control packet (10 subtypes) |\n+| 0x0C | NACK_CCX | `nack_ccx.ksy` | 28 bytes | NACK with extended CC |\n+\n+#### 3.3.1 RUD Request (Type 0x01, 12 bytes)\n+\n+**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_request.ksy`  \n+**Related Formats**: [ROD Request (3.3.2)](#332-rod-request-type-0x02-12-bytes) | [ACK (3.3.6)](#336-ack-type-0x07-12-bytes) | [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n+\n+##### Wire Format\n+\n+```\n+Byte:    0       1       2       3       4       5       6       7\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+     |type |nxt|flg|       clear_psn_offset |         PSN [31:0]    →\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+         8       9      10      11\n+     +-------+-------+-------+-------+\n+   → |    spdcid     |    dpdcid     |\n+     +-------+-------+-------+-------+\n+\n+Byte 0-1 Detail:\n+  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n+       |  type   |nxt_hdr| rsvd|r|a|s|rsvd|\n+       | (5 bits)|(4 bit)| (2) |t|r|y|(2) |\n+```\n+\n+##### Field Definitions\n+\n+| Field | Bits | Offset | Description | Constraints |\n+|-------|------|--------|-------------|-------------|\n+| type | 5 | 0[7:3] | PDS type = 0x01 (RUD) | Must be 0x01 |\n+| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n+| flags.rsvd | 2 | 1[6:5] | Reserved | Must be 0 |\n+| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n+| flags.ar | 1 | 1[3] | ACK request | 0=no ACK, 1=request ACK |\n+| flags.syn | 1 | 1[2] | PDC establishment | 0=normal, 1=SYN |\n+| flags.rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n+| clear_psn_offset | 16 | 2-3 | CLEAR_PSN relative to PSN | Unsigned offset |\n+| psn | 32 | 4-7 | Packet Sequence Number | 32-bit, wraps |\n+| spdcid | 16 | 8-9 | Source PDCID | Valid PDCID |\n+| dpdcid | 16 | 10-11 | Destination PDCID | See note below |\n+\n+##### Field Notes\n+\n+**dpdcid Interpretation** (depends on `syn` flag):\n+- `syn=0`: Destination PDCID for established PDC\n+- `syn=1`: `{pdc_info[3:0], psn_offset[11:0]}` for PDC establishment\n+  - `pdc_info[0]`: use_rsv_pdc (1=reserved pool, 0=shared pool)\n+  - `pdc_info[3:1]`: Reserved\n+  - `psn_offset[11:0]`: Difference between PSN and Start_PSN\n+\n+**clear_psn_offset**: Computed as `CLEAR_PSN = PSN - clear_psn_offset`. Indicates the highest PSN that has been delivered to SES at the source.\n+\n+##### Protocol Behavior\n+\n+**Delivery Mode**: RUD (Reliable Unordered Delivery) provides reliable packet delivery without ordering guarantees. Packets may be delivered to SES out of order.\n+\n+**State Machine**: RUD operates within the PDC (Packet Delivery Channel) state machine defined in Section 3.5.7.\n+\n+**Transmission Rules**:\n+1. Source assigns monotonically increasing PSN to each packet\n+2. `ar` flag SHOULD be set periodically (per `ack_request_interval`)\n+3. `retx` flag set when retransmitting due to timeout or NACK\n+4. `syn` flag set only for first packet establishing new PDC\n+\n+**Receiver Processing**:\n+1. Validate PDCID and PSN\n+2. If PSN is new: deliver to SES immediately (no ordering)\n+3. If PSN is duplicate: discard, optionally send ACK\n+4. If `ar=1`: generate ACK, ACK_CC, or ACK_CCX response\n+\n+**Timing Constraints**:\n+- Retransmit timeout: Implementation-defined (typically RTT-based)\n+- ACK coalescing: Up to `ack_coalesce_count` packets\n+\n+**Reference**: UE Spec v1.0.1, Table 3-33, Section 3.5.10.3, Page 256\n+\n+---\n+\n+#### 3.3.2 ROD Request (Type 0x02, 12 bytes)\n+\n+**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_request.ksy`  \n+**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [ACK (3.3.6)](#336-ack-type-0x07-12-bytes) | [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n+\n+##### Wire Format\n+\n+Identical to RUD Request (Section 3.3.1) with `type = 0x02`.\n+\n+##### Field Definitions\n+\n+Same as RUD Request. Only `type` field differs.\n+\n+##### Protocol Behavior\n+\n+**Delivery Mode**: ROD (Reliable Ordered Delivery) provides reliable packet delivery with strict ordering guarantees. Packets are delivered to SES in PSN order.\n+\n+**Key Difference from RUD**: ROD receiver MUST buffer out-of-order packets and deliver to SES only when all preceding PSNs have been received.\n+\n+**Ordering Guarantee**:\n+- Receiver maintains expected PSN\n+- Out-of-order packets are buffered (not delivered)\n+- When gap is filled, buffered packets delivered in order\n+- Head-of-line blocking possible if packet lost\n+\n+**Use Cases**:\n+- Multi-packet messages requiring in-order delivery\n+- Streaming data with ordering requirements\n+- Operations where partial delivery is not acceptable\n+\n+**Reference**: UE Spec v1.0.1, Table 3-33, Section 3.5.10.3, Page 256\n+\n+---\n+\n+#### 3.3.3 RUDI Request (Type 0x04, 6 bytes)\n+\n+**Datamodel**: `datamodel/protocols/ue/transport/pds/rudi_request_response.ksy`  \n+**Related Formats**: [RUDI Response (3.3.4)](#334-rudi-response-type-0x05-6-bytes) | [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n+\n+##### Wire Format\n+\n+```\n+Byte:    0       1       2       3       4       5\n+     +-------+-------+-------+-------+-------+-------+\n+     |type |nxt|  flags  |         pkt_id [31:0]     |\n+     +-------+-------+-------+-------+-------+-------+\n+\n+Byte 0-1 Detail:\n+  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n+       |  type   |nxt_hdr| rsvd|r|retx|rsvd|\n+       | (5 bits)|(4 bit)| (1) |m| (1)|(4) |\n+```\n+\n+##### Field Definitions\n+\n+| Field | Bits | Offset | Description | Constraints |\n+|-------|------|--------|-------------|-------------|\n+| type | 5 | 0[7:3] | PDS type = 0x04 (RUDI Request) | Must be 0x04 |\n+| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n+| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n+| flags.rsvd_m | 1 | 1[5] | Reserved (m for response) | Must be 0 for request |\n+| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n+| flags.rsvd | 4 | 1[3:0] | Reserved | Must be 0 |\n+| pkt_id | 32 | 2-5 | Packet Identifier | Locally unique |\n+\n+##### Protocol Behavior\n+\n+**Delivery Mode**: RUDI (Reliable Unordered Delivery with Idempotence) provides reliable delivery for idempotent operations without PDC context.\n+\n+**Key Characteristics**:\n+- Uses packet ID instead of sequence number\n+- No PDC (Packet Delivery Context) required\n+- Idempotent: safe to retry without side effects\n+- Smaller header (6 bytes vs 12 bytes for RUD/ROD)\n+\n+**Idempotence Guarantee**:\n+- Receiver tracks recently processed pkt_ids\n+- Duplicate pkt_ids are detected and response re-sent\n+- No state corruption from retransmissions\n+\n+**Use Cases**:\n+- Small, self-contained operations\n+- Stateless request/response patterns\n+- Operations where retry is safe (reads, idempotent writes)\n+\n+**Reference**: UE Spec v1.0.1, Table 3-39, Section 3.5.10.9, Page 262\n+\n+---\n+\n+#### 3.3.4 RUDI Response (Type 0x05, 6 bytes)\n+\n+**Datamodel**: `datamodel/protocols/ue/transport/pds/rudi_request_response.ksy`  \n+**Related Formats**: [RUDI Request (3.3.3)](#333-rudi-request-type-0x04-6-bytes)\n+\n+##### Wire Format\n+\n+Identical to RUDI Request with `type = 0x05` and `flags.m` valid.\n+\n+##### Field Definitions\n+\n+| Field | Bits | Offset | Description | Constraints |\n+|-------|------|--------|-------------|-------------|\n+| type | 5 | 0[7:3] | PDS type = 0x05 (RUDI Response) | Must be 0x05 |\n+| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n+| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n+| flags.m | 1 | 1[5] | ECN marked | 1 if request was ECN marked |\n+| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n+| flags.rsvd | 4 | 1[3:0] | Reserved | Must be 0 |\n+| pkt_id | 32 | 2-5 | Packet Identifier | Echoed from request |\n+\n+##### Protocol Behavior\n+\n+**Response Generation**:\n+1. Receiver processes RUDI Request\n+2. Generates RUDI Response with same pkt_id\n+3. Sets `m` flag if request packet was ECN marked\n+\n+**Reference**: UE Spec v1.0.1, Table 3-39, Section 3.5.10.9, Page 262\n+\n+---\n+\n+#### 3.3.5 UUD Request (Type 0x06, 6 bytes)\n+\n+**Datamodel**: `datamodel/protocols/ue/transport/pds/uud_request.ksy`  \n+**Related Formats**: None (no response generated)\n+\n+##### Wire Format\n+\n+```\n+Byte:    0       1       2       3       4       5\n+     +-------+-------+-------+-------+-------+-------+\n+     |type |nxt|  flags  |         pkt_id [31:0]     |\n+     +-------+-------+-------+-------+-------+-------+\n+\n+Byte 0-1 Detail:\n+  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n+       |  type   |nxt_hdr|     rsvd (7)    |\n+       | (5 bits)|(4 bit)|                 |\n+```\n+\n+##### Field Definitions\n+\n+| Field | Bits | Offset | Description | Constraints |\n+|-------|------|--------|-------------|-------------|\n+| type | 5 | 0[7:3] | PDS type = 0x06 (UUD) | Must be 0x06 |\n+| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n+| flags.rsvd | 7 | 1[6:0] | Reserved | Must be 0 |\n+| pkt_id | 32 | 2-5 | Packet Identifier | Locally unique |\n+\n+##### Protocol Behavior\n+\n+**Delivery Mode**: UUD (Unreliable Unordered Delivery) provides best-effort delivery with no reliability guarantees.\n+\n+**Key Characteristics**:\n+- No ACKs or NACKs generated\n+- No retransmissions\n+- Packet loss is acceptable\n+- Lowest overhead delivery mode\n+\n+**Use Cases**:\n+- Loss-tolerant traffic (video streaming, telemetry)\n+- High-frequency updates where latest value matters\n+- Multicast/broadcast scenarios\n+\n+**Reference**: UE Spec v1.0.1, Table 3-42, Section 3.5.10.12, Page 265\n+\n+---\n+\n+#### 3.3.6 ACK (Type 0x07, 12 bytes)\n+\n+**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_ack.ksy`  \n+**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [ACK_CC (3.3.7)](#337-ack_cc-type-0x08-28-bytes)\n+\n+##### Wire Format\n+\n+```\n+Byte:    0       1       2       3       4       5       6       7\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+     |type |nxt|  flags  |   ack_psn_offset  |    probe_opaque     →\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+         8       9      10      11\n+     +-------+-------+-------+-------+\n+   → |   cack_psn    |    spdcid     |    dpdcid     |\n+     +-------+-------+-------+-------+\n+\n+Byte 0-1 Detail:\n+  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n+       |  type   |nxt_hdr| rsvd|m|r|p|req|rsvd|\n+       | (5 bits)|(4 bit)| (1) | |t| |   |(1) |\n+```\n+\n+##### Field Definitions\n+\n+| Field | Bits | Offset | Description | Constraints |\n+|-------|------|--------|-------------|-------------|\n+| type | 5 | 0[7:3] | PDS type = 0x07 (ACK) | Must be 0x07 |\n+| next_hdr | 4 | 0[2:0]+1[7] | SES header type | UET_HDR_NONE |\n+| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n+| flags.m | 1 | 1[5] | ECN marked | 1 if any ACK'd packet was ECN marked |\n+| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n+| flags.p | 1 | 1[3] | Probe response | 1 if responding to Probe CP |\n+| flags.req | 2 | 1[2:1] | Request type | 0=RUD, 1=ROD |\n+| flags.rsvd | 1 | 1[0] | Reserved | Must be 0 |\n+| ack_psn_offset | 16 | 2-3 | Offset from CACK_PSN to ACK_PSN | Signed |\n+| probe_opaque | 16 | 4-5 | Copied from Probe CP | Opaque value |\n+| cack_psn | 32 | 6-9 | Cumulative ACK PSN | Highest in-order PSN |\n+| spdcid | 16 | 10-11 | Source PDCID | Swapped from request |\n+| dpdcid | 16 | 12-13 | Destination PDCID | Swapped from request |\n+\n+**Note**: Wire format shows 12 bytes but field table shows 14 bytes. Verify against spec - likely cack_psn is 16 bits or spdcid/dpdcid share bytes 10-11.\n+\n+##### Protocol Behavior\n+\n+**ACK Generation**:\n+1. Receiver tracks highest in-order PSN received (CACK_PSN)\n+2. ACK generated when `ar` flag set in request, or periodically\n+3. `m` flag set if any ACK'd packet had ECN marking\n+\n+**Cumulative ACK**:\n+- `cack_psn` acknowledges all PSNs ≤ this value\n+- Sender can free buffers for acknowledged packets\n+- Enables sliding window flow control\n+\n+**Reference**: UE Spec v1.0.1, Table 3-35, Section 3.5.10.5, Page 258\n+\n+---\n+\n+#### 3.3.7 ACK_CC (Type 0x08, 28 bytes)\n+\n+**Datamodel**: `datamodel/protocols/ue/transport/pds/ack_cc.ksy`  \n+**Related Formats**: [ACK (3.3.6)](#336-ack-type-0x07-12-bytes) | [ACK_CCX (3.3.8)](#338-ack_ccx-type-0x09-44-bytes)\n+\n+##### Wire Format\n+\n+```\n+Byte:    0       1       2       3       4       5       6       7\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+     |                    ACK Header (12 bytes)                      |\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+         8       9      10      11      12      13      14      15\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+     |  (ACK cont'd) |cc_typ|cc_flg|  mpr  | sack_psn_offset       →\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+        16      17      18      19      20      21      22      23\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+   → |              sack_bitmap [63:0]                               |\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+        24      25      26      27\n+     +-------+-------+-------+-------+\n+     |       ack_cc_state [63:0]     |\n+     +-------+-------+-------+-------+\n+```\n+\n+##### Field Definitions (CC Extension, bytes 12-27)\n+\n+| Field | Bits | Offset | Description | Constraints |\n+|-------|------|--------|-------------|-------------|\n+| cc_type | 4 | 12[7:4] | CC algorithm type | Per Section 3.6.9 |\n+| cc_flags | 4 | 12[3:0] | CC flags | Reserved, must be 0 |\n+| mpr | 8 | 13 | Maximum PSN Range | Flow control window |\n+| sack_psn_offset | 16 | 14-15 | Offset to SACK base PSN | Signed |\n+| sack_bitmap | 64 | 16-23 | Selective ACK bitmap | 1=ACK'd, 0=not ACK'd |\n+| ack_cc_state | 64 | 24-27 | CC state (per cc_type) | See Section 3.6.9 |\n+\n+##### CC Type Values\n+\n+| Value | Name | Description |\n+|-------|------|-------------|\n+| 0x0 | CC_NSCC | Network-Signaled Congestion Control |\n+| 0x1 | CC_CREDIT | RCCC/TFC Credit-based CC |\n+\n+##### Protocol Behavior\n+\n+**Selective ACK (SACK)**:\n+- `sack_bitmap` covers 64 PSNs starting at `CACK_PSN + sack_psn_offset`\n+- Bit N = 1 means PSN (base + N) received\n+- Enables efficient loss recovery without full retransmit\n+\n+**Congestion Control State**:\n+- `ack_cc_state` interpretation depends on `cc_type`\n+- For NSCC: Contains service_time, rcv_cwnd_pend, rcvd_bytes, ooo_count\n+- For CREDIT: Contains credit information\n+\n+**Reference**: UE Spec v1.0.1, Table 3-36, Section 3.5.10.6, Page 259\n+\n+---\n+\n+#### 3.3.8 ACK_CCX (Type 0x09, 44 bytes)\n+\n+**Datamodel**: `datamodel/protocols/ue/transport/pds/ack_ccx.ksy`  \n+**Related Formats**: [ACK_CC (3.3.7)](#337-ack_cc-type-0x08-28-bytes)\n+\n+##### Wire Format\n+\n+ACK_CCX extends ACK_CC with additional 16 bytes for extended CC state.\n+\n+```\n+Bytes 0-27:  ACK_CC header (28 bytes)\n+Bytes 28-43: Extended CC state (16 bytes)\n+```\n+\n+##### Additional Fields (bytes 28-43)\n+\n+| Field | Bits | Offset | Description |\n+|-------|------|--------|-------------|\n+| ack_ccx_state | 128 | 28-43 | Extended CC state |\n+\n+##### Protocol Behavior\n+\n+**Extended State**: ACK_CCX provides additional CC state for algorithms requiring more than 64 bits of feedback.\n+\n+**Reference**: UE Spec v1.0.1, Table 3-37, Section 3.5.10.7, Page 260\n+\n+---\n+\n+#### 3.3.9 NACK (Type 0x0A, 12 bytes)\n+\n+**Datamodel**: `datamodel/protocols/ue/transport/pds/nack.ksy`  \n+**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [NACK_CCX (3.3.10)](#3310-nack_ccx-type-0x0c-28-bytes)\n+\n+##### Wire Format\n+\n+```\n+Byte:    0       1       2       3       4       5       6       7\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+     |type |nxt|  flags  | nack_code |vendor_code|   nack_psn [31:0] →\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+         8       9      10      11\n+     +-------+-------+-------+-------+\n+   → |    spdcid     |    dpdcid     |\n+     +-------+-------+-------+-------+\n+\n+Byte 0-1 Detail:\n+  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n+       |  type   |nxt_hdr| rsvd|m|r|nt|rsvd|\n+       | (5 bits)|(4 bit)| (1) | |t|  |(3) |\n+```\n+\n+##### Field Definitions\n+\n+| Field | Bits | Offset | Description | Constraints |\n+|-------|------|--------|-------------|-------------|\n+| type | 5 | 0[7:3] | PDS type = 0x0A (NACK) | Must be 0x0A |\n+| next_hdr | 4 | 0[2:0]+1[7] | SES header type | UET_HDR_NONE |\n+| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n+| flags.m | 1 | 1[5] | ECN marked | 1 if request was ECN marked |\n+| flags.retx | 1 | 1[4] | Retransmit indicator | From request |\n+| flags.nt | 1 | 1[3] | NACK type | 0=RUD/ROD, 1=RUDI |\n+| flags.rsvd | 3 | 1[2:0] | Reserved | Must be 0 |\n+| nack_code | 8 | 2 | NACK reason code | Per Table 3-59 |\n+| vendor_code | 8 | 3 | Vendor-specific code | Optional |\n+| nack_psn | 32 | 4-7 | NACK'd PSN or pkt_id | Depends on nt flag |\n+| spdcid | 16 | 8-9 | Source PDCID | 0 if nt=1 or PDC failure |\n+| dpdcid | 16 | 10-11 | Destination PDCID | 0 if nt=1 |\n+\n+##### NACK Codes (Table 3-59)\n+\n+| Code | Name | Description |\n+|------|------|-------------|\n+| 0x00 | UET_NO_PKT_BUF | No packet buffer available |\n+| 0x01 | UET_TRIMMED | Packet was trimmed |\n+| 0x02 | UET_NO_PDC_AVAIL | No PDC resources available |\n+| 0x03 | UET_INV_DPDCID | Invalid destination PDCID |\n+| 0x04 | UET_PDC_HDR_MISMATCH | PDC header mismatch |\n+| 0x05 | UET_PSN_OOR_WINDOW | PSN outside expected window |\n+| 0x06 | UET_PSN_GAP | PSN gap detected (packet loss) |\n+\n+##### Protocol Behavior\n+\n+**NACK Generation**:\n+1. Receiver detects error condition (loss, resource exhaustion, etc.)\n+2. Generates NACK with appropriate nack_code\n+3. Sender receives NACK and takes corrective action\n+\n+**Sender Response to NACK**:\n+- `UET_PSN_GAP`: Retransmit missing packets\n+- `UET_NO_PKT_BUF`: Back off, retry later\n+- `UET_NO_PDC_AVAIL`: PDC establishment failed, retry or abort\n+\n+**Reference**: UE Spec v1.0.1, Table 3-40, Section 3.5.10.10, Page 263\n+\n+---\n+\n+#### 3.3.10 NACK_CCX (Type 0x0C, 28 bytes)\n+\n+**Datamodel**: `datamodel/protocols/ue/transport/pds/nack_ccx.ksy`  \n+**Related Formats**: [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n+\n+##### Wire Format\n+\n+NACK_CCX extends NACK with 16 bytes of CC state (similar to ACK_CC extension).\n+\n+```\n+Bytes 0-11:  NACK header (12 bytes)\n+Bytes 12-27: CC extension (16 bytes)\n+```\n+\n+##### Protocol Behavior\n+\n+**Extended NACK**: NACK_CCX provides congestion control feedback along with the negative acknowledgment, enabling the sender to adjust its rate while handling the error.\n+\n+**Reference**: UE Spec v1.0.1, Table 3-41, Section 3.5.10.11, Page 264\n+\n+---\n+\n+#### 3.3.11 Control Packet (Type 0x0B, 12 bytes)\n+\n+**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_cp.ksy`  \n+**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [ACK (3.3.6)](#336-ack-type-0x07-12-bytes)\n+\n+##### Wire Format\n+\n+```\n+Byte:    0       1       2       3       4       5       6       7\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+     |type |ctl|  flags  |   probe_opaque    |         PSN [31:0]  →\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+         8       9      10      11\n+     +-------+-------+-------+-------+\n+   → |    spdcid     |    dpdcid     |\n+     +-------+-------+-------+-------+\n+\n+Byte 0-1 Detail:\n+  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n+       |  type   |ctl_typ| rsvd|i|r|a|s|rsvd|\n+       | (5 bits)|(4 bit)| (1) |r|t|r|y|(2) |\n+```\n+\n+##### Field Definitions\n+\n+| Field | Bits | Offset | Description | Constraints |\n+|-------|------|--------|-------------|-------------|\n+| type | 5 | 0[7:3] | PDS type = 0x0B (CP) | Must be 0x0B |\n+| ctl_type | 4 | 0[2:0]+1[7] | Control packet subtype | 0-9 defined |\n+| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n+| flags.isrod | 1 | 1[5] | ROD indicator | 1=ROD, 0=RUD (for NOOP/Negotiation) |\n+| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n+| flags.ar | 1 | 1[3] | ACK request | 0=no ACK, 1=request ACK |\n+| flags.syn | 1 | 1[2] | PDC establishment | 0=normal, 1=SYN |\n+| flags.rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n+| probe_opaque | 16 | 2-3 | Opaque value for Probe | Echoed in ACK |\n+| psn | 32 | 4-7 | Packet Sequence Number | Some CPs consume PSN |\n+| spdcid | 16 | 8-9 | Source PDCID | Valid PDCID |\n+| dpdcid | 16 | 10-11 | Destination PDCID | Or {pdc_info, psn_offset} |\n+\n+##### Control Packet Subtypes\n+\n+| ctl_type | Name | Direction | Description |\n+|----------|------|-----------|-------------|\n+| 0 | NOOP | Either | No operation |\n+| 1 | ACK_REQUEST | Src→Dst | Request ACK for specific PSN |\n+| 2 | CLEAR_COMMAND | Init→Tgt | Clear guaranteed delivery state |\n+| 3 | CLEAR_REQUEST | Tgt→Init | Request initiator to send clear |\n+| 4 | CLOSE_COMMAND | Init→Tgt | PDC is being closed |\n+| 5 | CLOSE_REQUEST | Tgt→Init | Request initiator to close PDC |\n+| 6 | PROBE | Src→Dst | Request PDS ACK |\n+| 7 | CREDIT | Dst→Src | Carry CC credit |\n+| 8 | CREDIT_REQUEST | Src→Dst | Request credit |\n+| 9 | NEGOTIATION | Either | PDC negotiation |\n+\n+##### Protocol Behavior\n+\n+**PDC Lifecycle**:\n+- `CLOSE_COMMAND/REQUEST`: Graceful PDC teardown\n+- `CLEAR_COMMAND/REQUEST`: Clear delivery state without closing\n+\n+**Flow Control**:\n+- `CREDIT/CREDIT_REQUEST`: Credit-based flow control\n+- `PROBE`: Solicit ACK for RTT measurement or liveness check\n+\n+**Reference**: UE Spec v1.0.1, Table 3-38, Section 3.5.10.8, Page 261\n+\n ### 3.4 SES (Semantic Sublayer) Opcodes\n \n **Datamodel**: `datamodel/protocols/ue/transport/ses/opcodes.ksy`\n \n",
              "filediff": {
                "file": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
                "before": "# PMR (CN7000) Packet Format Taxonomy\n\n**Document**: Packet formats supported by PMR NIC ASIC  \n**Generated**: 2026-01-14  \n**Last Reviewed**: 2026-01-20  \n**Source**: `datamodel/` directory in EarlySim repository  \n**Reference**: `docs/HAS/PMR/05-packet-formats.md`\n\n---\n\n## Table of Contents\n\n1. [Overview](#1-overview)\n2. [Protocol Stack Summary](#2-protocol-stack-summary)\n3. [Ultra Ethernet+ (UE+) Formats](#3-ultra-ethernet-ue-formats)\n4. [RoCEv2 Formats](#4-rocev2-formats)\n5. [Standard Ethernet Formats](#5-standard-ethernet-formats)\n6. [Cornelis Proprietary Formats](#6-cornelis-proprietary-formats)\n7. [Host-Software Interface (HSI) Formats](#7-host-software-interface-hsi-formats)\n8. [IP Block Descriptors](#8-ip-block-descriptors)\n9. [Work List](#9-work-list)\n10. [UALink Protocol (Reference Only)](#10-ualink-protocol-reference-only)\n11. [References](#11-references)\n\n---\n\n## 1. Overview\n\nPMR (Prism River) is Cornelis Networks' 1.6 Tbps NIC ASIC (CN7000 product family). It supports multiple wire protocols with per-packet protocol selection on a single physical port.\n\n### Supported Protocols\n\n| Protocol | Version | Status | Description |\n|----------|---------|--------|-------------|\n| Ultra Ethernet+ | 1.0.1 | Full | Optimized UE with Cornelis extensions |\n| RoCEv2 | v2 | Full | RDMA over Converged Ethernet |\n| Standard Ethernet | IEEE 802.3 | Full | Traditional Ethernet with offloads |\n| Cornelis Proprietary | 1.0.0 | Full | UFH, CSIG+, VxLAN+, Collectives |\n\n### Header Efficiency Comparison\n\n| Protocol Stack | Total Headers | Efficiency (4KB payload) |\n|----------------|---------------|--------------------------|\n| UE+ (small msg) | ~20 bytes | 99.5% |\n| UE+ (standard) | ~40 bytes | 99.0% |\n| RoCEv2 (IPv4) | ~58 bytes | 98.6% |\n| RoCEv2 (IPv6) | ~78 bytes | 98.1% |\n\n---\n\n## 2. Protocol Stack Summary\n\n```\n+-----------------------------------------------------------------------------+\n|                           Application Layer                                  |\n|                    (Libfabric, Verbs, Sockets, DPDK)                         |\n+-----------------------------------------------------------------------------+\n|                           Transport Layer                                    |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UE Transport   |  |     RoCEv2       |  |    TCP/UDP       |            |\n|  |   (SES/PDS/CMS)  |  |   (BTH/RETH)     |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                           Network Layer                                      |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UFH-16/32      |  |   IPv4/IPv6      |  |   IPv4/IPv6      |            |\n|  |   (Cornelis)     |  |   + UDP          |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                            Link Layer                                        |\n|  +------------------+  +------------------+  +------------------+            |\n|  |      UE+         |  |   Ethernet II    |  |   Ethernet II    |            |\n|  |   (12 bytes)     |  |   (14 bytes)     |  |   (14 bytes)     |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                          Physical Layer                                      |\n|                    Hill Creek (212.5G x8 PAM4 SerDes)                        |\n+-----------------------------------------------------------------------------+\n      Ultra Ethernet+           RoCEv2              Standard Ethernet\n```\n\n---\n\n## 3. Ultra Ethernet+ (UE+) Formats\n\n### 3.1 UE+ L2 Header (12 bytes)\n\n**Datamodel**: `datamodel/protocols/cornelis/link/ue_plus.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Byte 2        | Byte 3        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n|L2|V|zyxm|Len  | Length[7:0]   | RC    | SC    | Hop Count     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 4        | Byte 5        | Byte 6        | Byte 7        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Dest LID [15:8]               | Dest LID [7:0]                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Entropy [15:8]                | Entropy [7:0]                 |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 8        | Byte 9        | Byte 10       | Byte 11       |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Source LID [15:8]             | Source LID [7:0]              |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Payload Type [15:8]           | Payload Type [7:0]            |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| L2 Type | 2 | Always 0b10 for UE+ |\n| Version | 1 | Protocol version |\n| zyxm | 4 | Routing control flags (multicast, adaptive) |\n| Length | 9 | Packet length in bytes |\n| RC | 4 | Routing Class (QoS) |\n| SC | 4 | Service Class |\n| Hop | 8 | TTL/hop count |\n| Dest LID | 16 | Destination Local Identifier |\n| Entropy | 16 | ECMP hash for load balancing |\n| Source LID | 16 | Source Local Identifier |\n| Type | 16 | Payload type (EtherType equivalent) |\n\n**Payload Types**:\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x0800 | IPv4 | IPv4 payload |\n| 0x86DD | IPv6 | IPv6 payload |\n| 0x8100 | VLAN | VLAN tagged frame |\n| 0x9000 | VxLAN+ | VxLAN+ encapsulated |\n| 0x9100 | CSIG+ | CSIG+ telemetry |\n| 0xC000 | UE PDS | Ultra Ethernet PDS |\n\n### 3.2 PDS (Packet Delivery Sublayer) Prologue (2 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/prologue.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0                        | Byte 1                        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| type[4:0] | next_hdr/ctl[3:0] | flags[6:0]                    |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| PDS Type | Value | Description |\n|----------|-------|-------------|\n| Reserved | 0 | Reserved |\n| TSS | 1 | Transport Security (encryption) |\n| RUD Request | 2 | Reliable Unordered Delivery |\n| ROD Request | 3 | Reliable Ordered Delivery |\n| RUDI Request | 4 | Reliable Unordered Immediate |\n| RUDI Response | 5 | RUDI response |\n| UUD Request | 6 | Unreliable Unordered Delivery |\n| ACK | 7 | Acknowledgment |\n| ACK_CC | 8 | ACK with congestion control |\n| ACK_CCX | 9 | ACK with extended CC |\n| NACK | 10 | Negative acknowledgment |\n| CP | 11 | Control packet |\n| NACK_CCX | 12 | NACK with extended CC |\n| RUD_CC_REQ | 13 | RUD with CC state |\n| ROD_CC_REQ | 14 | ROD with CC state |\n\n### 3.3 PDS Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/pds/`\n\n| Format | File | Size | Description |\n|--------|------|------|-------------|\n| RUD/ROD Request | `rud_rod_request.ksy` | Variable | Reliable delivery request |\n| RUD/ROD ACK | `rud_rod_ack.ksy` | Variable | Acknowledgment |\n| ACK_CC | `ack_cc.ksy` | Variable | ACK with CC state |\n| ACK_CCX | `ack_ccx.ksy` | Variable | ACK with extended CC |\n| NACK | `nack.ksy` | Variable | Negative acknowledgment |\n| NACK_CCX | `nack_ccx.ksy` | Variable | NACK with extended CC |\n| RUDI Request/Response | `rudi_request_response.ksy` | Variable | Low-latency immediate |\n| UUD Request | `uud_request.ksy` | Variable | Unreliable delivery |\n| Control Packet | `rud_rod_cp.ksy` | Variable | Control packet |\n| Entropy Header | `entropy_header.ksy` | Variable | Entropy extension |\n\n### 3.4 SES (Semantic Sublayer) Opcodes\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/opcodes.ksy`\n\n**Request Opcodes (Table 3-17)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Tagged Send | 0x00 | Send with tag matching |\n| RMA Write | 0x01 | Remote memory write |\n| RMA Read | 0x02 | Remote memory read |\n| Atomic Write | 0x03 | Atomic memory write |\n| Atomic Read | 0x04 | Atomic memory read |\n| Atomic CAS | 0x05 | Compare-and-swap |\n| Deferrable Send | 0x06 | Deferrable send |\n| Ready to Restart | 0x07 | Restart notification |\n| Small Message | 0x08 | Small message (32B header) |\n| Small RMA Write | 0x09 | Small RMA write |\n| Small RMA Read | 0x0A | Small RMA read |\n| Small Atomic Write | 0x0B | Small atomic write |\n| Small Atomic Read | 0x0C | Small atomic read |\n| Small Atomic CAS | 0x0D | Small atomic CAS |\n\n**Response Opcodes (Table 3-18)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Response | 0x00 | Standard response |\n| Response with Data | 0x01 | Response carrying data |\n| Optimized Response | 0x02 | Optimized format |\n| NACK | 0x03 | Negative acknowledgment |\n\n### 3.5 SES Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/ses/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Standard Request (SOM=1) | `standard_request_som1.ksy` | Start of message |\n| Standard Request (SOM=0) | `standard_request_som0.ksy` | Continuation |\n| Small Message | `small_message.ksy` | 32-byte header format |\n| Small RMA | `small_rma.ksy` | Small RMA operations |\n| Response | `response.ksy` | Standard response |\n| Response with Data | `response_with_data.ksy` | Data-carrying response |\n| Optimized Response | `optimized_response_with_data.ksy` | Optimized format |\n| Deferrable Send | `deferrable_send_request.ksy` | Deferrable operation |\n| Ready to Restart | `ready_to_restart.ksy` | Restart notification |\n| Rendezvous Extension | `rendezvous_extension.ksy` | Large message protocol |\n| Atomic Extension | `atomic_extension.ksy` | Atomic operations |\n| CAS Extension | `cas_extension.ksy` | Compare-and-swap |\n\n### 3.6 CMS (Congestion Management Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/cms/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Credit CP Payload | `credit_cp_payload.ksy` | Credit control packet |\n| Credit Request | `credit_request_cp_payload.ksy` | Credit request |\n| Request CC State | `req_cc_state.ksy` | Request CC state |\n| ACK CC State (NSCC) | `ack_cc_state_nscc.ksy` | NSCC algorithm state |\n| ACK CC State (RCCC/TFC) | `ack_cc_state_rccc_tfc.ksy` | RCCC/TFC state |\n\n### 3.7 TSS (Transport Security Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/tss/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Security Header | `security_header.ksy` | Encryption header |\n| IV Construction | `iv_construction.ksy` | Initialization vector |\n| Key Rotation | `protocols/key_rotation.ksy` | Key rotation protocol |\n| KDF Direct | `protocols/kdf_direct.ksy` | Direct key derivation |\n| KDF Client/Server | `protocols/kdf_client_server.ksy` | Client/server KDF |\n| KDF Cluster | `protocols/kdf_cluster.ksy` | Cluster KDF |\n| Join Secure Domain | `protocols/join_secure_domain.ksy` | Domain join |\n| TSS TX Processing | `protocols/tss_tx_processing.ksy` | Transmit processing |\n| TSS RX Processing | `protocols/tss_rx_processing.ksy` | Receive processing |\n\n### 3.8 Link Layer Formats\n\n#### LLR (Link-Level Retry)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/llr/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| LLR Preamble (64b66b) | `llr_preamble_64b66b.ksy` | 64b66b preamble |\n| LLR Preamble (MII) | `llr_preamble_mii.ksy` | MII preamble |\n| LLR Init CTLOS | `llr_init_ctlos.ksy` | Initialize LLR |\n| LLR Init Echo CTLOS | `llr_init_echo_ctlos.ksy` | Init acknowledgment |\n| LLR ACK CTLOS | `llr_ack_ctlos.ksy` | Frame acknowledgment |\n| LLR NACK CTLOS | `llr_nack_ctlos.ksy` | Retransmit request |\n\n#### CBFC (Credit-Based Flow Control)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/cbfc/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| CF Update | `cf_update.ksy` | Credit flow update |\n| CC Update | `cc_update.ksy` | Credit count update |\n| VC State Machine | `protocols/vc_state_machine.ksy` | Virtual channel FSM |\n| Lossless VC Init | `protocols/lossless_vc_init.ksy` | VC initialization |\n| Lossless VC Removal | `protocols/lossless_vc_removal.ksy` | VC teardown |\n\n#### LLDP Extensions\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/lldp/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| UE Link Negotiation TLV | `ue_link_negotiation_tlv.ksy` | Link negotiation |\n| UE CBFC TLV | `ue_cbfc_tlv.ksy` | CBFC parameters |\n\n---\n\n## 4. RoCEv2 Formats\n\n**Datamodel Directory**: `datamodel/protocols/roce/transport/`\n\n### 4.1 RoCEv2 Packet Structure\n\n```\n+-----------------------------------------------------------------------------+\n| Ethernet II Header (14 bytes)                                               |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2) = 0x0800/0x86DD            |\n+-----------------------------------------------------------------------------+\n| IP Header (20 bytes IPv4 / 40 bytes IPv6)                                   |\n|   Version, IHL, DSCP, ECN, Length, ID, Flags, TTL, Protocol=17, Checksum   |\n|   Source IP, Dest IP                                                        |\n+-----------------------------------------------------------------------------+\n| UDP Header (8 bytes)                                                        |\n|   Source Port (entropy) | Dest Port = 4791 | Length | Checksum             |\n+-----------------------------------------------------------------------------+\n| BTH - Base Transport Header (12 bytes)                                      |\n|   Opcode | Flags | P-Key | Dest QP | A | PSN                               |\n+-----------------------------------------------------------------------------+\n| Extended Headers (optional, operation-dependent)                            |\n|   RETH (16) | AETH (4) | AtomicETH (28) | ImmDt (4)                        |\n+-----------------------------------------------------------------------------+\n| Payload (0 - MTU bytes)                                                     |\n+-----------------------------------------------------------------------------+\n| ICRC (4 bytes)                                                              |\n+-----------------------------------------------------------------------------+\n```\n\n### 4.2 BTH (Base Transport Header) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/roce/transport/bth.ksy`\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| Opcode | 8 | Operation type (transport + operation) |\n| SE | 1 | Solicited Event |\n| M | 1 | Migration state |\n| Pad | 2 | Padding bytes (0-3) |\n| TVer | 4 | Transport version (must be 0) |\n| P-Key | 16 | Partition key |\n| Dest QP | 24 | Destination Queue Pair |\n| A | 1 | ACK request |\n| PSN | 24 | Packet Sequence Number |\n\n**Transport Types** (Opcode bits [7:5]):\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x00 | RC | Reliable Connection |\n| 0x20 | UC | Unreliable Connection |\n| 0x40 | RD | Reliable Datagram |\n| 0x60 | UD | Unreliable Datagram |\n\n**Operations** (Opcode bits [4:0]):\n| Value | Operation | Description |\n|-------|-----------|-------------|\n| 0x00 | SEND_FIRST | First send packet |\n| 0x01 | SEND_MIDDLE | Middle send packet |\n| 0x02 | SEND_LAST | Last send packet |\n| 0x03 | SEND_LAST_IMM | Last send with immediate |\n| 0x04 | SEND_ONLY | Single-packet send |\n| 0x05 | SEND_ONLY_IMM | Single send with immediate |\n| 0x06 | RDMA_WRITE_FIRST | First RDMA write |\n| 0x07 | RDMA_WRITE_MIDDLE | Middle RDMA write |\n| 0x08 | RDMA_WRITE_LAST | Last RDMA write |\n| 0x09 | RDMA_WRITE_LAST_IMM | Last write with immediate |\n| 0x0A | RDMA_WRITE_ONLY | Single-packet write |\n| 0x0B | RDMA_WRITE_ONLY_IMM | Single write with immediate |\n| 0x0C | RDMA_READ_REQUEST | Read request |\n| 0x0D | RDMA_READ_RESPONSE_FIRST | First read response |\n| 0x0E | RDMA_READ_RESPONSE_MIDDLE | Middle read response |\n| 0x0F | RDMA_READ_RESPONSE_LAST | Last read response |\n| 0x10 | RDMA_READ_RESPONSE_ONLY | Single read response |\n| 0x11 | ACK | Acknowledgment |\n| 0x12 | ATOMIC_ACK | Atomic acknowledgment |\n| 0x13 | CMP_SWAP | Compare and swap |\n| 0x14 | FETCH_ADD | Fetch and add |\n\n### 4.3 Extended Transport Headers\n\n| Header | File | Size | Description |\n|--------|------|------|-------------|\n| RETH | `reth.ksy` | 16 bytes | RDMA Extended Transport Header |\n| AETH | `aeth.ksy` | 4 bytes | ACK Extended Transport Header |\n| AtomicETH | `atomiceth.ksy` | 28 bytes | Atomic Extended Transport Header |\n| AtomicAckETH | `atomicacketh.ksy` | 8 bytes | Atomic ACK ETH |\n| DETH | `deth.ksy` | 8 bytes | Datagram Extended Transport Header |\n| ImmDt | `immdt.ksy` | 4 bytes | Immediate Data |\n| ICRC | `icrc.ksy` | 4 bytes | Invariant CRC |\n\n---\n\n## 5. Standard Ethernet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ethernet/`\n\n### 5.1 Ethernet II Frame\n\n**Datamodel**: `datamodel/protocols/ethernet/link/ethernet_ii.ksy`\n\n```\n+-----------------------------------------------------------------------------+\n| Preamble (7 bytes) + SFD (1 byte)  [not visible to software]               |\n+-----------------------------------------------------------------------------+\n| Ethernet Header (14 bytes)                                                  |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2)                            |\n+-----------------------------------------------------------------------------+\n| Optional VLAN Tag (4 bytes) - 802.1Q                                        |\n|   TPID (2) = 0x8100 | TCI (2) = PCP + DEI + VID                            |\n+-----------------------------------------------------------------------------+\n| Payload (46-1500 bytes, or up to 9000 for jumbo)                           |\n+-----------------------------------------------------------------------------+\n| FCS (4 bytes)                                                               |\n+-----------------------------------------------------------------------------+\n```\n\n### 5.2 Link Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| Ethernet II | `link/ethernet_ii.ksy` | Standard Ethernet frame |\n| VLAN 802.1Q | `link/vlan_802_1q.ksy` | VLAN tagging |\n\n### 5.3 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| IPv4 | `network/ipv4.ksy` | IPv4 header |\n| IPv6 | `network/ipv6.ksy` | IPv6 header |\n\n### 5.4 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| TCP | `transport/tcp.ksy` | TCP header |\n| UDP | `transport/udp.ksy` | UDP header |\n\n---\n\n## 6. Cornelis Proprietary Formats\n\n**Datamodel Directory**: `datamodel/protocols/cornelis/`\n\n### 6.1 Link Layer\n\n| Format | File | Size | Description |\n|--------|------|------|-------------|\n| UE+ Header | `link/ue_plus.ksy` | 12 bytes | Optimized L2 header |\n| Cornelis L2 Prefix | `link/cornelis_l2_prefix.ksy` | Variable | L2 prefix |\n\n### 6.2 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| UFH-16 | `network/ufh_16.ksy` | 16-bit forwarding header |\n| UFH-32 | `network/ufh_32.ksy` | 32-bit forwarding header |\n| Collective L2 | `network/collective_l2.ksy` | Collective operations header |\n| Scale-Up L2 | `network/scaleup_l2.ksy` | Scale-up deployments |\n\n#### 6.2.1 UFH-16 (Unified Forwarding Header 16-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_16.ksy`\n\nUFH-16 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 16-bit addressing.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |    Opaque (24-bit)    | Destination   |Opaque |Traffic|   Opaque      |    Source     |\n|[7:4]  |                       | (16-bit BE)   |[7:4]  |Class  |   (16-bit)    |  (16-bit BE)  |\n|SLAP   |                       |               |Z|Y|X|M|[7:0]  |               |               |\n|[3:0]  |                       |               |[3:0]  |       |               |               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1-3 | 24 | Opaque to hardware |\n| Destination | 4-5 | 16 | Destination endpoint address (big-endian) |\n| Opaque | 6 | [7:4] | Opaque to hardware |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Opaque | 8-9 | 16 | Opaque to hardware |\n| Source | 10-11 | 16 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-16 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5-14 | Reserved | Reserved for future use |\n| 15 | Extended | UFH-32 extension follows |\n\n**Usage**: Scale-up fabric forwarding, intra-pod communication, medium cluster networking (up to 65536 endpoints).\n\n#### 6.2.2 UFH-32 (Unified Forwarding Header 32-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_32.ksy`\n\nUFH-32 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 32-bit addressing for large-scale deployments.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |       |   Destination (32-bit BE)     |HopLim |Traffic|       Source (32-bit BE)      |\n|[7:4]  |Opaque |                               |[7:4]  |Class  |                               |\n|SLAP   |       |                               |Z|Y|X|M|[7:0]  |                               |\n|[3:0]  |       |                               |[3:0]  |       |                               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1 | [7:0] | Opaque to hardware |\n| Destination | 2-5 | 32 | Destination endpoint address (big-endian) |\n| Hop Limit | 6 | [7:4] | TTL/hop count |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Source | 8-11 | 32 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-32 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5 | Multicast | Multicast packet |\n| 6 | Barrier | Barrier synchronization |\n| 7 | Reduction | Reduction operation |\n| 8-14 | Reserved | Reserved for future use |\n| 15 | Vendor | Vendor-specific packet |\n\n**Usage**: Large-scale scale-up fabric forwarding (4+ billion endpoints), multi-pod communication, extended collective operations.\n\n### 6.3 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| CSIG+ | `transport/csig_plus.ksy` | Telemetry header |\n| PKEY | `transport/pkey.ksy` | Partition key |\n\n### 6.4 Encapsulation\n\n| Format | File | Description |\n|--------|------|-------------|\n| VxLAN+ | `encapsulation/vxlan_plus.ksy` | Extended VxLAN overlay |\n\n---\n\n## 7. Host-Software Interface (HSI) Formats\n\n**Datamodel Directory**: `datamodel/hw/asics/pmr/interfaces/host_interface/`\n\n### 7.1 Command Queue Segment (64 bytes)\n\n**Datamodel**: `command_queue_segment.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Bytes 2-3     | Bytes 4-7     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Opcode        | Flags         | Payload Len   | Reserved      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 8-15                    | Bytes 16-23                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Tag (64 bits)                 | Dest (64 bits)                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 24-31                   | Bytes 32-63                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Metadata (64 bits)            | Inline Data or SGL Entry      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n**Opcode Encoding**:\n| Bits | Field | Values |\n|------|-------|--------|\n| [7:4] | Family | MSG=0x1, TAGGED=0x2, RMA=0x3, ATOMIC=0x4 |\n| [3:2] | Variant | SEND=0, RECV=1, INJECT=2 |\n| [1] | Reserved | Must be 0 |\n| [0] | Data Source | INLINE=0, SGL=1 |\n\n### 7.2 Notification Formats\n\n| Format | File | Type | Size | Description |\n|--------|------|------|------|-------------|\n| Receive Notification | `receive_notification.ksy` | 0x00 | 64 bytes | Received message |\n| Send Completion | `send_completion.ksy` | 0x01 | 64 bytes | Send completed |\n| Event Notification | `event_notification.ksy` | 0x02 | 64 bytes | Async event |\n| Notification Entry | `notification_entry.ksy` | - | 64 bytes | Generic entry |\n| QW Violation Event | `qw_violation_event.ksy` | - | 64 bytes | QW alignment error |\n\n### 7.3 Receive Notification (64 bytes)\n\n**Datamodel**: `receive_notification.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x00 for receive |\n| flags | 1 | 1 | FI_INLINE, continuation |\n| status | 2 | 2 | Completion status |\n| src_id | 4 | 4 | Source endpoint ID |\n| tag | 8 | 8 | Tag value |\n| total_length | 16 | 4 | Payload length |\n| buffer_id_0 | 20 | 2 | First buffer ID |\n| buffer_id_1 | 22 | 2 | Second buffer ID |\n| buffer_offset | 24 | 2 | Offset in buffer |\n| reserved | 26 | 2 | Reserved |\n| inline_data | 28 | 35 | Inline payload |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.4 Send Completion (64 bytes)\n\n**Datamodel**: `send_completion.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x01 for send |\n| flags | 1 | 1 | Completion flags |\n| status | 2 | 2 | Completion status |\n| reserved_0 | 4 | 4 | Reserved |\n| op_context | 8 | 8 | Operation context |\n| bytes_sent | 16 | 4 | Bytes transferred |\n| reserved_1 | 20 | 43 | Reserved |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.5 Other HSI Formats\n\n| Format | File | Description |\n|--------|------|-------------|\n| SGL Entry | `sgl_entry.ksy` | Scatter-gather list entry |\n| PCIe Descriptors | `pcie/descriptors.ksy` | PCIe interface descriptors |\n\n---\n\n## 8. IP Block Descriptors\n\n**Datamodel Directory**: `datamodel/hw/ip/cornelis/`\n\n### 8.1 Collectives Engine (CE)\n\n**Datamodel**: `ce/descriptors.ksy`\n\nThe Collectives Engine uses RISC-V vector cores (VLEN=512) for hardware-accelerated collective operations.\n\n### 8.2 Electric Creek (EC)\n\n**Datamodel**: `ec/descriptors.ksy`\n\nElectric Creek is the management complex shared between PMR NIC and LNR Switch.\n\n---\n\n## 9. Work List\n\nThis section tracks issues requiring follow-up investigation or specification updates.\n\n### 9.1 Open Issues\n\n| ID | Priority | Category | Description | Status | Opened | Closed |\n|----|----------|----------|-------------|--------|--------|--------|\n| W-06-001 | Medium | Datamodel | UFH-32 lacks 16-bit entropy field; per-packet ECMP not supported; switch must derive entropy from Src+Dest hash | Deferred | 2026-01-20 | - |\n| W-07-001 | Low | Datamodel | `ack_cc.ksy` shows `ack_cc_state` as 32-bit (4 bytes) but UE Spec Table 3-36 shows 64-bit (8 bytes); verify field size | Investigation | 2026-01-22 | - |\n| W-07-002 | Low | Documentation | `collective_l2.ksy` and `scaleup_l2.ksy` marked as \"work_in_progress\" with spec_version 0.1; specifications incomplete | Spec Update | 2026-01-22 | - |\n| W-07-003 | Low | Datamodel | `ue_plus.ksy` 9-bit length field split across bytes 0-1 with unusual encoding (1 bit in byte 0, 8 bits in byte 1); verify encoding matches UE Spec | Investigation | 2026-01-22 | - |\n| W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |\n| W-05-002 | Medium | Specification | MTU values: Verify maximum MTU for each protocol | Investigation | 2026-01-10 | - |\n| W-05-003 | Medium | Documentation | CMS detailed formats: Need comprehensive documentation | Spec Update | 2026-01-10 | - |\n| W-03-002 | Low | Terminology | PDP vs PDS naming: UML uses both terms inconsistently | Spec Update | 2026-01-08 | - |\n| W-03-006 | Low | Terminology | SES vs SE: \"SES Processing Groups\" vs \"Semantic Engines\" | Spec Update | 2026-01-08 | - |\n\n### 9.2 Datamodel Gaps\n\n| ID | Priority | Description | Target Location | Status | Opened | Closed |\n|----|----------|-------------|-----------------|--------|--------|--------|\n| D-001 | High | PMR CSR definitions missing from datamodel | `datamodel/hw/asics/pmr/csrs/*.rdl` | Spec Update | 2026-01-10 | - |\n| D-002 | Medium | PMR block hierarchy YAML incomplete | `datamodel/hw/asics/pmr/blocks.yaml` | Spec Update | 2026-01-10 | - |\n| D-003 | Medium | PMR interface contracts missing | `datamodel/views/contracts/pmr-*.puml` | Spec Update | 2026-01-10 | - |\n\n### 9.3 Specification Clarifications Needed\n\n| ID | Priority | Question | Context | Status | Opened | Closed |\n|----|----------|----------|---------|--------|--------|--------|\n| Q1 | Medium | Lightweight Interface Scope | What features should be reduced in lightweight mode? | Investigation | 2026-01-10 | - |\n| Q2 | Medium | Tag Table Sizing | Should HW tag table size be per-endpoint configurable? | Investigation | 2026-01-10 | - |\n| Q3 | Medium | Multi-Packet Eager Messages | Should hardware support multi-packet eager messages? | Investigation | 2026-01-10 | - |\n| Q4 | Low | RoCE Work Queue Implementation | Confirm RoCE WQ/CQ are software-implemented | Investigation | 2026-01-10 | - |\n\n### 9.4 Closed Issues\n\n| ID | Priority | Category | Description | Resolution | Opened | Closed |\n|----|----------|----------|-------------|------------|--------|--------|\n| W-05-001 | Medium | Documentation | UE taxonomy reference | Documented in `05-packet-formats.md` | 2026-01-08 | 2026-01-10 |\n| W-02-005 | Medium | Documentation | Protocol support documentation | Documented UE+, RoCEv2, Ethernet | 2026-01-08 | 2026-01-10 |\n| W-02-006 | Medium | Documentation | Cornelis Collective Reduction Protocol | Documented in HAS §2.5.4 | 2026-01-08 | 2026-01-10 |\n| W-03-001 | Medium | Architecture | Semantic Engine count | Confirmed 64 (8x8) in UML and HAS | 2026-01-08 | 2026-01-10 |\n| W-17-005 | Low | Documentation | Port subdivision note | Added to HAS Ch17 | 2026-01-11 | 2026-01-11 |\n| W-17-006 | Medium | Documentation | MPORT interface documentation | Documented 256B @ 1.66 GHz | 2026-01-11 | 2026-01-11 |\n| W-04-005 | High | Datamodel | `ufh_16.ksy` address size: Datamodel shows 12-bit dest, should be 16-bit | UFH-16 restructured to 12-byte Ethernet MAC overlay with 16-bit destination (bytes 4-5) and 16-bit source (bytes 10-11) | 2026-01-10 | 2026-01-20 |\n| W-04-006 | High | Datamodel | `ufh_32.ksy` address size: Datamodel shows 16-bit dest, should be 32-bit | UFH-32 restructured to 12-byte Ethernet MAC overlay with 32-bit destination (bytes 2-5) and 32-bit source (bytes 8-11) | 2026-01-10 | 2026-01-20 |\n\n### 9.5 Change Log\n\n| Date | Change | Details |\n|------|--------|---------|\n| 2026-01-14 | Initial creation | Document created with PMR packet taxonomy |\n| 2026-01-20 | Review and update | Added UALink section (reference only, not PMR-supported); Added change log; Updated datamodel file counts; No new .ksy files since initial creation |\n| 2026-01-20 | UFH format details | Added detailed UFH-16 and UFH-32 format documentation in Section 6.2 (wire diagrams, field tables, type enumerations) |\n| 2026-01-20 | UFH restructuring | UFH-16 and UFH-32 restructured to 12-byte Ethernet MAC overlays; UFH-16 now 16-bit addressing, UFH-32 now 32-bit addressing; Added SLAP field constraints (Z,Y,X=001); Updated datamodel .ksy files; Closed W-04-005 and W-04-006 |\n| 2026-01-22 | Datamodel review | Added W-07-001 (ack_cc_state size mismatch), W-07-002 (collective/scaleup specs incomplete), W-07-003 (ue_plus length encoding); Identified 30+ packet formats requiring expansion |\n\n---\n\n## 10. UALink Protocol (Reference Only)\n\n**Note**: UALink is defined in the datamodel but is **NOT currently supported by PMR**. It is included here for reference as it may be relevant for future AI/ML accelerator interconnect work.\n\n**Datamodel Directory**: `datamodel/protocols/ualink/`\n\n### 10.1 UALink Overview\n\nUALink is an AI/ML accelerator interconnect protocol with 38 packet definitions across all OSI layers.\n\n| Layer | Count | Key Formats |\n|-------|-------|-------------|\n| UPLI (Upper Protocol Layer Interface) | 8 | commands.ksy, request_channel.ksy, status_codes.ksy |\n| Transaction | 9 | tl_flit.ksy, control_half_flit.ksy, data_half_flit.ksy |\n| Data Link | 12 | dl_flit.ksy, segment_header.ksy, crc.ksy, control_messages.ksy |\n| Physical | 4 | alignment_markers.ksy, control_ordered_sets.ksy, link_training.ksy |\n| Security | 5 | authentication.ksy, encryption.ksy, key_derivation.ksy |\n\n### 10.2 UALink Packet Formats\n\n#### UPLI Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Commands | `upli/commands.ksy` | UPLI command definitions |\n| Request Channel | `upli/request_channel.ksy` | Request channel format |\n| Originator Data | `upli/originator_data_channel.ksy` | Originator data channel |\n| Read Response | `upli/read_response_channel.ksy` | Read response channel |\n| Write Response | `upli/write_response_channel.ksy` | Write response channel |\n| Status Codes | `upli/status_codes.ksy` | Status code definitions |\n| Connection Handshake | `upli/protocols/connection_handshake.ksy` | Connection setup |\n| Flow Control | `upli/protocols/flow_control.ksy` | Flow control protocol |\n\n#### Transaction Layer\n| Format | File | Description |\n|--------|------|-------------|\n| TL Flit | `transaction/tl_flit.ksy` | Transaction layer flit |\n| Control Half Flit | `transaction/control_half_flit.ksy` | Control half flit |\n| Data Half Flit | `transaction/data_half_flit.ksy` | Data half flit |\n| Message Half Flit | `transaction/message_half_flit.ksy` | Message half flit |\n| Request Field | `transaction/request_field.ksy` | Request field format |\n| Response Field | `transaction/response_field.ksy` | Response field format |\n| Flow Control Field | `transaction/flow_control_field.ksy` | Flow control field |\n| Compression | `transaction/protocols/compression.ksy` | Data compression |\n| Address Cache | `transaction/protocols/address_cache.ksy` | Address caching |\n\n#### Data Link Layer\n| Format | File | Description |\n|--------|------|-------------|\n| DL Flit | `datalink/dl_flit.ksy` | Data link flit |\n| Flit Header | `datalink/flit_header.ksy` | Flit header format |\n| Segment Header | `datalink/segment_header.ksy` | Segment header |\n| CRC | `datalink/crc.ksy` | CRC calculation |\n| Control Messages | `datalink/messages/control_messages.ksy` | Control messages |\n| Basic Messages | `datalink/messages/basic_messages.ksy` | Basic messages |\n| UART Messages | `datalink/messages/uart_messages.ksy` | UART messages |\n| Vendor Defined | `datalink/messages/vendor_defined.ksy` | Vendor extensions |\n| Link Resiliency | `datalink/protocols/link_resiliency.ksy` | Link resiliency |\n| Link Level Replay | `datalink/protocols/link_level_replay.ksy` | Replay protocol |\n| Link State | `datalink/protocols/link_state.ksy` | Link state machine |\n| Link Folding | `datalink/protocols/link_folding.ksy` | Link folding |\n\n#### Physical Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Alignment Markers | `physical/alignment_markers.ksy` | Lane alignment |\n| Control Ordered Sets | `physical/control_ordered_sets.ksy` | Control sequences |\n| Reconciliation Sublayer | `physical/reconciliation_sublayer.ksy` | RS sublayer |\n| Link Training | `physical/protocols/link_training.ksy` | Link training |\n\n#### Security Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Authentication | `security/authentication.ksy` | Authentication |\n| Encryption | `security/encryption.ksy` | Encryption format |\n| IV Format | `security/iv_format.ksy` | Initialization vector |\n| Key Derivation | `security/protocols/key_derivation.ksy` | Key derivation |\n| Key Rotation | `security/protocols/key_rotation.ksy` | Key rotation |\n\n---\n\n## 11. References\n\n### Internal Documents\n- `docs/HAS/PMR/05-packet-formats.md` - PMR HAS Chapter 5\n- `docs/HAS/PMR/WORK.md` - PMR HAS Work Tracking\n- `.specify/memory/constitution.md` - Project Constitution\n\n### Datamodel Locations\n- `datamodel/protocols/ue/` - Ultra Ethernet protocols (94 .ksy files)\n- `datamodel/protocols/roce/` - RoCEv2 protocols (8 .ksy files)\n- `datamodel/protocols/ethernet/` - Standard Ethernet (6 .ksy files)\n- `datamodel/protocols/cornelis/` - Cornelis proprietary (9 .ksy files)\n- `datamodel/protocols/ualink/` - UALink protocols (38 .ksy files) - NOT supported by PMR\n- `datamodel/hw/asics/pmr/` - PMR ASIC definitions\n\n### External Specifications\n- [Ultra Ethernet Specification v1.0.1](https://ultraethernet.org/)\n- [InfiniBand Architecture Specification](https://www.infinibandta.org/)\n- IEEE 802.3 Ethernet Standard\n- UALink Specification (Ultra Accelerator Link)\n",
                "after": "# PMR (CN7000) Packet Format Taxonomy\n\n**Document**: Packet formats supported by PMR NIC ASIC  \n**Generated**: 2026-01-14  \n**Last Reviewed**: 2026-01-20  \n**Source**: `datamodel/` directory in EarlySim repository  \n**Reference**: `docs/HAS/PMR/05-packet-formats.md`\n\n---\n\n## Table of Contents\n\n1. [Overview](#1-overview)\n2. [Protocol Stack Summary](#2-protocol-stack-summary)\n3. [Ultra Ethernet+ (UE+) Formats](#3-ultra-ethernet-ue-formats)\n4. [RoCEv2 Formats](#4-rocev2-formats)\n5. [Standard Ethernet Formats](#5-standard-ethernet-formats)\n6. [Cornelis Proprietary Formats](#6-cornelis-proprietary-formats)\n7. [Host-Software Interface (HSI) Formats](#7-host-software-interface-hsi-formats)\n8. [IP Block Descriptors](#8-ip-block-descriptors)\n9. [Work List](#9-work-list)\n10. [UALink Protocol (Reference Only)](#10-ualink-protocol-reference-only)\n11. [References](#11-references)\n\n---\n\n## 1. Overview\n\nPMR (Prism River) is Cornelis Networks' 1.6 Tbps NIC ASIC (CN7000 product family). It supports multiple wire protocols with per-packet protocol selection on a single physical port.\n\n### Supported Protocols\n\n| Protocol | Version | Status | Description |\n|----------|---------|--------|-------------|\n| Ultra Ethernet+ | 1.0.1 | Full | Optimized UE with Cornelis extensions |\n| RoCEv2 | v2 | Full | RDMA over Converged Ethernet |\n| Standard Ethernet | IEEE 802.3 | Full | Traditional Ethernet with offloads |\n| Cornelis Proprietary | 1.0.0 | Full | UFH, CSIG+, VxLAN+, Collectives |\n\n### Header Efficiency Comparison\n\n| Protocol Stack | Total Headers | Efficiency (4KB payload) |\n|----------------|---------------|--------------------------|\n| UE+ (small msg) | ~20 bytes | 99.5% |\n| UE+ (standard) | ~40 bytes | 99.0% |\n| RoCEv2 (IPv4) | ~58 bytes | 98.6% |\n| RoCEv2 (IPv6) | ~78 bytes | 98.1% |\n\n---\n\n## 2. Protocol Stack Summary\n\n```\n+-----------------------------------------------------------------------------+\n|                           Application Layer                                  |\n|                    (Libfabric, Verbs, Sockets, DPDK)                         |\n+-----------------------------------------------------------------------------+\n|                           Transport Layer                                    |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UE Transport   |  |     RoCEv2       |  |    TCP/UDP       |            |\n|  |   (SES/PDS/CMS)  |  |   (BTH/RETH)     |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                           Network Layer                                      |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UFH-16/32      |  |   IPv4/IPv6      |  |   IPv4/IPv6      |            |\n|  |   (Cornelis)     |  |   + UDP          |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                            Link Layer                                        |\n|  +------------------+  +------------------+  +------------------+            |\n|  |      UE+         |  |   Ethernet II    |  |   Ethernet II    |            |\n|  |   (12 bytes)     |  |   (14 bytes)     |  |   (14 bytes)     |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                          Physical Layer                                      |\n|                    Hill Creek (212.5G x8 PAM4 SerDes)                        |\n+-----------------------------------------------------------------------------+\n      Ultra Ethernet+           RoCEv2              Standard Ethernet\n```\n\n---\n\n## 3. Ultra Ethernet+ (UE+) Formats\n\n### 3.1 UE+ L2 Header (12 bytes)\n\n**Datamodel**: `datamodel/protocols/cornelis/link/ue_plus.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Byte 2        | Byte 3        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n|L2|V|zyxm|Len  | Length[7:0]   | RC    | SC    | Hop Count     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 4        | Byte 5        | Byte 6        | Byte 7        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Dest LID [15:8]               | Dest LID [7:0]                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Entropy [15:8]                | Entropy [7:0]                 |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 8        | Byte 9        | Byte 10       | Byte 11       |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Source LID [15:8]             | Source LID [7:0]              |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Payload Type [15:8]           | Payload Type [7:0]            |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| L2 Type | 2 | Always 0b10 for UE+ |\n| Version | 1 | Protocol version |\n| zyxm | 4 | Routing control flags (multicast, adaptive) |\n| Length | 9 | Packet length in bytes |\n| RC | 4 | Routing Class (QoS) |\n| SC | 4 | Service Class |\n| Hop | 8 | TTL/hop count |\n| Dest LID | 16 | Destination Local Identifier |\n| Entropy | 16 | ECMP hash for load balancing |\n| Source LID | 16 | Source Local Identifier |\n| Type | 16 | Payload type (EtherType equivalent) |\n\n**Payload Types**:\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x0800 | IPv4 | IPv4 payload |\n| 0x86DD | IPv6 | IPv6 payload |\n| 0x8100 | VLAN | VLAN tagged frame |\n| 0x9000 | VxLAN+ | VxLAN+ encapsulated |\n| 0x9100 | CSIG+ | CSIG+ telemetry |\n| 0xC000 | UE PDS | Ultra Ethernet PDS |\n\n### 3.2 PDS (Packet Delivery Sublayer) Prologue (2 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/prologue.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0                        | Byte 1                        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| type[4:0] | next_hdr/ctl[3:0] | flags[6:0]                    |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| PDS Type | Value | Description |\n|----------|-------|-------------|\n| Reserved | 0 | Reserved |\n| TSS | 1 | Transport Security (encryption) |\n| RUD Request | 2 | Reliable Unordered Delivery |\n| ROD Request | 3 | Reliable Ordered Delivery |\n| RUDI Request | 4 | Reliable Unordered Immediate |\n| RUDI Response | 5 | RUDI response |\n| UUD Request | 6 | Unreliable Unordered Delivery |\n| ACK | 7 | Acknowledgment |\n| ACK_CC | 8 | ACK with congestion control |\n| ACK_CCX | 9 | ACK with extended CC |\n| NACK | 10 | Negative acknowledgment |\n| CP | 11 | Control packet |\n| NACK_CCX | 12 | NACK with extended CC |\n| RUD_CC_REQ | 13 | RUD with CC state |\n| ROD_CC_REQ | 14 | ROD with CC state |\n\n### 3.3 PDS Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/pds/`\n\n```\nPDS Request/Response Relationships:\n┌─────────────────────────────────────────────────────────────────┐\n│                                                                 │\n│  UUD Request (0x06) ──────────────────────→ (no response)       │\n│                                                                 │\n│  RUDI Request (0x04) ─────────────────────→ RUDI Response (0x05)│\n│                       └───────────────────→ NACK (0x0A)         │\n│                                                                 │\n│  RUD Request (0x01) ──┬───────────────────→ ACK (0x07)          │\n│                       ├───────────────────→ ACK_CC (0x08)       │\n│                       ├───────────────────→ ACK_CCX (0x09)      │\n│                       ├───────────────────→ NACK (0x0A)         │\n│                       └───────────────────→ NACK_CCX (0x0C)     │\n│                                                                 │\n│  ROD Request (0x02) ──┴───────────────────→ (same as RUD)       │\n│                                                                 │\n│  Control Packet (0x0B) ───────────────────→ (varies by subtype) │\n│                                                                 │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n| Type | Format | File | Size | Description |\n|------|--------|------|------|-------------|\n| 0x01 | RUD Request | `rud_rod_request.ksy` | 12 bytes | Reliable Unordered Delivery |\n| 0x02 | ROD Request | `rud_rod_request.ksy` | 12 bytes | Reliable Ordered Delivery |\n| 0x04 | RUDI Request | `rudi_request_response.ksy` | 6 bytes | Reliable Unordered Immediate |\n| 0x05 | RUDI Response | `rudi_request_response.ksy` | 6 bytes | RUDI response |\n| 0x06 | UUD Request | `uud_request.ksy` | 6 bytes | Unreliable Unordered Delivery |\n| 0x07 | ACK | `rud_rod_ack.ksy` | 12 bytes | Acknowledgment |\n| 0x08 | ACK_CC | `ack_cc.ksy` | 28 bytes | ACK with CC state |\n| 0x09 | ACK_CCX | `ack_ccx.ksy` | 44 bytes | ACK with extended CC |\n| 0x0A | NACK | `nack.ksy` | 12 bytes | Negative acknowledgment |\n| 0x0B | CP | `rud_rod_cp.ksy` | 12 bytes | Control packet (10 subtypes) |\n| 0x0C | NACK_CCX | `nack_ccx.ksy` | 28 bytes | NACK with extended CC |\n\n#### 3.3.1 RUD Request (Type 0x01, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_request.ksy`  \n**Related Formats**: [ROD Request (3.3.2)](#332-rod-request-type-0x02-12-bytes) | [ACK (3.3.6)](#336-ack-type-0x07-12-bytes) | [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |nxt|flg|       clear_psn_offset |         PSN [31:0]    →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|r|a|s|rsvd|\n       | (5 bits)|(4 bit)| (2) |t|r|y|(2) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x01 (RUD) | Must be 0x01 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 2 | 1[6:5] | Reserved | Must be 0 |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.ar | 1 | 1[3] | ACK request | 0=no ACK, 1=request ACK |\n| flags.syn | 1 | 1[2] | PDC establishment | 0=normal, 1=SYN |\n| flags.rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n| clear_psn_offset | 16 | 2-3 | CLEAR_PSN relative to PSN | Unsigned offset |\n| psn | 32 | 4-7 | Packet Sequence Number | 32-bit, wraps |\n| spdcid | 16 | 8-9 | Source PDCID | Valid PDCID |\n| dpdcid | 16 | 10-11 | Destination PDCID | See note below |\n\n##### Field Notes\n\n**dpdcid Interpretation** (depends on `syn` flag):\n- `syn=0`: Destination PDCID for established PDC\n- `syn=1`: `{pdc_info[3:0], psn_offset[11:0]}` for PDC establishment\n  - `pdc_info[0]`: use_rsv_pdc (1=reserved pool, 0=shared pool)\n  - `pdc_info[3:1]`: Reserved\n  - `psn_offset[11:0]`: Difference between PSN and Start_PSN\n\n**clear_psn_offset**: Computed as `CLEAR_PSN = PSN - clear_psn_offset`. Indicates the highest PSN that has been delivered to SES at the source.\n\n##### Protocol Behavior\n\n**Delivery Mode**: RUD (Reliable Unordered Delivery) provides reliable packet delivery without ordering guarantees. Packets may be delivered to SES out of order.\n\n**State Machine**: RUD operates within the PDC (Packet Delivery Channel) state machine defined in Section 3.5.7.\n\n**Transmission Rules**:\n1. Source assigns monotonically increasing PSN to each packet\n2. `ar` flag SHOULD be set periodically (per `ack_request_interval`)\n3. `retx` flag set when retransmitting due to timeout or NACK\n4. `syn` flag set only for first packet establishing new PDC\n\n**Receiver Processing**:\n1. Validate PDCID and PSN\n2. If PSN is new: deliver to SES immediately (no ordering)\n3. If PSN is duplicate: discard, optionally send ACK\n4. If `ar=1`: generate ACK, ACK_CC, or ACK_CCX response\n\n**Timing Constraints**:\n- Retransmit timeout: Implementation-defined (typically RTT-based)\n- ACK coalescing: Up to `ack_coalesce_count` packets\n\n**Reference**: UE Spec v1.0.1, Table 3-33, Section 3.5.10.3, Page 256\n\n---\n\n#### 3.3.2 ROD Request (Type 0x02, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_request.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [ACK (3.3.6)](#336-ack-type-0x07-12-bytes) | [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\nIdentical to RUD Request (Section 3.3.1) with `type = 0x02`.\n\n##### Field Definitions\n\nSame as RUD Request. Only `type` field differs.\n\n##### Protocol Behavior\n\n**Delivery Mode**: ROD (Reliable Ordered Delivery) provides reliable packet delivery with strict ordering guarantees. Packets are delivered to SES in PSN order.\n\n**Key Difference from RUD**: ROD receiver MUST buffer out-of-order packets and deliver to SES only when all preceding PSNs have been received.\n\n**Ordering Guarantee**:\n- Receiver maintains expected PSN\n- Out-of-order packets are buffered (not delivered)\n- When gap is filled, buffered packets delivered in order\n- Head-of-line blocking possible if packet lost\n\n**Use Cases**:\n- Multi-packet messages requiring in-order delivery\n- Streaming data with ordering requirements\n- Operations where partial delivery is not acceptable\n\n**Reference**: UE Spec v1.0.1, Table 3-33, Section 3.5.10.3, Page 256\n\n---\n\n#### 3.3.3 RUDI Request (Type 0x04, 6 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rudi_request_response.ksy`  \n**Related Formats**: [RUDI Response (3.3.4)](#334-rudi-response-type-0x05-6-bytes) | [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5\n     +-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  |         pkt_id [31:0]     |\n     +-------+-------+-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|r|retx|rsvd|\n       | (5 bits)|(4 bit)| (1) |m| (1)|(4) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x04 (RUDI Request) | Must be 0x04 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.rsvd_m | 1 | 1[5] | Reserved (m for response) | Must be 0 for request |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.rsvd | 4 | 1[3:0] | Reserved | Must be 0 |\n| pkt_id | 32 | 2-5 | Packet Identifier | Locally unique |\n\n##### Protocol Behavior\n\n**Delivery Mode**: RUDI (Reliable Unordered Delivery with Idempotence) provides reliable delivery for idempotent operations without PDC context.\n\n**Key Characteristics**:\n- Uses packet ID instead of sequence number\n- No PDC (Packet Delivery Context) required\n- Idempotent: safe to retry without side effects\n- Smaller header (6 bytes vs 12 bytes for RUD/ROD)\n\n**Idempotence Guarantee**:\n- Receiver tracks recently processed pkt_ids\n- Duplicate pkt_ids are detected and response re-sent\n- No state corruption from retransmissions\n\n**Use Cases**:\n- Small, self-contained operations\n- Stateless request/response patterns\n- Operations where retry is safe (reads, idempotent writes)\n\n**Reference**: UE Spec v1.0.1, Table 3-39, Section 3.5.10.9, Page 262\n\n---\n\n#### 3.3.4 RUDI Response (Type 0x05, 6 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rudi_request_response.ksy`  \n**Related Formats**: [RUDI Request (3.3.3)](#333-rudi-request-type-0x04-6-bytes)\n\n##### Wire Format\n\nIdentical to RUDI Request with `type = 0x05` and `flags.m` valid.\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x05 (RUDI Response) | Must be 0x05 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.m | 1 | 1[5] | ECN marked | 1 if request was ECN marked |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.rsvd | 4 | 1[3:0] | Reserved | Must be 0 |\n| pkt_id | 32 | 2-5 | Packet Identifier | Echoed from request |\n\n##### Protocol Behavior\n\n**Response Generation**:\n1. Receiver processes RUDI Request\n2. Generates RUDI Response with same pkt_id\n3. Sets `m` flag if request packet was ECN marked\n\n**Reference**: UE Spec v1.0.1, Table 3-39, Section 3.5.10.9, Page 262\n\n---\n\n#### 3.3.5 UUD Request (Type 0x06, 6 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/uud_request.ksy`  \n**Related Formats**: None (no response generated)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5\n     +-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  |         pkt_id [31:0]     |\n     +-------+-------+-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr|     rsvd (7)    |\n       | (5 bits)|(4 bit)|                 |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x06 (UUD) | Must be 0x06 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 7 | 1[6:0] | Reserved | Must be 0 |\n| pkt_id | 32 | 2-5 | Packet Identifier | Locally unique |\n\n##### Protocol Behavior\n\n**Delivery Mode**: UUD (Unreliable Unordered Delivery) provides best-effort delivery with no reliability guarantees.\n\n**Key Characteristics**:\n- No ACKs or NACKs generated\n- No retransmissions\n- Packet loss is acceptable\n- Lowest overhead delivery mode\n\n**Use Cases**:\n- Loss-tolerant traffic (video streaming, telemetry)\n- High-frequency updates where latest value matters\n- Multicast/broadcast scenarios\n\n**Reference**: UE Spec v1.0.1, Table 3-42, Section 3.5.10.12, Page 265\n\n---\n\n#### 3.3.6 ACK (Type 0x07, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_ack.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [ACK_CC (3.3.7)](#337-ack_cc-type-0x08-28-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  |   ack_psn_offset  |    probe_opaque     →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |   cack_psn    |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|m|r|p|req|rsvd|\n       | (5 bits)|(4 bit)| (1) | |t| |   |(1) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x07 (ACK) | Must be 0x07 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | UET_HDR_NONE |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.m | 1 | 1[5] | ECN marked | 1 if any ACK'd packet was ECN marked |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.p | 1 | 1[3] | Probe response | 1 if responding to Probe CP |\n| flags.req | 2 | 1[2:1] | Request type | 0=RUD, 1=ROD |\n| flags.rsvd | 1 | 1[0] | Reserved | Must be 0 |\n| ack_psn_offset | 16 | 2-3 | Offset from CACK_PSN to ACK_PSN | Signed |\n| probe_opaque | 16 | 4-5 | Copied from Probe CP | Opaque value |\n| cack_psn | 32 | 6-9 | Cumulative ACK PSN | Highest in-order PSN |\n| spdcid | 16 | 10-11 | Source PDCID | Swapped from request |\n| dpdcid | 16 | 12-13 | Destination PDCID | Swapped from request |\n\n**Note**: Wire format shows 12 bytes but field table shows 14 bytes. Verify against spec - likely cack_psn is 16 bits or spdcid/dpdcid share bytes 10-11.\n\n##### Protocol Behavior\n\n**ACK Generation**:\n1. Receiver tracks highest in-order PSN received (CACK_PSN)\n2. ACK generated when `ar` flag set in request, or periodically\n3. `m` flag set if any ACK'd packet had ECN marking\n\n**Cumulative ACK**:\n- `cack_psn` acknowledges all PSNs ≤ this value\n- Sender can free buffers for acknowledged packets\n- Enables sliding window flow control\n\n**Reference**: UE Spec v1.0.1, Table 3-35, Section 3.5.10.5, Page 258\n\n---\n\n#### 3.3.7 ACK_CC (Type 0x08, 28 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/ack_cc.ksy`  \n**Related Formats**: [ACK (3.3.6)](#336-ack-type-0x07-12-bytes) | [ACK_CCX (3.3.8)](#338-ack_ccx-type-0x09-44-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |                    ACK Header (12 bytes)                      |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |  (ACK cont'd) |cc_typ|cc_flg|  mpr  | sack_psn_offset       →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |              sack_bitmap [63:0]                               |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        24      25      26      27\n     +-------+-------+-------+-------+\n     |       ack_cc_state [63:0]     |\n     +-------+-------+-------+-------+\n```\n\n##### Field Definitions (CC Extension, bytes 12-27)\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| cc_type | 4 | 12[7:4] | CC algorithm type | Per Section 3.6.9 |\n| cc_flags | 4 | 12[3:0] | CC flags | Reserved, must be 0 |\n| mpr | 8 | 13 | Maximum PSN Range | Flow control window |\n| sack_psn_offset | 16 | 14-15 | Offset to SACK base PSN | Signed |\n| sack_bitmap | 64 | 16-23 | Selective ACK bitmap | 1=ACK'd, 0=not ACK'd |\n| ack_cc_state | 64 | 24-27 | CC state (per cc_type) | See Section 3.6.9 |\n\n##### CC Type Values\n\n| Value | Name | Description |\n|-------|------|-------------|\n| 0x0 | CC_NSCC | Network-Signaled Congestion Control |\n| 0x1 | CC_CREDIT | RCCC/TFC Credit-based CC |\n\n##### Protocol Behavior\n\n**Selective ACK (SACK)**:\n- `sack_bitmap` covers 64 PSNs starting at `CACK_PSN + sack_psn_offset`\n- Bit N = 1 means PSN (base + N) received\n- Enables efficient loss recovery without full retransmit\n\n**Congestion Control State**:\n- `ack_cc_state` interpretation depends on `cc_type`\n- For NSCC: Contains service_time, rcv_cwnd_pend, rcvd_bytes, ooo_count\n- For CREDIT: Contains credit information\n\n**Reference**: UE Spec v1.0.1, Table 3-36, Section 3.5.10.6, Page 259\n\n---\n\n#### 3.3.8 ACK_CCX (Type 0x09, 44 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/ack_ccx.ksy`  \n**Related Formats**: [ACK_CC (3.3.7)](#337-ack_cc-type-0x08-28-bytes)\n\n##### Wire Format\n\nACK_CCX extends ACK_CC with additional 16 bytes for extended CC state.\n\n```\nBytes 0-27:  ACK_CC header (28 bytes)\nBytes 28-43: Extended CC state (16 bytes)\n```\n\n##### Additional Fields (bytes 28-43)\n\n| Field | Bits | Offset | Description |\n|-------|------|--------|-------------|\n| ack_ccx_state | 128 | 28-43 | Extended CC state |\n\n##### Protocol Behavior\n\n**Extended State**: ACK_CCX provides additional CC state for algorithms requiring more than 64 bits of feedback.\n\n**Reference**: UE Spec v1.0.1, Table 3-37, Section 3.5.10.7, Page 260\n\n---\n\n#### 3.3.9 NACK (Type 0x0A, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/nack.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [NACK_CCX (3.3.10)](#3310-nack_ccx-type-0x0c-28-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  | nack_code |vendor_code|   nack_psn [31:0] →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|m|r|nt|rsvd|\n       | (5 bits)|(4 bit)| (1) | |t|  |(3) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x0A (NACK) | Must be 0x0A |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | UET_HDR_NONE |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.m | 1 | 1[5] | ECN marked | 1 if request was ECN marked |\n| flags.retx | 1 | 1[4] | Retransmit indicator | From request |\n| flags.nt | 1 | 1[3] | NACK type | 0=RUD/ROD, 1=RUDI |\n| flags.rsvd | 3 | 1[2:0] | Reserved | Must be 0 |\n| nack_code | 8 | 2 | NACK reason code | Per Table 3-59 |\n| vendor_code | 8 | 3 | Vendor-specific code | Optional |\n| nack_psn | 32 | 4-7 | NACK'd PSN or pkt_id | Depends on nt flag |\n| spdcid | 16 | 8-9 | Source PDCID | 0 if nt=1 or PDC failure |\n| dpdcid | 16 | 10-11 | Destination PDCID | 0 if nt=1 |\n\n##### NACK Codes (Table 3-59)\n\n| Code | Name | Description |\n|------|------|-------------|\n| 0x00 | UET_NO_PKT_BUF | No packet buffer available |\n| 0x01 | UET_TRIMMED | Packet was trimmed |\n| 0x02 | UET_NO_PDC_AVAIL | No PDC resources available |\n| 0x03 | UET_INV_DPDCID | Invalid destination PDCID |\n| 0x04 | UET_PDC_HDR_MISMATCH | PDC header mismatch |\n| 0x05 | UET_PSN_OOR_WINDOW | PSN outside expected window |\n| 0x06 | UET_PSN_GAP | PSN gap detected (packet loss) |\n\n##### Protocol Behavior\n\n**NACK Generation**:\n1. Receiver detects error condition (loss, resource exhaustion, etc.)\n2. Generates NACK with appropriate nack_code\n3. Sender receives NACK and takes corrective action\n\n**Sender Response to NACK**:\n- `UET_PSN_GAP`: Retransmit missing packets\n- `UET_NO_PKT_BUF`: Back off, retry later\n- `UET_NO_PDC_AVAIL`: PDC establishment failed, retry or abort\n\n**Reference**: UE Spec v1.0.1, Table 3-40, Section 3.5.10.10, Page 263\n\n---\n\n#### 3.3.10 NACK_CCX (Type 0x0C, 28 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/nack_ccx.ksy`  \n**Related Formats**: [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\nNACK_CCX extends NACK with 16 bytes of CC state (similar to ACK_CC extension).\n\n```\nBytes 0-11:  NACK header (12 bytes)\nBytes 12-27: CC extension (16 bytes)\n```\n\n##### Protocol Behavior\n\n**Extended NACK**: NACK_CCX provides congestion control feedback along with the negative acknowledgment, enabling the sender to adjust its rate while handling the error.\n\n**Reference**: UE Spec v1.0.1, Table 3-41, Section 3.5.10.11, Page 264\n\n---\n\n#### 3.3.11 Control Packet (Type 0x0B, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_cp.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [ACK (3.3.6)](#336-ack-type-0x07-12-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |ctl|  flags  |   probe_opaque    |         PSN [31:0]  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |ctl_typ| rsvd|i|r|a|s|rsvd|\n       | (5 bits)|(4 bit)| (1) |r|t|r|y|(2) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x0B (CP) | Must be 0x0B |\n| ctl_type | 4 | 0[2:0]+1[7] | Control packet subtype | 0-9 defined |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.isrod | 1 | 1[5] | ROD indicator | 1=ROD, 0=RUD (for NOOP/Negotiation) |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.ar | 1 | 1[3] | ACK request | 0=no ACK, 1=request ACK |\n| flags.syn | 1 | 1[2] | PDC establishment | 0=normal, 1=SYN |\n| flags.rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n| probe_opaque | 16 | 2-3 | Opaque value for Probe | Echoed in ACK |\n| psn | 32 | 4-7 | Packet Sequence Number | Some CPs consume PSN |\n| spdcid | 16 | 8-9 | Source PDCID | Valid PDCID |\n| dpdcid | 16 | 10-11 | Destination PDCID | Or {pdc_info, psn_offset} |\n\n##### Control Packet Subtypes\n\n| ctl_type | Name | Direction | Description |\n|----------|------|-----------|-------------|\n| 0 | NOOP | Either | No operation |\n| 1 | ACK_REQUEST | Src→Dst | Request ACK for specific PSN |\n| 2 | CLEAR_COMMAND | Init→Tgt | Clear guaranteed delivery state |\n| 3 | CLEAR_REQUEST | Tgt→Init | Request initiator to send clear |\n| 4 | CLOSE_COMMAND | Init→Tgt | PDC is being closed |\n| 5 | CLOSE_REQUEST | Tgt→Init | Request initiator to close PDC |\n| 6 | PROBE | Src→Dst | Request PDS ACK |\n| 7 | CREDIT | Dst→Src | Carry CC credit |\n| 8 | CREDIT_REQUEST | Src→Dst | Request credit |\n| 9 | NEGOTIATION | Either | PDC negotiation |\n\n##### Protocol Behavior\n\n**PDC Lifecycle**:\n- `CLOSE_COMMAND/REQUEST`: Graceful PDC teardown\n- `CLEAR_COMMAND/REQUEST`: Clear delivery state without closing\n\n**Flow Control**:\n- `CREDIT/CREDIT_REQUEST`: Credit-based flow control\n- `PROBE`: Solicit ACK for RTT measurement or liveness check\n\n**Reference**: UE Spec v1.0.1, Table 3-38, Section 3.5.10.8, Page 261\n\n### 3.4 SES (Semantic Sublayer) Opcodes\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/opcodes.ksy`\n\n**Request Opcodes (Table 3-17)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Tagged Send | 0x00 | Send with tag matching |\n| RMA Write | 0x01 | Remote memory write |\n| RMA Read | 0x02 | Remote memory read |\n| Atomic Write | 0x03 | Atomic memory write |\n| Atomic Read | 0x04 | Atomic memory read |\n| Atomic CAS | 0x05 | Compare-and-swap |\n| Deferrable Send | 0x06 | Deferrable send |\n| Ready to Restart | 0x07 | Restart notification |\n| Small Message | 0x08 | Small message (32B header) |\n| Small RMA Write | 0x09 | Small RMA write |\n| Small RMA Read | 0x0A | Small RMA read |\n| Small Atomic Write | 0x0B | Small atomic write |\n| Small Atomic Read | 0x0C | Small atomic read |\n| Small Atomic CAS | 0x0D | Small atomic CAS |\n\n**Response Opcodes (Table 3-18)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Response | 0x00 | Standard response |\n| Response with Data | 0x01 | Response carrying data |\n| Optimized Response | 0x02 | Optimized format |\n| NACK | 0x03 | Negative acknowledgment |\n\n### 3.5 SES Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/ses/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Standard Request (SOM=1) | `standard_request_som1.ksy` | Start of message |\n| Standard Request (SOM=0) | `standard_request_som0.ksy` | Continuation |\n| Small Message | `small_message.ksy` | 32-byte header format |\n| Small RMA | `small_rma.ksy` | Small RMA operations |\n| Response | `response.ksy` | Standard response |\n| Response with Data | `response_with_data.ksy` | Data-carrying response |\n| Optimized Response | `optimized_response_with_data.ksy` | Optimized format |\n| Deferrable Send | `deferrable_send_request.ksy` | Deferrable operation |\n| Ready to Restart | `ready_to_restart.ksy` | Restart notification |\n| Rendezvous Extension | `rendezvous_extension.ksy` | Large message protocol |\n| Atomic Extension | `atomic_extension.ksy` | Atomic operations |\n| CAS Extension | `cas_extension.ksy` | Compare-and-swap |\n\n### 3.6 CMS (Congestion Management Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/cms/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Credit CP Payload | `credit_cp_payload.ksy` | Credit control packet |\n| Credit Request | `credit_request_cp_payload.ksy` | Credit request |\n| Request CC State | `req_cc_state.ksy` | Request CC state |\n| ACK CC State (NSCC) | `ack_cc_state_nscc.ksy` | NSCC algorithm state |\n| ACK CC State (RCCC/TFC) | `ack_cc_state_rccc_tfc.ksy` | RCCC/TFC state |\n\n### 3.7 TSS (Transport Security Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/tss/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Security Header | `security_header.ksy` | Encryption header |\n| IV Construction | `iv_construction.ksy` | Initialization vector |\n| Key Rotation | `protocols/key_rotation.ksy` | Key rotation protocol |\n| KDF Direct | `protocols/kdf_direct.ksy` | Direct key derivation |\n| KDF Client/Server | `protocols/kdf_client_server.ksy` | Client/server KDF |\n| KDF Cluster | `protocols/kdf_cluster.ksy` | Cluster KDF |\n| Join Secure Domain | `protocols/join_secure_domain.ksy` | Domain join |\n| TSS TX Processing | `protocols/tss_tx_processing.ksy` | Transmit processing |\n| TSS RX Processing | `protocols/tss_rx_processing.ksy` | Receive processing |\n\n### 3.8 Link Layer Formats\n\n#### LLR (Link-Level Retry)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/llr/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| LLR Preamble (64b66b) | `llr_preamble_64b66b.ksy` | 64b66b preamble |\n| LLR Preamble (MII) | `llr_preamble_mii.ksy` | MII preamble |\n| LLR Init CTLOS | `llr_init_ctlos.ksy` | Initialize LLR |\n| LLR Init Echo CTLOS | `llr_init_echo_ctlos.ksy` | Init acknowledgment |\n| LLR ACK CTLOS | `llr_ack_ctlos.ksy` | Frame acknowledgment |\n| LLR NACK CTLOS | `llr_nack_ctlos.ksy` | Retransmit request |\n\n#### CBFC (Credit-Based Flow Control)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/cbfc/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| CF Update | `cf_update.ksy` | Credit flow update |\n| CC Update | `cc_update.ksy` | Credit count update |\n| VC State Machine | `protocols/vc_state_machine.ksy` | Virtual channel FSM |\n| Lossless VC Init | `protocols/lossless_vc_init.ksy` | VC initialization |\n| Lossless VC Removal | `protocols/lossless_vc_removal.ksy` | VC teardown |\n\n#### LLDP Extensions\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/lldp/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| UE Link Negotiation TLV | `ue_link_negotiation_tlv.ksy` | Link negotiation |\n| UE CBFC TLV | `ue_cbfc_tlv.ksy` | CBFC parameters |\n\n---\n\n## 4. RoCEv2 Formats\n\n**Datamodel Directory**: `datamodel/protocols/roce/transport/`\n\n### 4.1 RoCEv2 Packet Structure\n\n```\n+-----------------------------------------------------------------------------+\n| Ethernet II Header (14 bytes)                                               |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2) = 0x0800/0x86DD            |\n+-----------------------------------------------------------------------------+\n| IP Header (20 bytes IPv4 / 40 bytes IPv6)                                   |\n|   Version, IHL, DSCP, ECN, Length, ID, Flags, TTL, Protocol=17, Checksum   |\n|   Source IP, Dest IP                                                        |\n+-----------------------------------------------------------------------------+\n| UDP Header (8 bytes)                                                        |\n|   Source Port (entropy) | Dest Port = 4791 | Length | Checksum             |\n+-----------------------------------------------------------------------------+\n| BTH - Base Transport Header (12 bytes)                                      |\n|   Opcode | Flags | P-Key | Dest QP | A | PSN                               |\n+-----------------------------------------------------------------------------+\n| Extended Headers (optional, operation-dependent)                            |\n|   RETH (16) | AETH (4) | AtomicETH (28) | ImmDt (4)                        |\n+-----------------------------------------------------------------------------+\n| Payload (0 - MTU bytes)                                                     |\n+-----------------------------------------------------------------------------+\n| ICRC (4 bytes)                                                              |\n+-----------------------------------------------------------------------------+\n```\n\n### 4.2 BTH (Base Transport Header) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/roce/transport/bth.ksy`\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| Opcode | 8 | Operation type (transport + operation) |\n| SE | 1 | Solicited Event |\n| M | 1 | Migration state |\n| Pad | 2 | Padding bytes (0-3) |\n| TVer | 4 | Transport version (must be 0) |\n| P-Key | 16 | Partition key |\n| Dest QP | 24 | Destination Queue Pair |\n| A | 1 | ACK request |\n| PSN | 24 | Packet Sequence Number |\n\n**Transport Types** (Opcode bits [7:5]):\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x00 | RC | Reliable Connection |\n| 0x20 | UC | Unreliable Connection |\n| 0x40 | RD | Reliable Datagram |\n| 0x60 | UD | Unreliable Datagram |\n\n**Operations** (Opcode bits [4:0]):\n| Value | Operation | Description |\n|-------|-----------|-------------|\n| 0x00 | SEND_FIRST | First send packet |\n| 0x01 | SEND_MIDDLE | Middle send packet |\n| 0x02 | SEND_LAST | Last send packet |\n| 0x03 | SEND_LAST_IMM | Last send with immediate |\n| 0x04 | SEND_ONLY | Single-packet send |\n| 0x05 | SEND_ONLY_IMM | Single send with immediate |\n| 0x06 | RDMA_WRITE_FIRST | First RDMA write |\n| 0x07 | RDMA_WRITE_MIDDLE | Middle RDMA write |\n| 0x08 | RDMA_WRITE_LAST | Last RDMA write |\n| 0x09 | RDMA_WRITE_LAST_IMM | Last write with immediate |\n| 0x0A | RDMA_WRITE_ONLY | Single-packet write |\n| 0x0B | RDMA_WRITE_ONLY_IMM | Single write with immediate |\n| 0x0C | RDMA_READ_REQUEST | Read request |\n| 0x0D | RDMA_READ_RESPONSE_FIRST | First read response |\n| 0x0E | RDMA_READ_RESPONSE_MIDDLE | Middle read response |\n| 0x0F | RDMA_READ_RESPONSE_LAST | Last read response |\n| 0x10 | RDMA_READ_RESPONSE_ONLY | Single read response |\n| 0x11 | ACK | Acknowledgment |\n| 0x12 | ATOMIC_ACK | Atomic acknowledgment |\n| 0x13 | CMP_SWAP | Compare and swap |\n| 0x14 | FETCH_ADD | Fetch and add |\n\n### 4.3 Extended Transport Headers\n\n| Header | File | Size | Description |\n|--------|------|------|-------------|\n| RETH | `reth.ksy` | 16 bytes | RDMA Extended Transport Header |\n| AETH | `aeth.ksy` | 4 bytes | ACK Extended Transport Header |\n| AtomicETH | `atomiceth.ksy` | 28 bytes | Atomic Extended Transport Header |\n| AtomicAckETH | `atomicacketh.ksy` | 8 bytes | Atomic ACK ETH |\n| DETH | `deth.ksy` | 8 bytes | Datagram Extended Transport Header |\n| ImmDt | `immdt.ksy` | 4 bytes | Immediate Data |\n| ICRC | `icrc.ksy` | 4 bytes | Invariant CRC |\n\n---\n\n## 5. Standard Ethernet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ethernet/`\n\n### 5.1 Ethernet II Frame\n\n**Datamodel**: `datamodel/protocols/ethernet/link/ethernet_ii.ksy`\n\n```\n+-----------------------------------------------------------------------------+\n| Preamble (7 bytes) + SFD (1 byte)  [not visible to software]               |\n+-----------------------------------------------------------------------------+\n| Ethernet Header (14 bytes)                                                  |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2)                            |\n+-----------------------------------------------------------------------------+\n| Optional VLAN Tag (4 bytes) - 802.1Q                                        |\n|   TPID (2) = 0x8100 | TCI (2) = PCP + DEI + VID                            |\n+-----------------------------------------------------------------------------+\n| Payload (46-1500 bytes, or up to 9000 for jumbo)                           |\n+-----------------------------------------------------------------------------+\n| FCS (4 bytes)                                                               |\n+-----------------------------------------------------------------------------+\n```\n\n### 5.2 Link Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| Ethernet II | `link/ethernet_ii.ksy` | Standard Ethernet frame |\n| VLAN 802.1Q | `link/vlan_802_1q.ksy` | VLAN tagging |\n\n### 5.3 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| IPv4 | `network/ipv4.ksy` | IPv4 header |\n| IPv6 | `network/ipv6.ksy` | IPv6 header |\n\n### 5.4 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| TCP | `transport/tcp.ksy` | TCP header |\n| UDP | `transport/udp.ksy` | UDP header |\n\n---\n\n## 6. Cornelis Proprietary Formats\n\n**Datamodel Directory**: `datamodel/protocols/cornelis/`\n\n### 6.1 Link Layer\n\n| Format | File | Size | Description |\n|--------|------|------|-------------|\n| UE+ Header | `link/ue_plus.ksy` | 12 bytes | Optimized L2 header |\n| Cornelis L2 Prefix | `link/cornelis_l2_prefix.ksy` | Variable | L2 prefix |\n\n### 6.2 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| UFH-16 | `network/ufh_16.ksy` | 16-bit forwarding header |\n| UFH-32 | `network/ufh_32.ksy` | 32-bit forwarding header |\n| Collective L2 | `network/collective_l2.ksy` | Collective operations header |\n| Scale-Up L2 | `network/scaleup_l2.ksy` | Scale-up deployments |\n\n#### 6.2.1 UFH-16 (Unified Forwarding Header 16-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_16.ksy`\n\nUFH-16 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 16-bit addressing.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |    Opaque (24-bit)    | Destination   |Opaque |Traffic|   Opaque      |    Source     |\n|[7:4]  |                       | (16-bit BE)   |[7:4]  |Class  |   (16-bit)    |  (16-bit BE)  |\n|SLAP   |                       |               |Z|Y|X|M|[7:0]  |               |               |\n|[3:0]  |                       |               |[3:0]  |       |               |               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1-3 | 24 | Opaque to hardware |\n| Destination | 4-5 | 16 | Destination endpoint address (big-endian) |\n| Opaque | 6 | [7:4] | Opaque to hardware |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Opaque | 8-9 | 16 | Opaque to hardware |\n| Source | 10-11 | 16 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-16 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5-14 | Reserved | Reserved for future use |\n| 15 | Extended | UFH-32 extension follows |\n\n**Usage**: Scale-up fabric forwarding, intra-pod communication, medium cluster networking (up to 65536 endpoints).\n\n#### 6.2.2 UFH-32 (Unified Forwarding Header 32-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_32.ksy`\n\nUFH-32 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 32-bit addressing for large-scale deployments.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |       |   Destination (32-bit BE)     |HopLim |Traffic|       Source (32-bit BE)      |\n|[7:4]  |Opaque |                               |[7:4]  |Class  |                               |\n|SLAP   |       |                               |Z|Y|X|M|[7:0]  |                               |\n|[3:0]  |       |                               |[3:0]  |       |                               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1 | [7:0] | Opaque to hardware |\n| Destination | 2-5 | 32 | Destination endpoint address (big-endian) |\n| Hop Limit | 6 | [7:4] | TTL/hop count |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Source | 8-11 | 32 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-32 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5 | Multicast | Multicast packet |\n| 6 | Barrier | Barrier synchronization |\n| 7 | Reduction | Reduction operation |\n| 8-14 | Reserved | Reserved for future use |\n| 15 | Vendor | Vendor-specific packet |\n\n**Usage**: Large-scale scale-up fabric forwarding (4+ billion endpoints), multi-pod communication, extended collective operations.\n\n### 6.3 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| CSIG+ | `transport/csig_plus.ksy` | Telemetry header |\n| PKEY | `transport/pkey.ksy` | Partition key |\n\n### 6.4 Encapsulation\n\n| Format | File | Description |\n|--------|------|-------------|\n| VxLAN+ | `encapsulation/vxlan_plus.ksy` | Extended VxLAN overlay |\n\n---\n\n## 7. Host-Software Interface (HSI) Formats\n\n**Datamodel Directory**: `datamodel/hw/asics/pmr/interfaces/host_interface/`\n\n### 7.1 Command Queue Segment (64 bytes)\n\n**Datamodel**: `command_queue_segment.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Bytes 2-3     | Bytes 4-7     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Opcode        | Flags         | Payload Len   | Reserved      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 8-15                    | Bytes 16-23                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Tag (64 bits)                 | Dest (64 bits)                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 24-31                   | Bytes 32-63                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Metadata (64 bits)            | Inline Data or SGL Entry      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n**Opcode Encoding**:\n| Bits | Field | Values |\n|------|-------|--------|\n| [7:4] | Family | MSG=0x1, TAGGED=0x2, RMA=0x3, ATOMIC=0x4 |\n| [3:2] | Variant | SEND=0, RECV=1, INJECT=2 |\n| [1] | Reserved | Must be 0 |\n| [0] | Data Source | INLINE=0, SGL=1 |\n\n### 7.2 Notification Formats\n\n| Format | File | Type | Size | Description |\n|--------|------|------|------|-------------|\n| Receive Notification | `receive_notification.ksy` | 0x00 | 64 bytes | Received message |\n| Send Completion | `send_completion.ksy` | 0x01 | 64 bytes | Send completed |\n| Event Notification | `event_notification.ksy` | 0x02 | 64 bytes | Async event |\n| Notification Entry | `notification_entry.ksy` | - | 64 bytes | Generic entry |\n| QW Violation Event | `qw_violation_event.ksy` | - | 64 bytes | QW alignment error |\n\n### 7.3 Receive Notification (64 bytes)\n\n**Datamodel**: `receive_notification.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x00 for receive |\n| flags | 1 | 1 | FI_INLINE, continuation |\n| status | 2 | 2 | Completion status |\n| src_id | 4 | 4 | Source endpoint ID |\n| tag | 8 | 8 | Tag value |\n| total_length | 16 | 4 | Payload length |\n| buffer_id_0 | 20 | 2 | First buffer ID |\n| buffer_id_1 | 22 | 2 | Second buffer ID |\n| buffer_offset | 24 | 2 | Offset in buffer |\n| reserved | 26 | 2 | Reserved |\n| inline_data | 28 | 35 | Inline payload |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.4 Send Completion (64 bytes)\n\n**Datamodel**: `send_completion.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x01 for send |\n| flags | 1 | 1 | Completion flags |\n| status | 2 | 2 | Completion status |\n| reserved_0 | 4 | 4 | Reserved |\n| op_context | 8 | 8 | Operation context |\n| bytes_sent | 16 | 4 | Bytes transferred |\n| reserved_1 | 20 | 43 | Reserved |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.5 Other HSI Formats\n\n| Format | File | Description |\n|--------|------|-------------|\n| SGL Entry | `sgl_entry.ksy` | Scatter-gather list entry |\n| PCIe Descriptors | `pcie/descriptors.ksy` | PCIe interface descriptors |\n\n---\n\n## 8. IP Block Descriptors\n\n**Datamodel Directory**: `datamodel/hw/ip/cornelis/`\n\n### 8.1 Collectives Engine (CE)\n\n**Datamodel**: `ce/descriptors.ksy`\n\nThe Collectives Engine uses RISC-V vector cores (VLEN=512) for hardware-accelerated collective operations.\n\n### 8.2 Electric Creek (EC)\n\n**Datamodel**: `ec/descriptors.ksy`\n\nElectric Creek is the management complex shared between PMR NIC and LNR Switch.\n\n---\n\n## 9. Work List\n\nThis section tracks issues requiring follow-up investigation or specification updates.\n\n### 9.1 Open Issues\n\n| ID | Priority | Category | Description | Status | Opened | Closed |\n|----|----------|----------|-------------|--------|--------|--------|\n| W-06-001 | Medium | Datamodel | UFH-32 lacks 16-bit entropy field; per-packet ECMP not supported; switch must derive entropy from Src+Dest hash | Deferred | 2026-01-20 | - |\n| W-07-001 | Low | Datamodel | `ack_cc.ksy` shows `ack_cc_state` as 32-bit (4 bytes) but UE Spec Table 3-36 shows 64-bit (8 bytes); verify field size | Investigation | 2026-01-22 | - |\n| W-07-002 | Low | Documentation | `collective_l2.ksy` and `scaleup_l2.ksy` marked as \"work_in_progress\" with spec_version 0.1; specifications incomplete | Spec Update | 2026-01-22 | - |\n| W-07-003 | Low | Datamodel | `ue_plus.ksy` 9-bit length field split across bytes 0-1 with unusual encoding (1 bit in byte 0, 8 bits in byte 1); verify encoding matches UE Spec | Investigation | 2026-01-22 | - |\n| W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |\n| W-05-002 | Medium | Specification | MTU values: Verify maximum MTU for each protocol | Investigation | 2026-01-10 | - |\n| W-05-003 | Medium | Documentation | CMS detailed formats: Need comprehensive documentation | Spec Update | 2026-01-10 | - |\n| W-03-002 | Low | Terminology | PDP vs PDS naming: UML uses both terms inconsistently | Spec Update | 2026-01-08 | - |\n| W-03-006 | Low | Terminology | SES vs SE: \"SES Processing Groups\" vs \"Semantic Engines\" | Spec Update | 2026-01-08 | - |\n\n### 9.2 Datamodel Gaps\n\n| ID | Priority | Description | Target Location | Status | Opened | Closed |\n|----|----------|-------------|-----------------|--------|--------|--------|\n| D-001 | High | PMR CSR definitions missing from datamodel | `datamodel/hw/asics/pmr/csrs/*.rdl` | Spec Update | 2026-01-10 | - |\n| D-002 | Medium | PMR block hierarchy YAML incomplete | `datamodel/hw/asics/pmr/blocks.yaml` | Spec Update | 2026-01-10 | - |\n| D-003 | Medium | PMR interface contracts missing | `datamodel/views/contracts/pmr-*.puml` | Spec Update | 2026-01-10 | - |\n\n### 9.3 Specification Clarifications Needed\n\n| ID | Priority | Question | Context | Status | Opened | Closed |\n|----|----------|----------|---------|--------|--------|--------|\n| Q1 | Medium | Lightweight Interface Scope | What features should be reduced in lightweight mode? | Investigation | 2026-01-10 | - |\n| Q2 | Medium | Tag Table Sizing | Should HW tag table size be per-endpoint configurable? | Investigation | 2026-01-10 | - |\n| Q3 | Medium | Multi-Packet Eager Messages | Should hardware support multi-packet eager messages? | Investigation | 2026-01-10 | - |\n| Q4 | Low | RoCE Work Queue Implementation | Confirm RoCE WQ/CQ are software-implemented | Investigation | 2026-01-10 | - |\n\n### 9.4 Closed Issues\n\n| ID | Priority | Category | Description | Resolution | Opened | Closed |\n|----|----------|----------|-------------|------------|--------|--------|\n| W-05-001 | Medium | Documentation | UE taxonomy reference | Documented in `05-packet-formats.md` | 2026-01-08 | 2026-01-10 |\n| W-02-005 | Medium | Documentation | Protocol support documentation | Documented UE+, RoCEv2, Ethernet | 2026-01-08 | 2026-01-10 |\n| W-02-006 | Medium | Documentation | Cornelis Collective Reduction Protocol | Documented in HAS §2.5.4 | 2026-01-08 | 2026-01-10 |\n| W-03-001 | Medium | Architecture | Semantic Engine count | Confirmed 64 (8x8) in UML and HAS | 2026-01-08 | 2026-01-10 |\n| W-17-005 | Low | Documentation | Port subdivision note | Added to HAS Ch17 | 2026-01-11 | 2026-01-11 |\n| W-17-006 | Medium | Documentation | MPORT interface documentation | Documented 256B @ 1.66 GHz | 2026-01-11 | 2026-01-11 |\n| W-04-005 | High | Datamodel | `ufh_16.ksy` address size: Datamodel shows 12-bit dest, should be 16-bit | UFH-16 restructured to 12-byte Ethernet MAC overlay with 16-bit destination (bytes 4-5) and 16-bit source (bytes 10-11) | 2026-01-10 | 2026-01-20 |\n| W-04-006 | High | Datamodel | `ufh_32.ksy` address size: Datamodel shows 16-bit dest, should be 32-bit | UFH-32 restructured to 12-byte Ethernet MAC overlay with 32-bit destination (bytes 2-5) and 32-bit source (bytes 8-11) | 2026-01-10 | 2026-01-20 |\n\n### 9.5 Change Log\n\n| Date | Change | Details |\n|------|--------|---------|\n| 2026-01-14 | Initial creation | Document created with PMR packet taxonomy |\n| 2026-01-20 | Review and update | Added UALink section (reference only, not PMR-supported); Added change log; Updated datamodel file counts; No new .ksy files since initial creation |\n| 2026-01-20 | UFH format details | Added detailed UFH-16 and UFH-32 format documentation in Section 6.2 (wire diagrams, field tables, type enumerations) |\n| 2026-01-20 | UFH restructuring | UFH-16 and UFH-32 restructured to 12-byte Ethernet MAC overlays; UFH-16 now 16-bit addressing, UFH-32 now 32-bit addressing; Added SLAP field constraints (Z,Y,X=001); Updated datamodel .ksy files; Closed W-04-005 and W-04-006 |\n| 2026-01-22 | Datamodel review | Added W-07-001 (ack_cc_state size mismatch), W-07-002 (collective/scaleup specs incomplete), W-07-003 (ue_plus length encoding); Identified 30+ packet formats requiring expansion |\n\n---\n\n## 10. UALink Protocol (Reference Only)\n\n**Note**: UALink is defined in the datamodel but is **NOT currently supported by PMR**. It is included here for reference as it may be relevant for future AI/ML accelerator interconnect work.\n\n**Datamodel Directory**: `datamodel/protocols/ualink/`\n\n### 10.1 UALink Overview\n\nUALink is an AI/ML accelerator interconnect protocol with 38 packet definitions across all OSI layers.\n\n| Layer | Count | Key Formats |\n|-------|-------|-------------|\n| UPLI (Upper Protocol Layer Interface) | 8 | commands.ksy, request_channel.ksy, status_codes.ksy |\n| Transaction | 9 | tl_flit.ksy, control_half_flit.ksy, data_half_flit.ksy |\n| Data Link | 12 | dl_flit.ksy, segment_header.ksy, crc.ksy, control_messages.ksy |\n| Physical | 4 | alignment_markers.ksy, control_ordered_sets.ksy, link_training.ksy |\n| Security | 5 | authentication.ksy, encryption.ksy, key_derivation.ksy |\n\n### 10.2 UALink Packet Formats\n\n#### UPLI Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Commands | `upli/commands.ksy` | UPLI command definitions |\n| Request Channel | `upli/request_channel.ksy` | Request channel format |\n| Originator Data | `upli/originator_data_channel.ksy` | Originator data channel |\n| Read Response | `upli/read_response_channel.ksy` | Read response channel |\n| Write Response | `upli/write_response_channel.ksy` | Write response channel |\n| Status Codes | `upli/status_codes.ksy` | Status code definitions |\n| Connection Handshake | `upli/protocols/connection_handshake.ksy` | Connection setup |\n| Flow Control | `upli/protocols/flow_control.ksy` | Flow control protocol |\n\n#### Transaction Layer\n| Format | File | Description |\n|--------|------|-------------|\n| TL Flit | `transaction/tl_flit.ksy` | Transaction layer flit |\n| Control Half Flit | `transaction/control_half_flit.ksy` | Control half flit |\n| Data Half Flit | `transaction/data_half_flit.ksy` | Data half flit |\n| Message Half Flit | `transaction/message_half_flit.ksy` | Message half flit |\n| Request Field | `transaction/request_field.ksy` | Request field format |\n| Response Field | `transaction/response_field.ksy` | Response field format |\n| Flow Control Field | `transaction/flow_control_field.ksy` | Flow control field |\n| Compression | `transaction/protocols/compression.ksy` | Data compression |\n| Address Cache | `transaction/protocols/address_cache.ksy` | Address caching |\n\n#### Data Link Layer\n| Format | File | Description |\n|--------|------|-------------|\n| DL Flit | `datalink/dl_flit.ksy` | Data link flit |\n| Flit Header | `datalink/flit_header.ksy` | Flit header format |\n| Segment Header | `datalink/segment_header.ksy` | Segment header |\n| CRC | `datalink/crc.ksy` | CRC calculation |\n| Control Messages | `datalink/messages/control_messages.ksy` | Control messages |\n| Basic Messages | `datalink/messages/basic_messages.ksy` | Basic messages |\n| UART Messages | `datalink/messages/uart_messages.ksy` | UART messages |\n| Vendor Defined | `datalink/messages/vendor_defined.ksy` | Vendor extensions |\n| Link Resiliency | `datalink/protocols/link_resiliency.ksy` | Link resiliency |\n| Link Level Replay | `datalink/protocols/link_level_replay.ksy` | Replay protocol |\n| Link State | `datalink/protocols/link_state.ksy` | Link state machine |\n| Link Folding | `datalink/protocols/link_folding.ksy` | Link folding |\n\n#### Physical Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Alignment Markers | `physical/alignment_markers.ksy` | Lane alignment |\n| Control Ordered Sets | `physical/control_ordered_sets.ksy` | Control sequences |\n| Reconciliation Sublayer | `physical/reconciliation_sublayer.ksy` | RS sublayer |\n| Link Training | `physical/protocols/link_training.ksy` | Link training |\n\n#### Security Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Authentication | `security/authentication.ksy` | Authentication |\n| Encryption | `security/encryption.ksy` | Encryption format |\n| IV Format | `security/iv_format.ksy` | Initialization vector |\n| Key Derivation | `security/protocols/key_derivation.ksy` | Key derivation |\n| Key Rotation | `security/protocols/key_rotation.ksy` | Key rotation |\n\n---\n\n## 11. References\n\n### Internal Documents\n- `docs/HAS/PMR/05-packet-formats.md` - PMR HAS Chapter 5\n- `docs/HAS/PMR/WORK.md` - PMR HAS Work Tracking\n- `.specify/memory/constitution.md` - Project Constitution\n\n### Datamodel Locations\n- `datamodel/protocols/ue/` - Ultra Ethernet protocols (94 .ksy files)\n- `datamodel/protocols/roce/` - RoCEv2 protocols (8 .ksy files)\n- `datamodel/protocols/ethernet/` - Standard Ethernet (6 .ksy files)\n- `datamodel/protocols/cornelis/` - Cornelis proprietary (9 .ksy files)\n- `datamodel/protocols/ualink/` - UALink protocols (38 .ksy files) - NOT supported by PMR\n- `datamodel/hw/asics/pmr/` - PMR ASIC definitions\n\n### External Specifications\n- [Ultra Ethernet Specification v1.0.1](https://ultraethernet.org/)\n- [InfiniBand Architecture Specification](https://www.infinibandta.org/)\n- IEEE 802.3 Ethernet Standard\n- UALink Specification (Ultra Accelerator Link)\n",
                "additions": 583,
                "deletions": 12
              },
              "truncated": false
            },
            "time": {
              "start": 1769123705463,
              "end": 1769123705770
            }
          }
        },
        {
          "id": "prt_be7fd73ae001xhw2uGthp22GOa",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fb9301001yf5axy2QpM8ISq",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 94073,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7fd73f1001kzyR179gccwgoX",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769123705841,
          "completed": 1769123723063
        },
        "parentID": "msg_be7faadd7001qnhXPM5tKghXUR",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 94082,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7fd7911001LpH7slM4Lx7sIe",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fd73f1001kzyR179gccwgoX",
          "type": "step-start"
        },
        {
          "id": "prt_be7fdb6f9001fUHLePCqN9xqe6",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fd73f1001kzyR179gccwgoX",
          "type": "tool",
          "callID": "toolu_01H1Mq6Y2SWi3ZSRw51CpZUC",
          "tool": "todowrite",
          "state": {
            "status": "completed",
            "input": {
              "todos": [
                {
                  "id": "p1-1",
                  "content": "Read current packet_taxonomy.md Section 3 structure",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-2",
                  "content": "Expand PDS 3.3.1 UUD Request (Type 0x00)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-3",
                  "content": "Expand PDS 3.3.2 RUDI Request/Response (Type 0x01)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-4",
                  "content": "Expand PDS 3.3.3 RUD Request (Type 0x02)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-5",
                  "content": "Expand PDS 3.3.4 ROD Request (Type 0x03)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-6",
                  "content": "Expand PDS 3.3.5 Control Packet (Type 0x04)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-7",
                  "content": "Expand PDS 3.3.6 ACK (Type 0x08)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-8",
                  "content": "Expand PDS 3.3.7 ACK_CC (Type 0x09)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-9",
                  "content": "Expand PDS 3.3.8 ACK_CCX (Type 0x0A)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-10",
                  "content": "Expand PDS 3.3.9 NACK (Type 0x0C)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-11",
                  "content": "Expand PDS 3.3.10 NACK_CCX (Type 0x0D)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-12",
                  "content": "Expand SES 3.5.1 Standard Request SOM=1 (Table 3-8)",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "p1-13",
                  "content": "Expand SES 3.5.2 Standard Request SOM=0 (Table 3-9)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-14",
                  "content": "Expand SES 3.5.3 Response (Table 3-11)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-15",
                  "content": "Expand SES 3.5.4 Response with Data (Table 3-12)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-16",
                  "content": "Expand SES 3.5.5 Optimized Response with Data (Figure 3-13)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p1-17",
                  "content": "Expand SES 3.5.6 Small Message (Figure 3-14)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-18",
                  "content": "Expand SES 3.5.7 Rendezvous Extension (Figure 3-15)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p1-19",
                  "content": "Expand SES 3.5.8 Atomic Extension (Figure 3-16)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p1-20",
                  "content": "Add cross-reference diagrams to section headers",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "p1-21",
                  "content": "Validation pass against .ksy files",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-22",
                  "content": "Update change log",
                  "status": "pending",
                  "priority": "medium"
                }
              ]
            },
            "output": "[\n  {\n    \"id\": \"p1-1\",\n    \"content\": \"Read current packet_taxonomy.md Section 3 structure\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-2\",\n    \"content\": \"Expand PDS 3.3.1 UUD Request (Type 0x00)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-3\",\n    \"content\": \"Expand PDS 3.3.2 RUDI Request/Response (Type 0x01)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-4\",\n    \"content\": \"Expand PDS 3.3.3 RUD Request (Type 0x02)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-5\",\n    \"content\": \"Expand PDS 3.3.4 ROD Request (Type 0x03)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-6\",\n    \"content\": \"Expand PDS 3.3.5 Control Packet (Type 0x04)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-7\",\n    \"content\": \"Expand PDS 3.3.6 ACK (Type 0x08)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-8\",\n    \"content\": \"Expand PDS 3.3.7 ACK_CC (Type 0x09)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-9\",\n    \"content\": \"Expand PDS 3.3.8 ACK_CCX (Type 0x0A)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-10\",\n    \"content\": \"Expand PDS 3.3.9 NACK (Type 0x0C)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-11\",\n    \"content\": \"Expand PDS 3.3.10 NACK_CCX (Type 0x0D)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-12\",\n    \"content\": \"Expand SES 3.5.1 Standard Request SOM=1 (Table 3-8)\",\n    \"status\": \"in_progress\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-13\",\n    \"content\": \"Expand SES 3.5.2 Standard Request SOM=0 (Table 3-9)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-14\",\n    \"content\": \"Expand SES 3.5.3 Response (Table 3-11)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-15\",\n    \"content\": \"Expand SES 3.5.4 Response with Data (Table 3-12)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-16\",\n    \"content\": \"Expand SES 3.5.5 Optimized Response with Data (Figure 3-13)\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p1-17\",\n    \"content\": \"Expand SES 3.5.6 Small Message (Figure 3-14)\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-18\",\n    \"content\": \"Expand SES 3.5.7 Rendezvous Extension (Figure 3-15)\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p1-19\",\n    \"content\": \"Expand SES 3.5.8 Atomic Extension (Figure 3-16)\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p1-20\",\n    \"content\": \"Add cross-reference diagrams to section headers\",\n    \"status\": \"completed\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p1-21\",\n    \"content\": \"Validation pass against .ksy files\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-22\",\n    \"content\": \"Update change log\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  }\n]",
            "title": "10 todos",
            "metadata": {
              "todos": [
                {
                  "id": "p1-1",
                  "content": "Read current packet_taxonomy.md Section 3 structure",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-2",
                  "content": "Expand PDS 3.3.1 UUD Request (Type 0x00)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-3",
                  "content": "Expand PDS 3.3.2 RUDI Request/Response (Type 0x01)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-4",
                  "content": "Expand PDS 3.3.3 RUD Request (Type 0x02)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-5",
                  "content": "Expand PDS 3.3.4 ROD Request (Type 0x03)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-6",
                  "content": "Expand PDS 3.3.5 Control Packet (Type 0x04)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-7",
                  "content": "Expand PDS 3.3.6 ACK (Type 0x08)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-8",
                  "content": "Expand PDS 3.3.7 ACK_CC (Type 0x09)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-9",
                  "content": "Expand PDS 3.3.8 ACK_CCX (Type 0x0A)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-10",
                  "content": "Expand PDS 3.3.9 NACK (Type 0x0C)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-11",
                  "content": "Expand PDS 3.3.10 NACK_CCX (Type 0x0D)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-12",
                  "content": "Expand SES 3.5.1 Standard Request SOM=1 (Table 3-8)",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "p1-13",
                  "content": "Expand SES 3.5.2 Standard Request SOM=0 (Table 3-9)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-14",
                  "content": "Expand SES 3.5.3 Response (Table 3-11)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-15",
                  "content": "Expand SES 3.5.4 Response with Data (Table 3-12)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-16",
                  "content": "Expand SES 3.5.5 Optimized Response with Data (Figure 3-13)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p1-17",
                  "content": "Expand SES 3.5.6 Small Message (Figure 3-14)",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-18",
                  "content": "Expand SES 3.5.7 Rendezvous Extension (Figure 3-15)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p1-19",
                  "content": "Expand SES 3.5.8 Atomic Extension (Figure 3-16)",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p1-20",
                  "content": "Add cross-reference diagrams to section headers",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "p1-21",
                  "content": "Validation pass against .ksy files",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p1-22",
                  "content": "Update change log",
                  "status": "pending",
                  "priority": "medium"
                }
              ],
              "truncated": false
            },
            "time": {
              "start": 1769123723003,
              "end": 1769123723054
            }
          }
        },
        {
          "id": "prt_be7fdb730001qfpKE5N8KWwMLD",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fd73f1001kzyR179gccwgoX",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 94082,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7fdb77e0013GXs4cXPWgTQJ0",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769123723134,
          "completed": 1769123732697
        },
        "parentID": "msg_be7faadd7001qnhXPM5tKghXUR",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 95097,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7fdbbdb001jRyVkL8U6dHxVB",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fdb77e0013GXs4cXPWgTQJ0",
          "type": "step-start"
        },
        {
          "id": "prt_be7fddc8c001BC4UN5pNb41bV7",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fdb77e0013GXs4cXPWgTQJ0",
          "type": "tool",
          "callID": "toolu_01N9ZwR3uAsJsJ391KdxHTx4",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
              "offset": 480,
              "limit": 100
            },
            "output": "<file>\n00481| | flags.req | 2 | 1[2:1] | Request type | 0=RUD, 1=ROD |\n00482| | flags.rsvd | 1 | 1[0] | Reserved | Must be 0 |\n00483| | ack_psn_offset | 16 | 2-3 | Offset from CACK_PSN to ACK_PSN | Signed |\n00484| | probe_opaque | 16 | 4-5 | Copied from Probe CP | Opaque value |\n00485| | cack_psn | 32 | 6-9 | Cumulative ACK PSN | Highest in-order PSN |\n00486| | spdcid | 16 | 10-11 | Source PDCID | Swapped from request |\n00487| | dpdcid | 16 | 12-13 | Destination PDCID | Swapped from request |\n00488| \n00489| **Note**: Wire format shows 12 bytes but field table shows 14 bytes. Verify against spec - likely cack_psn is 16 bits or spdcid/dpdcid share bytes 10-11.\n00490| \n00491| ##### Protocol Behavior\n00492| \n00493| **ACK Generation**:\n00494| 1. Receiver tracks highest in-order PSN received (CACK_PSN)\n00495| 2. ACK generated when `ar` flag set in request, or periodically\n00496| 3. `m` flag set if any ACK'd packet had ECN marking\n00497| \n00498| **Cumulative ACK**:\n00499| - `cack_psn` acknowledges all PSNs ≤ this value\n00500| - Sender can free buffers for acknowledged packets\n00501| - Enables sliding window flow control\n00502| \n00503| **Reference**: UE Spec v1.0.1, Table 3-35, Section 3.5.10.5, Page 258\n00504| \n00505| ---\n00506| \n00507| #### 3.3.7 ACK_CC (Type 0x08, 28 bytes)\n00508| \n00509| **Datamodel**: `datamodel/protocols/ue/transport/pds/ack_cc.ksy`  \n00510| **Related Formats**: [ACK (3.3.6)](#336-ack-type-0x07-12-bytes) | [ACK_CCX (3.3.8)](#338-ack_ccx-type-0x09-44-bytes)\n00511| \n00512| ##### Wire Format\n00513| \n00514| ```\n00515| Byte:    0       1       2       3       4       5       6       7\n00516|      +-------+-------+-------+-------+-------+-------+-------+-------+\n00517|      |                    ACK Header (12 bytes)                      |\n00518|      +-------+-------+-------+-------+-------+-------+-------+-------+\n00519|          8       9      10      11      12      13      14      15\n00520|      +-------+-------+-------+-------+-------+-------+-------+-------+\n00521|      |  (ACK cont'd) |cc_typ|cc_flg|  mpr  | sack_psn_offset       →\n00522|      +-------+-------+-------+-------+-------+-------+-------+-------+\n00523|         16      17      18      19      20      21      22      23\n00524|      +-------+-------+-------+-------+-------+-------+-------+-------+\n00525|    → |              sack_bitmap [63:0]                               |\n00526|      +-------+-------+-------+-------+-------+-------+-------+-------+\n00527|         24      25      26      27\n00528|      +-------+-------+-------+-------+\n00529|      |       ack_cc_state [63:0]     |\n00530|      +-------+-------+-------+-------+\n00531| ```\n00532| \n00533| ##### Field Definitions (CC Extension, bytes 12-27)\n00534| \n00535| | Field | Bits | Offset | Description | Constraints |\n00536| |-------|------|--------|-------------|-------------|\n00537| | cc_type | 4 | 12[7:4] | CC algorithm type | Per Section 3.6.9 |\n00538| | cc_flags | 4 | 12[3:0] | CC flags | Reserved, must be 0 |\n00539| | mpr | 8 | 13 | Maximum PSN Range | Flow control window |\n00540| | sack_psn_offset | 16 | 14-15 | Offset to SACK base PSN | Signed |\n00541| | sack_bitmap | 64 | 16-23 | Selective ACK bitmap | 1=ACK'd, 0=not ACK'd |\n00542| | ack_cc_state | 64 | 24-27 | CC state (per cc_type) | See Section 3.6.9 |\n00543| \n00544| ##### CC Type Values\n00545| \n00546| | Value | Name | Description |\n00547| |-------|------|-------------|\n00548| | 0x0 | CC_NSCC | Network-Signaled Congestion Control |\n00549| | 0x1 | CC_CREDIT | RCCC/TFC Credit-based CC |\n00550| \n00551| ##### Protocol Behavior\n00552| \n00553| **Selective ACK (SACK)**:\n00554| - `sack_bitmap` covers 64 PSNs starting at `CACK_PSN + sack_psn_offset`\n00555| - Bit N = 1 means PSN (base + N) received\n00556| - Enables efficient loss recovery without full retransmit\n00557| \n00558| **Congestion Control State**:\n00559| - `ack_cc_state` interpretation depends on `cc_type`\n00560| - For NSCC: Contains service_time, rcv_cwnd_pend, rcvd_bytes, ooo_count\n00561| - For CREDIT: Contains credit information\n00562| \n00563| **Reference**: UE Spec v1.0.1, Table 3-36, Section 3.5.10.6, Page 259\n00564| \n00565| ---\n00566| \n00567| #### 3.3.8 ACK_CCX (Type 0x09, 44 bytes)\n00568| \n00569| **Datamodel**: `datamodel/protocols/ue/transport/pds/ack_ccx.ksy`  \n00570| **Related Formats**: [ACK_CC (3.3.7)](#337-ack_cc-type-0x08-28-bytes)\n00571| \n00572| ##### Wire Format\n00573| \n00574| ACK_CCX extends ACK_CC with additional 16 bytes for extended CC state.\n00575| \n00576| ```\n00577| Bytes 0-27:  ACK_CC header (28 bytes)\n00578| Bytes 28-43: Extended CC state (16 bytes)\n00579| ```\n00580| \n\n(File has more lines. Use 'offset' parameter to read beyond line 580)\n</file>",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy.md",
            "metadata": {
              "preview": "| flags.req | 2 | 1[2:1] | Request type | 0=RUD, 1=ROD |\n| flags.rsvd | 1 | 1[0] | Reserved | Must be 0 |\n| ack_psn_offset | 16 | 2-3 | Offset from CACK_PSN to ACK_PSN | Signed |\n| probe_opaque | 16 | 4-5 | Copied from Probe CP | Opaque value |\n| cack_psn | 32 | 6-9 | Cumulative ACK PSN | Highest in-order PSN |\n| spdcid | 16 | 10-11 | Source PDCID | Swapped from request |\n| dpdcid | 16 | 12-13 | Destination PDCID | Swapped from request |\n\n**Note**: Wire format shows 12 bytes but field table shows 14 bytes. Verify against spec - likely cack_psn is 16 bits or spdcid/dpdcid share bytes 10-11.\n\n##### Protocol Behavior\n\n**ACK Generation**:\n1. Receiver tracks highest in-order PSN received (CACK_PSN)\n2. ACK generated when `ar` flag set in request, or periodically\n3. `m` flag set if any ACK'd packet had ECN marking\n\n**Cumulative ACK**:\n- `cack_psn` acknowledges all PSNs ≤ this value\n- Sender can free buffers for acknowledged packets",
              "truncated": true
            },
            "time": {
              "start": 1769123732623,
              "end": 1769123732688
            }
          }
        },
        {
          "id": "prt_be7fddcd1001KAjDbvGjsjJ1aU",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fdb77e0013GXs4cXPWgTQJ0",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 95097,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7fddd00001R8cmEwBejX4kBI",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769123732736,
          "completed": 1769123739773
        },
        "parentID": "msg_be7faadd7001qnhXPM5tKghXUR",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 96662,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7fde147001U5uey0di3hPUN4",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fddd00001R8cmEwBejX4kBI",
          "type": "step-start"
        },
        {
          "id": "prt_be7fdf83c001gkARhAp4Tf1EAF",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fddd00001R8cmEwBejX4kBI",
          "type": "tool",
          "callID": "toolu_018Xmns7Mfc2HHcy7SPQLHgD",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
              "offset": 640,
              "limit": 80
            },
            "output": "<file>\n00641| | 0x02 | UET_NO_PDC_AVAIL | No PDC resources available |\n00642| | 0x03 | UET_INV_DPDCID | Invalid destination PDCID |\n00643| | 0x04 | UET_PDC_HDR_MISMATCH | PDC header mismatch |\n00644| | 0x05 | UET_PSN_OOR_WINDOW | PSN outside expected window |\n00645| | 0x06 | UET_PSN_GAP | PSN gap detected (packet loss) |\n00646| \n00647| ##### Protocol Behavior\n00648| \n00649| **NACK Generation**:\n00650| 1. Receiver detects error condition (loss, resource exhaustion, etc.)\n00651| 2. Generates NACK with appropriate nack_code\n00652| 3. Sender receives NACK and takes corrective action\n00653| \n00654| **Sender Response to NACK**:\n00655| - `UET_PSN_GAP`: Retransmit missing packets\n00656| - `UET_NO_PKT_BUF`: Back off, retry later\n00657| - `UET_NO_PDC_AVAIL`: PDC establishment failed, retry or abort\n00658| \n00659| **Reference**: UE Spec v1.0.1, Table 3-40, Section 3.5.10.10, Page 263\n00660| \n00661| ---\n00662| \n00663| #### 3.3.10 NACK_CCX (Type 0x0C, 28 bytes)\n00664| \n00665| **Datamodel**: `datamodel/protocols/ue/transport/pds/nack_ccx.ksy`  \n00666| **Related Formats**: [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n00667| \n00668| ##### Wire Format\n00669| \n00670| NACK_CCX extends NACK with 16 bytes of CC state (similar to ACK_CC extension).\n00671| \n00672| ```\n00673| Bytes 0-11:  NACK header (12 bytes)\n00674| Bytes 12-27: CC extension (16 bytes)\n00675| ```\n00676| \n00677| ##### Protocol Behavior\n00678| \n00679| **Extended NACK**: NACK_CCX provides congestion control feedback along with the negative acknowledgment, enabling the sender to adjust its rate while handling the error.\n00680| \n00681| **Reference**: UE Spec v1.0.1, Table 3-41, Section 3.5.10.11, Page 264\n00682| \n00683| ---\n00684| \n00685| #### 3.3.11 Control Packet (Type 0x0B, 12 bytes)\n00686| \n00687| **Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_cp.ksy`  \n00688| **Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [ACK (3.3.6)](#336-ack-type-0x07-12-bytes)\n00689| \n00690| ##### Wire Format\n00691| \n00692| ```\n00693| Byte:    0       1       2       3       4       5       6       7\n00694|      +-------+-------+-------+-------+-------+-------+-------+-------+\n00695|      |type |ctl|  flags  |   probe_opaque    |         PSN [31:0]  →\n00696|      +-------+-------+-------+-------+-------+-------+-------+-------+\n00697|          8       9      10      11\n00698|      +-------+-------+-------+-------+\n00699|    → |    spdcid     |    dpdcid     |\n00700|      +-------+-------+-------+-------+\n00701| \n00702| Byte 0-1 Detail:\n00703|   Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n00704|        |  type   |ctl_typ| rsvd|i|r|a|s|rsvd|\n00705|        | (5 bits)|(4 bit)| (1) |r|t|r|y|(2) |\n00706| ```\n00707| \n00708| ##### Field Definitions\n00709| \n00710| | Field | Bits | Offset | Description | Constraints |\n00711| |-------|------|--------|-------------|-------------|\n00712| | type | 5 | 0[7:3] | PDS type = 0x0B (CP) | Must be 0x0B |\n00713| | ctl_type | 4 | 0[2:0]+1[7] | Control packet subtype | 0-9 defined |\n00714| | flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n00715| | flags.isrod | 1 | 1[5] | ROD indicator | 1=ROD, 0=RUD (for NOOP/Negotiation) |\n00716| | flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n00717| | flags.ar | 1 | 1[3] | ACK request | 0=no ACK, 1=request ACK |\n00718| | flags.syn | 1 | 1[2] | PDC establishment | 0=normal, 1=SYN |\n00719| | flags.rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n00720| | probe_opaque | 16 | 2-3 | Opaque value for Probe | Echoed in ACK |\n\n(File has more lines. Use 'offset' parameter to read beyond line 720)\n</file>",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy.md",
            "metadata": {
              "preview": "| 0x02 | UET_NO_PDC_AVAIL | No PDC resources available |\n| 0x03 | UET_INV_DPDCID | Invalid destination PDCID |\n| 0x04 | UET_PDC_HDR_MISMATCH | PDC header mismatch |\n| 0x05 | UET_PSN_OOR_WINDOW | PSN outside expected window |\n| 0x06 | UET_PSN_GAP | PSN gap detected (packet loss) |\n\n##### Protocol Behavior\n\n**NACK Generation**:\n1. Receiver detects error condition (loss, resource exhaustion, etc.)\n2. Generates NACK with appropriate nack_code\n3. Sender receives NACK and takes corrective action\n\n**Sender Response to NACK**:\n- `UET_PSN_GAP`: Retransmit missing packets\n- `UET_NO_PKT_BUF`: Back off, retry later\n- `UET_NO_PDC_AVAIL`: PDC establishment failed, retry or abort\n\n**Reference**: UE Spec v1.0.1, Table 3-40, Section 3.5.10.10, Page 263\n",
              "truncated": true
            },
            "time": {
              "start": 1769123739710,
              "end": 1769123739763
            }
          }
        },
        {
          "id": "prt_be7fdf87a0016k5EcecOSQRqt2",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fddd00001R8cmEwBejX4kBI",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 96662,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7fdf8a4001Kk9S8jtwoH01GG",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769123739812,
          "completed": 1769123747912
        },
        "parentID": "msg_be7faadd7001qnhXPM5tKghXUR",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 97864,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7fdfd030015sUKns1QJCF3hW",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fdf8a4001Kk9S8jtwoH01GG",
          "type": "step-start"
        },
        {
          "id": "prt_be7fe1806001ztlLjn512tnpG7",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fdf8a4001Kk9S8jtwoH01GG",
          "type": "tool",
          "callID": "toolu_01Hkim34uL4RcS61Pd2HGK85",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
              "offset": 740,
              "limit": 100
            },
            "output": "<file>\n00741| \n00742| **PDC Lifecycle**:\n00743| - `CLOSE_COMMAND/REQUEST`: Graceful PDC teardown\n00744| - `CLEAR_COMMAND/REQUEST`: Clear delivery state without closing\n00745| \n00746| **Flow Control**:\n00747| - `CREDIT/CREDIT_REQUEST`: Credit-based flow control\n00748| - `PROBE`: Solicit ACK for RTT measurement or liveness check\n00749| \n00750| **Reference**: UE Spec v1.0.1, Table 3-38, Section 3.5.10.8, Page 261\n00751| \n00752| ### 3.4 SES (Semantic Sublayer) Opcodes\n00753| \n00754| **Datamodel**: `datamodel/protocols/ue/transport/ses/opcodes.ksy`\n00755| \n00756| **Request Opcodes (Table 3-17)**:\n00757| \n00758| | Opcode | Value | Description |\n00759| |--------|-------|-------------|\n00760| | Tagged Send | 0x00 | Send with tag matching |\n00761| | RMA Write | 0x01 | Remote memory write |\n00762| | RMA Read | 0x02 | Remote memory read |\n00763| | Atomic Write | 0x03 | Atomic memory write |\n00764| | Atomic Read | 0x04 | Atomic memory read |\n00765| | Atomic CAS | 0x05 | Compare-and-swap |\n00766| | Deferrable Send | 0x06 | Deferrable send |\n00767| | Ready to Restart | 0x07 | Restart notification |\n00768| | Small Message | 0x08 | Small message (32B header) |\n00769| | Small RMA Write | 0x09 | Small RMA write |\n00770| | Small RMA Read | 0x0A | Small RMA read |\n00771| | Small Atomic Write | 0x0B | Small atomic write |\n00772| | Small Atomic Read | 0x0C | Small atomic read |\n00773| | Small Atomic CAS | 0x0D | Small atomic CAS |\n00774| \n00775| **Response Opcodes (Table 3-18)**:\n00776| \n00777| | Opcode | Value | Description |\n00778| |--------|-------|-------------|\n00779| | Response | 0x00 | Standard response |\n00780| | Response with Data | 0x01 | Response carrying data |\n00781| | Optimized Response | 0x02 | Optimized format |\n00782| | NACK | 0x03 | Negative acknowledgment |\n00783| \n00784| ### 3.5 SES Packet Formats\n00785| \n00786| **Datamodel Directory**: `datamodel/protocols/ue/transport/ses/`\n00787| \n00788| | Format | File | Description |\n00789| |--------|------|-------------|\n00790| | Standard Request (SOM=1) | `standard_request_som1.ksy` | Start of message |\n00791| | Standard Request (SOM=0) | `standard_request_som0.ksy` | Continuation |\n00792| | Small Message | `small_message.ksy` | 32-byte header format |\n00793| | Small RMA | `small_rma.ksy` | Small RMA operations |\n00794| | Response | `response.ksy` | Standard response |\n00795| | Response with Data | `response_with_data.ksy` | Data-carrying response |\n00796| | Optimized Response | `optimized_response_with_data.ksy` | Optimized format |\n00797| | Deferrable Send | `deferrable_send_request.ksy` | Deferrable operation |\n00798| | Ready to Restart | `ready_to_restart.ksy` | Restart notification |\n00799| | Rendezvous Extension | `rendezvous_extension.ksy` | Large message protocol |\n00800| | Atomic Extension | `atomic_extension.ksy` | Atomic operations |\n00801| | CAS Extension | `cas_extension.ksy` | Compare-and-swap |\n00802| \n00803| ### 3.6 CMS (Congestion Management Sublayer)\n00804| \n00805| **Datamodel Directory**: `datamodel/protocols/ue/transport/cms/`\n00806| \n00807| | Format | File | Description |\n00808| |--------|------|-------------|\n00809| | Credit CP Payload | `credit_cp_payload.ksy` | Credit control packet |\n00810| | Credit Request | `credit_request_cp_payload.ksy` | Credit request |\n00811| | Request CC State | `req_cc_state.ksy` | Request CC state |\n00812| | ACK CC State (NSCC) | `ack_cc_state_nscc.ksy` | NSCC algorithm state |\n00813| | ACK CC State (RCCC/TFC) | `ack_cc_state_rccc_tfc.ksy` | RCCC/TFC state |\n00814| \n00815| ### 3.7 TSS (Transport Security Sublayer)\n00816| \n00817| **Datamodel Directory**: `datamodel/protocols/ue/transport/tss/`\n00818| \n00819| | Format | File | Description |\n00820| |--------|------|-------------|\n00821| | Security Header | `security_header.ksy` | Encryption header |\n00822| | IV Construction | `iv_construction.ksy` | Initialization vector |\n00823| | Key Rotation | `protocols/key_rotation.ksy` | Key rotation protocol |\n00824| | KDF Direct | `protocols/kdf_direct.ksy` | Direct key derivation |\n00825| | KDF Client/Server | `protocols/kdf_client_server.ksy` | Client/server KDF |\n00826| | KDF Cluster | `protocols/kdf_cluster.ksy` | Cluster KDF |\n00827| | Join Secure Domain | `protocols/join_secure_domain.ksy` | Domain join |\n00828| | TSS TX Processing | `protocols/tss_tx_processing.ksy` | Transmit processing |\n00829| | TSS RX Processing | `protocols/tss_rx_processing.ksy` | Receive processing |\n00830| \n00831| ### 3.8 Link Layer Formats\n00832| \n00833| #### LLR (Link-Level Retry)\n00834| \n00835| **Datamodel Directory**: `datamodel/protocols/ue/link/llr/`\n00836| \n00837| | Format | File | Description |\n00838| |--------|------|-------------|\n00839| | LLR Preamble (64b66b) | `llr_preamble_64b66b.ksy` | 64b66b preamble |\n00840| | LLR Preamble (MII) | `llr_preamble_mii.ksy` | MII preamble |\n\n(File has more lines. Use 'offset' parameter to read beyond line 840)\n</file>",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy.md",
            "metadata": {
              "preview": "\n**PDC Lifecycle**:\n- `CLOSE_COMMAND/REQUEST`: Graceful PDC teardown\n- `CLEAR_COMMAND/REQUEST`: Clear delivery state without closing\n\n**Flow Control**:\n- `CREDIT/CREDIT_REQUEST`: Credit-based flow control\n- `PROBE`: Solicit ACK for RTT measurement or liveness check\n\n**Reference**: UE Spec v1.0.1, Table 3-38, Section 3.5.10.8, Page 261\n\n### 3.4 SES (Semantic Sublayer) Opcodes\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/opcodes.ksy`\n\n**Request Opcodes (Table 3-17)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Tagged Send | 0x00 | Send with tag matching |",
              "truncated": true
            },
            "time": {
              "start": 1769123747848,
              "end": 1769123747901
            }
          }
        },
        {
          "id": "prt_be7fe183e001vd2xQF56su8k65",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fdf8a4001Kk9S8jtwoH01GG",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 97864,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7fe1874001WDlrE5vdP3z3jP",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769123747956,
          "completed": 1769123848125
        },
        "parentID": "msg_be7faadd7001qnhXPM5tKghXUR",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 99502,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7fe1ca2001pnUob6yiqgCvw7",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fe1874001WDlrE5vdP3z3jP",
          "type": "step-start"
        },
        {
          "id": "prt_be7ff9c72001cR3IJcrWh3N37R",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fe1874001WDlrE5vdP3z3jP",
          "type": "tool",
          "callID": "toolu_01UZfjGmeS676Q5MJhVYbhVu",
          "tool": "edit",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
              "oldString": "### 3.5 SES Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/ses/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Standard Request (SOM=1) | `standard_request_som1.ksy` | Start of message |\n| Standard Request (SOM=0) | `standard_request_som0.ksy` | Continuation |\n| Small Message | `small_message.ksy` | 32-byte header format |\n| Small RMA | `small_rma.ksy` | Small RMA operations |\n| Response | `response.ksy` | Standard response |\n| Response with Data | `response_with_data.ksy` | Data-carrying response |\n| Optimized Response | `optimized_response_with_data.ksy` | Optimized format |\n| Deferrable Send | `deferrable_send_request.ksy` | Deferrable operation |\n| Ready to Restart | `ready_to_restart.ksy` | Restart notification |\n| Rendezvous Extension | `rendezvous_extension.ksy` | Large message protocol |\n| Atomic Extension | `atomic_extension.ksy` | Atomic operations |\n| CAS Extension | `cas_extension.ksy` | Compare-and-swap |",
              "newString": "### 3.5 SES Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/ses/`\n\n```\nSES Request/Response Relationships:\n┌─────────────────────────────────────────────────────────────────┐\n│                                                                 │\n│  Standard Request ────┬───────────────────→ Response            │\n│  (SOM=1, 44B)         └───────────────────→ Response w/Data     │\n│       │                                                         │\n│       └──→ Continuation (SOM=0, 16B)                            │\n│                                                                 │\n│  Small Message (32B) ─────────────────────→ Response            │\n│                                                                 │\n│  + Atomic Extension (8B) ─────────────────→ Response w/Data     │\n│                                             (for fetching ops)  │\n│                                                                 │\n│  + Rendezvous Extension (32B) ────────────→ (target pulls data) │\n│                                                                 │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n| Table/Figure | Format | File | Size | Description |\n|--------------|--------|------|------|-------------|\n| Table 3-8 | Standard Request (SOM=1) | `standard_request_som1.ksy` | 44 bytes | Start of message |\n| Table 3-9 | Standard Request (SOM=0) | `standard_request_som0.ksy` | 16 bytes | Continuation |\n| Table 3-11 | Response | `response.ksy` | 16 bytes | Standard response |\n| Table 3-12 | Response with Data | `response_with_data.ksy` | 24 bytes | Data-carrying response |\n| Figure 3-14 | Small Message | `small_message.ksy` | 32 bytes | Single-packet optimized |\n| Figure 3-15 | Rendezvous Extension | `rendezvous_extension.ksy` | 32 bytes | Large message protocol |\n| Figure 3-16 | Atomic Extension | `atomic_extension.ksy` | 8 bytes | Atomic operations |\n\n#### 3.5.1 Standard Request SOM=1 (Table 3-8, 44 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/standard_request_som1.ksy`  \n**Related Formats**: [Standard Request SOM=0 (3.5.2)](#352-standard-request-som0-table-3-9-16-bytes) | [Response (3.5.3)](#353-response-table-3-11-16-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |rs|opcode |v|dc|ie|rl|hd|eo|so|    message_id     | ri_gen  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |rsvd|pid_on_fep |rsvd| resource_idx  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |                    buffer_offset [63:0]                       |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        24      25      26      27      28      29      30      31\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |        initiator [31:0]       |   match_bits / memory_key    →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        32      33      34      35      36      37      38      39\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |  (match_bits cont'd) [63:0]   |       header_data [63:0]     →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        40      41      42      43\n     +-------+-------+-------+-------+\n   → | (hdr_data)    | request_length|\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |rsvd |  opcode |v|dc|ie|rl|hd|eo|so|\n       | (2) | (6 bits)|r| | | | | | | |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| rsvd | 2 | 0[7:6] | Reserved | Must be 0 |\n| opcode | 6 | 0[5:0] | Operation code | Per Table 3-17 |\n| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n| dc | 1 | 1[5] | Delivery Complete | Defer response until globally observable |\n| ie | 1 | 1[4] | Initiator Error | Error at initiator |\n| rel | 1 | 1[3] | Relative addressing | 0=absolute, 1=relative |\n| hd | 1 | 1[2] | Header Data present | 1=header_data valid |\n| eom | 1 | 1[1] | End of Message | 1=last packet |\n| som | 1 | 1[0] | Start of Message | Must be 1 for this format |\n| message_id | 16 | 2-3 | Message identifier | 0=reserved (invalid) |\n| ri_generation | 8 | 4 | Resource Index generation | For buffer exhaustion recovery |\n| job_id | 24 | 5-7 | Job Identifier | Matches VXLAN VNI size |\n| rsvd | 4 | 8[7:4] | Reserved | Must be 0 |\n| pid_on_fep | 12 | 8[3:0]+9 | Process ID on FEP | Target process |\n| rsvd | 4 | 10[7:4] | Reserved | Must be 0 |\n| resource_index | 12 | 10[3:0]+11 | Resource Index | Target resource |\n| buffer_offset | 64 | 12-19 | Buffer offset | Or restart token for deferrable |\n| initiator | 32 | 20-23 | Initiator ID | For tagged matching |\n| match_bits | 64 | 24-31 | Match bits / Memory key | Dual-purpose field |\n| header_data | 64 | 32-39 | Header data | Completion data (if hd=1) |\n| request_length | 32 | 40-43 | Request length | Bytes to transfer |\n\n##### Field Notes\n\n**match_bits / memory_key Interpretation**:\n- For tagged operations (sends): Match bits for receive queue matching\n- For RMA operations (reads, writes): Memory key for authorization\n\n**buffer_offset Special Uses**:\n- For deferrable sends: Contains restart token (upper 32b initiator, lower 32b target)\n- For FI_MR_VIRT_ADDR: Contains absolute virtual address\n\n##### Protocol Behavior\n\n**Message Framing**:\n- `som=1, eom=1`: Single-packet message\n- `som=1, eom=0`: First packet of multi-packet message\n- Continuation packets use SOM=0 format (Table 3-9)\n\n**Addressing Modes**:\n- `rel=0` (Absolute): {JobID, PIDonFEP, resource_index} identifies target\n- `rel=1` (Relative): Addressing relative to connection context\n\n**Delivery Complete (dc)**:\n- When `dc=1`: Response deferred until data globally observable\n- Matches FI_DELIVERY_COMPLETE libfabric option\n\n**Reference**: UE Spec v1.0.1, Table 3-8, Section 3.4.2.1, Page 158\n\n---\n\n#### 3.5.2 Standard Request SOM=0 (Table 3-9, 16 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/standard_request_som0.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |rs|opcode |v|dc|ie|rl|hd|eo|so|    message_id     | ri_gen  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |       message_offset [31:0]          |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| rsvd | 2 | 0[7:6] | Reserved | Must be 0 |\n| opcode | 6 | 0[5:0] | Operation code | Same as SOM=1 packet |\n| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n| dc | 1 | 1[5] | Delivery Complete | Same as SOM=1 |\n| ie | 1 | 1[4] | Initiator Error | Error at initiator |\n| rel | 1 | 1[3] | Relative addressing | Same as SOM=1 |\n| hd | 1 | 1[2] | Header Data present | Ignored for SOM=0 |\n| eom | 1 | 1[1] | End of Message | 1=last packet |\n| som | 1 | 1[0] | Start of Message | Must be 0 for this format |\n| message_id | 16 | 2-3 | Message identifier | Same as SOM=1 packet |\n| ri_generation | 8 | 4 | Resource Index generation | Same as SOM=1 |\n| job_id | 24 | 5-7 | Job Identifier | Same as SOM=1 |\n| message_offset | 32 | 8-11 | Offset within message | Byte offset from start |\n\n##### Protocol Behavior\n\n**Continuation Packets**:\n- Used for packets 2..N of multi-packet messages\n- `message_offset` indicates position within overall message\n- Target uses offset to place data correctly in buffer\n\n**Packet Ordering**:\n- ROD delivery: Packets delivered in PSN order\n- RUD delivery: Packets may arrive out of order; target reassembles using message_offset\n\n**Reference**: UE Spec v1.0.1, Table 3-9, Section 3.4.2.1, Page 159\n\n---\n\n#### 3.5.3 Response (Table 3-11, 16 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/response.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes) | [Response with Data (3.5.4)](#354-response-with-data-table-3-12-24-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     | list|opcode |v| return_code |    message_id     | ri_gen  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |       modified_length [31:0]         |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |list |  opcode |v| return_code   |\n       | (2) | (6 bits)|r|   (6 bits)    |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| list | 2 | 0[7:6] | List indicator | 0=expected, 1=unexpected |\n| opcode | 6 | 0[5:0] | Response opcode | Per Table 3-18 |\n| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n| return_code | 6 | 1[5:0] | Return code | Per Table 3-19 |\n| message_id | 16 | 2-3 | Message identifier | From original request |\n| ri_generation | 8 | 4 | Resource Index generation | New generation on mismatch |\n| job_id | 24 | 5-7 | Job Identifier | From original request |\n| modified_length | 32 | 8-11 | Modified length | Bytes actually transferred |\n| rsvd | 32 | 12-15 | Reserved | Must be 0 |\n\n##### Return Codes (Table 3-19)\n\n| Code | Name | Description |\n|------|------|-------------|\n| 0x00 | RC_OK | Success |\n| 0x01 | RC_NO_MATCH | No matching buffer found |\n| 0x02 | RC_BUFFER_TOO_SMALL | Target buffer too small |\n| 0x03 | RC_AUTHORIZATION_FAILURE | Memory key mismatch |\n| 0x04 | RC_INVALID_OPERATION | Invalid operation |\n| 0x05 | RC_RESOURCE_EXHAUSTION | Resource exhaustion |\n| 0x06 | RC_GENERATION_MISMATCH | RI generation mismatch |\n| 0x07 | RC_TRUNCATED | Message truncated |\n\n##### Protocol Behavior\n\n**Response Generation**:\n1. Target processes request\n2. Generates response with appropriate return_code\n3. `modified_length` indicates actual bytes transferred (may be < request_length)\n\n**List Indicator**:\n- `list=0`: Payload delivered to expected list (matched posted receive)\n- `list=1`: Payload delivered to unexpected list (no matching receive)\n\n**Reference**: UE Spec v1.0.1, Table 3-11, Section 3.4.2.5, Page 167\n\n---\n\n#### 3.5.4 Response with Data (Table 3-12, 24 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/response_with_data.ksy`  \n**Related Formats**: [Response (3.5.3)](#353-response-table-3-11-16-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     | list|opcode |v| return_code | response_msg_id   | rsvd    →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |read_req_msg_id|rs|payload_len      →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |       modified_length [31:0]  |       message_offset [31:0]  |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| list | 2 | 0[7:6] | List indicator | 0=expected, 1=unexpected |\n| opcode | 6 | 0[5:0] | Response opcode | Per Table 3-18 |\n| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n| return_code | 6 | 1[5:0] | Return code | Per Table 3-19 |\n| response_message_id | 16 | 2-3 | Response message ID | For this response |\n| rsvd | 8 | 4 | Reserved | Must be 0 |\n| job_id | 24 | 5-7 | Job Identifier | From original request |\n| read_request_message_id | 16 | 8-9 | Original request msg ID | Links to request |\n| rsvd | 2 | 10[7:6] | Reserved | Must be 0 |\n| payload_length | 14 | 10[5:0]+11 | Payload in this packet | Max 16383 bytes |\n| modified_length | 32 | 12-15 | Total bytes transferred | Across all packets |\n| message_offset | 32 | 16-19 | Offset in response | For multi-packet responses |\n| rsvd | 32 | 20-23 | Reserved | Must be 0 |\n\n##### Protocol Behavior\n\n**Use Cases**:\n- RDMA Read responses (returning requested data)\n- Fetching atomic responses (returning original value)\n\n**Multi-Packet Responses**:\n- `message_offset` indicates position within overall response\n- `payload_length` indicates data in this specific packet\n- `modified_length` is total across all response packets\n\n**Reference**: UE Spec v1.0.1, Table 3-12, Section 3.4.2.5, Page 168\n\n---\n\n#### 3.5.5 Small Message (Figure 3-14, 32 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/small_message.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes) | [Response (3.5.3)](#353-response-table-3-11-16-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |opcode |v|dc|ie|rl|hd|eo|so|rs| request_length  | ri_gen  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |rsvd|pid_on_fep |rsvd| resource_idx  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |        initiator [31:0]       |        match_bits [63:0]     →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        24      25      26      27      28      29      30      31\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |  (match_bits cont'd)          |       header_data [63:0]     |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| opcode | 6 | 0[7:2] | Operation code | Per Table 3-17 |\n| version | 2 | 0[1:0] | Protocol version | 0 for v1.0.1 |\n| dc | 1 | 1[7] | Delivery Complete | Defer response |\n| ie | 1 | 1[6] | Initiator Error | Error at initiator |\n| rel | 1 | 1[5] | Relative addressing | 0=absolute, 1=relative |\n| hd | 1 | 1[4] | Header Data present | 1=header_data valid |\n| eom | 1 | 1[3] | End of Message | Must be 1 (single packet) |\n| som | 1 | 1[2] | Start of Message | Must be 1 (single packet) |\n| rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n| rsvd | 2 | 2[7:6] | Reserved | Must be 0 |\n| request_length | 14 | 2[5:0]+3 | Request length | Max 16383 bytes |\n| ri_generation | 8 | 4 | Resource Index generation | For buffer recovery |\n| job_id | 24 | 5-7 | Job Identifier | Target job |\n| rsvd | 4 | 8[7:4] | Reserved | Must be 0 |\n| pid_on_fep | 12 | 8[3:0]+9 | Process ID on FEP | Target process |\n| rsvd | 4 | 10[7:4] | Reserved | Must be 0 |\n| resource_index | 12 | 10[3:0]+11 | Resource Index | Target resource |\n| initiator | 32 | 12-15 | Initiator ID | For tagged matching |\n| match_bits | 64 | 16-23 | Match bits | For tagged matching |\n| header_data | 64 | 24-31 | Header data | Completion data |\n\n##### Protocol Behavior\n\n**Optimized Format**:\n- 32 bytes vs 44 bytes for standard request\n- Single-packet only (`som=1, eom=1` required)\n- No buffer_offset (not needed for single packet)\n- 14-bit request_length (max 16383 bytes)\n\n**Use Cases**:\n- Small tagged sends\n- Single-packet messages with matching criteria\n- Latency-sensitive operations\n\n**Reference**: UE Spec v1.0.1, Figure 3-14, Section 3.4.2.3, Page 164\n\n---\n\n#### 3.5.6 Rendezvous Extension (Figure 3-15, 32 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/rendezvous_extension.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |       eager_length [31:0]     |        memory_key [63:0]     →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |  (memory_key cont'd)          |       buffer_offset [63:0]   →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |  (buffer_offset cont'd)       |     remaining_length [31:0]  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        24      25      26      27      28      29      30      31\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → | (remaining)   |              reserved [63:0]                  |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| eager_length | 32 | 0-3 | Eager data length | Bytes pushed with request |\n| memory_key | 64 | 4-11 | Initiator memory key | For target to pull data |\n| buffer_offset | 64 | 12-19 | Initiator buffer offset | Start of remaining data |\n| remaining_length | 32 | 20-23 | Remaining data length | Bytes to pull |\n| rsvd | 64 | 24-31 | Reserved | Must be 0 |\n\n##### Protocol Behavior\n\n**Rendezvous Protocol**:\n1. Initiator sends request with eager data + rendezvous extension\n2. Target receives eager data, allocates buffer\n3. Target issues RDMA Read to pull remaining data using {memory_key, buffer_offset}\n4. Target completes operation when all data received\n\n**Two-Sided Protocol**:\n- Enables large message transfer without pre-registered buffers\n- Target controls when/how to pull remaining data\n- Reduces memory registration overhead\n\n**Constraints**:\n- MUST NOT be combined with atomic extension\n- Placed on every packet using rendezvous opcode\n\n**Reference**: UE Spec v1.0.1, Figure 3-15, Section 3.4.2.3, Page 165\n\n---\n\n#### 3.5.7 Atomic Extension (Figure 3-16, 8 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/atomic_extension.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes) | [Response with Data (3.5.4)](#354-response-with-data-table-3-12-24-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |atomic_opcode  |atomic_datatype| semantic_control  | reserved  |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| atomic_opcode | 8 | 0 | Atomic operation | Per Table 3-21 |\n| atomic_datatype | 8 | 1 | Data type | Per Table 3-22 |\n| semantic_control | 16 | 2-3 | Semantic control | Per Table 3-23 |\n| rsvd | 32 | 4-7 | Reserved | Must be 0 |\n\n##### Atomic Opcodes (Table 3-21)\n\n| Code | Name | Operation |\n|------|------|-----------|\n| 0x00 | MIN | Target = MIN(Target, Initiator) |\n| 0x01 | MAX | Target = MAX(Target, Initiator) |\n| 0x02 | SUM | Target = Target + Initiator |\n| 0x03 | DIFF | Target = Target - Initiator |\n| 0x04 | PROD | Target = Target * Initiator |\n| 0x05 | LOR | Target = Target \\|\\| Initiator |\n| 0x06 | LAND | Target = Target && Initiator |\n| 0x07 | BOR | Target = Target \\| Initiator |\n| 0x08 | BAND | Target = Target & Initiator |\n| 0x09 | LXOR | Logical XOR |\n| 0x0A | BXOR | Target = Target ^ Initiator |\n| 0x0B | READ | Initiator = Target |\n| 0x0C | WRITE | Target = Initiator |\n| 0x0D | CSWAP | Compare and swap if equal |\n| 0x0E | CSWAP_NE | Compare and swap if not equal |\n| 0x0F | CSWAP_LE | Compare and swap if ≤ |\n| 0x10 | CSWAP_LT | Compare and swap if < |\n| 0x11 | CSWAP_GE | Compare and swap if ≥ |\n| 0x12 | CSWAP_GT | Compare and swap if > |\n| 0x13 | MSWAP | Masked swap |\n| 0x14 | INVAL | Invalidate cache |\n\n##### Atomic Datatypes (Table 3-22)\n\n| Code | Name | Size |\n|------|------|------|\n| 0x00 | INT8 | 1 byte |\n| 0x01 | UINT8 | 1 byte |\n| 0x02 | INT16 | 2 bytes |\n| 0x03 | UINT16 | 2 bytes |\n| 0x04 | INT32 | 4 bytes |\n| 0x05 | UINT32 | 4 bytes |\n| 0x06 | INT64 | 8 bytes |\n| 0x07 | UINT64 | 8 bytes |\n| 0x08 | FLOAT | 4 bytes |\n| 0x09 | DOUBLE | 8 bytes |\n| 0x0A | FLOAT_COMPLEX | 8 bytes |\n| 0x0B | DOUBLE_COMPLEX | 16 bytes |\n| 0x0E | FLOAT16 | 2 bytes |\n| 0x0F | BFLOAT16 | 2 bytes |\n\n##### Protocol Behavior\n\n**Atomic Operations**:\n- Always 8 bytes and must be naturally aligned\n- Payload must be integral multiple of datatype size\n- Fetching atomics return original value in Response with Data\n\n**Constraints**:\n- MUST NOT be combined with rendezvous extension\n- Fetching atomics MUST NOT operate on more than one element\n\n**Reference**: UE Spec v1.0.1, Figure 3-16, Section 3.4.2.4, Page 165"
            },
            "output": "Edit applied successfully.",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy.md",
            "metadata": {
              "diagnostics": {},
              "diff": "Index: /home/matkins/CN7000/analysis/packet_taxonomy.md\n===================================================================\n--- /home/matkins/CN7000/analysis/packet_taxonomy.md\n+++ /home/matkins/CN7000/analysis/packet_taxonomy.md\n@@ -784,23 +784,508 @@\n ### 3.5 SES Packet Formats\n \n **Datamodel Directory**: `datamodel/protocols/ue/transport/ses/`\n \n-| Format | File | Description |\n-|--------|------|-------------|\n-| Standard Request (SOM=1) | `standard_request_som1.ksy` | Start of message |\n-| Standard Request (SOM=0) | `standard_request_som0.ksy` | Continuation |\n-| Small Message | `small_message.ksy` | 32-byte header format |\n-| Small RMA | `small_rma.ksy` | Small RMA operations |\n-| Response | `response.ksy` | Standard response |\n-| Response with Data | `response_with_data.ksy` | Data-carrying response |\n-| Optimized Response | `optimized_response_with_data.ksy` | Optimized format |\n-| Deferrable Send | `deferrable_send_request.ksy` | Deferrable operation |\n-| Ready to Restart | `ready_to_restart.ksy` | Restart notification |\n-| Rendezvous Extension | `rendezvous_extension.ksy` | Large message protocol |\n-| Atomic Extension | `atomic_extension.ksy` | Atomic operations |\n-| CAS Extension | `cas_extension.ksy` | Compare-and-swap |\n+```\n+SES Request/Response Relationships:\n+┌─────────────────────────────────────────────────────────────────┐\n+│                                                                 │\n+│  Standard Request ────┬───────────────────→ Response            │\n+│  (SOM=1, 44B)         └───────────────────→ Response w/Data     │\n+│       │                                                         │\n+│       └──→ Continuation (SOM=0, 16B)                            │\n+│                                                                 │\n+│  Small Message (32B) ─────────────────────→ Response            │\n+│                                                                 │\n+│  + Atomic Extension (8B) ─────────────────→ Response w/Data     │\n+│                                             (for fetching ops)  │\n+│                                                                 │\n+│  + Rendezvous Extension (32B) ────────────→ (target pulls data) │\n+│                                                                 │\n+└─────────────────────────────────────────────────────────────────┘\n+```\n \n+| Table/Figure | Format | File | Size | Description |\n+|--------------|--------|------|------|-------------|\n+| Table 3-8 | Standard Request (SOM=1) | `standard_request_som1.ksy` | 44 bytes | Start of message |\n+| Table 3-9 | Standard Request (SOM=0) | `standard_request_som0.ksy` | 16 bytes | Continuation |\n+| Table 3-11 | Response | `response.ksy` | 16 bytes | Standard response |\n+| Table 3-12 | Response with Data | `response_with_data.ksy` | 24 bytes | Data-carrying response |\n+| Figure 3-14 | Small Message | `small_message.ksy` | 32 bytes | Single-packet optimized |\n+| Figure 3-15 | Rendezvous Extension | `rendezvous_extension.ksy` | 32 bytes | Large message protocol |\n+| Figure 3-16 | Atomic Extension | `atomic_extension.ksy` | 8 bytes | Atomic operations |\n+\n+#### 3.5.1 Standard Request SOM=1 (Table 3-8, 44 bytes)\n+\n+**Datamodel**: `datamodel/protocols/ue/transport/ses/standard_request_som1.ksy`  \n+**Related Formats**: [Standard Request SOM=0 (3.5.2)](#352-standard-request-som0-table-3-9-16-bytes) | [Response (3.5.3)](#353-response-table-3-11-16-bytes)\n+\n+##### Wire Format\n+\n+```\n+Byte:    0       1       2       3       4       5       6       7\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+     |rs|opcode |v|dc|ie|rl|hd|eo|so|    message_id     | ri_gen  →\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+         8       9      10      11      12      13      14      15\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+   → |      job_id [23:0]    |rsvd|pid_on_fep |rsvd| resource_idx  →\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+        16      17      18      19      20      21      22      23\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+   → |                    buffer_offset [63:0]                       |\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+        24      25      26      27      28      29      30      31\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+     |        initiator [31:0]       |   match_bits / memory_key    →\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+        32      33      34      35      36      37      38      39\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+   → |  (match_bits cont'd) [63:0]   |       header_data [63:0]     →\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+        40      41      42      43\n+     +-------+-------+-------+-------+\n+   → | (hdr_data)    | request_length|\n+     +-------+-------+-------+-------+\n+\n+Byte 0-1 Detail:\n+  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n+       |rsvd |  opcode |v|dc|ie|rl|hd|eo|so|\n+       | (2) | (6 bits)|r| | | | | | | |\n+```\n+\n+##### Field Definitions\n+\n+| Field | Bits | Offset | Description | Constraints |\n+|-------|------|--------|-------------|-------------|\n+| rsvd | 2 | 0[7:6] | Reserved | Must be 0 |\n+| opcode | 6 | 0[5:0] | Operation code | Per Table 3-17 |\n+| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n+| dc | 1 | 1[5] | Delivery Complete | Defer response until globally observable |\n+| ie | 1 | 1[4] | Initiator Error | Error at initiator |\n+| rel | 1 | 1[3] | Relative addressing | 0=absolute, 1=relative |\n+| hd | 1 | 1[2] | Header Data present | 1=header_data valid |\n+| eom | 1 | 1[1] | End of Message | 1=last packet |\n+| som | 1 | 1[0] | Start of Message | Must be 1 for this format |\n+| message_id | 16 | 2-3 | Message identifier | 0=reserved (invalid) |\n+| ri_generation | 8 | 4 | Resource Index generation | For buffer exhaustion recovery |\n+| job_id | 24 | 5-7 | Job Identifier | Matches VXLAN VNI size |\n+| rsvd | 4 | 8[7:4] | Reserved | Must be 0 |\n+| pid_on_fep | 12 | 8[3:0]+9 | Process ID on FEP | Target process |\n+| rsvd | 4 | 10[7:4] | Reserved | Must be 0 |\n+| resource_index | 12 | 10[3:0]+11 | Resource Index | Target resource |\n+| buffer_offset | 64 | 12-19 | Buffer offset | Or restart token for deferrable |\n+| initiator | 32 | 20-23 | Initiator ID | For tagged matching |\n+| match_bits | 64 | 24-31 | Match bits / Memory key | Dual-purpose field |\n+| header_data | 64 | 32-39 | Header data | Completion data (if hd=1) |\n+| request_length | 32 | 40-43 | Request length | Bytes to transfer |\n+\n+##### Field Notes\n+\n+**match_bits / memory_key Interpretation**:\n+- For tagged operations (sends): Match bits for receive queue matching\n+- For RMA operations (reads, writes): Memory key for authorization\n+\n+**buffer_offset Special Uses**:\n+- For deferrable sends: Contains restart token (upper 32b initiator, lower 32b target)\n+- For FI_MR_VIRT_ADDR: Contains absolute virtual address\n+\n+##### Protocol Behavior\n+\n+**Message Framing**:\n+- `som=1, eom=1`: Single-packet message\n+- `som=1, eom=0`: First packet of multi-packet message\n+- Continuation packets use SOM=0 format (Table 3-9)\n+\n+**Addressing Modes**:\n+- `rel=0` (Absolute): {JobID, PIDonFEP, resource_index} identifies target\n+- `rel=1` (Relative): Addressing relative to connection context\n+\n+**Delivery Complete (dc)**:\n+- When `dc=1`: Response deferred until data globally observable\n+- Matches FI_DELIVERY_COMPLETE libfabric option\n+\n+**Reference**: UE Spec v1.0.1, Table 3-8, Section 3.4.2.1, Page 158\n+\n+---\n+\n+#### 3.5.2 Standard Request SOM=0 (Table 3-9, 16 bytes)\n+\n+**Datamodel**: `datamodel/protocols/ue/transport/ses/standard_request_som0.ksy`  \n+**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes)\n+\n+##### Wire Format\n+\n+```\n+Byte:    0       1       2       3       4       5       6       7\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+     |rs|opcode |v|dc|ie|rl|hd|eo|so|    message_id     | ri_gen  →\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+         8       9      10      11      12      13      14      15\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+   → |      job_id [23:0]    |       message_offset [31:0]          |\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+```\n+\n+##### Field Definitions\n+\n+| Field | Bits | Offset | Description | Constraints |\n+|-------|------|--------|-------------|-------------|\n+| rsvd | 2 | 0[7:6] | Reserved | Must be 0 |\n+| opcode | 6 | 0[5:0] | Operation code | Same as SOM=1 packet |\n+| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n+| dc | 1 | 1[5] | Delivery Complete | Same as SOM=1 |\n+| ie | 1 | 1[4] | Initiator Error | Error at initiator |\n+| rel | 1 | 1[3] | Relative addressing | Same as SOM=1 |\n+| hd | 1 | 1[2] | Header Data present | Ignored for SOM=0 |\n+| eom | 1 | 1[1] | End of Message | 1=last packet |\n+| som | 1 | 1[0] | Start of Message | Must be 0 for this format |\n+| message_id | 16 | 2-3 | Message identifier | Same as SOM=1 packet |\n+| ri_generation | 8 | 4 | Resource Index generation | Same as SOM=1 |\n+| job_id | 24 | 5-7 | Job Identifier | Same as SOM=1 |\n+| message_offset | 32 | 8-11 | Offset within message | Byte offset from start |\n+\n+##### Protocol Behavior\n+\n+**Continuation Packets**:\n+- Used for packets 2..N of multi-packet messages\n+- `message_offset` indicates position within overall message\n+- Target uses offset to place data correctly in buffer\n+\n+**Packet Ordering**:\n+- ROD delivery: Packets delivered in PSN order\n+- RUD delivery: Packets may arrive out of order; target reassembles using message_offset\n+\n+**Reference**: UE Spec v1.0.1, Table 3-9, Section 3.4.2.1, Page 159\n+\n+---\n+\n+#### 3.5.3 Response (Table 3-11, 16 bytes)\n+\n+**Datamodel**: `datamodel/protocols/ue/transport/ses/response.ksy`  \n+**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes) | [Response with Data (3.5.4)](#354-response-with-data-table-3-12-24-bytes)\n+\n+##### Wire Format\n+\n+```\n+Byte:    0       1       2       3       4       5       6       7\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+     | list|opcode |v| return_code |    message_id     | ri_gen  →\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+         8       9      10      11      12      13      14      15\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+   → |      job_id [23:0]    |       modified_length [31:0]         |\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+\n+Byte 0-1 Detail:\n+  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n+       |list |  opcode |v| return_code   |\n+       | (2) | (6 bits)|r|   (6 bits)    |\n+```\n+\n+##### Field Definitions\n+\n+| Field | Bits | Offset | Description | Constraints |\n+|-------|------|--------|-------------|-------------|\n+| list | 2 | 0[7:6] | List indicator | 0=expected, 1=unexpected |\n+| opcode | 6 | 0[5:0] | Response opcode | Per Table 3-18 |\n+| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n+| return_code | 6 | 1[5:0] | Return code | Per Table 3-19 |\n+| message_id | 16 | 2-3 | Message identifier | From original request |\n+| ri_generation | 8 | 4 | Resource Index generation | New generation on mismatch |\n+| job_id | 24 | 5-7 | Job Identifier | From original request |\n+| modified_length | 32 | 8-11 | Modified length | Bytes actually transferred |\n+| rsvd | 32 | 12-15 | Reserved | Must be 0 |\n+\n+##### Return Codes (Table 3-19)\n+\n+| Code | Name | Description |\n+|------|------|-------------|\n+| 0x00 | RC_OK | Success |\n+| 0x01 | RC_NO_MATCH | No matching buffer found |\n+| 0x02 | RC_BUFFER_TOO_SMALL | Target buffer too small |\n+| 0x03 | RC_AUTHORIZATION_FAILURE | Memory key mismatch |\n+| 0x04 | RC_INVALID_OPERATION | Invalid operation |\n+| 0x05 | RC_RESOURCE_EXHAUSTION | Resource exhaustion |\n+| 0x06 | RC_GENERATION_MISMATCH | RI generation mismatch |\n+| 0x07 | RC_TRUNCATED | Message truncated |\n+\n+##### Protocol Behavior\n+\n+**Response Generation**:\n+1. Target processes request\n+2. Generates response with appropriate return_code\n+3. `modified_length` indicates actual bytes transferred (may be < request_length)\n+\n+**List Indicator**:\n+- `list=0`: Payload delivered to expected list (matched posted receive)\n+- `list=1`: Payload delivered to unexpected list (no matching receive)\n+\n+**Reference**: UE Spec v1.0.1, Table 3-11, Section 3.4.2.5, Page 167\n+\n+---\n+\n+#### 3.5.4 Response with Data (Table 3-12, 24 bytes)\n+\n+**Datamodel**: `datamodel/protocols/ue/transport/ses/response_with_data.ksy`  \n+**Related Formats**: [Response (3.5.3)](#353-response-table-3-11-16-bytes)\n+\n+##### Wire Format\n+\n+```\n+Byte:    0       1       2       3       4       5       6       7\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+     | list|opcode |v| return_code | response_msg_id   | rsvd    →\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+         8       9      10      11      12      13      14      15\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+   → |      job_id [23:0]    |read_req_msg_id|rs|payload_len      →\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+        16      17      18      19      20      21      22      23\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+   → |       modified_length [31:0]  |       message_offset [31:0]  |\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+```\n+\n+##### Field Definitions\n+\n+| Field | Bits | Offset | Description | Constraints |\n+|-------|------|--------|-------------|-------------|\n+| list | 2 | 0[7:6] | List indicator | 0=expected, 1=unexpected |\n+| opcode | 6 | 0[5:0] | Response opcode | Per Table 3-18 |\n+| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n+| return_code | 6 | 1[5:0] | Return code | Per Table 3-19 |\n+| response_message_id | 16 | 2-3 | Response message ID | For this response |\n+| rsvd | 8 | 4 | Reserved | Must be 0 |\n+| job_id | 24 | 5-7 | Job Identifier | From original request |\n+| read_request_message_id | 16 | 8-9 | Original request msg ID | Links to request |\n+| rsvd | 2 | 10[7:6] | Reserved | Must be 0 |\n+| payload_length | 14 | 10[5:0]+11 | Payload in this packet | Max 16383 bytes |\n+| modified_length | 32 | 12-15 | Total bytes transferred | Across all packets |\n+| message_offset | 32 | 16-19 | Offset in response | For multi-packet responses |\n+| rsvd | 32 | 20-23 | Reserved | Must be 0 |\n+\n+##### Protocol Behavior\n+\n+**Use Cases**:\n+- RDMA Read responses (returning requested data)\n+- Fetching atomic responses (returning original value)\n+\n+**Multi-Packet Responses**:\n+- `message_offset` indicates position within overall response\n+- `payload_length` indicates data in this specific packet\n+- `modified_length` is total across all response packets\n+\n+**Reference**: UE Spec v1.0.1, Table 3-12, Section 3.4.2.5, Page 168\n+\n+---\n+\n+#### 3.5.5 Small Message (Figure 3-14, 32 bytes)\n+\n+**Datamodel**: `datamodel/protocols/ue/transport/ses/small_message.ksy`  \n+**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes) | [Response (3.5.3)](#353-response-table-3-11-16-bytes)\n+\n+##### Wire Format\n+\n+```\n+Byte:    0       1       2       3       4       5       6       7\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+     |opcode |v|dc|ie|rl|hd|eo|so|rs| request_length  | ri_gen  →\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+         8       9      10      11      12      13      14      15\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+   → |      job_id [23:0]    |rsvd|pid_on_fep |rsvd| resource_idx  →\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+        16      17      18      19      20      21      22      23\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+   → |        initiator [31:0]       |        match_bits [63:0]     →\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+        24      25      26      27      28      29      30      31\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+   → |  (match_bits cont'd)          |       header_data [63:0]     |\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+```\n+\n+##### Field Definitions\n+\n+| Field | Bits | Offset | Description | Constraints |\n+|-------|------|--------|-------------|-------------|\n+| opcode | 6 | 0[7:2] | Operation code | Per Table 3-17 |\n+| version | 2 | 0[1:0] | Protocol version | 0 for v1.0.1 |\n+| dc | 1 | 1[7] | Delivery Complete | Defer response |\n+| ie | 1 | 1[6] | Initiator Error | Error at initiator |\n+| rel | 1 | 1[5] | Relative addressing | 0=absolute, 1=relative |\n+| hd | 1 | 1[4] | Header Data present | 1=header_data valid |\n+| eom | 1 | 1[3] | End of Message | Must be 1 (single packet) |\n+| som | 1 | 1[2] | Start of Message | Must be 1 (single packet) |\n+| rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n+| rsvd | 2 | 2[7:6] | Reserved | Must be 0 |\n+| request_length | 14 | 2[5:0]+3 | Request length | Max 16383 bytes |\n+| ri_generation | 8 | 4 | Resource Index generation | For buffer recovery |\n+| job_id | 24 | 5-7 | Job Identifier | Target job |\n+| rsvd | 4 | 8[7:4] | Reserved | Must be 0 |\n+| pid_on_fep | 12 | 8[3:0]+9 | Process ID on FEP | Target process |\n+| rsvd | 4 | 10[7:4] | Reserved | Must be 0 |\n+| resource_index | 12 | 10[3:0]+11 | Resource Index | Target resource |\n+| initiator | 32 | 12-15 | Initiator ID | For tagged matching |\n+| match_bits | 64 | 16-23 | Match bits | For tagged matching |\n+| header_data | 64 | 24-31 | Header data | Completion data |\n+\n+##### Protocol Behavior\n+\n+**Optimized Format**:\n+- 32 bytes vs 44 bytes for standard request\n+- Single-packet only (`som=1, eom=1` required)\n+- No buffer_offset (not needed for single packet)\n+- 14-bit request_length (max 16383 bytes)\n+\n+**Use Cases**:\n+- Small tagged sends\n+- Single-packet messages with matching criteria\n+- Latency-sensitive operations\n+\n+**Reference**: UE Spec v1.0.1, Figure 3-14, Section 3.4.2.3, Page 164\n+\n+---\n+\n+#### 3.5.6 Rendezvous Extension (Figure 3-15, 32 bytes)\n+\n+**Datamodel**: `datamodel/protocols/ue/transport/ses/rendezvous_extension.ksy`  \n+**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes)\n+\n+##### Wire Format\n+\n+```\n+Byte:    0       1       2       3       4       5       6       7\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+     |       eager_length [31:0]     |        memory_key [63:0]     →\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+         8       9      10      11      12      13      14      15\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+   → |  (memory_key cont'd)          |       buffer_offset [63:0]   →\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+        16      17      18      19      20      21      22      23\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+   → |  (buffer_offset cont'd)       |     remaining_length [31:0]  →\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+        24      25      26      27      28      29      30      31\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+   → | (remaining)   |              reserved [63:0]                  |\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+```\n+\n+##### Field Definitions\n+\n+| Field | Bits | Offset | Description | Constraints |\n+|-------|------|--------|-------------|-------------|\n+| eager_length | 32 | 0-3 | Eager data length | Bytes pushed with request |\n+| memory_key | 64 | 4-11 | Initiator memory key | For target to pull data |\n+| buffer_offset | 64 | 12-19 | Initiator buffer offset | Start of remaining data |\n+| remaining_length | 32 | 20-23 | Remaining data length | Bytes to pull |\n+| rsvd | 64 | 24-31 | Reserved | Must be 0 |\n+\n+##### Protocol Behavior\n+\n+**Rendezvous Protocol**:\n+1. Initiator sends request with eager data + rendezvous extension\n+2. Target receives eager data, allocates buffer\n+3. Target issues RDMA Read to pull remaining data using {memory_key, buffer_offset}\n+4. Target completes operation when all data received\n+\n+**Two-Sided Protocol**:\n+- Enables large message transfer without pre-registered buffers\n+- Target controls when/how to pull remaining data\n+- Reduces memory registration overhead\n+\n+**Constraints**:\n+- MUST NOT be combined with atomic extension\n+- Placed on every packet using rendezvous opcode\n+\n+**Reference**: UE Spec v1.0.1, Figure 3-15, Section 3.4.2.3, Page 165\n+\n+---\n+\n+#### 3.5.7 Atomic Extension (Figure 3-16, 8 bytes)\n+\n+**Datamodel**: `datamodel/protocols/ue/transport/ses/atomic_extension.ksy`  \n+**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes) | [Response with Data (3.5.4)](#354-response-with-data-table-3-12-24-bytes)\n+\n+##### Wire Format\n+\n+```\n+Byte:    0       1       2       3       4       5       6       7\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+     |atomic_opcode  |atomic_datatype| semantic_control  | reserved  |\n+     +-------+-------+-------+-------+-------+-------+-------+-------+\n+```\n+\n+##### Field Definitions\n+\n+| Field | Bits | Offset | Description | Constraints |\n+|-------|------|--------|-------------|-------------|\n+| atomic_opcode | 8 | 0 | Atomic operation | Per Table 3-21 |\n+| atomic_datatype | 8 | 1 | Data type | Per Table 3-22 |\n+| semantic_control | 16 | 2-3 | Semantic control | Per Table 3-23 |\n+| rsvd | 32 | 4-7 | Reserved | Must be 0 |\n+\n+##### Atomic Opcodes (Table 3-21)\n+\n+| Code | Name | Operation |\n+|------|------|-----------|\n+| 0x00 | MIN | Target = MIN(Target, Initiator) |\n+| 0x01 | MAX | Target = MAX(Target, Initiator) |\n+| 0x02 | SUM | Target = Target + Initiator |\n+| 0x03 | DIFF | Target = Target - Initiator |\n+| 0x04 | PROD | Target = Target * Initiator |\n+| 0x05 | LOR | Target = Target \\|\\| Initiator |\n+| 0x06 | LAND | Target = Target && Initiator |\n+| 0x07 | BOR | Target = Target \\| Initiator |\n+| 0x08 | BAND | Target = Target & Initiator |\n+| 0x09 | LXOR | Logical XOR |\n+| 0x0A | BXOR | Target = Target ^ Initiator |\n+| 0x0B | READ | Initiator = Target |\n+| 0x0C | WRITE | Target = Initiator |\n+| 0x0D | CSWAP | Compare and swap if equal |\n+| 0x0E | CSWAP_NE | Compare and swap if not equal |\n+| 0x0F | CSWAP_LE | Compare and swap if ≤ |\n+| 0x10 | CSWAP_LT | Compare and swap if < |\n+| 0x11 | CSWAP_GE | Compare and swap if ≥ |\n+| 0x12 | CSWAP_GT | Compare and swap if > |\n+| 0x13 | MSWAP | Masked swap |\n+| 0x14 | INVAL | Invalidate cache |\n+\n+##### Atomic Datatypes (Table 3-22)\n+\n+| Code | Name | Size |\n+|------|------|------|\n+| 0x00 | INT8 | 1 byte |\n+| 0x01 | UINT8 | 1 byte |\n+| 0x02 | INT16 | 2 bytes |\n+| 0x03 | UINT16 | 2 bytes |\n+| 0x04 | INT32 | 4 bytes |\n+| 0x05 | UINT32 | 4 bytes |\n+| 0x06 | INT64 | 8 bytes |\n+| 0x07 | UINT64 | 8 bytes |\n+| 0x08 | FLOAT | 4 bytes |\n+| 0x09 | DOUBLE | 8 bytes |\n+| 0x0A | FLOAT_COMPLEX | 8 bytes |\n+| 0x0B | DOUBLE_COMPLEX | 16 bytes |\n+| 0x0E | FLOAT16 | 2 bytes |\n+| 0x0F | BFLOAT16 | 2 bytes |\n+\n+##### Protocol Behavior\n+\n+**Atomic Operations**:\n+- Always 8 bytes and must be naturally aligned\n+- Payload must be integral multiple of datatype size\n+- Fetching atomics return original value in Response with Data\n+\n+**Constraints**:\n+- MUST NOT be combined with rendezvous extension\n+- Fetching atomics MUST NOT operate on more than one element\n+\n+**Reference**: UE Spec v1.0.1, Figure 3-16, Section 3.4.2.4, Page 165\n+\n ### 3.6 CMS (Congestion Management Sublayer)\n \n **Datamodel Directory**: `datamodel/protocols/ue/transport/cms/`\n \n",
              "filediff": {
                "file": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
                "before": "# PMR (CN7000) Packet Format Taxonomy\n\n**Document**: Packet formats supported by PMR NIC ASIC  \n**Generated**: 2026-01-14  \n**Last Reviewed**: 2026-01-20  \n**Source**: `datamodel/` directory in EarlySim repository  \n**Reference**: `docs/HAS/PMR/05-packet-formats.md`\n\n---\n\n## Table of Contents\n\n1. [Overview](#1-overview)\n2. [Protocol Stack Summary](#2-protocol-stack-summary)\n3. [Ultra Ethernet+ (UE+) Formats](#3-ultra-ethernet-ue-formats)\n4. [RoCEv2 Formats](#4-rocev2-formats)\n5. [Standard Ethernet Formats](#5-standard-ethernet-formats)\n6. [Cornelis Proprietary Formats](#6-cornelis-proprietary-formats)\n7. [Host-Software Interface (HSI) Formats](#7-host-software-interface-hsi-formats)\n8. [IP Block Descriptors](#8-ip-block-descriptors)\n9. [Work List](#9-work-list)\n10. [UALink Protocol (Reference Only)](#10-ualink-protocol-reference-only)\n11. [References](#11-references)\n\n---\n\n## 1. Overview\n\nPMR (Prism River) is Cornelis Networks' 1.6 Tbps NIC ASIC (CN7000 product family). It supports multiple wire protocols with per-packet protocol selection on a single physical port.\n\n### Supported Protocols\n\n| Protocol | Version | Status | Description |\n|----------|---------|--------|-------------|\n| Ultra Ethernet+ | 1.0.1 | Full | Optimized UE with Cornelis extensions |\n| RoCEv2 | v2 | Full | RDMA over Converged Ethernet |\n| Standard Ethernet | IEEE 802.3 | Full | Traditional Ethernet with offloads |\n| Cornelis Proprietary | 1.0.0 | Full | UFH, CSIG+, VxLAN+, Collectives |\n\n### Header Efficiency Comparison\n\n| Protocol Stack | Total Headers | Efficiency (4KB payload) |\n|----------------|---------------|--------------------------|\n| UE+ (small msg) | ~20 bytes | 99.5% |\n| UE+ (standard) | ~40 bytes | 99.0% |\n| RoCEv2 (IPv4) | ~58 bytes | 98.6% |\n| RoCEv2 (IPv6) | ~78 bytes | 98.1% |\n\n---\n\n## 2. Protocol Stack Summary\n\n```\n+-----------------------------------------------------------------------------+\n|                           Application Layer                                  |\n|                    (Libfabric, Verbs, Sockets, DPDK)                         |\n+-----------------------------------------------------------------------------+\n|                           Transport Layer                                    |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UE Transport   |  |     RoCEv2       |  |    TCP/UDP       |            |\n|  |   (SES/PDS/CMS)  |  |   (BTH/RETH)     |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                           Network Layer                                      |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UFH-16/32      |  |   IPv4/IPv6      |  |   IPv4/IPv6      |            |\n|  |   (Cornelis)     |  |   + UDP          |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                            Link Layer                                        |\n|  +------------------+  +------------------+  +------------------+            |\n|  |      UE+         |  |   Ethernet II    |  |   Ethernet II    |            |\n|  |   (12 bytes)     |  |   (14 bytes)     |  |   (14 bytes)     |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                          Physical Layer                                      |\n|                    Hill Creek (212.5G x8 PAM4 SerDes)                        |\n+-----------------------------------------------------------------------------+\n      Ultra Ethernet+           RoCEv2              Standard Ethernet\n```\n\n---\n\n## 3. Ultra Ethernet+ (UE+) Formats\n\n### 3.1 UE+ L2 Header (12 bytes)\n\n**Datamodel**: `datamodel/protocols/cornelis/link/ue_plus.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Byte 2        | Byte 3        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n|L2|V|zyxm|Len  | Length[7:0]   | RC    | SC    | Hop Count     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 4        | Byte 5        | Byte 6        | Byte 7        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Dest LID [15:8]               | Dest LID [7:0]                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Entropy [15:8]                | Entropy [7:0]                 |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 8        | Byte 9        | Byte 10       | Byte 11       |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Source LID [15:8]             | Source LID [7:0]              |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Payload Type [15:8]           | Payload Type [7:0]            |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| L2 Type | 2 | Always 0b10 for UE+ |\n| Version | 1 | Protocol version |\n| zyxm | 4 | Routing control flags (multicast, adaptive) |\n| Length | 9 | Packet length in bytes |\n| RC | 4 | Routing Class (QoS) |\n| SC | 4 | Service Class |\n| Hop | 8 | TTL/hop count |\n| Dest LID | 16 | Destination Local Identifier |\n| Entropy | 16 | ECMP hash for load balancing |\n| Source LID | 16 | Source Local Identifier |\n| Type | 16 | Payload type (EtherType equivalent) |\n\n**Payload Types**:\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x0800 | IPv4 | IPv4 payload |\n| 0x86DD | IPv6 | IPv6 payload |\n| 0x8100 | VLAN | VLAN tagged frame |\n| 0x9000 | VxLAN+ | VxLAN+ encapsulated |\n| 0x9100 | CSIG+ | CSIG+ telemetry |\n| 0xC000 | UE PDS | Ultra Ethernet PDS |\n\n### 3.2 PDS (Packet Delivery Sublayer) Prologue (2 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/prologue.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0                        | Byte 1                        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| type[4:0] | next_hdr/ctl[3:0] | flags[6:0]                    |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| PDS Type | Value | Description |\n|----------|-------|-------------|\n| Reserved | 0 | Reserved |\n| TSS | 1 | Transport Security (encryption) |\n| RUD Request | 2 | Reliable Unordered Delivery |\n| ROD Request | 3 | Reliable Ordered Delivery |\n| RUDI Request | 4 | Reliable Unordered Immediate |\n| RUDI Response | 5 | RUDI response |\n| UUD Request | 6 | Unreliable Unordered Delivery |\n| ACK | 7 | Acknowledgment |\n| ACK_CC | 8 | ACK with congestion control |\n| ACK_CCX | 9 | ACK with extended CC |\n| NACK | 10 | Negative acknowledgment |\n| CP | 11 | Control packet |\n| NACK_CCX | 12 | NACK with extended CC |\n| RUD_CC_REQ | 13 | RUD with CC state |\n| ROD_CC_REQ | 14 | ROD with CC state |\n\n### 3.3 PDS Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/pds/`\n\n```\nPDS Request/Response Relationships:\n┌─────────────────────────────────────────────────────────────────┐\n│                                                                 │\n│  UUD Request (0x06) ──────────────────────→ (no response)       │\n│                                                                 │\n│  RUDI Request (0x04) ─────────────────────→ RUDI Response (0x05)│\n│                       └───────────────────→ NACK (0x0A)         │\n│                                                                 │\n│  RUD Request (0x01) ──┬───────────────────→ ACK (0x07)          │\n│                       ├───────────────────→ ACK_CC (0x08)       │\n│                       ├───────────────────→ ACK_CCX (0x09)      │\n│                       ├───────────────────→ NACK (0x0A)         │\n│                       └───────────────────→ NACK_CCX (0x0C)     │\n│                                                                 │\n│  ROD Request (0x02) ──┴───────────────────→ (same as RUD)       │\n│                                                                 │\n│  Control Packet (0x0B) ───────────────────→ (varies by subtype) │\n│                                                                 │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n| Type | Format | File | Size | Description |\n|------|--------|------|------|-------------|\n| 0x01 | RUD Request | `rud_rod_request.ksy` | 12 bytes | Reliable Unordered Delivery |\n| 0x02 | ROD Request | `rud_rod_request.ksy` | 12 bytes | Reliable Ordered Delivery |\n| 0x04 | RUDI Request | `rudi_request_response.ksy` | 6 bytes | Reliable Unordered Immediate |\n| 0x05 | RUDI Response | `rudi_request_response.ksy` | 6 bytes | RUDI response |\n| 0x06 | UUD Request | `uud_request.ksy` | 6 bytes | Unreliable Unordered Delivery |\n| 0x07 | ACK | `rud_rod_ack.ksy` | 12 bytes | Acknowledgment |\n| 0x08 | ACK_CC | `ack_cc.ksy` | 28 bytes | ACK with CC state |\n| 0x09 | ACK_CCX | `ack_ccx.ksy` | 44 bytes | ACK with extended CC |\n| 0x0A | NACK | `nack.ksy` | 12 bytes | Negative acknowledgment |\n| 0x0B | CP | `rud_rod_cp.ksy` | 12 bytes | Control packet (10 subtypes) |\n| 0x0C | NACK_CCX | `nack_ccx.ksy` | 28 bytes | NACK with extended CC |\n\n#### 3.3.1 RUD Request (Type 0x01, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_request.ksy`  \n**Related Formats**: [ROD Request (3.3.2)](#332-rod-request-type-0x02-12-bytes) | [ACK (3.3.6)](#336-ack-type-0x07-12-bytes) | [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |nxt|flg|       clear_psn_offset |         PSN [31:0]    →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|r|a|s|rsvd|\n       | (5 bits)|(4 bit)| (2) |t|r|y|(2) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x01 (RUD) | Must be 0x01 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 2 | 1[6:5] | Reserved | Must be 0 |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.ar | 1 | 1[3] | ACK request | 0=no ACK, 1=request ACK |\n| flags.syn | 1 | 1[2] | PDC establishment | 0=normal, 1=SYN |\n| flags.rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n| clear_psn_offset | 16 | 2-3 | CLEAR_PSN relative to PSN | Unsigned offset |\n| psn | 32 | 4-7 | Packet Sequence Number | 32-bit, wraps |\n| spdcid | 16 | 8-9 | Source PDCID | Valid PDCID |\n| dpdcid | 16 | 10-11 | Destination PDCID | See note below |\n\n##### Field Notes\n\n**dpdcid Interpretation** (depends on `syn` flag):\n- `syn=0`: Destination PDCID for established PDC\n- `syn=1`: `{pdc_info[3:0], psn_offset[11:0]}` for PDC establishment\n  - `pdc_info[0]`: use_rsv_pdc (1=reserved pool, 0=shared pool)\n  - `pdc_info[3:1]`: Reserved\n  - `psn_offset[11:0]`: Difference between PSN and Start_PSN\n\n**clear_psn_offset**: Computed as `CLEAR_PSN = PSN - clear_psn_offset`. Indicates the highest PSN that has been delivered to SES at the source.\n\n##### Protocol Behavior\n\n**Delivery Mode**: RUD (Reliable Unordered Delivery) provides reliable packet delivery without ordering guarantees. Packets may be delivered to SES out of order.\n\n**State Machine**: RUD operates within the PDC (Packet Delivery Channel) state machine defined in Section 3.5.7.\n\n**Transmission Rules**:\n1. Source assigns monotonically increasing PSN to each packet\n2. `ar` flag SHOULD be set periodically (per `ack_request_interval`)\n3. `retx` flag set when retransmitting due to timeout or NACK\n4. `syn` flag set only for first packet establishing new PDC\n\n**Receiver Processing**:\n1. Validate PDCID and PSN\n2. If PSN is new: deliver to SES immediately (no ordering)\n3. If PSN is duplicate: discard, optionally send ACK\n4. If `ar=1`: generate ACK, ACK_CC, or ACK_CCX response\n\n**Timing Constraints**:\n- Retransmit timeout: Implementation-defined (typically RTT-based)\n- ACK coalescing: Up to `ack_coalesce_count` packets\n\n**Reference**: UE Spec v1.0.1, Table 3-33, Section 3.5.10.3, Page 256\n\n---\n\n#### 3.3.2 ROD Request (Type 0x02, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_request.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [ACK (3.3.6)](#336-ack-type-0x07-12-bytes) | [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\nIdentical to RUD Request (Section 3.3.1) with `type = 0x02`.\n\n##### Field Definitions\n\nSame as RUD Request. Only `type` field differs.\n\n##### Protocol Behavior\n\n**Delivery Mode**: ROD (Reliable Ordered Delivery) provides reliable packet delivery with strict ordering guarantees. Packets are delivered to SES in PSN order.\n\n**Key Difference from RUD**: ROD receiver MUST buffer out-of-order packets and deliver to SES only when all preceding PSNs have been received.\n\n**Ordering Guarantee**:\n- Receiver maintains expected PSN\n- Out-of-order packets are buffered (not delivered)\n- When gap is filled, buffered packets delivered in order\n- Head-of-line blocking possible if packet lost\n\n**Use Cases**:\n- Multi-packet messages requiring in-order delivery\n- Streaming data with ordering requirements\n- Operations where partial delivery is not acceptable\n\n**Reference**: UE Spec v1.0.1, Table 3-33, Section 3.5.10.3, Page 256\n\n---\n\n#### 3.3.3 RUDI Request (Type 0x04, 6 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rudi_request_response.ksy`  \n**Related Formats**: [RUDI Response (3.3.4)](#334-rudi-response-type-0x05-6-bytes) | [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5\n     +-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  |         pkt_id [31:0]     |\n     +-------+-------+-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|r|retx|rsvd|\n       | (5 bits)|(4 bit)| (1) |m| (1)|(4) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x04 (RUDI Request) | Must be 0x04 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.rsvd_m | 1 | 1[5] | Reserved (m for response) | Must be 0 for request |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.rsvd | 4 | 1[3:0] | Reserved | Must be 0 |\n| pkt_id | 32 | 2-5 | Packet Identifier | Locally unique |\n\n##### Protocol Behavior\n\n**Delivery Mode**: RUDI (Reliable Unordered Delivery with Idempotence) provides reliable delivery for idempotent operations without PDC context.\n\n**Key Characteristics**:\n- Uses packet ID instead of sequence number\n- No PDC (Packet Delivery Context) required\n- Idempotent: safe to retry without side effects\n- Smaller header (6 bytes vs 12 bytes for RUD/ROD)\n\n**Idempotence Guarantee**:\n- Receiver tracks recently processed pkt_ids\n- Duplicate pkt_ids are detected and response re-sent\n- No state corruption from retransmissions\n\n**Use Cases**:\n- Small, self-contained operations\n- Stateless request/response patterns\n- Operations where retry is safe (reads, idempotent writes)\n\n**Reference**: UE Spec v1.0.1, Table 3-39, Section 3.5.10.9, Page 262\n\n---\n\n#### 3.3.4 RUDI Response (Type 0x05, 6 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rudi_request_response.ksy`  \n**Related Formats**: [RUDI Request (3.3.3)](#333-rudi-request-type-0x04-6-bytes)\n\n##### Wire Format\n\nIdentical to RUDI Request with `type = 0x05` and `flags.m` valid.\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x05 (RUDI Response) | Must be 0x05 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.m | 1 | 1[5] | ECN marked | 1 if request was ECN marked |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.rsvd | 4 | 1[3:0] | Reserved | Must be 0 |\n| pkt_id | 32 | 2-5 | Packet Identifier | Echoed from request |\n\n##### Protocol Behavior\n\n**Response Generation**:\n1. Receiver processes RUDI Request\n2. Generates RUDI Response with same pkt_id\n3. Sets `m` flag if request packet was ECN marked\n\n**Reference**: UE Spec v1.0.1, Table 3-39, Section 3.5.10.9, Page 262\n\n---\n\n#### 3.3.5 UUD Request (Type 0x06, 6 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/uud_request.ksy`  \n**Related Formats**: None (no response generated)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5\n     +-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  |         pkt_id [31:0]     |\n     +-------+-------+-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr|     rsvd (7)    |\n       | (5 bits)|(4 bit)|                 |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x06 (UUD) | Must be 0x06 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 7 | 1[6:0] | Reserved | Must be 0 |\n| pkt_id | 32 | 2-5 | Packet Identifier | Locally unique |\n\n##### Protocol Behavior\n\n**Delivery Mode**: UUD (Unreliable Unordered Delivery) provides best-effort delivery with no reliability guarantees.\n\n**Key Characteristics**:\n- No ACKs or NACKs generated\n- No retransmissions\n- Packet loss is acceptable\n- Lowest overhead delivery mode\n\n**Use Cases**:\n- Loss-tolerant traffic (video streaming, telemetry)\n- High-frequency updates where latest value matters\n- Multicast/broadcast scenarios\n\n**Reference**: UE Spec v1.0.1, Table 3-42, Section 3.5.10.12, Page 265\n\n---\n\n#### 3.3.6 ACK (Type 0x07, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_ack.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [ACK_CC (3.3.7)](#337-ack_cc-type-0x08-28-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  |   ack_psn_offset  |    probe_opaque     →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |   cack_psn    |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|m|r|p|req|rsvd|\n       | (5 bits)|(4 bit)| (1) | |t| |   |(1) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x07 (ACK) | Must be 0x07 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | UET_HDR_NONE |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.m | 1 | 1[5] | ECN marked | 1 if any ACK'd packet was ECN marked |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.p | 1 | 1[3] | Probe response | 1 if responding to Probe CP |\n| flags.req | 2 | 1[2:1] | Request type | 0=RUD, 1=ROD |\n| flags.rsvd | 1 | 1[0] | Reserved | Must be 0 |\n| ack_psn_offset | 16 | 2-3 | Offset from CACK_PSN to ACK_PSN | Signed |\n| probe_opaque | 16 | 4-5 | Copied from Probe CP | Opaque value |\n| cack_psn | 32 | 6-9 | Cumulative ACK PSN | Highest in-order PSN |\n| spdcid | 16 | 10-11 | Source PDCID | Swapped from request |\n| dpdcid | 16 | 12-13 | Destination PDCID | Swapped from request |\n\n**Note**: Wire format shows 12 bytes but field table shows 14 bytes. Verify against spec - likely cack_psn is 16 bits or spdcid/dpdcid share bytes 10-11.\n\n##### Protocol Behavior\n\n**ACK Generation**:\n1. Receiver tracks highest in-order PSN received (CACK_PSN)\n2. ACK generated when `ar` flag set in request, or periodically\n3. `m` flag set if any ACK'd packet had ECN marking\n\n**Cumulative ACK**:\n- `cack_psn` acknowledges all PSNs ≤ this value\n- Sender can free buffers for acknowledged packets\n- Enables sliding window flow control\n\n**Reference**: UE Spec v1.0.1, Table 3-35, Section 3.5.10.5, Page 258\n\n---\n\n#### 3.3.7 ACK_CC (Type 0x08, 28 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/ack_cc.ksy`  \n**Related Formats**: [ACK (3.3.6)](#336-ack-type-0x07-12-bytes) | [ACK_CCX (3.3.8)](#338-ack_ccx-type-0x09-44-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |                    ACK Header (12 bytes)                      |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |  (ACK cont'd) |cc_typ|cc_flg|  mpr  | sack_psn_offset       →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |              sack_bitmap [63:0]                               |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        24      25      26      27\n     +-------+-------+-------+-------+\n     |       ack_cc_state [63:0]     |\n     +-------+-------+-------+-------+\n```\n\n##### Field Definitions (CC Extension, bytes 12-27)\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| cc_type | 4 | 12[7:4] | CC algorithm type | Per Section 3.6.9 |\n| cc_flags | 4 | 12[3:0] | CC flags | Reserved, must be 0 |\n| mpr | 8 | 13 | Maximum PSN Range | Flow control window |\n| sack_psn_offset | 16 | 14-15 | Offset to SACK base PSN | Signed |\n| sack_bitmap | 64 | 16-23 | Selective ACK bitmap | 1=ACK'd, 0=not ACK'd |\n| ack_cc_state | 64 | 24-27 | CC state (per cc_type) | See Section 3.6.9 |\n\n##### CC Type Values\n\n| Value | Name | Description |\n|-------|------|-------------|\n| 0x0 | CC_NSCC | Network-Signaled Congestion Control |\n| 0x1 | CC_CREDIT | RCCC/TFC Credit-based CC |\n\n##### Protocol Behavior\n\n**Selective ACK (SACK)**:\n- `sack_bitmap` covers 64 PSNs starting at `CACK_PSN + sack_psn_offset`\n- Bit N = 1 means PSN (base + N) received\n- Enables efficient loss recovery without full retransmit\n\n**Congestion Control State**:\n- `ack_cc_state` interpretation depends on `cc_type`\n- For NSCC: Contains service_time, rcv_cwnd_pend, rcvd_bytes, ooo_count\n- For CREDIT: Contains credit information\n\n**Reference**: UE Spec v1.0.1, Table 3-36, Section 3.5.10.6, Page 259\n\n---\n\n#### 3.3.8 ACK_CCX (Type 0x09, 44 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/ack_ccx.ksy`  \n**Related Formats**: [ACK_CC (3.3.7)](#337-ack_cc-type-0x08-28-bytes)\n\n##### Wire Format\n\nACK_CCX extends ACK_CC with additional 16 bytes for extended CC state.\n\n```\nBytes 0-27:  ACK_CC header (28 bytes)\nBytes 28-43: Extended CC state (16 bytes)\n```\n\n##### Additional Fields (bytes 28-43)\n\n| Field | Bits | Offset | Description |\n|-------|------|--------|-------------|\n| ack_ccx_state | 128 | 28-43 | Extended CC state |\n\n##### Protocol Behavior\n\n**Extended State**: ACK_CCX provides additional CC state for algorithms requiring more than 64 bits of feedback.\n\n**Reference**: UE Spec v1.0.1, Table 3-37, Section 3.5.10.7, Page 260\n\n---\n\n#### 3.3.9 NACK (Type 0x0A, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/nack.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [NACK_CCX (3.3.10)](#3310-nack_ccx-type-0x0c-28-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  | nack_code |vendor_code|   nack_psn [31:0] →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|m|r|nt|rsvd|\n       | (5 bits)|(4 bit)| (1) | |t|  |(3) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x0A (NACK) | Must be 0x0A |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | UET_HDR_NONE |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.m | 1 | 1[5] | ECN marked | 1 if request was ECN marked |\n| flags.retx | 1 | 1[4] | Retransmit indicator | From request |\n| flags.nt | 1 | 1[3] | NACK type | 0=RUD/ROD, 1=RUDI |\n| flags.rsvd | 3 | 1[2:0] | Reserved | Must be 0 |\n| nack_code | 8 | 2 | NACK reason code | Per Table 3-59 |\n| vendor_code | 8 | 3 | Vendor-specific code | Optional |\n| nack_psn | 32 | 4-7 | NACK'd PSN or pkt_id | Depends on nt flag |\n| spdcid | 16 | 8-9 | Source PDCID | 0 if nt=1 or PDC failure |\n| dpdcid | 16 | 10-11 | Destination PDCID | 0 if nt=1 |\n\n##### NACK Codes (Table 3-59)\n\n| Code | Name | Description |\n|------|------|-------------|\n| 0x00 | UET_NO_PKT_BUF | No packet buffer available |\n| 0x01 | UET_TRIMMED | Packet was trimmed |\n| 0x02 | UET_NO_PDC_AVAIL | No PDC resources available |\n| 0x03 | UET_INV_DPDCID | Invalid destination PDCID |\n| 0x04 | UET_PDC_HDR_MISMATCH | PDC header mismatch |\n| 0x05 | UET_PSN_OOR_WINDOW | PSN outside expected window |\n| 0x06 | UET_PSN_GAP | PSN gap detected (packet loss) |\n\n##### Protocol Behavior\n\n**NACK Generation**:\n1. Receiver detects error condition (loss, resource exhaustion, etc.)\n2. Generates NACK with appropriate nack_code\n3. Sender receives NACK and takes corrective action\n\n**Sender Response to NACK**:\n- `UET_PSN_GAP`: Retransmit missing packets\n- `UET_NO_PKT_BUF`: Back off, retry later\n- `UET_NO_PDC_AVAIL`: PDC establishment failed, retry or abort\n\n**Reference**: UE Spec v1.0.1, Table 3-40, Section 3.5.10.10, Page 263\n\n---\n\n#### 3.3.10 NACK_CCX (Type 0x0C, 28 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/nack_ccx.ksy`  \n**Related Formats**: [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\nNACK_CCX extends NACK with 16 bytes of CC state (similar to ACK_CC extension).\n\n```\nBytes 0-11:  NACK header (12 bytes)\nBytes 12-27: CC extension (16 bytes)\n```\n\n##### Protocol Behavior\n\n**Extended NACK**: NACK_CCX provides congestion control feedback along with the negative acknowledgment, enabling the sender to adjust its rate while handling the error.\n\n**Reference**: UE Spec v1.0.1, Table 3-41, Section 3.5.10.11, Page 264\n\n---\n\n#### 3.3.11 Control Packet (Type 0x0B, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_cp.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [ACK (3.3.6)](#336-ack-type-0x07-12-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |ctl|  flags  |   probe_opaque    |         PSN [31:0]  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |ctl_typ| rsvd|i|r|a|s|rsvd|\n       | (5 bits)|(4 bit)| (1) |r|t|r|y|(2) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x0B (CP) | Must be 0x0B |\n| ctl_type | 4 | 0[2:0]+1[7] | Control packet subtype | 0-9 defined |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.isrod | 1 | 1[5] | ROD indicator | 1=ROD, 0=RUD (for NOOP/Negotiation) |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.ar | 1 | 1[3] | ACK request | 0=no ACK, 1=request ACK |\n| flags.syn | 1 | 1[2] | PDC establishment | 0=normal, 1=SYN |\n| flags.rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n| probe_opaque | 16 | 2-3 | Opaque value for Probe | Echoed in ACK |\n| psn | 32 | 4-7 | Packet Sequence Number | Some CPs consume PSN |\n| spdcid | 16 | 8-9 | Source PDCID | Valid PDCID |\n| dpdcid | 16 | 10-11 | Destination PDCID | Or {pdc_info, psn_offset} |\n\n##### Control Packet Subtypes\n\n| ctl_type | Name | Direction | Description |\n|----------|------|-----------|-------------|\n| 0 | NOOP | Either | No operation |\n| 1 | ACK_REQUEST | Src→Dst | Request ACK for specific PSN |\n| 2 | CLEAR_COMMAND | Init→Tgt | Clear guaranteed delivery state |\n| 3 | CLEAR_REQUEST | Tgt→Init | Request initiator to send clear |\n| 4 | CLOSE_COMMAND | Init→Tgt | PDC is being closed |\n| 5 | CLOSE_REQUEST | Tgt→Init | Request initiator to close PDC |\n| 6 | PROBE | Src→Dst | Request PDS ACK |\n| 7 | CREDIT | Dst→Src | Carry CC credit |\n| 8 | CREDIT_REQUEST | Src→Dst | Request credit |\n| 9 | NEGOTIATION | Either | PDC negotiation |\n\n##### Protocol Behavior\n\n**PDC Lifecycle**:\n- `CLOSE_COMMAND/REQUEST`: Graceful PDC teardown\n- `CLEAR_COMMAND/REQUEST`: Clear delivery state without closing\n\n**Flow Control**:\n- `CREDIT/CREDIT_REQUEST`: Credit-based flow control\n- `PROBE`: Solicit ACK for RTT measurement or liveness check\n\n**Reference**: UE Spec v1.0.1, Table 3-38, Section 3.5.10.8, Page 261\n\n### 3.4 SES (Semantic Sublayer) Opcodes\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/opcodes.ksy`\n\n**Request Opcodes (Table 3-17)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Tagged Send | 0x00 | Send with tag matching |\n| RMA Write | 0x01 | Remote memory write |\n| RMA Read | 0x02 | Remote memory read |\n| Atomic Write | 0x03 | Atomic memory write |\n| Atomic Read | 0x04 | Atomic memory read |\n| Atomic CAS | 0x05 | Compare-and-swap |\n| Deferrable Send | 0x06 | Deferrable send |\n| Ready to Restart | 0x07 | Restart notification |\n| Small Message | 0x08 | Small message (32B header) |\n| Small RMA Write | 0x09 | Small RMA write |\n| Small RMA Read | 0x0A | Small RMA read |\n| Small Atomic Write | 0x0B | Small atomic write |\n| Small Atomic Read | 0x0C | Small atomic read |\n| Small Atomic CAS | 0x0D | Small atomic CAS |\n\n**Response Opcodes (Table 3-18)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Response | 0x00 | Standard response |\n| Response with Data | 0x01 | Response carrying data |\n| Optimized Response | 0x02 | Optimized format |\n| NACK | 0x03 | Negative acknowledgment |\n\n### 3.5 SES Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/ses/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Standard Request (SOM=1) | `standard_request_som1.ksy` | Start of message |\n| Standard Request (SOM=0) | `standard_request_som0.ksy` | Continuation |\n| Small Message | `small_message.ksy` | 32-byte header format |\n| Small RMA | `small_rma.ksy` | Small RMA operations |\n| Response | `response.ksy` | Standard response |\n| Response with Data | `response_with_data.ksy` | Data-carrying response |\n| Optimized Response | `optimized_response_with_data.ksy` | Optimized format |\n| Deferrable Send | `deferrable_send_request.ksy` | Deferrable operation |\n| Ready to Restart | `ready_to_restart.ksy` | Restart notification |\n| Rendezvous Extension | `rendezvous_extension.ksy` | Large message protocol |\n| Atomic Extension | `atomic_extension.ksy` | Atomic operations |\n| CAS Extension | `cas_extension.ksy` | Compare-and-swap |\n\n### 3.6 CMS (Congestion Management Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/cms/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Credit CP Payload | `credit_cp_payload.ksy` | Credit control packet |\n| Credit Request | `credit_request_cp_payload.ksy` | Credit request |\n| Request CC State | `req_cc_state.ksy` | Request CC state |\n| ACK CC State (NSCC) | `ack_cc_state_nscc.ksy` | NSCC algorithm state |\n| ACK CC State (RCCC/TFC) | `ack_cc_state_rccc_tfc.ksy` | RCCC/TFC state |\n\n### 3.7 TSS (Transport Security Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/tss/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Security Header | `security_header.ksy` | Encryption header |\n| IV Construction | `iv_construction.ksy` | Initialization vector |\n| Key Rotation | `protocols/key_rotation.ksy` | Key rotation protocol |\n| KDF Direct | `protocols/kdf_direct.ksy` | Direct key derivation |\n| KDF Client/Server | `protocols/kdf_client_server.ksy` | Client/server KDF |\n| KDF Cluster | `protocols/kdf_cluster.ksy` | Cluster KDF |\n| Join Secure Domain | `protocols/join_secure_domain.ksy` | Domain join |\n| TSS TX Processing | `protocols/tss_tx_processing.ksy` | Transmit processing |\n| TSS RX Processing | `protocols/tss_rx_processing.ksy` | Receive processing |\n\n### 3.8 Link Layer Formats\n\n#### LLR (Link-Level Retry)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/llr/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| LLR Preamble (64b66b) | `llr_preamble_64b66b.ksy` | 64b66b preamble |\n| LLR Preamble (MII) | `llr_preamble_mii.ksy` | MII preamble |\n| LLR Init CTLOS | `llr_init_ctlos.ksy` | Initialize LLR |\n| LLR Init Echo CTLOS | `llr_init_echo_ctlos.ksy` | Init acknowledgment |\n| LLR ACK CTLOS | `llr_ack_ctlos.ksy` | Frame acknowledgment |\n| LLR NACK CTLOS | `llr_nack_ctlos.ksy` | Retransmit request |\n\n#### CBFC (Credit-Based Flow Control)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/cbfc/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| CF Update | `cf_update.ksy` | Credit flow update |\n| CC Update | `cc_update.ksy` | Credit count update |\n| VC State Machine | `protocols/vc_state_machine.ksy` | Virtual channel FSM |\n| Lossless VC Init | `protocols/lossless_vc_init.ksy` | VC initialization |\n| Lossless VC Removal | `protocols/lossless_vc_removal.ksy` | VC teardown |\n\n#### LLDP Extensions\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/lldp/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| UE Link Negotiation TLV | `ue_link_negotiation_tlv.ksy` | Link negotiation |\n| UE CBFC TLV | `ue_cbfc_tlv.ksy` | CBFC parameters |\n\n---\n\n## 4. RoCEv2 Formats\n\n**Datamodel Directory**: `datamodel/protocols/roce/transport/`\n\n### 4.1 RoCEv2 Packet Structure\n\n```\n+-----------------------------------------------------------------------------+\n| Ethernet II Header (14 bytes)                                               |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2) = 0x0800/0x86DD            |\n+-----------------------------------------------------------------------------+\n| IP Header (20 bytes IPv4 / 40 bytes IPv6)                                   |\n|   Version, IHL, DSCP, ECN, Length, ID, Flags, TTL, Protocol=17, Checksum   |\n|   Source IP, Dest IP                                                        |\n+-----------------------------------------------------------------------------+\n| UDP Header (8 bytes)                                                        |\n|   Source Port (entropy) | Dest Port = 4791 | Length | Checksum             |\n+-----------------------------------------------------------------------------+\n| BTH - Base Transport Header (12 bytes)                                      |\n|   Opcode | Flags | P-Key | Dest QP | A | PSN                               |\n+-----------------------------------------------------------------------------+\n| Extended Headers (optional, operation-dependent)                            |\n|   RETH (16) | AETH (4) | AtomicETH (28) | ImmDt (4)                        |\n+-----------------------------------------------------------------------------+\n| Payload (0 - MTU bytes)                                                     |\n+-----------------------------------------------------------------------------+\n| ICRC (4 bytes)                                                              |\n+-----------------------------------------------------------------------------+\n```\n\n### 4.2 BTH (Base Transport Header) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/roce/transport/bth.ksy`\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| Opcode | 8 | Operation type (transport + operation) |\n| SE | 1 | Solicited Event |\n| M | 1 | Migration state |\n| Pad | 2 | Padding bytes (0-3) |\n| TVer | 4 | Transport version (must be 0) |\n| P-Key | 16 | Partition key |\n| Dest QP | 24 | Destination Queue Pair |\n| A | 1 | ACK request |\n| PSN | 24 | Packet Sequence Number |\n\n**Transport Types** (Opcode bits [7:5]):\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x00 | RC | Reliable Connection |\n| 0x20 | UC | Unreliable Connection |\n| 0x40 | RD | Reliable Datagram |\n| 0x60 | UD | Unreliable Datagram |\n\n**Operations** (Opcode bits [4:0]):\n| Value | Operation | Description |\n|-------|-----------|-------------|\n| 0x00 | SEND_FIRST | First send packet |\n| 0x01 | SEND_MIDDLE | Middle send packet |\n| 0x02 | SEND_LAST | Last send packet |\n| 0x03 | SEND_LAST_IMM | Last send with immediate |\n| 0x04 | SEND_ONLY | Single-packet send |\n| 0x05 | SEND_ONLY_IMM | Single send with immediate |\n| 0x06 | RDMA_WRITE_FIRST | First RDMA write |\n| 0x07 | RDMA_WRITE_MIDDLE | Middle RDMA write |\n| 0x08 | RDMA_WRITE_LAST | Last RDMA write |\n| 0x09 | RDMA_WRITE_LAST_IMM | Last write with immediate |\n| 0x0A | RDMA_WRITE_ONLY | Single-packet write |\n| 0x0B | RDMA_WRITE_ONLY_IMM | Single write with immediate |\n| 0x0C | RDMA_READ_REQUEST | Read request |\n| 0x0D | RDMA_READ_RESPONSE_FIRST | First read response |\n| 0x0E | RDMA_READ_RESPONSE_MIDDLE | Middle read response |\n| 0x0F | RDMA_READ_RESPONSE_LAST | Last read response |\n| 0x10 | RDMA_READ_RESPONSE_ONLY | Single read response |\n| 0x11 | ACK | Acknowledgment |\n| 0x12 | ATOMIC_ACK | Atomic acknowledgment |\n| 0x13 | CMP_SWAP | Compare and swap |\n| 0x14 | FETCH_ADD | Fetch and add |\n\n### 4.3 Extended Transport Headers\n\n| Header | File | Size | Description |\n|--------|------|------|-------------|\n| RETH | `reth.ksy` | 16 bytes | RDMA Extended Transport Header |\n| AETH | `aeth.ksy` | 4 bytes | ACK Extended Transport Header |\n| AtomicETH | `atomiceth.ksy` | 28 bytes | Atomic Extended Transport Header |\n| AtomicAckETH | `atomicacketh.ksy` | 8 bytes | Atomic ACK ETH |\n| DETH | `deth.ksy` | 8 bytes | Datagram Extended Transport Header |\n| ImmDt | `immdt.ksy` | 4 bytes | Immediate Data |\n| ICRC | `icrc.ksy` | 4 bytes | Invariant CRC |\n\n---\n\n## 5. Standard Ethernet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ethernet/`\n\n### 5.1 Ethernet II Frame\n\n**Datamodel**: `datamodel/protocols/ethernet/link/ethernet_ii.ksy`\n\n```\n+-----------------------------------------------------------------------------+\n| Preamble (7 bytes) + SFD (1 byte)  [not visible to software]               |\n+-----------------------------------------------------------------------------+\n| Ethernet Header (14 bytes)                                                  |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2)                            |\n+-----------------------------------------------------------------------------+\n| Optional VLAN Tag (4 bytes) - 802.1Q                                        |\n|   TPID (2) = 0x8100 | TCI (2) = PCP + DEI + VID                            |\n+-----------------------------------------------------------------------------+\n| Payload (46-1500 bytes, or up to 9000 for jumbo)                           |\n+-----------------------------------------------------------------------------+\n| FCS (4 bytes)                                                               |\n+-----------------------------------------------------------------------------+\n```\n\n### 5.2 Link Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| Ethernet II | `link/ethernet_ii.ksy` | Standard Ethernet frame |\n| VLAN 802.1Q | `link/vlan_802_1q.ksy` | VLAN tagging |\n\n### 5.3 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| IPv4 | `network/ipv4.ksy` | IPv4 header |\n| IPv6 | `network/ipv6.ksy` | IPv6 header |\n\n### 5.4 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| TCP | `transport/tcp.ksy` | TCP header |\n| UDP | `transport/udp.ksy` | UDP header |\n\n---\n\n## 6. Cornelis Proprietary Formats\n\n**Datamodel Directory**: `datamodel/protocols/cornelis/`\n\n### 6.1 Link Layer\n\n| Format | File | Size | Description |\n|--------|------|------|-------------|\n| UE+ Header | `link/ue_plus.ksy` | 12 bytes | Optimized L2 header |\n| Cornelis L2 Prefix | `link/cornelis_l2_prefix.ksy` | Variable | L2 prefix |\n\n### 6.2 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| UFH-16 | `network/ufh_16.ksy` | 16-bit forwarding header |\n| UFH-32 | `network/ufh_32.ksy` | 32-bit forwarding header |\n| Collective L2 | `network/collective_l2.ksy` | Collective operations header |\n| Scale-Up L2 | `network/scaleup_l2.ksy` | Scale-up deployments |\n\n#### 6.2.1 UFH-16 (Unified Forwarding Header 16-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_16.ksy`\n\nUFH-16 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 16-bit addressing.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |    Opaque (24-bit)    | Destination   |Opaque |Traffic|   Opaque      |    Source     |\n|[7:4]  |                       | (16-bit BE)   |[7:4]  |Class  |   (16-bit)    |  (16-bit BE)  |\n|SLAP   |                       |               |Z|Y|X|M|[7:0]  |               |               |\n|[3:0]  |                       |               |[3:0]  |       |               |               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1-3 | 24 | Opaque to hardware |\n| Destination | 4-5 | 16 | Destination endpoint address (big-endian) |\n| Opaque | 6 | [7:4] | Opaque to hardware |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Opaque | 8-9 | 16 | Opaque to hardware |\n| Source | 10-11 | 16 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-16 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5-14 | Reserved | Reserved for future use |\n| 15 | Extended | UFH-32 extension follows |\n\n**Usage**: Scale-up fabric forwarding, intra-pod communication, medium cluster networking (up to 65536 endpoints).\n\n#### 6.2.2 UFH-32 (Unified Forwarding Header 32-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_32.ksy`\n\nUFH-32 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 32-bit addressing for large-scale deployments.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |       |   Destination (32-bit BE)     |HopLim |Traffic|       Source (32-bit BE)      |\n|[7:4]  |Opaque |                               |[7:4]  |Class  |                               |\n|SLAP   |       |                               |Z|Y|X|M|[7:0]  |                               |\n|[3:0]  |       |                               |[3:0]  |       |                               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1 | [7:0] | Opaque to hardware |\n| Destination | 2-5 | 32 | Destination endpoint address (big-endian) |\n| Hop Limit | 6 | [7:4] | TTL/hop count |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Source | 8-11 | 32 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-32 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5 | Multicast | Multicast packet |\n| 6 | Barrier | Barrier synchronization |\n| 7 | Reduction | Reduction operation |\n| 8-14 | Reserved | Reserved for future use |\n| 15 | Vendor | Vendor-specific packet |\n\n**Usage**: Large-scale scale-up fabric forwarding (4+ billion endpoints), multi-pod communication, extended collective operations.\n\n### 6.3 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| CSIG+ | `transport/csig_plus.ksy` | Telemetry header |\n| PKEY | `transport/pkey.ksy` | Partition key |\n\n### 6.4 Encapsulation\n\n| Format | File | Description |\n|--------|------|-------------|\n| VxLAN+ | `encapsulation/vxlan_plus.ksy` | Extended VxLAN overlay |\n\n---\n\n## 7. Host-Software Interface (HSI) Formats\n\n**Datamodel Directory**: `datamodel/hw/asics/pmr/interfaces/host_interface/`\n\n### 7.1 Command Queue Segment (64 bytes)\n\n**Datamodel**: `command_queue_segment.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Bytes 2-3     | Bytes 4-7     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Opcode        | Flags         | Payload Len   | Reserved      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 8-15                    | Bytes 16-23                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Tag (64 bits)                 | Dest (64 bits)                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 24-31                   | Bytes 32-63                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Metadata (64 bits)            | Inline Data or SGL Entry      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n**Opcode Encoding**:\n| Bits | Field | Values |\n|------|-------|--------|\n| [7:4] | Family | MSG=0x1, TAGGED=0x2, RMA=0x3, ATOMIC=0x4 |\n| [3:2] | Variant | SEND=0, RECV=1, INJECT=2 |\n| [1] | Reserved | Must be 0 |\n| [0] | Data Source | INLINE=0, SGL=1 |\n\n### 7.2 Notification Formats\n\n| Format | File | Type | Size | Description |\n|--------|------|------|------|-------------|\n| Receive Notification | `receive_notification.ksy` | 0x00 | 64 bytes | Received message |\n| Send Completion | `send_completion.ksy` | 0x01 | 64 bytes | Send completed |\n| Event Notification | `event_notification.ksy` | 0x02 | 64 bytes | Async event |\n| Notification Entry | `notification_entry.ksy` | - | 64 bytes | Generic entry |\n| QW Violation Event | `qw_violation_event.ksy` | - | 64 bytes | QW alignment error |\n\n### 7.3 Receive Notification (64 bytes)\n\n**Datamodel**: `receive_notification.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x00 for receive |\n| flags | 1 | 1 | FI_INLINE, continuation |\n| status | 2 | 2 | Completion status |\n| src_id | 4 | 4 | Source endpoint ID |\n| tag | 8 | 8 | Tag value |\n| total_length | 16 | 4 | Payload length |\n| buffer_id_0 | 20 | 2 | First buffer ID |\n| buffer_id_1 | 22 | 2 | Second buffer ID |\n| buffer_offset | 24 | 2 | Offset in buffer |\n| reserved | 26 | 2 | Reserved |\n| inline_data | 28 | 35 | Inline payload |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.4 Send Completion (64 bytes)\n\n**Datamodel**: `send_completion.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x01 for send |\n| flags | 1 | 1 | Completion flags |\n| status | 2 | 2 | Completion status |\n| reserved_0 | 4 | 4 | Reserved |\n| op_context | 8 | 8 | Operation context |\n| bytes_sent | 16 | 4 | Bytes transferred |\n| reserved_1 | 20 | 43 | Reserved |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.5 Other HSI Formats\n\n| Format | File | Description |\n|--------|------|-------------|\n| SGL Entry | `sgl_entry.ksy` | Scatter-gather list entry |\n| PCIe Descriptors | `pcie/descriptors.ksy` | PCIe interface descriptors |\n\n---\n\n## 8. IP Block Descriptors\n\n**Datamodel Directory**: `datamodel/hw/ip/cornelis/`\n\n### 8.1 Collectives Engine (CE)\n\n**Datamodel**: `ce/descriptors.ksy`\n\nThe Collectives Engine uses RISC-V vector cores (VLEN=512) for hardware-accelerated collective operations.\n\n### 8.2 Electric Creek (EC)\n\n**Datamodel**: `ec/descriptors.ksy`\n\nElectric Creek is the management complex shared between PMR NIC and LNR Switch.\n\n---\n\n## 9. Work List\n\nThis section tracks issues requiring follow-up investigation or specification updates.\n\n### 9.1 Open Issues\n\n| ID | Priority | Category | Description | Status | Opened | Closed |\n|----|----------|----------|-------------|--------|--------|--------|\n| W-06-001 | Medium | Datamodel | UFH-32 lacks 16-bit entropy field; per-packet ECMP not supported; switch must derive entropy from Src+Dest hash | Deferred | 2026-01-20 | - |\n| W-07-001 | Low | Datamodel | `ack_cc.ksy` shows `ack_cc_state` as 32-bit (4 bytes) but UE Spec Table 3-36 shows 64-bit (8 bytes); verify field size | Investigation | 2026-01-22 | - |\n| W-07-002 | Low | Documentation | `collective_l2.ksy` and `scaleup_l2.ksy` marked as \"work_in_progress\" with spec_version 0.1; specifications incomplete | Spec Update | 2026-01-22 | - |\n| W-07-003 | Low | Datamodel | `ue_plus.ksy` 9-bit length field split across bytes 0-1 with unusual encoding (1 bit in byte 0, 8 bits in byte 1); verify encoding matches UE Spec | Investigation | 2026-01-22 | - |\n| W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |\n| W-05-002 | Medium | Specification | MTU values: Verify maximum MTU for each protocol | Investigation | 2026-01-10 | - |\n| W-05-003 | Medium | Documentation | CMS detailed formats: Need comprehensive documentation | Spec Update | 2026-01-10 | - |\n| W-03-002 | Low | Terminology | PDP vs PDS naming: UML uses both terms inconsistently | Spec Update | 2026-01-08 | - |\n| W-03-006 | Low | Terminology | SES vs SE: \"SES Processing Groups\" vs \"Semantic Engines\" | Spec Update | 2026-01-08 | - |\n\n### 9.2 Datamodel Gaps\n\n| ID | Priority | Description | Target Location | Status | Opened | Closed |\n|----|----------|-------------|-----------------|--------|--------|--------|\n| D-001 | High | PMR CSR definitions missing from datamodel | `datamodel/hw/asics/pmr/csrs/*.rdl` | Spec Update | 2026-01-10 | - |\n| D-002 | Medium | PMR block hierarchy YAML incomplete | `datamodel/hw/asics/pmr/blocks.yaml` | Spec Update | 2026-01-10 | - |\n| D-003 | Medium | PMR interface contracts missing | `datamodel/views/contracts/pmr-*.puml` | Spec Update | 2026-01-10 | - |\n\n### 9.3 Specification Clarifications Needed\n\n| ID | Priority | Question | Context | Status | Opened | Closed |\n|----|----------|----------|---------|--------|--------|--------|\n| Q1 | Medium | Lightweight Interface Scope | What features should be reduced in lightweight mode? | Investigation | 2026-01-10 | - |\n| Q2 | Medium | Tag Table Sizing | Should HW tag table size be per-endpoint configurable? | Investigation | 2026-01-10 | - |\n| Q3 | Medium | Multi-Packet Eager Messages | Should hardware support multi-packet eager messages? | Investigation | 2026-01-10 | - |\n| Q4 | Low | RoCE Work Queue Implementation | Confirm RoCE WQ/CQ are software-implemented | Investigation | 2026-01-10 | - |\n\n### 9.4 Closed Issues\n\n| ID | Priority | Category | Description | Resolution | Opened | Closed |\n|----|----------|----------|-------------|------------|--------|--------|\n| W-05-001 | Medium | Documentation | UE taxonomy reference | Documented in `05-packet-formats.md` | 2026-01-08 | 2026-01-10 |\n| W-02-005 | Medium | Documentation | Protocol support documentation | Documented UE+, RoCEv2, Ethernet | 2026-01-08 | 2026-01-10 |\n| W-02-006 | Medium | Documentation | Cornelis Collective Reduction Protocol | Documented in HAS §2.5.4 | 2026-01-08 | 2026-01-10 |\n| W-03-001 | Medium | Architecture | Semantic Engine count | Confirmed 64 (8x8) in UML and HAS | 2026-01-08 | 2026-01-10 |\n| W-17-005 | Low | Documentation | Port subdivision note | Added to HAS Ch17 | 2026-01-11 | 2026-01-11 |\n| W-17-006 | Medium | Documentation | MPORT interface documentation | Documented 256B @ 1.66 GHz | 2026-01-11 | 2026-01-11 |\n| W-04-005 | High | Datamodel | `ufh_16.ksy` address size: Datamodel shows 12-bit dest, should be 16-bit | UFH-16 restructured to 12-byte Ethernet MAC overlay with 16-bit destination (bytes 4-5) and 16-bit source (bytes 10-11) | 2026-01-10 | 2026-01-20 |\n| W-04-006 | High | Datamodel | `ufh_32.ksy` address size: Datamodel shows 16-bit dest, should be 32-bit | UFH-32 restructured to 12-byte Ethernet MAC overlay with 32-bit destination (bytes 2-5) and 32-bit source (bytes 8-11) | 2026-01-10 | 2026-01-20 |\n\n### 9.5 Change Log\n\n| Date | Change | Details |\n|------|--------|---------|\n| 2026-01-14 | Initial creation | Document created with PMR packet taxonomy |\n| 2026-01-20 | Review and update | Added UALink section (reference only, not PMR-supported); Added change log; Updated datamodel file counts; No new .ksy files since initial creation |\n| 2026-01-20 | UFH format details | Added detailed UFH-16 and UFH-32 format documentation in Section 6.2 (wire diagrams, field tables, type enumerations) |\n| 2026-01-20 | UFH restructuring | UFH-16 and UFH-32 restructured to 12-byte Ethernet MAC overlays; UFH-16 now 16-bit addressing, UFH-32 now 32-bit addressing; Added SLAP field constraints (Z,Y,X=001); Updated datamodel .ksy files; Closed W-04-005 and W-04-006 |\n| 2026-01-22 | Datamodel review | Added W-07-001 (ack_cc_state size mismatch), W-07-002 (collective/scaleup specs incomplete), W-07-003 (ue_plus length encoding); Identified 30+ packet formats requiring expansion |\n\n---\n\n## 10. UALink Protocol (Reference Only)\n\n**Note**: UALink is defined in the datamodel but is **NOT currently supported by PMR**. It is included here for reference as it may be relevant for future AI/ML accelerator interconnect work.\n\n**Datamodel Directory**: `datamodel/protocols/ualink/`\n\n### 10.1 UALink Overview\n\nUALink is an AI/ML accelerator interconnect protocol with 38 packet definitions across all OSI layers.\n\n| Layer | Count | Key Formats |\n|-------|-------|-------------|\n| UPLI (Upper Protocol Layer Interface) | 8 | commands.ksy, request_channel.ksy, status_codes.ksy |\n| Transaction | 9 | tl_flit.ksy, control_half_flit.ksy, data_half_flit.ksy |\n| Data Link | 12 | dl_flit.ksy, segment_header.ksy, crc.ksy, control_messages.ksy |\n| Physical | 4 | alignment_markers.ksy, control_ordered_sets.ksy, link_training.ksy |\n| Security | 5 | authentication.ksy, encryption.ksy, key_derivation.ksy |\n\n### 10.2 UALink Packet Formats\n\n#### UPLI Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Commands | `upli/commands.ksy` | UPLI command definitions |\n| Request Channel | `upli/request_channel.ksy` | Request channel format |\n| Originator Data | `upli/originator_data_channel.ksy` | Originator data channel |\n| Read Response | `upli/read_response_channel.ksy` | Read response channel |\n| Write Response | `upli/write_response_channel.ksy` | Write response channel |\n| Status Codes | `upli/status_codes.ksy` | Status code definitions |\n| Connection Handshake | `upli/protocols/connection_handshake.ksy` | Connection setup |\n| Flow Control | `upli/protocols/flow_control.ksy` | Flow control protocol |\n\n#### Transaction Layer\n| Format | File | Description |\n|--------|------|-------------|\n| TL Flit | `transaction/tl_flit.ksy` | Transaction layer flit |\n| Control Half Flit | `transaction/control_half_flit.ksy` | Control half flit |\n| Data Half Flit | `transaction/data_half_flit.ksy` | Data half flit |\n| Message Half Flit | `transaction/message_half_flit.ksy` | Message half flit |\n| Request Field | `transaction/request_field.ksy` | Request field format |\n| Response Field | `transaction/response_field.ksy` | Response field format |\n| Flow Control Field | `transaction/flow_control_field.ksy` | Flow control field |\n| Compression | `transaction/protocols/compression.ksy` | Data compression |\n| Address Cache | `transaction/protocols/address_cache.ksy` | Address caching |\n\n#### Data Link Layer\n| Format | File | Description |\n|--------|------|-------------|\n| DL Flit | `datalink/dl_flit.ksy` | Data link flit |\n| Flit Header | `datalink/flit_header.ksy` | Flit header format |\n| Segment Header | `datalink/segment_header.ksy` | Segment header |\n| CRC | `datalink/crc.ksy` | CRC calculation |\n| Control Messages | `datalink/messages/control_messages.ksy` | Control messages |\n| Basic Messages | `datalink/messages/basic_messages.ksy` | Basic messages |\n| UART Messages | `datalink/messages/uart_messages.ksy` | UART messages |\n| Vendor Defined | `datalink/messages/vendor_defined.ksy` | Vendor extensions |\n| Link Resiliency | `datalink/protocols/link_resiliency.ksy` | Link resiliency |\n| Link Level Replay | `datalink/protocols/link_level_replay.ksy` | Replay protocol |\n| Link State | `datalink/protocols/link_state.ksy` | Link state machine |\n| Link Folding | `datalink/protocols/link_folding.ksy` | Link folding |\n\n#### Physical Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Alignment Markers | `physical/alignment_markers.ksy` | Lane alignment |\n| Control Ordered Sets | `physical/control_ordered_sets.ksy` | Control sequences |\n| Reconciliation Sublayer | `physical/reconciliation_sublayer.ksy` | RS sublayer |\n| Link Training | `physical/protocols/link_training.ksy` | Link training |\n\n#### Security Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Authentication | `security/authentication.ksy` | Authentication |\n| Encryption | `security/encryption.ksy` | Encryption format |\n| IV Format | `security/iv_format.ksy` | Initialization vector |\n| Key Derivation | `security/protocols/key_derivation.ksy` | Key derivation |\n| Key Rotation | `security/protocols/key_rotation.ksy` | Key rotation |\n\n---\n\n## 11. References\n\n### Internal Documents\n- `docs/HAS/PMR/05-packet-formats.md` - PMR HAS Chapter 5\n- `docs/HAS/PMR/WORK.md` - PMR HAS Work Tracking\n- `.specify/memory/constitution.md` - Project Constitution\n\n### Datamodel Locations\n- `datamodel/protocols/ue/` - Ultra Ethernet protocols (94 .ksy files)\n- `datamodel/protocols/roce/` - RoCEv2 protocols (8 .ksy files)\n- `datamodel/protocols/ethernet/` - Standard Ethernet (6 .ksy files)\n- `datamodel/protocols/cornelis/` - Cornelis proprietary (9 .ksy files)\n- `datamodel/protocols/ualink/` - UALink protocols (38 .ksy files) - NOT supported by PMR\n- `datamodel/hw/asics/pmr/` - PMR ASIC definitions\n\n### External Specifications\n- [Ultra Ethernet Specification v1.0.1](https://ultraethernet.org/)\n- [InfiniBand Architecture Specification](https://www.infinibandta.org/)\n- IEEE 802.3 Ethernet Standard\n- UALink Specification (Ultra Accelerator Link)\n",
                "after": "# PMR (CN7000) Packet Format Taxonomy\n\n**Document**: Packet formats supported by PMR NIC ASIC  \n**Generated**: 2026-01-14  \n**Last Reviewed**: 2026-01-20  \n**Source**: `datamodel/` directory in EarlySim repository  \n**Reference**: `docs/HAS/PMR/05-packet-formats.md`\n\n---\n\n## Table of Contents\n\n1. [Overview](#1-overview)\n2. [Protocol Stack Summary](#2-protocol-stack-summary)\n3. [Ultra Ethernet+ (UE+) Formats](#3-ultra-ethernet-ue-formats)\n4. [RoCEv2 Formats](#4-rocev2-formats)\n5. [Standard Ethernet Formats](#5-standard-ethernet-formats)\n6. [Cornelis Proprietary Formats](#6-cornelis-proprietary-formats)\n7. [Host-Software Interface (HSI) Formats](#7-host-software-interface-hsi-formats)\n8. [IP Block Descriptors](#8-ip-block-descriptors)\n9. [Work List](#9-work-list)\n10. [UALink Protocol (Reference Only)](#10-ualink-protocol-reference-only)\n11. [References](#11-references)\n\n---\n\n## 1. Overview\n\nPMR (Prism River) is Cornelis Networks' 1.6 Tbps NIC ASIC (CN7000 product family). It supports multiple wire protocols with per-packet protocol selection on a single physical port.\n\n### Supported Protocols\n\n| Protocol | Version | Status | Description |\n|----------|---------|--------|-------------|\n| Ultra Ethernet+ | 1.0.1 | Full | Optimized UE with Cornelis extensions |\n| RoCEv2 | v2 | Full | RDMA over Converged Ethernet |\n| Standard Ethernet | IEEE 802.3 | Full | Traditional Ethernet with offloads |\n| Cornelis Proprietary | 1.0.0 | Full | UFH, CSIG+, VxLAN+, Collectives |\n\n### Header Efficiency Comparison\n\n| Protocol Stack | Total Headers | Efficiency (4KB payload) |\n|----------------|---------------|--------------------------|\n| UE+ (small msg) | ~20 bytes | 99.5% |\n| UE+ (standard) | ~40 bytes | 99.0% |\n| RoCEv2 (IPv4) | ~58 bytes | 98.6% |\n| RoCEv2 (IPv6) | ~78 bytes | 98.1% |\n\n---\n\n## 2. Protocol Stack Summary\n\n```\n+-----------------------------------------------------------------------------+\n|                           Application Layer                                  |\n|                    (Libfabric, Verbs, Sockets, DPDK)                         |\n+-----------------------------------------------------------------------------+\n|                           Transport Layer                                    |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UE Transport   |  |     RoCEv2       |  |    TCP/UDP       |            |\n|  |   (SES/PDS/CMS)  |  |   (BTH/RETH)     |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                           Network Layer                                      |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UFH-16/32      |  |   IPv4/IPv6      |  |   IPv4/IPv6      |            |\n|  |   (Cornelis)     |  |   + UDP          |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                            Link Layer                                        |\n|  +------------------+  +------------------+  +------------------+            |\n|  |      UE+         |  |   Ethernet II    |  |   Ethernet II    |            |\n|  |   (12 bytes)     |  |   (14 bytes)     |  |   (14 bytes)     |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                          Physical Layer                                      |\n|                    Hill Creek (212.5G x8 PAM4 SerDes)                        |\n+-----------------------------------------------------------------------------+\n      Ultra Ethernet+           RoCEv2              Standard Ethernet\n```\n\n---\n\n## 3. Ultra Ethernet+ (UE+) Formats\n\n### 3.1 UE+ L2 Header (12 bytes)\n\n**Datamodel**: `datamodel/protocols/cornelis/link/ue_plus.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Byte 2        | Byte 3        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n|L2|V|zyxm|Len  | Length[7:0]   | RC    | SC    | Hop Count     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 4        | Byte 5        | Byte 6        | Byte 7        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Dest LID [15:8]               | Dest LID [7:0]                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Entropy [15:8]                | Entropy [7:0]                 |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 8        | Byte 9        | Byte 10       | Byte 11       |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Source LID [15:8]             | Source LID [7:0]              |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Payload Type [15:8]           | Payload Type [7:0]            |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| L2 Type | 2 | Always 0b10 for UE+ |\n| Version | 1 | Protocol version |\n| zyxm | 4 | Routing control flags (multicast, adaptive) |\n| Length | 9 | Packet length in bytes |\n| RC | 4 | Routing Class (QoS) |\n| SC | 4 | Service Class |\n| Hop | 8 | TTL/hop count |\n| Dest LID | 16 | Destination Local Identifier |\n| Entropy | 16 | ECMP hash for load balancing |\n| Source LID | 16 | Source Local Identifier |\n| Type | 16 | Payload type (EtherType equivalent) |\n\n**Payload Types**:\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x0800 | IPv4 | IPv4 payload |\n| 0x86DD | IPv6 | IPv6 payload |\n| 0x8100 | VLAN | VLAN tagged frame |\n| 0x9000 | VxLAN+ | VxLAN+ encapsulated |\n| 0x9100 | CSIG+ | CSIG+ telemetry |\n| 0xC000 | UE PDS | Ultra Ethernet PDS |\n\n### 3.2 PDS (Packet Delivery Sublayer) Prologue (2 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/prologue.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0                        | Byte 1                        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| type[4:0] | next_hdr/ctl[3:0] | flags[6:0]                    |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| PDS Type | Value | Description |\n|----------|-------|-------------|\n| Reserved | 0 | Reserved |\n| TSS | 1 | Transport Security (encryption) |\n| RUD Request | 2 | Reliable Unordered Delivery |\n| ROD Request | 3 | Reliable Ordered Delivery |\n| RUDI Request | 4 | Reliable Unordered Immediate |\n| RUDI Response | 5 | RUDI response |\n| UUD Request | 6 | Unreliable Unordered Delivery |\n| ACK | 7 | Acknowledgment |\n| ACK_CC | 8 | ACK with congestion control |\n| ACK_CCX | 9 | ACK with extended CC |\n| NACK | 10 | Negative acknowledgment |\n| CP | 11 | Control packet |\n| NACK_CCX | 12 | NACK with extended CC |\n| RUD_CC_REQ | 13 | RUD with CC state |\n| ROD_CC_REQ | 14 | ROD with CC state |\n\n### 3.3 PDS Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/pds/`\n\n```\nPDS Request/Response Relationships:\n┌─────────────────────────────────────────────────────────────────┐\n│                                                                 │\n│  UUD Request (0x06) ──────────────────────→ (no response)       │\n│                                                                 │\n│  RUDI Request (0x04) ─────────────────────→ RUDI Response (0x05)│\n│                       └───────────────────→ NACK (0x0A)         │\n│                                                                 │\n│  RUD Request (0x01) ──┬───────────────────→ ACK (0x07)          │\n│                       ├───────────────────→ ACK_CC (0x08)       │\n│                       ├───────────────────→ ACK_CCX (0x09)      │\n│                       ├───────────────────→ NACK (0x0A)         │\n│                       └───────────────────→ NACK_CCX (0x0C)     │\n│                                                                 │\n│  ROD Request (0x02) ──┴───────────────────→ (same as RUD)       │\n│                                                                 │\n│  Control Packet (0x0B) ───────────────────→ (varies by subtype) │\n│                                                                 │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n| Type | Format | File | Size | Description |\n|------|--------|------|------|-------------|\n| 0x01 | RUD Request | `rud_rod_request.ksy` | 12 bytes | Reliable Unordered Delivery |\n| 0x02 | ROD Request | `rud_rod_request.ksy` | 12 bytes | Reliable Ordered Delivery |\n| 0x04 | RUDI Request | `rudi_request_response.ksy` | 6 bytes | Reliable Unordered Immediate |\n| 0x05 | RUDI Response | `rudi_request_response.ksy` | 6 bytes | RUDI response |\n| 0x06 | UUD Request | `uud_request.ksy` | 6 bytes | Unreliable Unordered Delivery |\n| 0x07 | ACK | `rud_rod_ack.ksy` | 12 bytes | Acknowledgment |\n| 0x08 | ACK_CC | `ack_cc.ksy` | 28 bytes | ACK with CC state |\n| 0x09 | ACK_CCX | `ack_ccx.ksy` | 44 bytes | ACK with extended CC |\n| 0x0A | NACK | `nack.ksy` | 12 bytes | Negative acknowledgment |\n| 0x0B | CP | `rud_rod_cp.ksy` | 12 bytes | Control packet (10 subtypes) |\n| 0x0C | NACK_CCX | `nack_ccx.ksy` | 28 bytes | NACK with extended CC |\n\n#### 3.3.1 RUD Request (Type 0x01, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_request.ksy`  \n**Related Formats**: [ROD Request (3.3.2)](#332-rod-request-type-0x02-12-bytes) | [ACK (3.3.6)](#336-ack-type-0x07-12-bytes) | [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |nxt|flg|       clear_psn_offset |         PSN [31:0]    →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|r|a|s|rsvd|\n       | (5 bits)|(4 bit)| (2) |t|r|y|(2) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x01 (RUD) | Must be 0x01 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 2 | 1[6:5] | Reserved | Must be 0 |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.ar | 1 | 1[3] | ACK request | 0=no ACK, 1=request ACK |\n| flags.syn | 1 | 1[2] | PDC establishment | 0=normal, 1=SYN |\n| flags.rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n| clear_psn_offset | 16 | 2-3 | CLEAR_PSN relative to PSN | Unsigned offset |\n| psn | 32 | 4-7 | Packet Sequence Number | 32-bit, wraps |\n| spdcid | 16 | 8-9 | Source PDCID | Valid PDCID |\n| dpdcid | 16 | 10-11 | Destination PDCID | See note below |\n\n##### Field Notes\n\n**dpdcid Interpretation** (depends on `syn` flag):\n- `syn=0`: Destination PDCID for established PDC\n- `syn=1`: `{pdc_info[3:0], psn_offset[11:0]}` for PDC establishment\n  - `pdc_info[0]`: use_rsv_pdc (1=reserved pool, 0=shared pool)\n  - `pdc_info[3:1]`: Reserved\n  - `psn_offset[11:0]`: Difference between PSN and Start_PSN\n\n**clear_psn_offset**: Computed as `CLEAR_PSN = PSN - clear_psn_offset`. Indicates the highest PSN that has been delivered to SES at the source.\n\n##### Protocol Behavior\n\n**Delivery Mode**: RUD (Reliable Unordered Delivery) provides reliable packet delivery without ordering guarantees. Packets may be delivered to SES out of order.\n\n**State Machine**: RUD operates within the PDC (Packet Delivery Channel) state machine defined in Section 3.5.7.\n\n**Transmission Rules**:\n1. Source assigns monotonically increasing PSN to each packet\n2. `ar` flag SHOULD be set periodically (per `ack_request_interval`)\n3. `retx` flag set when retransmitting due to timeout or NACK\n4. `syn` flag set only for first packet establishing new PDC\n\n**Receiver Processing**:\n1. Validate PDCID and PSN\n2. If PSN is new: deliver to SES immediately (no ordering)\n3. If PSN is duplicate: discard, optionally send ACK\n4. If `ar=1`: generate ACK, ACK_CC, or ACK_CCX response\n\n**Timing Constraints**:\n- Retransmit timeout: Implementation-defined (typically RTT-based)\n- ACK coalescing: Up to `ack_coalesce_count` packets\n\n**Reference**: UE Spec v1.0.1, Table 3-33, Section 3.5.10.3, Page 256\n\n---\n\n#### 3.3.2 ROD Request (Type 0x02, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_request.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [ACK (3.3.6)](#336-ack-type-0x07-12-bytes) | [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\nIdentical to RUD Request (Section 3.3.1) with `type = 0x02`.\n\n##### Field Definitions\n\nSame as RUD Request. Only `type` field differs.\n\n##### Protocol Behavior\n\n**Delivery Mode**: ROD (Reliable Ordered Delivery) provides reliable packet delivery with strict ordering guarantees. Packets are delivered to SES in PSN order.\n\n**Key Difference from RUD**: ROD receiver MUST buffer out-of-order packets and deliver to SES only when all preceding PSNs have been received.\n\n**Ordering Guarantee**:\n- Receiver maintains expected PSN\n- Out-of-order packets are buffered (not delivered)\n- When gap is filled, buffered packets delivered in order\n- Head-of-line blocking possible if packet lost\n\n**Use Cases**:\n- Multi-packet messages requiring in-order delivery\n- Streaming data with ordering requirements\n- Operations where partial delivery is not acceptable\n\n**Reference**: UE Spec v1.0.1, Table 3-33, Section 3.5.10.3, Page 256\n\n---\n\n#### 3.3.3 RUDI Request (Type 0x04, 6 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rudi_request_response.ksy`  \n**Related Formats**: [RUDI Response (3.3.4)](#334-rudi-response-type-0x05-6-bytes) | [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5\n     +-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  |         pkt_id [31:0]     |\n     +-------+-------+-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|r|retx|rsvd|\n       | (5 bits)|(4 bit)| (1) |m| (1)|(4) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x04 (RUDI Request) | Must be 0x04 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.rsvd_m | 1 | 1[5] | Reserved (m for response) | Must be 0 for request |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.rsvd | 4 | 1[3:0] | Reserved | Must be 0 |\n| pkt_id | 32 | 2-5 | Packet Identifier | Locally unique |\n\n##### Protocol Behavior\n\n**Delivery Mode**: RUDI (Reliable Unordered Delivery with Idempotence) provides reliable delivery for idempotent operations without PDC context.\n\n**Key Characteristics**:\n- Uses packet ID instead of sequence number\n- No PDC (Packet Delivery Context) required\n- Idempotent: safe to retry without side effects\n- Smaller header (6 bytes vs 12 bytes for RUD/ROD)\n\n**Idempotence Guarantee**:\n- Receiver tracks recently processed pkt_ids\n- Duplicate pkt_ids are detected and response re-sent\n- No state corruption from retransmissions\n\n**Use Cases**:\n- Small, self-contained operations\n- Stateless request/response patterns\n- Operations where retry is safe (reads, idempotent writes)\n\n**Reference**: UE Spec v1.0.1, Table 3-39, Section 3.5.10.9, Page 262\n\n---\n\n#### 3.3.4 RUDI Response (Type 0x05, 6 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rudi_request_response.ksy`  \n**Related Formats**: [RUDI Request (3.3.3)](#333-rudi-request-type-0x04-6-bytes)\n\n##### Wire Format\n\nIdentical to RUDI Request with `type = 0x05` and `flags.m` valid.\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x05 (RUDI Response) | Must be 0x05 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.m | 1 | 1[5] | ECN marked | 1 if request was ECN marked |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.rsvd | 4 | 1[3:0] | Reserved | Must be 0 |\n| pkt_id | 32 | 2-5 | Packet Identifier | Echoed from request |\n\n##### Protocol Behavior\n\n**Response Generation**:\n1. Receiver processes RUDI Request\n2. Generates RUDI Response with same pkt_id\n3. Sets `m` flag if request packet was ECN marked\n\n**Reference**: UE Spec v1.0.1, Table 3-39, Section 3.5.10.9, Page 262\n\n---\n\n#### 3.3.5 UUD Request (Type 0x06, 6 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/uud_request.ksy`  \n**Related Formats**: None (no response generated)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5\n     +-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  |         pkt_id [31:0]     |\n     +-------+-------+-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr|     rsvd (7)    |\n       | (5 bits)|(4 bit)|                 |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x06 (UUD) | Must be 0x06 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 7 | 1[6:0] | Reserved | Must be 0 |\n| pkt_id | 32 | 2-5 | Packet Identifier | Locally unique |\n\n##### Protocol Behavior\n\n**Delivery Mode**: UUD (Unreliable Unordered Delivery) provides best-effort delivery with no reliability guarantees.\n\n**Key Characteristics**:\n- No ACKs or NACKs generated\n- No retransmissions\n- Packet loss is acceptable\n- Lowest overhead delivery mode\n\n**Use Cases**:\n- Loss-tolerant traffic (video streaming, telemetry)\n- High-frequency updates where latest value matters\n- Multicast/broadcast scenarios\n\n**Reference**: UE Spec v1.0.1, Table 3-42, Section 3.5.10.12, Page 265\n\n---\n\n#### 3.3.6 ACK (Type 0x07, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_ack.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [ACK_CC (3.3.7)](#337-ack_cc-type-0x08-28-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  |   ack_psn_offset  |    probe_opaque     →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |   cack_psn    |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|m|r|p|req|rsvd|\n       | (5 bits)|(4 bit)| (1) | |t| |   |(1) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x07 (ACK) | Must be 0x07 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | UET_HDR_NONE |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.m | 1 | 1[5] | ECN marked | 1 if any ACK'd packet was ECN marked |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.p | 1 | 1[3] | Probe response | 1 if responding to Probe CP |\n| flags.req | 2 | 1[2:1] | Request type | 0=RUD, 1=ROD |\n| flags.rsvd | 1 | 1[0] | Reserved | Must be 0 |\n| ack_psn_offset | 16 | 2-3 | Offset from CACK_PSN to ACK_PSN | Signed |\n| probe_opaque | 16 | 4-5 | Copied from Probe CP | Opaque value |\n| cack_psn | 32 | 6-9 | Cumulative ACK PSN | Highest in-order PSN |\n| spdcid | 16 | 10-11 | Source PDCID | Swapped from request |\n| dpdcid | 16 | 12-13 | Destination PDCID | Swapped from request |\n\n**Note**: Wire format shows 12 bytes but field table shows 14 bytes. Verify against spec - likely cack_psn is 16 bits or spdcid/dpdcid share bytes 10-11.\n\n##### Protocol Behavior\n\n**ACK Generation**:\n1. Receiver tracks highest in-order PSN received (CACK_PSN)\n2. ACK generated when `ar` flag set in request, or periodically\n3. `m` flag set if any ACK'd packet had ECN marking\n\n**Cumulative ACK**:\n- `cack_psn` acknowledges all PSNs ≤ this value\n- Sender can free buffers for acknowledged packets\n- Enables sliding window flow control\n\n**Reference**: UE Spec v1.0.1, Table 3-35, Section 3.5.10.5, Page 258\n\n---\n\n#### 3.3.7 ACK_CC (Type 0x08, 28 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/ack_cc.ksy`  \n**Related Formats**: [ACK (3.3.6)](#336-ack-type-0x07-12-bytes) | [ACK_CCX (3.3.8)](#338-ack_ccx-type-0x09-44-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |                    ACK Header (12 bytes)                      |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |  (ACK cont'd) |cc_typ|cc_flg|  mpr  | sack_psn_offset       →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |              sack_bitmap [63:0]                               |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        24      25      26      27\n     +-------+-------+-------+-------+\n     |       ack_cc_state [63:0]     |\n     +-------+-------+-------+-------+\n```\n\n##### Field Definitions (CC Extension, bytes 12-27)\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| cc_type | 4 | 12[7:4] | CC algorithm type | Per Section 3.6.9 |\n| cc_flags | 4 | 12[3:0] | CC flags | Reserved, must be 0 |\n| mpr | 8 | 13 | Maximum PSN Range | Flow control window |\n| sack_psn_offset | 16 | 14-15 | Offset to SACK base PSN | Signed |\n| sack_bitmap | 64 | 16-23 | Selective ACK bitmap | 1=ACK'd, 0=not ACK'd |\n| ack_cc_state | 64 | 24-27 | CC state (per cc_type) | See Section 3.6.9 |\n\n##### CC Type Values\n\n| Value | Name | Description |\n|-------|------|-------------|\n| 0x0 | CC_NSCC | Network-Signaled Congestion Control |\n| 0x1 | CC_CREDIT | RCCC/TFC Credit-based CC |\n\n##### Protocol Behavior\n\n**Selective ACK (SACK)**:\n- `sack_bitmap` covers 64 PSNs starting at `CACK_PSN + sack_psn_offset`\n- Bit N = 1 means PSN (base + N) received\n- Enables efficient loss recovery without full retransmit\n\n**Congestion Control State**:\n- `ack_cc_state` interpretation depends on `cc_type`\n- For NSCC: Contains service_time, rcv_cwnd_pend, rcvd_bytes, ooo_count\n- For CREDIT: Contains credit information\n\n**Reference**: UE Spec v1.0.1, Table 3-36, Section 3.5.10.6, Page 259\n\n---\n\n#### 3.3.8 ACK_CCX (Type 0x09, 44 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/ack_ccx.ksy`  \n**Related Formats**: [ACK_CC (3.3.7)](#337-ack_cc-type-0x08-28-bytes)\n\n##### Wire Format\n\nACK_CCX extends ACK_CC with additional 16 bytes for extended CC state.\n\n```\nBytes 0-27:  ACK_CC header (28 bytes)\nBytes 28-43: Extended CC state (16 bytes)\n```\n\n##### Additional Fields (bytes 28-43)\n\n| Field | Bits | Offset | Description |\n|-------|------|--------|-------------|\n| ack_ccx_state | 128 | 28-43 | Extended CC state |\n\n##### Protocol Behavior\n\n**Extended State**: ACK_CCX provides additional CC state for algorithms requiring more than 64 bits of feedback.\n\n**Reference**: UE Spec v1.0.1, Table 3-37, Section 3.5.10.7, Page 260\n\n---\n\n#### 3.3.9 NACK (Type 0x0A, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/nack.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [NACK_CCX (3.3.10)](#3310-nack_ccx-type-0x0c-28-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  | nack_code |vendor_code|   nack_psn [31:0] →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|m|r|nt|rsvd|\n       | (5 bits)|(4 bit)| (1) | |t|  |(3) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x0A (NACK) | Must be 0x0A |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | UET_HDR_NONE |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.m | 1 | 1[5] | ECN marked | 1 if request was ECN marked |\n| flags.retx | 1 | 1[4] | Retransmit indicator | From request |\n| flags.nt | 1 | 1[3] | NACK type | 0=RUD/ROD, 1=RUDI |\n| flags.rsvd | 3 | 1[2:0] | Reserved | Must be 0 |\n| nack_code | 8 | 2 | NACK reason code | Per Table 3-59 |\n| vendor_code | 8 | 3 | Vendor-specific code | Optional |\n| nack_psn | 32 | 4-7 | NACK'd PSN or pkt_id | Depends on nt flag |\n| spdcid | 16 | 8-9 | Source PDCID | 0 if nt=1 or PDC failure |\n| dpdcid | 16 | 10-11 | Destination PDCID | 0 if nt=1 |\n\n##### NACK Codes (Table 3-59)\n\n| Code | Name | Description |\n|------|------|-------------|\n| 0x00 | UET_NO_PKT_BUF | No packet buffer available |\n| 0x01 | UET_TRIMMED | Packet was trimmed |\n| 0x02 | UET_NO_PDC_AVAIL | No PDC resources available |\n| 0x03 | UET_INV_DPDCID | Invalid destination PDCID |\n| 0x04 | UET_PDC_HDR_MISMATCH | PDC header mismatch |\n| 0x05 | UET_PSN_OOR_WINDOW | PSN outside expected window |\n| 0x06 | UET_PSN_GAP | PSN gap detected (packet loss) |\n\n##### Protocol Behavior\n\n**NACK Generation**:\n1. Receiver detects error condition (loss, resource exhaustion, etc.)\n2. Generates NACK with appropriate nack_code\n3. Sender receives NACK and takes corrective action\n\n**Sender Response to NACK**:\n- `UET_PSN_GAP`: Retransmit missing packets\n- `UET_NO_PKT_BUF`: Back off, retry later\n- `UET_NO_PDC_AVAIL`: PDC establishment failed, retry or abort\n\n**Reference**: UE Spec v1.0.1, Table 3-40, Section 3.5.10.10, Page 263\n\n---\n\n#### 3.3.10 NACK_CCX (Type 0x0C, 28 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/nack_ccx.ksy`  \n**Related Formats**: [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\nNACK_CCX extends NACK with 16 bytes of CC state (similar to ACK_CC extension).\n\n```\nBytes 0-11:  NACK header (12 bytes)\nBytes 12-27: CC extension (16 bytes)\n```\n\n##### Protocol Behavior\n\n**Extended NACK**: NACK_CCX provides congestion control feedback along with the negative acknowledgment, enabling the sender to adjust its rate while handling the error.\n\n**Reference**: UE Spec v1.0.1, Table 3-41, Section 3.5.10.11, Page 264\n\n---\n\n#### 3.3.11 Control Packet (Type 0x0B, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_cp.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [ACK (3.3.6)](#336-ack-type-0x07-12-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |ctl|  flags  |   probe_opaque    |         PSN [31:0]  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |ctl_typ| rsvd|i|r|a|s|rsvd|\n       | (5 bits)|(4 bit)| (1) |r|t|r|y|(2) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x0B (CP) | Must be 0x0B |\n| ctl_type | 4 | 0[2:0]+1[7] | Control packet subtype | 0-9 defined |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.isrod | 1 | 1[5] | ROD indicator | 1=ROD, 0=RUD (for NOOP/Negotiation) |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.ar | 1 | 1[3] | ACK request | 0=no ACK, 1=request ACK |\n| flags.syn | 1 | 1[2] | PDC establishment | 0=normal, 1=SYN |\n| flags.rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n| probe_opaque | 16 | 2-3 | Opaque value for Probe | Echoed in ACK |\n| psn | 32 | 4-7 | Packet Sequence Number | Some CPs consume PSN |\n| spdcid | 16 | 8-9 | Source PDCID | Valid PDCID |\n| dpdcid | 16 | 10-11 | Destination PDCID | Or {pdc_info, psn_offset} |\n\n##### Control Packet Subtypes\n\n| ctl_type | Name | Direction | Description |\n|----------|------|-----------|-------------|\n| 0 | NOOP | Either | No operation |\n| 1 | ACK_REQUEST | Src→Dst | Request ACK for specific PSN |\n| 2 | CLEAR_COMMAND | Init→Tgt | Clear guaranteed delivery state |\n| 3 | CLEAR_REQUEST | Tgt→Init | Request initiator to send clear |\n| 4 | CLOSE_COMMAND | Init→Tgt | PDC is being closed |\n| 5 | CLOSE_REQUEST | Tgt→Init | Request initiator to close PDC |\n| 6 | PROBE | Src→Dst | Request PDS ACK |\n| 7 | CREDIT | Dst→Src | Carry CC credit |\n| 8 | CREDIT_REQUEST | Src→Dst | Request credit |\n| 9 | NEGOTIATION | Either | PDC negotiation |\n\n##### Protocol Behavior\n\n**PDC Lifecycle**:\n- `CLOSE_COMMAND/REQUEST`: Graceful PDC teardown\n- `CLEAR_COMMAND/REQUEST`: Clear delivery state without closing\n\n**Flow Control**:\n- `CREDIT/CREDIT_REQUEST`: Credit-based flow control\n- `PROBE`: Solicit ACK for RTT measurement or liveness check\n\n**Reference**: UE Spec v1.0.1, Table 3-38, Section 3.5.10.8, Page 261\n\n### 3.4 SES (Semantic Sublayer) Opcodes\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/opcodes.ksy`\n\n**Request Opcodes (Table 3-17)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Tagged Send | 0x00 | Send with tag matching |\n| RMA Write | 0x01 | Remote memory write |\n| RMA Read | 0x02 | Remote memory read |\n| Atomic Write | 0x03 | Atomic memory write |\n| Atomic Read | 0x04 | Atomic memory read |\n| Atomic CAS | 0x05 | Compare-and-swap |\n| Deferrable Send | 0x06 | Deferrable send |\n| Ready to Restart | 0x07 | Restart notification |\n| Small Message | 0x08 | Small message (32B header) |\n| Small RMA Write | 0x09 | Small RMA write |\n| Small RMA Read | 0x0A | Small RMA read |\n| Small Atomic Write | 0x0B | Small atomic write |\n| Small Atomic Read | 0x0C | Small atomic read |\n| Small Atomic CAS | 0x0D | Small atomic CAS |\n\n**Response Opcodes (Table 3-18)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Response | 0x00 | Standard response |\n| Response with Data | 0x01 | Response carrying data |\n| Optimized Response | 0x02 | Optimized format |\n| NACK | 0x03 | Negative acknowledgment |\n\n### 3.5 SES Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/ses/`\n\n```\nSES Request/Response Relationships:\n┌─────────────────────────────────────────────────────────────────┐\n│                                                                 │\n│  Standard Request ────┬───────────────────→ Response            │\n│  (SOM=1, 44B)         └───────────────────→ Response w/Data     │\n│       │                                                         │\n│       └──→ Continuation (SOM=0, 16B)                            │\n│                                                                 │\n│  Small Message (32B) ─────────────────────→ Response            │\n│                                                                 │\n│  + Atomic Extension (8B) ─────────────────→ Response w/Data     │\n│                                             (for fetching ops)  │\n│                                                                 │\n│  + Rendezvous Extension (32B) ────────────→ (target pulls data) │\n│                                                                 │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n| Table/Figure | Format | File | Size | Description |\n|--------------|--------|------|------|-------------|\n| Table 3-8 | Standard Request (SOM=1) | `standard_request_som1.ksy` | 44 bytes | Start of message |\n| Table 3-9 | Standard Request (SOM=0) | `standard_request_som0.ksy` | 16 bytes | Continuation |\n| Table 3-11 | Response | `response.ksy` | 16 bytes | Standard response |\n| Table 3-12 | Response with Data | `response_with_data.ksy` | 24 bytes | Data-carrying response |\n| Figure 3-14 | Small Message | `small_message.ksy` | 32 bytes | Single-packet optimized |\n| Figure 3-15 | Rendezvous Extension | `rendezvous_extension.ksy` | 32 bytes | Large message protocol |\n| Figure 3-16 | Atomic Extension | `atomic_extension.ksy` | 8 bytes | Atomic operations |\n\n#### 3.5.1 Standard Request SOM=1 (Table 3-8, 44 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/standard_request_som1.ksy`  \n**Related Formats**: [Standard Request SOM=0 (3.5.2)](#352-standard-request-som0-table-3-9-16-bytes) | [Response (3.5.3)](#353-response-table-3-11-16-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |rs|opcode |v|dc|ie|rl|hd|eo|so|    message_id     | ri_gen  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |rsvd|pid_on_fep |rsvd| resource_idx  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |                    buffer_offset [63:0]                       |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        24      25      26      27      28      29      30      31\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |        initiator [31:0]       |   match_bits / memory_key    →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        32      33      34      35      36      37      38      39\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |  (match_bits cont'd) [63:0]   |       header_data [63:0]     →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        40      41      42      43\n     +-------+-------+-------+-------+\n   → | (hdr_data)    | request_length|\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |rsvd |  opcode |v|dc|ie|rl|hd|eo|so|\n       | (2) | (6 bits)|r| | | | | | | |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| rsvd | 2 | 0[7:6] | Reserved | Must be 0 |\n| opcode | 6 | 0[5:0] | Operation code | Per Table 3-17 |\n| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n| dc | 1 | 1[5] | Delivery Complete | Defer response until globally observable |\n| ie | 1 | 1[4] | Initiator Error | Error at initiator |\n| rel | 1 | 1[3] | Relative addressing | 0=absolute, 1=relative |\n| hd | 1 | 1[2] | Header Data present | 1=header_data valid |\n| eom | 1 | 1[1] | End of Message | 1=last packet |\n| som | 1 | 1[0] | Start of Message | Must be 1 for this format |\n| message_id | 16 | 2-3 | Message identifier | 0=reserved (invalid) |\n| ri_generation | 8 | 4 | Resource Index generation | For buffer exhaustion recovery |\n| job_id | 24 | 5-7 | Job Identifier | Matches VXLAN VNI size |\n| rsvd | 4 | 8[7:4] | Reserved | Must be 0 |\n| pid_on_fep | 12 | 8[3:0]+9 | Process ID on FEP | Target process |\n| rsvd | 4 | 10[7:4] | Reserved | Must be 0 |\n| resource_index | 12 | 10[3:0]+11 | Resource Index | Target resource |\n| buffer_offset | 64 | 12-19 | Buffer offset | Or restart token for deferrable |\n| initiator | 32 | 20-23 | Initiator ID | For tagged matching |\n| match_bits | 64 | 24-31 | Match bits / Memory key | Dual-purpose field |\n| header_data | 64 | 32-39 | Header data | Completion data (if hd=1) |\n| request_length | 32 | 40-43 | Request length | Bytes to transfer |\n\n##### Field Notes\n\n**match_bits / memory_key Interpretation**:\n- For tagged operations (sends): Match bits for receive queue matching\n- For RMA operations (reads, writes): Memory key for authorization\n\n**buffer_offset Special Uses**:\n- For deferrable sends: Contains restart token (upper 32b initiator, lower 32b target)\n- For FI_MR_VIRT_ADDR: Contains absolute virtual address\n\n##### Protocol Behavior\n\n**Message Framing**:\n- `som=1, eom=1`: Single-packet message\n- `som=1, eom=0`: First packet of multi-packet message\n- Continuation packets use SOM=0 format (Table 3-9)\n\n**Addressing Modes**:\n- `rel=0` (Absolute): {JobID, PIDonFEP, resource_index} identifies target\n- `rel=1` (Relative): Addressing relative to connection context\n\n**Delivery Complete (dc)**:\n- When `dc=1`: Response deferred until data globally observable\n- Matches FI_DELIVERY_COMPLETE libfabric option\n\n**Reference**: UE Spec v1.0.1, Table 3-8, Section 3.4.2.1, Page 158\n\n---\n\n#### 3.5.2 Standard Request SOM=0 (Table 3-9, 16 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/standard_request_som0.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |rs|opcode |v|dc|ie|rl|hd|eo|so|    message_id     | ri_gen  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |       message_offset [31:0]          |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| rsvd | 2 | 0[7:6] | Reserved | Must be 0 |\n| opcode | 6 | 0[5:0] | Operation code | Same as SOM=1 packet |\n| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n| dc | 1 | 1[5] | Delivery Complete | Same as SOM=1 |\n| ie | 1 | 1[4] | Initiator Error | Error at initiator |\n| rel | 1 | 1[3] | Relative addressing | Same as SOM=1 |\n| hd | 1 | 1[2] | Header Data present | Ignored for SOM=0 |\n| eom | 1 | 1[1] | End of Message | 1=last packet |\n| som | 1 | 1[0] | Start of Message | Must be 0 for this format |\n| message_id | 16 | 2-3 | Message identifier | Same as SOM=1 packet |\n| ri_generation | 8 | 4 | Resource Index generation | Same as SOM=1 |\n| job_id | 24 | 5-7 | Job Identifier | Same as SOM=1 |\n| message_offset | 32 | 8-11 | Offset within message | Byte offset from start |\n\n##### Protocol Behavior\n\n**Continuation Packets**:\n- Used for packets 2..N of multi-packet messages\n- `message_offset` indicates position within overall message\n- Target uses offset to place data correctly in buffer\n\n**Packet Ordering**:\n- ROD delivery: Packets delivered in PSN order\n- RUD delivery: Packets may arrive out of order; target reassembles using message_offset\n\n**Reference**: UE Spec v1.0.1, Table 3-9, Section 3.4.2.1, Page 159\n\n---\n\n#### 3.5.3 Response (Table 3-11, 16 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/response.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes) | [Response with Data (3.5.4)](#354-response-with-data-table-3-12-24-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     | list|opcode |v| return_code |    message_id     | ri_gen  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |       modified_length [31:0]         |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |list |  opcode |v| return_code   |\n       | (2) | (6 bits)|r|   (6 bits)    |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| list | 2 | 0[7:6] | List indicator | 0=expected, 1=unexpected |\n| opcode | 6 | 0[5:0] | Response opcode | Per Table 3-18 |\n| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n| return_code | 6 | 1[5:0] | Return code | Per Table 3-19 |\n| message_id | 16 | 2-3 | Message identifier | From original request |\n| ri_generation | 8 | 4 | Resource Index generation | New generation on mismatch |\n| job_id | 24 | 5-7 | Job Identifier | From original request |\n| modified_length | 32 | 8-11 | Modified length | Bytes actually transferred |\n| rsvd | 32 | 12-15 | Reserved | Must be 0 |\n\n##### Return Codes (Table 3-19)\n\n| Code | Name | Description |\n|------|------|-------------|\n| 0x00 | RC_OK | Success |\n| 0x01 | RC_NO_MATCH | No matching buffer found |\n| 0x02 | RC_BUFFER_TOO_SMALL | Target buffer too small |\n| 0x03 | RC_AUTHORIZATION_FAILURE | Memory key mismatch |\n| 0x04 | RC_INVALID_OPERATION | Invalid operation |\n| 0x05 | RC_RESOURCE_EXHAUSTION | Resource exhaustion |\n| 0x06 | RC_GENERATION_MISMATCH | RI generation mismatch |\n| 0x07 | RC_TRUNCATED | Message truncated |\n\n##### Protocol Behavior\n\n**Response Generation**:\n1. Target processes request\n2. Generates response with appropriate return_code\n3. `modified_length` indicates actual bytes transferred (may be < request_length)\n\n**List Indicator**:\n- `list=0`: Payload delivered to expected list (matched posted receive)\n- `list=1`: Payload delivered to unexpected list (no matching receive)\n\n**Reference**: UE Spec v1.0.1, Table 3-11, Section 3.4.2.5, Page 167\n\n---\n\n#### 3.5.4 Response with Data (Table 3-12, 24 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/response_with_data.ksy`  \n**Related Formats**: [Response (3.5.3)](#353-response-table-3-11-16-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     | list|opcode |v| return_code | response_msg_id   | rsvd    →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |read_req_msg_id|rs|payload_len      →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |       modified_length [31:0]  |       message_offset [31:0]  |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| list | 2 | 0[7:6] | List indicator | 0=expected, 1=unexpected |\n| opcode | 6 | 0[5:0] | Response opcode | Per Table 3-18 |\n| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n| return_code | 6 | 1[5:0] | Return code | Per Table 3-19 |\n| response_message_id | 16 | 2-3 | Response message ID | For this response |\n| rsvd | 8 | 4 | Reserved | Must be 0 |\n| job_id | 24 | 5-7 | Job Identifier | From original request |\n| read_request_message_id | 16 | 8-9 | Original request msg ID | Links to request |\n| rsvd | 2 | 10[7:6] | Reserved | Must be 0 |\n| payload_length | 14 | 10[5:0]+11 | Payload in this packet | Max 16383 bytes |\n| modified_length | 32 | 12-15 | Total bytes transferred | Across all packets |\n| message_offset | 32 | 16-19 | Offset in response | For multi-packet responses |\n| rsvd | 32 | 20-23 | Reserved | Must be 0 |\n\n##### Protocol Behavior\n\n**Use Cases**:\n- RDMA Read responses (returning requested data)\n- Fetching atomic responses (returning original value)\n\n**Multi-Packet Responses**:\n- `message_offset` indicates position within overall response\n- `payload_length` indicates data in this specific packet\n- `modified_length` is total across all response packets\n\n**Reference**: UE Spec v1.0.1, Table 3-12, Section 3.4.2.5, Page 168\n\n---\n\n#### 3.5.5 Small Message (Figure 3-14, 32 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/small_message.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes) | [Response (3.5.3)](#353-response-table-3-11-16-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |opcode |v|dc|ie|rl|hd|eo|so|rs| request_length  | ri_gen  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |rsvd|pid_on_fep |rsvd| resource_idx  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |        initiator [31:0]       |        match_bits [63:0]     →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        24      25      26      27      28      29      30      31\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |  (match_bits cont'd)          |       header_data [63:0]     |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| opcode | 6 | 0[7:2] | Operation code | Per Table 3-17 |\n| version | 2 | 0[1:0] | Protocol version | 0 for v1.0.1 |\n| dc | 1 | 1[7] | Delivery Complete | Defer response |\n| ie | 1 | 1[6] | Initiator Error | Error at initiator |\n| rel | 1 | 1[5] | Relative addressing | 0=absolute, 1=relative |\n| hd | 1 | 1[4] | Header Data present | 1=header_data valid |\n| eom | 1 | 1[3] | End of Message | Must be 1 (single packet) |\n| som | 1 | 1[2] | Start of Message | Must be 1 (single packet) |\n| rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n| rsvd | 2 | 2[7:6] | Reserved | Must be 0 |\n| request_length | 14 | 2[5:0]+3 | Request length | Max 16383 bytes |\n| ri_generation | 8 | 4 | Resource Index generation | For buffer recovery |\n| job_id | 24 | 5-7 | Job Identifier | Target job |\n| rsvd | 4 | 8[7:4] | Reserved | Must be 0 |\n| pid_on_fep | 12 | 8[3:0]+9 | Process ID on FEP | Target process |\n| rsvd | 4 | 10[7:4] | Reserved | Must be 0 |\n| resource_index | 12 | 10[3:0]+11 | Resource Index | Target resource |\n| initiator | 32 | 12-15 | Initiator ID | For tagged matching |\n| match_bits | 64 | 16-23 | Match bits | For tagged matching |\n| header_data | 64 | 24-31 | Header data | Completion data |\n\n##### Protocol Behavior\n\n**Optimized Format**:\n- 32 bytes vs 44 bytes for standard request\n- Single-packet only (`som=1, eom=1` required)\n- No buffer_offset (not needed for single packet)\n- 14-bit request_length (max 16383 bytes)\n\n**Use Cases**:\n- Small tagged sends\n- Single-packet messages with matching criteria\n- Latency-sensitive operations\n\n**Reference**: UE Spec v1.0.1, Figure 3-14, Section 3.4.2.3, Page 164\n\n---\n\n#### 3.5.6 Rendezvous Extension (Figure 3-15, 32 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/rendezvous_extension.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |       eager_length [31:0]     |        memory_key [63:0]     →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |  (memory_key cont'd)          |       buffer_offset [63:0]   →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |  (buffer_offset cont'd)       |     remaining_length [31:0]  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        24      25      26      27      28      29      30      31\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → | (remaining)   |              reserved [63:0]                  |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| eager_length | 32 | 0-3 | Eager data length | Bytes pushed with request |\n| memory_key | 64 | 4-11 | Initiator memory key | For target to pull data |\n| buffer_offset | 64 | 12-19 | Initiator buffer offset | Start of remaining data |\n| remaining_length | 32 | 20-23 | Remaining data length | Bytes to pull |\n| rsvd | 64 | 24-31 | Reserved | Must be 0 |\n\n##### Protocol Behavior\n\n**Rendezvous Protocol**:\n1. Initiator sends request with eager data + rendezvous extension\n2. Target receives eager data, allocates buffer\n3. Target issues RDMA Read to pull remaining data using {memory_key, buffer_offset}\n4. Target completes operation when all data received\n\n**Two-Sided Protocol**:\n- Enables large message transfer without pre-registered buffers\n- Target controls when/how to pull remaining data\n- Reduces memory registration overhead\n\n**Constraints**:\n- MUST NOT be combined with atomic extension\n- Placed on every packet using rendezvous opcode\n\n**Reference**: UE Spec v1.0.1, Figure 3-15, Section 3.4.2.3, Page 165\n\n---\n\n#### 3.5.7 Atomic Extension (Figure 3-16, 8 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/atomic_extension.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes) | [Response with Data (3.5.4)](#354-response-with-data-table-3-12-24-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |atomic_opcode  |atomic_datatype| semantic_control  | reserved  |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| atomic_opcode | 8 | 0 | Atomic operation | Per Table 3-21 |\n| atomic_datatype | 8 | 1 | Data type | Per Table 3-22 |\n| semantic_control | 16 | 2-3 | Semantic control | Per Table 3-23 |\n| rsvd | 32 | 4-7 | Reserved | Must be 0 |\n\n##### Atomic Opcodes (Table 3-21)\n\n| Code | Name | Operation |\n|------|------|-----------|\n| 0x00 | MIN | Target = MIN(Target, Initiator) |\n| 0x01 | MAX | Target = MAX(Target, Initiator) |\n| 0x02 | SUM | Target = Target + Initiator |\n| 0x03 | DIFF | Target = Target - Initiator |\n| 0x04 | PROD | Target = Target * Initiator |\n| 0x05 | LOR | Target = Target \\|\\| Initiator |\n| 0x06 | LAND | Target = Target && Initiator |\n| 0x07 | BOR | Target = Target \\| Initiator |\n| 0x08 | BAND | Target = Target & Initiator |\n| 0x09 | LXOR | Logical XOR |\n| 0x0A | BXOR | Target = Target ^ Initiator |\n| 0x0B | READ | Initiator = Target |\n| 0x0C | WRITE | Target = Initiator |\n| 0x0D | CSWAP | Compare and swap if equal |\n| 0x0E | CSWAP_NE | Compare and swap if not equal |\n| 0x0F | CSWAP_LE | Compare and swap if ≤ |\n| 0x10 | CSWAP_LT | Compare and swap if < |\n| 0x11 | CSWAP_GE | Compare and swap if ≥ |\n| 0x12 | CSWAP_GT | Compare and swap if > |\n| 0x13 | MSWAP | Masked swap |\n| 0x14 | INVAL | Invalidate cache |\n\n##### Atomic Datatypes (Table 3-22)\n\n| Code | Name | Size |\n|------|------|------|\n| 0x00 | INT8 | 1 byte |\n| 0x01 | UINT8 | 1 byte |\n| 0x02 | INT16 | 2 bytes |\n| 0x03 | UINT16 | 2 bytes |\n| 0x04 | INT32 | 4 bytes |\n| 0x05 | UINT32 | 4 bytes |\n| 0x06 | INT64 | 8 bytes |\n| 0x07 | UINT64 | 8 bytes |\n| 0x08 | FLOAT | 4 bytes |\n| 0x09 | DOUBLE | 8 bytes |\n| 0x0A | FLOAT_COMPLEX | 8 bytes |\n| 0x0B | DOUBLE_COMPLEX | 16 bytes |\n| 0x0E | FLOAT16 | 2 bytes |\n| 0x0F | BFLOAT16 | 2 bytes |\n\n##### Protocol Behavior\n\n**Atomic Operations**:\n- Always 8 bytes and must be naturally aligned\n- Payload must be integral multiple of datatype size\n- Fetching atomics return original value in Response with Data\n\n**Constraints**:\n- MUST NOT be combined with rendezvous extension\n- Fetching atomics MUST NOT operate on more than one element\n\n**Reference**: UE Spec v1.0.1, Figure 3-16, Section 3.4.2.4, Page 165\n\n### 3.6 CMS (Congestion Management Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/cms/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Credit CP Payload | `credit_cp_payload.ksy` | Credit control packet |\n| Credit Request | `credit_request_cp_payload.ksy` | Credit request |\n| Request CC State | `req_cc_state.ksy` | Request CC state |\n| ACK CC State (NSCC) | `ack_cc_state_nscc.ksy` | NSCC algorithm state |\n| ACK CC State (RCCC/TFC) | `ack_cc_state_rccc_tfc.ksy` | RCCC/TFC state |\n\n### 3.7 TSS (Transport Security Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/tss/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Security Header | `security_header.ksy` | Encryption header |\n| IV Construction | `iv_construction.ksy` | Initialization vector |\n| Key Rotation | `protocols/key_rotation.ksy` | Key rotation protocol |\n| KDF Direct | `protocols/kdf_direct.ksy` | Direct key derivation |\n| KDF Client/Server | `protocols/kdf_client_server.ksy` | Client/server KDF |\n| KDF Cluster | `protocols/kdf_cluster.ksy` | Cluster KDF |\n| Join Secure Domain | `protocols/join_secure_domain.ksy` | Domain join |\n| TSS TX Processing | `protocols/tss_tx_processing.ksy` | Transmit processing |\n| TSS RX Processing | `protocols/tss_rx_processing.ksy` | Receive processing |\n\n### 3.8 Link Layer Formats\n\n#### LLR (Link-Level Retry)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/llr/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| LLR Preamble (64b66b) | `llr_preamble_64b66b.ksy` | 64b66b preamble |\n| LLR Preamble (MII) | `llr_preamble_mii.ksy` | MII preamble |\n| LLR Init CTLOS | `llr_init_ctlos.ksy` | Initialize LLR |\n| LLR Init Echo CTLOS | `llr_init_echo_ctlos.ksy` | Init acknowledgment |\n| LLR ACK CTLOS | `llr_ack_ctlos.ksy` | Frame acknowledgment |\n| LLR NACK CTLOS | `llr_nack_ctlos.ksy` | Retransmit request |\n\n#### CBFC (Credit-Based Flow Control)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/cbfc/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| CF Update | `cf_update.ksy` | Credit flow update |\n| CC Update | `cc_update.ksy` | Credit count update |\n| VC State Machine | `protocols/vc_state_machine.ksy` | Virtual channel FSM |\n| Lossless VC Init | `protocols/lossless_vc_init.ksy` | VC initialization |\n| Lossless VC Removal | `protocols/lossless_vc_removal.ksy` | VC teardown |\n\n#### LLDP Extensions\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/lldp/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| UE Link Negotiation TLV | `ue_link_negotiation_tlv.ksy` | Link negotiation |\n| UE CBFC TLV | `ue_cbfc_tlv.ksy` | CBFC parameters |\n\n---\n\n## 4. RoCEv2 Formats\n\n**Datamodel Directory**: `datamodel/protocols/roce/transport/`\n\n### 4.1 RoCEv2 Packet Structure\n\n```\n+-----------------------------------------------------------------------------+\n| Ethernet II Header (14 bytes)                                               |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2) = 0x0800/0x86DD            |\n+-----------------------------------------------------------------------------+\n| IP Header (20 bytes IPv4 / 40 bytes IPv6)                                   |\n|   Version, IHL, DSCP, ECN, Length, ID, Flags, TTL, Protocol=17, Checksum   |\n|   Source IP, Dest IP                                                        |\n+-----------------------------------------------------------------------------+\n| UDP Header (8 bytes)                                                        |\n|   Source Port (entropy) | Dest Port = 4791 | Length | Checksum             |\n+-----------------------------------------------------------------------------+\n| BTH - Base Transport Header (12 bytes)                                      |\n|   Opcode | Flags | P-Key | Dest QP | A | PSN                               |\n+-----------------------------------------------------------------------------+\n| Extended Headers (optional, operation-dependent)                            |\n|   RETH (16) | AETH (4) | AtomicETH (28) | ImmDt (4)                        |\n+-----------------------------------------------------------------------------+\n| Payload (0 - MTU bytes)                                                     |\n+-----------------------------------------------------------------------------+\n| ICRC (4 bytes)                                                              |\n+-----------------------------------------------------------------------------+\n```\n\n### 4.2 BTH (Base Transport Header) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/roce/transport/bth.ksy`\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| Opcode | 8 | Operation type (transport + operation) |\n| SE | 1 | Solicited Event |\n| M | 1 | Migration state |\n| Pad | 2 | Padding bytes (0-3) |\n| TVer | 4 | Transport version (must be 0) |\n| P-Key | 16 | Partition key |\n| Dest QP | 24 | Destination Queue Pair |\n| A | 1 | ACK request |\n| PSN | 24 | Packet Sequence Number |\n\n**Transport Types** (Opcode bits [7:5]):\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x00 | RC | Reliable Connection |\n| 0x20 | UC | Unreliable Connection |\n| 0x40 | RD | Reliable Datagram |\n| 0x60 | UD | Unreliable Datagram |\n\n**Operations** (Opcode bits [4:0]):\n| Value | Operation | Description |\n|-------|-----------|-------------|\n| 0x00 | SEND_FIRST | First send packet |\n| 0x01 | SEND_MIDDLE | Middle send packet |\n| 0x02 | SEND_LAST | Last send packet |\n| 0x03 | SEND_LAST_IMM | Last send with immediate |\n| 0x04 | SEND_ONLY | Single-packet send |\n| 0x05 | SEND_ONLY_IMM | Single send with immediate |\n| 0x06 | RDMA_WRITE_FIRST | First RDMA write |\n| 0x07 | RDMA_WRITE_MIDDLE | Middle RDMA write |\n| 0x08 | RDMA_WRITE_LAST | Last RDMA write |\n| 0x09 | RDMA_WRITE_LAST_IMM | Last write with immediate |\n| 0x0A | RDMA_WRITE_ONLY | Single-packet write |\n| 0x0B | RDMA_WRITE_ONLY_IMM | Single write with immediate |\n| 0x0C | RDMA_READ_REQUEST | Read request |\n| 0x0D | RDMA_READ_RESPONSE_FIRST | First read response |\n| 0x0E | RDMA_READ_RESPONSE_MIDDLE | Middle read response |\n| 0x0F | RDMA_READ_RESPONSE_LAST | Last read response |\n| 0x10 | RDMA_READ_RESPONSE_ONLY | Single read response |\n| 0x11 | ACK | Acknowledgment |\n| 0x12 | ATOMIC_ACK | Atomic acknowledgment |\n| 0x13 | CMP_SWAP | Compare and swap |\n| 0x14 | FETCH_ADD | Fetch and add |\n\n### 4.3 Extended Transport Headers\n\n| Header | File | Size | Description |\n|--------|------|------|-------------|\n| RETH | `reth.ksy` | 16 bytes | RDMA Extended Transport Header |\n| AETH | `aeth.ksy` | 4 bytes | ACK Extended Transport Header |\n| AtomicETH | `atomiceth.ksy` | 28 bytes | Atomic Extended Transport Header |\n| AtomicAckETH | `atomicacketh.ksy` | 8 bytes | Atomic ACK ETH |\n| DETH | `deth.ksy` | 8 bytes | Datagram Extended Transport Header |\n| ImmDt | `immdt.ksy` | 4 bytes | Immediate Data |\n| ICRC | `icrc.ksy` | 4 bytes | Invariant CRC |\n\n---\n\n## 5. Standard Ethernet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ethernet/`\n\n### 5.1 Ethernet II Frame\n\n**Datamodel**: `datamodel/protocols/ethernet/link/ethernet_ii.ksy`\n\n```\n+-----------------------------------------------------------------------------+\n| Preamble (7 bytes) + SFD (1 byte)  [not visible to software]               |\n+-----------------------------------------------------------------------------+\n| Ethernet Header (14 bytes)                                                  |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2)                            |\n+-----------------------------------------------------------------------------+\n| Optional VLAN Tag (4 bytes) - 802.1Q                                        |\n|   TPID (2) = 0x8100 | TCI (2) = PCP + DEI + VID                            |\n+-----------------------------------------------------------------------------+\n| Payload (46-1500 bytes, or up to 9000 for jumbo)                           |\n+-----------------------------------------------------------------------------+\n| FCS (4 bytes)                                                               |\n+-----------------------------------------------------------------------------+\n```\n\n### 5.2 Link Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| Ethernet II | `link/ethernet_ii.ksy` | Standard Ethernet frame |\n| VLAN 802.1Q | `link/vlan_802_1q.ksy` | VLAN tagging |\n\n### 5.3 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| IPv4 | `network/ipv4.ksy` | IPv4 header |\n| IPv6 | `network/ipv6.ksy` | IPv6 header |\n\n### 5.4 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| TCP | `transport/tcp.ksy` | TCP header |\n| UDP | `transport/udp.ksy` | UDP header |\n\n---\n\n## 6. Cornelis Proprietary Formats\n\n**Datamodel Directory**: `datamodel/protocols/cornelis/`\n\n### 6.1 Link Layer\n\n| Format | File | Size | Description |\n|--------|------|------|-------------|\n| UE+ Header | `link/ue_plus.ksy` | 12 bytes | Optimized L2 header |\n| Cornelis L2 Prefix | `link/cornelis_l2_prefix.ksy` | Variable | L2 prefix |\n\n### 6.2 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| UFH-16 | `network/ufh_16.ksy` | 16-bit forwarding header |\n| UFH-32 | `network/ufh_32.ksy` | 32-bit forwarding header |\n| Collective L2 | `network/collective_l2.ksy` | Collective operations header |\n| Scale-Up L2 | `network/scaleup_l2.ksy` | Scale-up deployments |\n\n#### 6.2.1 UFH-16 (Unified Forwarding Header 16-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_16.ksy`\n\nUFH-16 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 16-bit addressing.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |    Opaque (24-bit)    | Destination   |Opaque |Traffic|   Opaque      |    Source     |\n|[7:4]  |                       | (16-bit BE)   |[7:4]  |Class  |   (16-bit)    |  (16-bit BE)  |\n|SLAP   |                       |               |Z|Y|X|M|[7:0]  |               |               |\n|[3:0]  |                       |               |[3:0]  |       |               |               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1-3 | 24 | Opaque to hardware |\n| Destination | 4-5 | 16 | Destination endpoint address (big-endian) |\n| Opaque | 6 | [7:4] | Opaque to hardware |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Opaque | 8-9 | 16 | Opaque to hardware |\n| Source | 10-11 | 16 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-16 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5-14 | Reserved | Reserved for future use |\n| 15 | Extended | UFH-32 extension follows |\n\n**Usage**: Scale-up fabric forwarding, intra-pod communication, medium cluster networking (up to 65536 endpoints).\n\n#### 6.2.2 UFH-32 (Unified Forwarding Header 32-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_32.ksy`\n\nUFH-32 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 32-bit addressing for large-scale deployments.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |       |   Destination (32-bit BE)     |HopLim |Traffic|       Source (32-bit BE)      |\n|[7:4]  |Opaque |                               |[7:4]  |Class  |                               |\n|SLAP   |       |                               |Z|Y|X|M|[7:0]  |                               |\n|[3:0]  |       |                               |[3:0]  |       |                               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1 | [7:0] | Opaque to hardware |\n| Destination | 2-5 | 32 | Destination endpoint address (big-endian) |\n| Hop Limit | 6 | [7:4] | TTL/hop count |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Source | 8-11 | 32 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-32 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5 | Multicast | Multicast packet |\n| 6 | Barrier | Barrier synchronization |\n| 7 | Reduction | Reduction operation |\n| 8-14 | Reserved | Reserved for future use |\n| 15 | Vendor | Vendor-specific packet |\n\n**Usage**: Large-scale scale-up fabric forwarding (4+ billion endpoints), multi-pod communication, extended collective operations.\n\n### 6.3 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| CSIG+ | `transport/csig_plus.ksy` | Telemetry header |\n| PKEY | `transport/pkey.ksy` | Partition key |\n\n### 6.4 Encapsulation\n\n| Format | File | Description |\n|--------|------|-------------|\n| VxLAN+ | `encapsulation/vxlan_plus.ksy` | Extended VxLAN overlay |\n\n---\n\n## 7. Host-Software Interface (HSI) Formats\n\n**Datamodel Directory**: `datamodel/hw/asics/pmr/interfaces/host_interface/`\n\n### 7.1 Command Queue Segment (64 bytes)\n\n**Datamodel**: `command_queue_segment.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Bytes 2-3     | Bytes 4-7     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Opcode        | Flags         | Payload Len   | Reserved      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 8-15                    | Bytes 16-23                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Tag (64 bits)                 | Dest (64 bits)                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 24-31                   | Bytes 32-63                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Metadata (64 bits)            | Inline Data or SGL Entry      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n**Opcode Encoding**:\n| Bits | Field | Values |\n|------|-------|--------|\n| [7:4] | Family | MSG=0x1, TAGGED=0x2, RMA=0x3, ATOMIC=0x4 |\n| [3:2] | Variant | SEND=0, RECV=1, INJECT=2 |\n| [1] | Reserved | Must be 0 |\n| [0] | Data Source | INLINE=0, SGL=1 |\n\n### 7.2 Notification Formats\n\n| Format | File | Type | Size | Description |\n|--------|------|------|------|-------------|\n| Receive Notification | `receive_notification.ksy` | 0x00 | 64 bytes | Received message |\n| Send Completion | `send_completion.ksy` | 0x01 | 64 bytes | Send completed |\n| Event Notification | `event_notification.ksy` | 0x02 | 64 bytes | Async event |\n| Notification Entry | `notification_entry.ksy` | - | 64 bytes | Generic entry |\n| QW Violation Event | `qw_violation_event.ksy` | - | 64 bytes | QW alignment error |\n\n### 7.3 Receive Notification (64 bytes)\n\n**Datamodel**: `receive_notification.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x00 for receive |\n| flags | 1 | 1 | FI_INLINE, continuation |\n| status | 2 | 2 | Completion status |\n| src_id | 4 | 4 | Source endpoint ID |\n| tag | 8 | 8 | Tag value |\n| total_length | 16 | 4 | Payload length |\n| buffer_id_0 | 20 | 2 | First buffer ID |\n| buffer_id_1 | 22 | 2 | Second buffer ID |\n| buffer_offset | 24 | 2 | Offset in buffer |\n| reserved | 26 | 2 | Reserved |\n| inline_data | 28 | 35 | Inline payload |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.4 Send Completion (64 bytes)\n\n**Datamodel**: `send_completion.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x01 for send |\n| flags | 1 | 1 | Completion flags |\n| status | 2 | 2 | Completion status |\n| reserved_0 | 4 | 4 | Reserved |\n| op_context | 8 | 8 | Operation context |\n| bytes_sent | 16 | 4 | Bytes transferred |\n| reserved_1 | 20 | 43 | Reserved |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.5 Other HSI Formats\n\n| Format | File | Description |\n|--------|------|-------------|\n| SGL Entry | `sgl_entry.ksy` | Scatter-gather list entry |\n| PCIe Descriptors | `pcie/descriptors.ksy` | PCIe interface descriptors |\n\n---\n\n## 8. IP Block Descriptors\n\n**Datamodel Directory**: `datamodel/hw/ip/cornelis/`\n\n### 8.1 Collectives Engine (CE)\n\n**Datamodel**: `ce/descriptors.ksy`\n\nThe Collectives Engine uses RISC-V vector cores (VLEN=512) for hardware-accelerated collective operations.\n\n### 8.2 Electric Creek (EC)\n\n**Datamodel**: `ec/descriptors.ksy`\n\nElectric Creek is the management complex shared between PMR NIC and LNR Switch.\n\n---\n\n## 9. Work List\n\nThis section tracks issues requiring follow-up investigation or specification updates.\n\n### 9.1 Open Issues\n\n| ID | Priority | Category | Description | Status | Opened | Closed |\n|----|----------|----------|-------------|--------|--------|--------|\n| W-06-001 | Medium | Datamodel | UFH-32 lacks 16-bit entropy field; per-packet ECMP not supported; switch must derive entropy from Src+Dest hash | Deferred | 2026-01-20 | - |\n| W-07-001 | Low | Datamodel | `ack_cc.ksy` shows `ack_cc_state` as 32-bit (4 bytes) but UE Spec Table 3-36 shows 64-bit (8 bytes); verify field size | Investigation | 2026-01-22 | - |\n| W-07-002 | Low | Documentation | `collective_l2.ksy` and `scaleup_l2.ksy` marked as \"work_in_progress\" with spec_version 0.1; specifications incomplete | Spec Update | 2026-01-22 | - |\n| W-07-003 | Low | Datamodel | `ue_plus.ksy` 9-bit length field split across bytes 0-1 with unusual encoding (1 bit in byte 0, 8 bits in byte 1); verify encoding matches UE Spec | Investigation | 2026-01-22 | - |\n| W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |\n| W-05-002 | Medium | Specification | MTU values: Verify maximum MTU for each protocol | Investigation | 2026-01-10 | - |\n| W-05-003 | Medium | Documentation | CMS detailed formats: Need comprehensive documentation | Spec Update | 2026-01-10 | - |\n| W-03-002 | Low | Terminology | PDP vs PDS naming: UML uses both terms inconsistently | Spec Update | 2026-01-08 | - |\n| W-03-006 | Low | Terminology | SES vs SE: \"SES Processing Groups\" vs \"Semantic Engines\" | Spec Update | 2026-01-08 | - |\n\n### 9.2 Datamodel Gaps\n\n| ID | Priority | Description | Target Location | Status | Opened | Closed |\n|----|----------|-------------|-----------------|--------|--------|--------|\n| D-001 | High | PMR CSR definitions missing from datamodel | `datamodel/hw/asics/pmr/csrs/*.rdl` | Spec Update | 2026-01-10 | - |\n| D-002 | Medium | PMR block hierarchy YAML incomplete | `datamodel/hw/asics/pmr/blocks.yaml` | Spec Update | 2026-01-10 | - |\n| D-003 | Medium | PMR interface contracts missing | `datamodel/views/contracts/pmr-*.puml` | Spec Update | 2026-01-10 | - |\n\n### 9.3 Specification Clarifications Needed\n\n| ID | Priority | Question | Context | Status | Opened | Closed |\n|----|----------|----------|---------|--------|--------|--------|\n| Q1 | Medium | Lightweight Interface Scope | What features should be reduced in lightweight mode? | Investigation | 2026-01-10 | - |\n| Q2 | Medium | Tag Table Sizing | Should HW tag table size be per-endpoint configurable? | Investigation | 2026-01-10 | - |\n| Q3 | Medium | Multi-Packet Eager Messages | Should hardware support multi-packet eager messages? | Investigation | 2026-01-10 | - |\n| Q4 | Low | RoCE Work Queue Implementation | Confirm RoCE WQ/CQ are software-implemented | Investigation | 2026-01-10 | - |\n\n### 9.4 Closed Issues\n\n| ID | Priority | Category | Description | Resolution | Opened | Closed |\n|----|----------|----------|-------------|------------|--------|--------|\n| W-05-001 | Medium | Documentation | UE taxonomy reference | Documented in `05-packet-formats.md` | 2026-01-08 | 2026-01-10 |\n| W-02-005 | Medium | Documentation | Protocol support documentation | Documented UE+, RoCEv2, Ethernet | 2026-01-08 | 2026-01-10 |\n| W-02-006 | Medium | Documentation | Cornelis Collective Reduction Protocol | Documented in HAS §2.5.4 | 2026-01-08 | 2026-01-10 |\n| W-03-001 | Medium | Architecture | Semantic Engine count | Confirmed 64 (8x8) in UML and HAS | 2026-01-08 | 2026-01-10 |\n| W-17-005 | Low | Documentation | Port subdivision note | Added to HAS Ch17 | 2026-01-11 | 2026-01-11 |\n| W-17-006 | Medium | Documentation | MPORT interface documentation | Documented 256B @ 1.66 GHz | 2026-01-11 | 2026-01-11 |\n| W-04-005 | High | Datamodel | `ufh_16.ksy` address size: Datamodel shows 12-bit dest, should be 16-bit | UFH-16 restructured to 12-byte Ethernet MAC overlay with 16-bit destination (bytes 4-5) and 16-bit source (bytes 10-11) | 2026-01-10 | 2026-01-20 |\n| W-04-006 | High | Datamodel | `ufh_32.ksy` address size: Datamodel shows 16-bit dest, should be 32-bit | UFH-32 restructured to 12-byte Ethernet MAC overlay with 32-bit destination (bytes 2-5) and 32-bit source (bytes 8-11) | 2026-01-10 | 2026-01-20 |\n\n### 9.5 Change Log\n\n| Date | Change | Details |\n|------|--------|---------|\n| 2026-01-14 | Initial creation | Document created with PMR packet taxonomy |\n| 2026-01-20 | Review and update | Added UALink section (reference only, not PMR-supported); Added change log; Updated datamodel file counts; No new .ksy files since initial creation |\n| 2026-01-20 | UFH format details | Added detailed UFH-16 and UFH-32 format documentation in Section 6.2 (wire diagrams, field tables, type enumerations) |\n| 2026-01-20 | UFH restructuring | UFH-16 and UFH-32 restructured to 12-byte Ethernet MAC overlays; UFH-16 now 16-bit addressing, UFH-32 now 32-bit addressing; Added SLAP field constraints (Z,Y,X=001); Updated datamodel .ksy files; Closed W-04-005 and W-04-006 |\n| 2026-01-22 | Datamodel review | Added W-07-001 (ack_cc_state size mismatch), W-07-002 (collective/scaleup specs incomplete), W-07-003 (ue_plus length encoding); Identified 30+ packet formats requiring expansion |\n\n---\n\n## 10. UALink Protocol (Reference Only)\n\n**Note**: UALink is defined in the datamodel but is **NOT currently supported by PMR**. It is included here for reference as it may be relevant for future AI/ML accelerator interconnect work.\n\n**Datamodel Directory**: `datamodel/protocols/ualink/`\n\n### 10.1 UALink Overview\n\nUALink is an AI/ML accelerator interconnect protocol with 38 packet definitions across all OSI layers.\n\n| Layer | Count | Key Formats |\n|-------|-------|-------------|\n| UPLI (Upper Protocol Layer Interface) | 8 | commands.ksy, request_channel.ksy, status_codes.ksy |\n| Transaction | 9 | tl_flit.ksy, control_half_flit.ksy, data_half_flit.ksy |\n| Data Link | 12 | dl_flit.ksy, segment_header.ksy, crc.ksy, control_messages.ksy |\n| Physical | 4 | alignment_markers.ksy, control_ordered_sets.ksy, link_training.ksy |\n| Security | 5 | authentication.ksy, encryption.ksy, key_derivation.ksy |\n\n### 10.2 UALink Packet Formats\n\n#### UPLI Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Commands | `upli/commands.ksy` | UPLI command definitions |\n| Request Channel | `upli/request_channel.ksy` | Request channel format |\n| Originator Data | `upli/originator_data_channel.ksy` | Originator data channel |\n| Read Response | `upli/read_response_channel.ksy` | Read response channel |\n| Write Response | `upli/write_response_channel.ksy` | Write response channel |\n| Status Codes | `upli/status_codes.ksy` | Status code definitions |\n| Connection Handshake | `upli/protocols/connection_handshake.ksy` | Connection setup |\n| Flow Control | `upli/protocols/flow_control.ksy` | Flow control protocol |\n\n#### Transaction Layer\n| Format | File | Description |\n|--------|------|-------------|\n| TL Flit | `transaction/tl_flit.ksy` | Transaction layer flit |\n| Control Half Flit | `transaction/control_half_flit.ksy` | Control half flit |\n| Data Half Flit | `transaction/data_half_flit.ksy` | Data half flit |\n| Message Half Flit | `transaction/message_half_flit.ksy` | Message half flit |\n| Request Field | `transaction/request_field.ksy` | Request field format |\n| Response Field | `transaction/response_field.ksy` | Response field format |\n| Flow Control Field | `transaction/flow_control_field.ksy` | Flow control field |\n| Compression | `transaction/protocols/compression.ksy` | Data compression |\n| Address Cache | `transaction/protocols/address_cache.ksy` | Address caching |\n\n#### Data Link Layer\n| Format | File | Description |\n|--------|------|-------------|\n| DL Flit | `datalink/dl_flit.ksy` | Data link flit |\n| Flit Header | `datalink/flit_header.ksy` | Flit header format |\n| Segment Header | `datalink/segment_header.ksy` | Segment header |\n| CRC | `datalink/crc.ksy` | CRC calculation |\n| Control Messages | `datalink/messages/control_messages.ksy` | Control messages |\n| Basic Messages | `datalink/messages/basic_messages.ksy` | Basic messages |\n| UART Messages | `datalink/messages/uart_messages.ksy` | UART messages |\n| Vendor Defined | `datalink/messages/vendor_defined.ksy` | Vendor extensions |\n| Link Resiliency | `datalink/protocols/link_resiliency.ksy` | Link resiliency |\n| Link Level Replay | `datalink/protocols/link_level_replay.ksy` | Replay protocol |\n| Link State | `datalink/protocols/link_state.ksy` | Link state machine |\n| Link Folding | `datalink/protocols/link_folding.ksy` | Link folding |\n\n#### Physical Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Alignment Markers | `physical/alignment_markers.ksy` | Lane alignment |\n| Control Ordered Sets | `physical/control_ordered_sets.ksy` | Control sequences |\n| Reconciliation Sublayer | `physical/reconciliation_sublayer.ksy` | RS sublayer |\n| Link Training | `physical/protocols/link_training.ksy` | Link training |\n\n#### Security Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Authentication | `security/authentication.ksy` | Authentication |\n| Encryption | `security/encryption.ksy` | Encryption format |\n| IV Format | `security/iv_format.ksy` | Initialization vector |\n| Key Derivation | `security/protocols/key_derivation.ksy` | Key derivation |\n| Key Rotation | `security/protocols/key_rotation.ksy` | Key rotation |\n\n---\n\n## 11. References\n\n### Internal Documents\n- `docs/HAS/PMR/05-packet-formats.md` - PMR HAS Chapter 5\n- `docs/HAS/PMR/WORK.md` - PMR HAS Work Tracking\n- `.specify/memory/constitution.md` - Project Constitution\n\n### Datamodel Locations\n- `datamodel/protocols/ue/` - Ultra Ethernet protocols (94 .ksy files)\n- `datamodel/protocols/roce/` - RoCEv2 protocols (8 .ksy files)\n- `datamodel/protocols/ethernet/` - Standard Ethernet (6 .ksy files)\n- `datamodel/protocols/cornelis/` - Cornelis proprietary (9 .ksy files)\n- `datamodel/protocols/ualink/` - UALink protocols (38 .ksy files) - NOT supported by PMR\n- `datamodel/hw/asics/pmr/` - PMR ASIC definitions\n\n### External Specifications\n- [Ultra Ethernet Specification v1.0.1](https://ultraethernet.org/)\n- [InfiniBand Architecture Specification](https://www.infinibandta.org/)\n- IEEE 802.3 Ethernet Standard\n- UALink Specification (Ultra Accelerator Link)\n",
                "additions": 499,
                "deletions": 14
              },
              "truncated": false
            },
            "time": {
              "start": 1769123847285,
              "end": 1769123848089
            }
          }
        },
        {
          "id": "prt_be7ff9fa1001KvbssIXGiteQJ4",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fe1874001WDlrE5vdP3z3jP",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 99502,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7ffa00d001I67tBWMETl76Yj",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769123848205,
          "completed": 1769123864506
        },
        "parentID": "msg_be7faadd7001qnhXPM5tKghXUR",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 99510,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7ffa53b001ecwBos5AnrQvxT",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7ffa00d001I67tBWMETl76Yj",
          "type": "step-start"
        },
        {
          "id": "prt_be7ffdf73001I1MvL20sNit5z1",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7ffa00d001I67tBWMETl76Yj",
          "type": "tool",
          "callID": "toolu_01N55vu7ZXRxghtWapVxfmVr",
          "tool": "todowrite",
          "state": {
            "status": "completed",
            "input": {
              "todos": [
                {
                  "id": "p1-1",
                  "content": "Read current packet_taxonomy.md Section 3 structure",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-2",
                  "content": "Expand PDS 3.3.1 UUD Request (Type 0x00)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-3",
                  "content": "Expand PDS 3.3.2 RUDI Request/Response (Type 0x01)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-4",
                  "content": "Expand PDS 3.3.3 RUD Request (Type 0x02)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-5",
                  "content": "Expand PDS 3.3.4 ROD Request (Type 0x03)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-6",
                  "content": "Expand PDS 3.3.5 Control Packet (Type 0x04)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-7",
                  "content": "Expand PDS 3.3.6 ACK (Type 0x08)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-8",
                  "content": "Expand PDS 3.3.7 ACK_CC (Type 0x09)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-9",
                  "content": "Expand PDS 3.3.8 ACK_CCX (Type 0x0A)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-10",
                  "content": "Expand PDS 3.3.9 NACK (Type 0x0C)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-11",
                  "content": "Expand PDS 3.3.10 NACK_CCX (Type 0x0D)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-12",
                  "content": "Expand SES 3.5.1 Standard Request SOM=1 (Table 3-8)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-13",
                  "content": "Expand SES 3.5.2 Standard Request SOM=0 (Table 3-9)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-14",
                  "content": "Expand SES 3.5.3 Response (Table 3-11)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-15",
                  "content": "Expand SES 3.5.4 Response with Data (Table 3-12)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-16",
                  "content": "Expand SES 3.5.5 Optimized Response with Data (Figure 3-13)",
                  "status": "cancelled",
                  "priority": "medium"
                },
                {
                  "id": "p1-17",
                  "content": "Expand SES 3.5.6 Small Message (Figure 3-14)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-18",
                  "content": "Expand SES 3.5.7 Rendezvous Extension (Figure 3-15)",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "p1-19",
                  "content": "Expand SES 3.5.8 Atomic Extension (Figure 3-16)",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "p1-20",
                  "content": "Add cross-reference diagrams to section headers",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "p1-21",
                  "content": "Validation pass against .ksy files",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "p1-22",
                  "content": "Update change log",
                  "status": "pending",
                  "priority": "medium"
                }
              ]
            },
            "output": "[\n  {\n    \"id\": \"p1-1\",\n    \"content\": \"Read current packet_taxonomy.md Section 3 structure\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-2\",\n    \"content\": \"Expand PDS 3.3.1 UUD Request (Type 0x00)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-3\",\n    \"content\": \"Expand PDS 3.3.2 RUDI Request/Response (Type 0x01)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-4\",\n    \"content\": \"Expand PDS 3.3.3 RUD Request (Type 0x02)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-5\",\n    \"content\": \"Expand PDS 3.3.4 ROD Request (Type 0x03)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-6\",\n    \"content\": \"Expand PDS 3.3.5 Control Packet (Type 0x04)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-7\",\n    \"content\": \"Expand PDS 3.3.6 ACK (Type 0x08)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-8\",\n    \"content\": \"Expand PDS 3.3.7 ACK_CC (Type 0x09)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-9\",\n    \"content\": \"Expand PDS 3.3.8 ACK_CCX (Type 0x0A)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-10\",\n    \"content\": \"Expand PDS 3.3.9 NACK (Type 0x0C)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-11\",\n    \"content\": \"Expand PDS 3.3.10 NACK_CCX (Type 0x0D)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-12\",\n    \"content\": \"Expand SES 3.5.1 Standard Request SOM=1 (Table 3-8)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-13\",\n    \"content\": \"Expand SES 3.5.2 Standard Request SOM=0 (Table 3-9)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-14\",\n    \"content\": \"Expand SES 3.5.3 Response (Table 3-11)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-15\",\n    \"content\": \"Expand SES 3.5.4 Response with Data (Table 3-12)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-16\",\n    \"content\": \"Expand SES 3.5.5 Optimized Response with Data (Figure 3-13)\",\n    \"status\": \"cancelled\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p1-17\",\n    \"content\": \"Expand SES 3.5.6 Small Message (Figure 3-14)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-18\",\n    \"content\": \"Expand SES 3.5.7 Rendezvous Extension (Figure 3-15)\",\n    \"status\": \"completed\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p1-19\",\n    \"content\": \"Expand SES 3.5.8 Atomic Extension (Figure 3-16)\",\n    \"status\": \"completed\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p1-20\",\n    \"content\": \"Add cross-reference diagrams to section headers\",\n    \"status\": \"completed\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p1-21\",\n    \"content\": \"Validation pass against .ksy files\",\n    \"status\": \"in_progress\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-22\",\n    \"content\": \"Update change log\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  }\n]",
            "title": "3 todos",
            "metadata": {
              "todos": [
                {
                  "id": "p1-1",
                  "content": "Read current packet_taxonomy.md Section 3 structure",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-2",
                  "content": "Expand PDS 3.3.1 UUD Request (Type 0x00)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-3",
                  "content": "Expand PDS 3.3.2 RUDI Request/Response (Type 0x01)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-4",
                  "content": "Expand PDS 3.3.3 RUD Request (Type 0x02)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-5",
                  "content": "Expand PDS 3.3.4 ROD Request (Type 0x03)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-6",
                  "content": "Expand PDS 3.3.5 Control Packet (Type 0x04)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-7",
                  "content": "Expand PDS 3.3.6 ACK (Type 0x08)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-8",
                  "content": "Expand PDS 3.3.7 ACK_CC (Type 0x09)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-9",
                  "content": "Expand PDS 3.3.8 ACK_CCX (Type 0x0A)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-10",
                  "content": "Expand PDS 3.3.9 NACK (Type 0x0C)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-11",
                  "content": "Expand PDS 3.3.10 NACK_CCX (Type 0x0D)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-12",
                  "content": "Expand SES 3.5.1 Standard Request SOM=1 (Table 3-8)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-13",
                  "content": "Expand SES 3.5.2 Standard Request SOM=0 (Table 3-9)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-14",
                  "content": "Expand SES 3.5.3 Response (Table 3-11)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-15",
                  "content": "Expand SES 3.5.4 Response with Data (Table 3-12)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-16",
                  "content": "Expand SES 3.5.5 Optimized Response with Data (Figure 3-13)",
                  "status": "cancelled",
                  "priority": "medium"
                },
                {
                  "id": "p1-17",
                  "content": "Expand SES 3.5.6 Small Message (Figure 3-14)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-18",
                  "content": "Expand SES 3.5.7 Rendezvous Extension (Figure 3-15)",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "p1-19",
                  "content": "Expand SES 3.5.8 Atomic Extension (Figure 3-16)",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "p1-20",
                  "content": "Add cross-reference diagrams to section headers",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "p1-21",
                  "content": "Validation pass against .ksy files",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "p1-22",
                  "content": "Update change log",
                  "status": "pending",
                  "priority": "medium"
                }
              ],
              "truncated": false
            },
            "time": {
              "start": 1769123864437,
              "end": 1769123864497
            }
          }
        },
        {
          "id": "prt_be7ffdfb20017rukEfQlEA0iXR",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7ffa00d001I67tBWMETl76Yj",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 99510,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7ffdff3001D6N2Zx18315yYf",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769123864563,
          "completed": 1769123871935
        },
        "parentID": "msg_be7faadd7001qnhXPM5tKghXUR",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 100531,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be7ffe48e001XfIaDxYA8lzsWC",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7ffdff3001D6N2Zx18315yYf",
          "type": "step-start"
        },
        {
          "id": "prt_be7fffc0d001TVvCC4DTY1QSXz",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7ffdff3001D6N2Zx18315yYf",
          "type": "tool",
          "callID": "toolu_011sGpCXft2ifhAVoJKm4NuU",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
              "offset": 1180,
              "limit": 60
            },
            "output": "<file>\n01181| | memory_key | 64 | 4-11 | Initiator memory key | For target to pull data |\n01182| | buffer_offset | 64 | 12-19 | Initiator buffer offset | Start of remaining data |\n01183| | remaining_length | 32 | 20-23 | Remaining data length | Bytes to pull |\n01184| | rsvd | 64 | 24-31 | Reserved | Must be 0 |\n01185| \n01186| ##### Protocol Behavior\n01187| \n01188| **Rendezvous Protocol**:\n01189| 1. Initiator sends request with eager data + rendezvous extension\n01190| 2. Target receives eager data, allocates buffer\n01191| 3. Target issues RDMA Read to pull remaining data using {memory_key, buffer_offset}\n01192| 4. Target completes operation when all data received\n01193| \n01194| **Two-Sided Protocol**:\n01195| - Enables large message transfer without pre-registered buffers\n01196| - Target controls when/how to pull remaining data\n01197| - Reduces memory registration overhead\n01198| \n01199| **Constraints**:\n01200| - MUST NOT be combined with atomic extension\n01201| - Placed on every packet using rendezvous opcode\n01202| \n01203| **Reference**: UE Spec v1.0.1, Figure 3-15, Section 3.4.2.3, Page 165\n01204| \n01205| ---\n01206| \n01207| #### 3.5.7 Atomic Extension (Figure 3-16, 8 bytes)\n01208| \n01209| **Datamodel**: `datamodel/protocols/ue/transport/ses/atomic_extension.ksy`  \n01210| **Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes) | [Response with Data (3.5.4)](#354-response-with-data-table-3-12-24-bytes)\n01211| \n01212| ##### Wire Format\n01213| \n01214| ```\n01215| Byte:    0       1       2       3       4       5       6       7\n01216|      +-------+-------+-------+-------+-------+-------+-------+-------+\n01217|      |atomic_opcode  |atomic_datatype| semantic_control  | reserved  |\n01218|      +-------+-------+-------+-------+-------+-------+-------+-------+\n01219| ```\n01220| \n01221| ##### Field Definitions\n01222| \n01223| | Field | Bits | Offset | Description | Constraints |\n01224| |-------|------|--------|-------------|-------------|\n01225| | atomic_opcode | 8 | 0 | Atomic operation | Per Table 3-21 |\n01226| | atomic_datatype | 8 | 1 | Data type | Per Table 3-22 |\n01227| | semantic_control | 16 | 2-3 | Semantic control | Per Table 3-23 |\n01228| | rsvd | 32 | 4-7 | Reserved | Must be 0 |\n01229| \n01230| ##### Atomic Opcodes (Table 3-21)\n01231| \n01232| | Code | Name | Operation |\n01233| |------|------|-----------|\n01234| | 0x00 | MIN | Target = MIN(Target, Initiator) |\n01235| | 0x01 | MAX | Target = MAX(Target, Initiator) |\n01236| | 0x02 | SUM | Target = Target + Initiator |\n01237| | 0x03 | DIFF | Target = Target - Initiator |\n01238| | 0x04 | PROD | Target = Target * Initiator |\n01239| | 0x05 | LOR | Target = Target \\|\\| Initiator |\n01240| | 0x06 | LAND | Target = Target && Initiator |\n\n(File has more lines. Use 'offset' parameter to read beyond line 1240)\n</file>",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy.md",
            "metadata": {
              "preview": "| memory_key | 64 | 4-11 | Initiator memory key | For target to pull data |\n| buffer_offset | 64 | 12-19 | Initiator buffer offset | Start of remaining data |\n| remaining_length | 32 | 20-23 | Remaining data length | Bytes to pull |\n| rsvd | 64 | 24-31 | Reserved | Must be 0 |\n\n##### Protocol Behavior\n\n**Rendezvous Protocol**:\n1. Initiator sends request with eager data + rendezvous extension\n2. Target receives eager data, allocates buffer\n3. Target issues RDMA Read to pull remaining data using {memory_key, buffer_offset}\n4. Target completes operation when all data received\n\n**Two-Sided Protocol**:\n- Enables large message transfer without pre-registered buffers\n- Target controls when/how to pull remaining data\n- Reduces memory registration overhead\n\n**Constraints**:\n- MUST NOT be combined with atomic extension",
              "truncated": true
            },
            "time": {
              "start": 1769123871762,
              "end": 1769123871918
            }
          }
        },
        {
          "id": "prt_be7fffcb0001uxeB5qD6mGimN7",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7ffdff3001D6N2Zx18315yYf",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 100531,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be7fffd4b001VTWzObP8YuEZhp",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769123872075,
          "completed": 1769123879257
        },
        "parentID": "msg_be7faadd7001qnhXPM5tKghXUR",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 101482,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be800020e001UB3JqM7Lqueewo",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fffd4b001VTWzObP8YuEZhp",
          "type": "step-start"
        },
        {
          "id": "prt_be8001864001iMikftQqSfG0Y2",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fffd4b001VTWzObP8YuEZhp",
          "type": "tool",
          "callID": "toolu_01NWL76BeENhnU9sSTAvyaJe",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
              "offset": 1280,
              "limit": 80
            },
            "output": "<file>\n01281| \n01282| **Constraints**:\n01283| - MUST NOT be combined with rendezvous extension\n01284| - Fetching atomics MUST NOT operate on more than one element\n01285| \n01286| **Reference**: UE Spec v1.0.1, Figure 3-16, Section 3.4.2.4, Page 165\n01287| \n01288| ### 3.6 CMS (Congestion Management Sublayer)\n01289| \n01290| **Datamodel Directory**: `datamodel/protocols/ue/transport/cms/`\n01291| \n01292| | Format | File | Description |\n01293| |--------|------|-------------|\n01294| | Credit CP Payload | `credit_cp_payload.ksy` | Credit control packet |\n01295| | Credit Request | `credit_request_cp_payload.ksy` | Credit request |\n01296| | Request CC State | `req_cc_state.ksy` | Request CC state |\n01297| | ACK CC State (NSCC) | `ack_cc_state_nscc.ksy` | NSCC algorithm state |\n01298| | ACK CC State (RCCC/TFC) | `ack_cc_state_rccc_tfc.ksy` | RCCC/TFC state |\n01299| \n01300| ### 3.7 TSS (Transport Security Sublayer)\n01301| \n01302| **Datamodel Directory**: `datamodel/protocols/ue/transport/tss/`\n01303| \n01304| | Format | File | Description |\n01305| |--------|------|-------------|\n01306| | Security Header | `security_header.ksy` | Encryption header |\n01307| | IV Construction | `iv_construction.ksy` | Initialization vector |\n01308| | Key Rotation | `protocols/key_rotation.ksy` | Key rotation protocol |\n01309| | KDF Direct | `protocols/kdf_direct.ksy` | Direct key derivation |\n01310| | KDF Client/Server | `protocols/kdf_client_server.ksy` | Client/server KDF |\n01311| | KDF Cluster | `protocols/kdf_cluster.ksy` | Cluster KDF |\n01312| | Join Secure Domain | `protocols/join_secure_domain.ksy` | Domain join |\n01313| | TSS TX Processing | `protocols/tss_tx_processing.ksy` | Transmit processing |\n01314| | TSS RX Processing | `protocols/tss_rx_processing.ksy` | Receive processing |\n01315| \n01316| ### 3.8 Link Layer Formats\n01317| \n01318| #### LLR (Link-Level Retry)\n01319| \n01320| **Datamodel Directory**: `datamodel/protocols/ue/link/llr/`\n01321| \n01322| | Format | File | Description |\n01323| |--------|------|-------------|\n01324| | LLR Preamble (64b66b) | `llr_preamble_64b66b.ksy` | 64b66b preamble |\n01325| | LLR Preamble (MII) | `llr_preamble_mii.ksy` | MII preamble |\n01326| | LLR Init CTLOS | `llr_init_ctlos.ksy` | Initialize LLR |\n01327| | LLR Init Echo CTLOS | `llr_init_echo_ctlos.ksy` | Init acknowledgment |\n01328| | LLR ACK CTLOS | `llr_ack_ctlos.ksy` | Frame acknowledgment |\n01329| | LLR NACK CTLOS | `llr_nack_ctlos.ksy` | Retransmit request |\n01330| \n01331| #### CBFC (Credit-Based Flow Control)\n01332| \n01333| **Datamodel Directory**: `datamodel/protocols/ue/link/cbfc/`\n01334| \n01335| | Format | File | Description |\n01336| |--------|------|-------------|\n01337| | CF Update | `cf_update.ksy` | Credit flow update |\n01338| | CC Update | `cc_update.ksy` | Credit count update |\n01339| | VC State Machine | `protocols/vc_state_machine.ksy` | Virtual channel FSM |\n01340| | Lossless VC Init | `protocols/lossless_vc_init.ksy` | VC initialization |\n01341| | Lossless VC Removal | `protocols/lossless_vc_removal.ksy` | VC teardown |\n01342| \n01343| #### LLDP Extensions\n01344| \n01345| **Datamodel Directory**: `datamodel/protocols/ue/link/lldp/`\n01346| \n01347| | Format | File | Description |\n01348| |--------|------|-------------|\n01349| | UE Link Negotiation TLV | `ue_link_negotiation_tlv.ksy` | Link negotiation |\n01350| | UE CBFC TLV | `ue_cbfc_tlv.ksy` | CBFC parameters |\n01351| \n01352| ---\n01353| \n01354| ## 4. RoCEv2 Formats\n01355| \n01356| **Datamodel Directory**: `datamodel/protocols/roce/transport/`\n01357| \n01358| ### 4.1 RoCEv2 Packet Structure\n01359| \n01360| ```\n\n(File has more lines. Use 'offset' parameter to read beyond line 1360)\n</file>",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy.md",
            "metadata": {
              "preview": "\n**Constraints**:\n- MUST NOT be combined with rendezvous extension\n- Fetching atomics MUST NOT operate on more than one element\n\n**Reference**: UE Spec v1.0.1, Figure 3-16, Section 3.4.2.4, Page 165\n\n### 3.6 CMS (Congestion Management Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/cms/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Credit CP Payload | `credit_cp_payload.ksy` | Credit control packet |\n| Credit Request | `credit_request_cp_payload.ksy` | Credit request |\n| Request CC State | `req_cc_state.ksy` | Request CC state |\n| ACK CC State (NSCC) | `ack_cc_state_nscc.ksy` | NSCC algorithm state |\n| ACK CC State (RCCC/TFC) | `ack_cc_state_rccc_tfc.ksy` | RCCC/TFC state |\n\n### 3.7 TSS (Transport Security Sublayer)",
              "truncated": true
            },
            "time": {
              "start": 1769123879019,
              "end": 1769123879242
            }
          }
        },
        {
          "id": "prt_be800194c00149JLg5hTYKOhRa",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be7fffd4b001VTWzObP8YuEZhp",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 101482,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be80019ea001KWzahyVgJ5TcA8",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769123879402,
          "completed": 1769123886367
        },
        "parentID": "msg_be7faadd7001qnhXPM5tKghXUR",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 102709,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be8001e41001gC0yU5wGLwzWp6",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be80019ea001KWzahyVgJ5TcA8",
          "type": "step-start"
        },
        {
          "id": "prt_be8003490001ovse0hYl1qV6cJ",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be80019ea001KWzahyVgJ5TcA8",
          "type": "tool",
          "callID": "toolu_0179BAxg9i4w32rgd3YJToQZ",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
              "offset": 1560,
              "limit": 80
            },
            "output": "<file>\n01561| \n01562| **Datamodel**: `datamodel/protocols/cornelis/network/ufh_32.ksy`\n01563| \n01564| UFH-32 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 32-bit addressing for large-scale deployments.\n01565| \n01566| ```\n01567|          MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n01568| +-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n01569| | Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n01570| +-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n01571| |Type|  |       |   Destination (32-bit BE)     |HopLim |Traffic|       Source (32-bit BE)      |\n01572| |[7:4]  |Opaque |                               |[7:4]  |Class  |                               |\n01573| |SLAP   |       |                               |Z|Y|X|M|[7:0]  |                               |\n01574| |[3:0]  |       |                               |[3:0]  |       |                               |\n01575| +-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n01576| ```\n01577| \n01578| | Field | Byte(s) | Bits | Description |\n01579| |-------|---------|------|-------------|\n01580| | Type | 0 | [7:4] | Packet type for forwarding decisions |\n01581| | SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n01582| | Opaque | 1 | [7:0] | Opaque to hardware |\n01583| | Destination | 2-5 | 32 | Destination endpoint address (big-endian) |\n01584| | Hop Limit | 6 | [7:4] | TTL/hop count |\n01585| | SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n01586| | Traffic Class | 7 | [7:0] | QoS / priority classification |\n01587| | Source | 8-11 | 32 | Source endpoint address (big-endian) |\n01588| \n01589| **SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n01590| \n01591| **UFH-32 Type Values**:\n01592| \n01593| | Value | Type | Description |\n01594| |-------|------|-------------|\n01595| | 0 | Data | Data packet |\n01596| | 1 | Control | Control packet |\n01597| | 2 | Collective | Collective operation packet |\n01598| | 3 | Credit | Credit/flow control |\n01599| | 4 | Management | Management packet |\n01600| | 5 | Multicast | Multicast packet |\n01601| | 6 | Barrier | Barrier synchronization |\n01602| | 7 | Reduction | Reduction operation |\n01603| | 8-14 | Reserved | Reserved for future use |\n01604| | 15 | Vendor | Vendor-specific packet |\n01605| \n01606| **Usage**: Large-scale scale-up fabric forwarding (4+ billion endpoints), multi-pod communication, extended collective operations.\n01607| \n01608| ### 6.3 Transport Layer\n01609| \n01610| | Format | File | Description |\n01611| |--------|------|-------------|\n01612| | CSIG+ | `transport/csig_plus.ksy` | Telemetry header |\n01613| | PKEY | `transport/pkey.ksy` | Partition key |\n01614| \n01615| ### 6.4 Encapsulation\n01616| \n01617| | Format | File | Description |\n01618| |--------|------|-------------|\n01619| | VxLAN+ | `encapsulation/vxlan_plus.ksy` | Extended VxLAN overlay |\n01620| \n01621| ---\n01622| \n01623| ## 7. Host-Software Interface (HSI) Formats\n01624| \n01625| **Datamodel Directory**: `datamodel/hw/asics/pmr/interfaces/host_interface/`\n01626| \n01627| ### 7.1 Command Queue Segment (64 bytes)\n01628| \n01629| **Datamodel**: `command_queue_segment.ksy`\n01630| \n01631| ```\n01632| +-------+-------+-------+-------+-------+-------+-------+-------+\n01633| | Byte 0        | Byte 1        | Bytes 2-3     | Bytes 4-7     |\n01634| +-------+-------+-------+-------+-------+-------+-------+-------+\n01635| | Opcode        | Flags         | Payload Len   | Reserved      |\n01636| +-------+-------+-------+-------+-------+-------+-------+-------+\n01637| | Bytes 8-15                    | Bytes 16-23                   |\n01638| +-------+-------+-------+-------+-------+-------+-------+-------+\n01639| | Tag (64 bits)                 | Dest (64 bits)                |\n01640| +-------+-------+-------+-------+-------+-------+-------+-------+\n\n(File has more lines. Use 'offset' parameter to read beyond line 1640)\n</file>",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy.md",
            "metadata": {
              "preview": "\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_32.ksy`\n\nUFH-32 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 32-bit addressing for large-scale deployments.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |       |   Destination (32-bit BE)     |HopLim |Traffic|       Source (32-bit BE)      |\n|[7:4]  |Opaque |                               |[7:4]  |Class  |                               |\n|SLAP   |       |                               |Z|Y|X|M|[7:0]  |                               |\n|[3:0]  |       |                               |[3:0]  |       |                               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |",
              "truncated": true
            },
            "time": {
              "start": 1769123886236,
              "end": 1769123886355
            }
          }
        },
        {
          "id": "prt_be8003514001Vuoj6MzRYZ7cvY",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be80019ea001KWzahyVgJ5TcA8",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 102709,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be800357b001jzgfj6T0acb7Lo",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769123886459,
          "completed": 1769123893287
        },
        "parentID": "msg_be7faadd7001qnhXPM5tKghXUR",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 104119,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be80039d0001tfro5FT6yxRgfk",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be800357b001jzgfj6T0acb7Lo",
          "type": "step-start"
        },
        {
          "id": "prt_be8004f7b001oyeZJsbouark02",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be800357b001jzgfj6T0acb7Lo",
          "type": "tool",
          "callID": "toolu_013Sp9x2UYzr1wPixs44j2pL",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
              "offset": 1720,
              "limit": 100
            },
            "output": "<file>\n01721| \n01722| Electric Creek is the management complex shared between PMR NIC and LNR Switch.\n01723| \n01724| ---\n01725| \n01726| ## 9. Work List\n01727| \n01728| This section tracks issues requiring follow-up investigation or specification updates.\n01729| \n01730| ### 9.1 Open Issues\n01731| \n01732| | ID | Priority | Category | Description | Status | Opened | Closed |\n01733| |----|----------|----------|-------------|--------|--------|--------|\n01734| | W-06-001 | Medium | Datamodel | UFH-32 lacks 16-bit entropy field; per-packet ECMP not supported; switch must derive entropy from Src+Dest hash | Deferred | 2026-01-20 | - |\n01735| | W-07-001 | Low | Datamodel | `ack_cc.ksy` shows `ack_cc_state` as 32-bit (4 bytes) but UE Spec Table 3-36 shows 64-bit (8 bytes); verify field size | Investigation | 2026-01-22 | - |\n01736| | W-07-002 | Low | Documentation | `collective_l2.ksy` and `scaleup_l2.ksy` marked as \"work_in_progress\" with spec_version 0.1; specifications incomplete | Spec Update | 2026-01-22 | - |\n01737| | W-07-003 | Low | Datamodel | `ue_plus.ksy` 9-bit length field split across bytes 0-1 with unusual encoding (1 bit in byte 0, 8 bits in byte 1); verify encoding matches UE Spec | Investigation | 2026-01-22 | - |\n01738| | W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |\n01739| | W-05-002 | Medium | Specification | MTU values: Verify maximum MTU for each protocol | Investigation | 2026-01-10 | - |\n01740| | W-05-003 | Medium | Documentation | CMS detailed formats: Need comprehensive documentation | Spec Update | 2026-01-10 | - |\n01741| | W-03-002 | Low | Terminology | PDP vs PDS naming: UML uses both terms inconsistently | Spec Update | 2026-01-08 | - |\n01742| | W-03-006 | Low | Terminology | SES vs SE: \"SES Processing Groups\" vs \"Semantic Engines\" | Spec Update | 2026-01-08 | - |\n01743| \n01744| ### 9.2 Datamodel Gaps\n01745| \n01746| | ID | Priority | Description | Target Location | Status | Opened | Closed |\n01747| |----|----------|-------------|-----------------|--------|--------|--------|\n01748| | D-001 | High | PMR CSR definitions missing from datamodel | `datamodel/hw/asics/pmr/csrs/*.rdl` | Spec Update | 2026-01-10 | - |\n01749| | D-002 | Medium | PMR block hierarchy YAML incomplete | `datamodel/hw/asics/pmr/blocks.yaml` | Spec Update | 2026-01-10 | - |\n01750| | D-003 | Medium | PMR interface contracts missing | `datamodel/views/contracts/pmr-*.puml` | Spec Update | 2026-01-10 | - |\n01751| \n01752| ### 9.3 Specification Clarifications Needed\n01753| \n01754| | ID | Priority | Question | Context | Status | Opened | Closed |\n01755| |----|----------|----------|---------|--------|--------|--------|\n01756| | Q1 | Medium | Lightweight Interface Scope | What features should be reduced in lightweight mode? | Investigation | 2026-01-10 | - |\n01757| | Q2 | Medium | Tag Table Sizing | Should HW tag table size be per-endpoint configurable? | Investigation | 2026-01-10 | - |\n01758| | Q3 | Medium | Multi-Packet Eager Messages | Should hardware support multi-packet eager messages? | Investigation | 2026-01-10 | - |\n01759| | Q4 | Low | RoCE Work Queue Implementation | Confirm RoCE WQ/CQ are software-implemented | Investigation | 2026-01-10 | - |\n01760| \n01761| ### 9.4 Closed Issues\n01762| \n01763| | ID | Priority | Category | Description | Resolution | Opened | Closed |\n01764| |----|----------|----------|-------------|------------|--------|--------|\n01765| | W-05-001 | Medium | Documentation | UE taxonomy reference | Documented in `05-packet-formats.md` | 2026-01-08 | 2026-01-10 |\n01766| | W-02-005 | Medium | Documentation | Protocol support documentation | Documented UE+, RoCEv2, Ethernet | 2026-01-08 | 2026-01-10 |\n01767| | W-02-006 | Medium | Documentation | Cornelis Collective Reduction Protocol | Documented in HAS §2.5.4 | 2026-01-08 | 2026-01-10 |\n01768| | W-03-001 | Medium | Architecture | Semantic Engine count | Confirmed 64 (8x8) in UML and HAS | 2026-01-08 | 2026-01-10 |\n01769| | W-17-005 | Low | Documentation | Port subdivision note | Added to HAS Ch17 | 2026-01-11 | 2026-01-11 |\n01770| | W-17-006 | Medium | Documentation | MPORT interface documentation | Documented 256B @ 1.66 GHz | 2026-01-11 | 2026-01-11 |\n01771| | W-04-005 | High | Datamodel | `ufh_16.ksy` address size: Datamodel shows 12-bit dest, should be 16-bit | UFH-16 restructured to 12-byte Ethernet MAC overlay with 16-bit destination (bytes 4-5) and 16-bit source (bytes 10-11) | 2026-01-10 | 2026-01-20 |\n01772| | W-04-006 | High | Datamodel | `ufh_32.ksy` address size: Datamodel shows 16-bit dest, should be 32-bit | UFH-32 restructured to 12-byte Ethernet MAC overlay with 32-bit destination (bytes 2-5) and 32-bit source (bytes 8-11) | 2026-01-10 | 2026-01-20 |\n01773| \n01774| ### 9.5 Change Log\n01775| \n01776| | Date | Change | Details |\n01777| |------|--------|---------|\n01778| | 2026-01-14 | Initial creation | Document created with PMR packet taxonomy |\n01779| | 2026-01-20 | Review and update | Added UALink section (reference only, not PMR-supported); Added change log; Updated datamodel file counts; No new .ksy files since initial creation |\n01780| | 2026-01-20 | UFH format details | Added detailed UFH-16 and UFH-32 format documentation in Section 6.2 (wire diagrams, field tables, type enumerations) |\n01781| | 2026-01-20 | UFH restructuring | UFH-16 and UFH-32 restructured to 12-byte Ethernet MAC overlays; UFH-16 now 16-bit addressing, UFH-32 now 32-bit addressing; Added SLAP field constraints (Z,Y,X=001); Updated datamodel .ksy files; Closed W-04-005 and W-04-006 |\n01782| | 2026-01-22 | Datamodel review | Added W-07-001 (ack_cc_state size mismatch), W-07-002 (collective/scaleup specs incomplete), W-07-003 (ue_plus length encoding); Identified 30+ packet formats requiring expansion |\n01783| \n01784| ---\n01785| \n01786| ## 10. UALink Protocol (Reference Only)\n01787| \n01788| **Note**: UALink is defined in the datamodel but is **NOT currently supported by PMR**. It is included here for reference as it may be relevant for future AI/ML accelerator interconnect work.\n01789| \n01790| **Datamodel Directory**: `datamodel/protocols/ualink/`\n01791| \n01792| ### 10.1 UALink Overview\n01793| \n01794| UALink is an AI/ML accelerator interconnect protocol with 38 packet definitions across all OSI layers.\n01795| \n01796| | Layer | Count | Key Formats |\n01797| |-------|-------|-------------|\n01798| | UPLI (Upper Protocol Layer Interface) | 8 | commands.ksy, request_channel.ksy, status_codes.ksy |\n01799| | Transaction | 9 | tl_flit.ksy, control_half_flit.ksy, data_half_flit.ksy |\n01800| | Data Link | 12 | dl_flit.ksy, segment_header.ksy, crc.ksy, control_messages.ksy |\n01801| | Physical | 4 | alignment_markers.ksy, control_ordered_sets.ksy, link_training.ksy |\n01802| | Security | 5 | authentication.ksy, encryption.ksy, key_derivation.ksy |\n01803| \n01804| ### 10.2 UALink Packet Formats\n01805| \n01806| #### UPLI Layer\n01807| | Format | File | Description |\n01808| |--------|------|-------------|\n01809| | Commands | `upli/commands.ksy` | UPLI command definitions |\n01810| | Request Channel | `upli/request_channel.ksy` | Request channel format |\n01811| | Originator Data | `upli/originator_data_channel.ksy` | Originator data channel |\n01812| | Read Response | `upli/read_response_channel.ksy` | Read response channel |\n01813| | Write Response | `upli/write_response_channel.ksy` | Write response channel |\n01814| | Status Codes | `upli/status_codes.ksy` | Status code definitions |\n01815| | Connection Handshake | `upli/protocols/connection_handshake.ksy` | Connection setup |\n01816| | Flow Control | `upli/protocols/flow_control.ksy` | Flow control protocol |\n01817| \n01818| #### Transaction Layer\n01819| | Format | File | Description |\n01820| |--------|------|-------------|\n\n(File has more lines. Use 'offset' parameter to read beyond line 1820)\n</file>",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy.md",
            "metadata": {
              "preview": "\nElectric Creek is the management complex shared between PMR NIC and LNR Switch.\n\n---\n\n## 9. Work List\n\nThis section tracks issues requiring follow-up investigation or specification updates.\n\n### 9.1 Open Issues\n\n| ID | Priority | Category | Description | Status | Opened | Closed |\n|----|----------|----------|-------------|--------|--------|--------|\n| W-06-001 | Medium | Datamodel | UFH-32 lacks 16-bit entropy field; per-packet ECMP not supported; switch must derive entropy from Src+Dest hash | Deferred | 2026-01-20 | - |\n| W-07-001 | Low | Datamodel | `ack_cc.ksy` shows `ack_cc_state` as 32-bit (4 bytes) but UE Spec Table 3-36 shows 64-bit (8 bytes); verify field size | Investigation | 2026-01-22 | - |\n| W-07-002 | Low | Documentation | `collective_l2.ksy` and `scaleup_l2.ksy` marked as \"work_in_progress\" with spec_version 0.1; specifications incomplete | Spec Update | 2026-01-22 | - |\n| W-07-003 | Low | Datamodel | `ue_plus.ksy` 9-bit length field split across bytes 0-1 with unusual encoding (1 bit in byte 0, 8 bits in byte 1); verify encoding matches UE Spec | Investigation | 2026-01-22 | - |\n| W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |\n| W-05-002 | Medium | Specification | MTU values: Verify maximum MTU for each protocol | Investigation | 2026-01-10 | - |\n| W-05-003 | Medium | Documentation | CMS detailed formats: Need comprehensive documentation | Spec Update | 2026-01-10 | - |",
              "truncated": true
            },
            "time": {
              "start": 1769123893118,
              "end": 1769123893272
            }
          }
        },
        {
          "id": "prt_be800501a001ag1SaDrrlVyvnS",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be800357b001jzgfj6T0acb7Lo",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 104119,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be800508b001BLBtapAvCJwdMV",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769123893387,
          "completed": 1769123908258
        },
        "parentID": "msg_be7faadd7001qnhXPM5tKghXUR",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 106757,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be8005501001eXzT2L7SIYDt8H",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be800508b001BLBtapAvCJwdMV",
          "type": "step-start"
        },
        {
          "id": "prt_be8008a2a001wvc9v60tsQmuJ3",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be800508b001BLBtapAvCJwdMV",
          "type": "tool",
          "callID": "toolu_011AU1rkHVPoBPSpNYufgqx3",
          "tool": "edit",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
              "oldString": "| Date | Change | Details |\n|------|--------|---------|\n| 2026-01-14 | Initial creation | Document created with PMR packet taxonomy |\n| 2026-01-20 | Review and update | Added UALink section (reference only, not PMR-supported); Added change log; Updated datamodel file counts; No new .ksy files since initial creation |\n| 2026-01-20 | UFH format details | Added detailed UFH-16 and UFH-32 format documentation in Section 6.2 (wire diagrams, field tables, type enumerations) |\n| 2026-01-20 | UFH restructuring | UFH-16 and UFH-32 restructured to 12-byte Ethernet MAC overlays; UFH-16 now 16-bit addressing, UFH-32 now 32-bit addressing; Added SLAP field constraints (Z,Y,X=001); Updated datamodel .ksy files; Closed W-04-005 and W-04-006 |\n| 2026-01-22 | Datamodel review | Added W-07-001 (ack_cc_state size mismatch), W-07-002 (collective/scaleup specs incomplete), W-07-003 (ue_plus length encoding); Identified 30+ packet formats requiring expansion |",
              "newString": "| Date | Change | Details |\n|------|--------|---------|\n| 2026-01-14 | Initial creation | Document created with PMR packet taxonomy |\n| 2026-01-20 | Review and update | Added UALink section (reference only, not PMR-supported); Added change log; Updated datamodel file counts; No new .ksy files since initial creation |\n| 2026-01-20 | UFH format details | Added detailed UFH-16 and UFH-32 format documentation in Section 6.2 (wire diagrams, field tables, type enumerations) |\n| 2026-01-20 | UFH restructuring | UFH-16 and UFH-32 restructured to 12-byte Ethernet MAC overlays; UFH-16 now 16-bit addressing, UFH-32 now 32-bit addressing; Added SLAP field constraints (Z,Y,X=001); Updated datamodel .ksy files; Closed W-04-005 and W-04-006 |\n| 2026-01-22 | Datamodel review | Added W-07-001 (ack_cc_state size mismatch), W-07-002 (collective/scaleup specs incomplete), W-07-003 (ue_plus length encoding); Identified 30+ packet formats requiring expansion |\n| 2026-01-22 | Phase 1 expansion | Expanded PDS formats (3.3.1-3.3.11): RUD, ROD, RUDI, UUD, ACK, ACK_CC, ACK_CCX, NACK, NACK_CCX, Control Packet with wire diagrams, field tables, protocol behavior, and cross-references. Expanded SES formats (3.5.1-3.5.7): Standard Request SOM=1/SOM=0, Response, Response with Data, Small Message, Rendezvous Extension, Atomic Extension. Added request/response relationship diagrams. Total ~1200 lines added. |"
            },
            "output": "Edit applied successfully.",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy.md",
            "metadata": {
              "diagnostics": {},
              "diff": "Index: /home/matkins/CN7000/analysis/packet_taxonomy.md\n===================================================================\n--- /home/matkins/CN7000/analysis/packet_taxonomy.md\n+++ /home/matkins/CN7000/analysis/packet_taxonomy.md\n@@ -1779,8 +1779,9 @@\n | 2026-01-20 | Review and update | Added UALink section (reference only, not PMR-supported); Added change log; Updated datamodel file counts; No new .ksy files since initial creation |\n | 2026-01-20 | UFH format details | Added detailed UFH-16 and UFH-32 format documentation in Section 6.2 (wire diagrams, field tables, type enumerations) |\n | 2026-01-20 | UFH restructuring | UFH-16 and UFH-32 restructured to 12-byte Ethernet MAC overlays; UFH-16 now 16-bit addressing, UFH-32 now 32-bit addressing; Added SLAP field constraints (Z,Y,X=001); Updated datamodel .ksy files; Closed W-04-005 and W-04-006 |\n | 2026-01-22 | Datamodel review | Added W-07-001 (ack_cc_state size mismatch), W-07-002 (collective/scaleup specs incomplete), W-07-003 (ue_plus length encoding); Identified 30+ packet formats requiring expansion |\n+| 2026-01-22 | Phase 1 expansion | Expanded PDS formats (3.3.1-3.3.11): RUD, ROD, RUDI, UUD, ACK, ACK_CC, ACK_CCX, NACK, NACK_CCX, Control Packet with wire diagrams, field tables, protocol behavior, and cross-references. Expanded SES formats (3.5.1-3.5.7): Standard Request SOM=1/SOM=0, Response, Response with Data, Small Message, Rendezvous Extension, Atomic Extension. Added request/response relationship diagrams. Total ~1200 lines added. |\n \n ---\n \n ## 10. UALink Protocol (Reference Only)\n",
              "filediff": {
                "file": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
                "before": "# PMR (CN7000) Packet Format Taxonomy\n\n**Document**: Packet formats supported by PMR NIC ASIC  \n**Generated**: 2026-01-14  \n**Last Reviewed**: 2026-01-20  \n**Source**: `datamodel/` directory in EarlySim repository  \n**Reference**: `docs/HAS/PMR/05-packet-formats.md`\n\n---\n\n## Table of Contents\n\n1. [Overview](#1-overview)\n2. [Protocol Stack Summary](#2-protocol-stack-summary)\n3. [Ultra Ethernet+ (UE+) Formats](#3-ultra-ethernet-ue-formats)\n4. [RoCEv2 Formats](#4-rocev2-formats)\n5. [Standard Ethernet Formats](#5-standard-ethernet-formats)\n6. [Cornelis Proprietary Formats](#6-cornelis-proprietary-formats)\n7. [Host-Software Interface (HSI) Formats](#7-host-software-interface-hsi-formats)\n8. [IP Block Descriptors](#8-ip-block-descriptors)\n9. [Work List](#9-work-list)\n10. [UALink Protocol (Reference Only)](#10-ualink-protocol-reference-only)\n11. [References](#11-references)\n\n---\n\n## 1. Overview\n\nPMR (Prism River) is Cornelis Networks' 1.6 Tbps NIC ASIC (CN7000 product family). It supports multiple wire protocols with per-packet protocol selection on a single physical port.\n\n### Supported Protocols\n\n| Protocol | Version | Status | Description |\n|----------|---------|--------|-------------|\n| Ultra Ethernet+ | 1.0.1 | Full | Optimized UE with Cornelis extensions |\n| RoCEv2 | v2 | Full | RDMA over Converged Ethernet |\n| Standard Ethernet | IEEE 802.3 | Full | Traditional Ethernet with offloads |\n| Cornelis Proprietary | 1.0.0 | Full | UFH, CSIG+, VxLAN+, Collectives |\n\n### Header Efficiency Comparison\n\n| Protocol Stack | Total Headers | Efficiency (4KB payload) |\n|----------------|---------------|--------------------------|\n| UE+ (small msg) | ~20 bytes | 99.5% |\n| UE+ (standard) | ~40 bytes | 99.0% |\n| RoCEv2 (IPv4) | ~58 bytes | 98.6% |\n| RoCEv2 (IPv6) | ~78 bytes | 98.1% |\n\n---\n\n## 2. Protocol Stack Summary\n\n```\n+-----------------------------------------------------------------------------+\n|                           Application Layer                                  |\n|                    (Libfabric, Verbs, Sockets, DPDK)                         |\n+-----------------------------------------------------------------------------+\n|                           Transport Layer                                    |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UE Transport   |  |     RoCEv2       |  |    TCP/UDP       |            |\n|  |   (SES/PDS/CMS)  |  |   (BTH/RETH)     |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                           Network Layer                                      |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UFH-16/32      |  |   IPv4/IPv6      |  |   IPv4/IPv6      |            |\n|  |   (Cornelis)     |  |   + UDP          |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                            Link Layer                                        |\n|  +------------------+  +------------------+  +------------------+            |\n|  |      UE+         |  |   Ethernet II    |  |   Ethernet II    |            |\n|  |   (12 bytes)     |  |   (14 bytes)     |  |   (14 bytes)     |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                          Physical Layer                                      |\n|                    Hill Creek (212.5G x8 PAM4 SerDes)                        |\n+-----------------------------------------------------------------------------+\n      Ultra Ethernet+           RoCEv2              Standard Ethernet\n```\n\n---\n\n## 3. Ultra Ethernet+ (UE+) Formats\n\n### 3.1 UE+ L2 Header (12 bytes)\n\n**Datamodel**: `datamodel/protocols/cornelis/link/ue_plus.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Byte 2        | Byte 3        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n|L2|V|zyxm|Len  | Length[7:0]   | RC    | SC    | Hop Count     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 4        | Byte 5        | Byte 6        | Byte 7        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Dest LID [15:8]               | Dest LID [7:0]                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Entropy [15:8]                | Entropy [7:0]                 |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 8        | Byte 9        | Byte 10       | Byte 11       |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Source LID [15:8]             | Source LID [7:0]              |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Payload Type [15:8]           | Payload Type [7:0]            |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| L2 Type | 2 | Always 0b10 for UE+ |\n| Version | 1 | Protocol version |\n| zyxm | 4 | Routing control flags (multicast, adaptive) |\n| Length | 9 | Packet length in bytes |\n| RC | 4 | Routing Class (QoS) |\n| SC | 4 | Service Class |\n| Hop | 8 | TTL/hop count |\n| Dest LID | 16 | Destination Local Identifier |\n| Entropy | 16 | ECMP hash for load balancing |\n| Source LID | 16 | Source Local Identifier |\n| Type | 16 | Payload type (EtherType equivalent) |\n\n**Payload Types**:\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x0800 | IPv4 | IPv4 payload |\n| 0x86DD | IPv6 | IPv6 payload |\n| 0x8100 | VLAN | VLAN tagged frame |\n| 0x9000 | VxLAN+ | VxLAN+ encapsulated |\n| 0x9100 | CSIG+ | CSIG+ telemetry |\n| 0xC000 | UE PDS | Ultra Ethernet PDS |\n\n### 3.2 PDS (Packet Delivery Sublayer) Prologue (2 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/prologue.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0                        | Byte 1                        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| type[4:0] | next_hdr/ctl[3:0] | flags[6:0]                    |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| PDS Type | Value | Description |\n|----------|-------|-------------|\n| Reserved | 0 | Reserved |\n| TSS | 1 | Transport Security (encryption) |\n| RUD Request | 2 | Reliable Unordered Delivery |\n| ROD Request | 3 | Reliable Ordered Delivery |\n| RUDI Request | 4 | Reliable Unordered Immediate |\n| RUDI Response | 5 | RUDI response |\n| UUD Request | 6 | Unreliable Unordered Delivery |\n| ACK | 7 | Acknowledgment |\n| ACK_CC | 8 | ACK with congestion control |\n| ACK_CCX | 9 | ACK with extended CC |\n| NACK | 10 | Negative acknowledgment |\n| CP | 11 | Control packet |\n| NACK_CCX | 12 | NACK with extended CC |\n| RUD_CC_REQ | 13 | RUD with CC state |\n| ROD_CC_REQ | 14 | ROD with CC state |\n\n### 3.3 PDS Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/pds/`\n\n```\nPDS Request/Response Relationships:\n┌─────────────────────────────────────────────────────────────────┐\n│                                                                 │\n│  UUD Request (0x06) ──────────────────────→ (no response)       │\n│                                                                 │\n│  RUDI Request (0x04) ─────────────────────→ RUDI Response (0x05)│\n│                       └───────────────────→ NACK (0x0A)         │\n│                                                                 │\n│  RUD Request (0x01) ──┬───────────────────→ ACK (0x07)          │\n│                       ├───────────────────→ ACK_CC (0x08)       │\n│                       ├───────────────────→ ACK_CCX (0x09)      │\n│                       ├───────────────────→ NACK (0x0A)         │\n│                       └───────────────────→ NACK_CCX (0x0C)     │\n│                                                                 │\n│  ROD Request (0x02) ──┴───────────────────→ (same as RUD)       │\n│                                                                 │\n│  Control Packet (0x0B) ───────────────────→ (varies by subtype) │\n│                                                                 │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n| Type | Format | File | Size | Description |\n|------|--------|------|------|-------------|\n| 0x01 | RUD Request | `rud_rod_request.ksy` | 12 bytes | Reliable Unordered Delivery |\n| 0x02 | ROD Request | `rud_rod_request.ksy` | 12 bytes | Reliable Ordered Delivery |\n| 0x04 | RUDI Request | `rudi_request_response.ksy` | 6 bytes | Reliable Unordered Immediate |\n| 0x05 | RUDI Response | `rudi_request_response.ksy` | 6 bytes | RUDI response |\n| 0x06 | UUD Request | `uud_request.ksy` | 6 bytes | Unreliable Unordered Delivery |\n| 0x07 | ACK | `rud_rod_ack.ksy` | 12 bytes | Acknowledgment |\n| 0x08 | ACK_CC | `ack_cc.ksy` | 28 bytes | ACK with CC state |\n| 0x09 | ACK_CCX | `ack_ccx.ksy` | 44 bytes | ACK with extended CC |\n| 0x0A | NACK | `nack.ksy` | 12 bytes | Negative acknowledgment |\n| 0x0B | CP | `rud_rod_cp.ksy` | 12 bytes | Control packet (10 subtypes) |\n| 0x0C | NACK_CCX | `nack_ccx.ksy` | 28 bytes | NACK with extended CC |\n\n#### 3.3.1 RUD Request (Type 0x01, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_request.ksy`  \n**Related Formats**: [ROD Request (3.3.2)](#332-rod-request-type-0x02-12-bytes) | [ACK (3.3.6)](#336-ack-type-0x07-12-bytes) | [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |nxt|flg|       clear_psn_offset |         PSN [31:0]    →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|r|a|s|rsvd|\n       | (5 bits)|(4 bit)| (2) |t|r|y|(2) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x01 (RUD) | Must be 0x01 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 2 | 1[6:5] | Reserved | Must be 0 |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.ar | 1 | 1[3] | ACK request | 0=no ACK, 1=request ACK |\n| flags.syn | 1 | 1[2] | PDC establishment | 0=normal, 1=SYN |\n| flags.rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n| clear_psn_offset | 16 | 2-3 | CLEAR_PSN relative to PSN | Unsigned offset |\n| psn | 32 | 4-7 | Packet Sequence Number | 32-bit, wraps |\n| spdcid | 16 | 8-9 | Source PDCID | Valid PDCID |\n| dpdcid | 16 | 10-11 | Destination PDCID | See note below |\n\n##### Field Notes\n\n**dpdcid Interpretation** (depends on `syn` flag):\n- `syn=0`: Destination PDCID for established PDC\n- `syn=1`: `{pdc_info[3:0], psn_offset[11:0]}` for PDC establishment\n  - `pdc_info[0]`: use_rsv_pdc (1=reserved pool, 0=shared pool)\n  - `pdc_info[3:1]`: Reserved\n  - `psn_offset[11:0]`: Difference between PSN and Start_PSN\n\n**clear_psn_offset**: Computed as `CLEAR_PSN = PSN - clear_psn_offset`. Indicates the highest PSN that has been delivered to SES at the source.\n\n##### Protocol Behavior\n\n**Delivery Mode**: RUD (Reliable Unordered Delivery) provides reliable packet delivery without ordering guarantees. Packets may be delivered to SES out of order.\n\n**State Machine**: RUD operates within the PDC (Packet Delivery Channel) state machine defined in Section 3.5.7.\n\n**Transmission Rules**:\n1. Source assigns monotonically increasing PSN to each packet\n2. `ar` flag SHOULD be set periodically (per `ack_request_interval`)\n3. `retx` flag set when retransmitting due to timeout or NACK\n4. `syn` flag set only for first packet establishing new PDC\n\n**Receiver Processing**:\n1. Validate PDCID and PSN\n2. If PSN is new: deliver to SES immediately (no ordering)\n3. If PSN is duplicate: discard, optionally send ACK\n4. If `ar=1`: generate ACK, ACK_CC, or ACK_CCX response\n\n**Timing Constraints**:\n- Retransmit timeout: Implementation-defined (typically RTT-based)\n- ACK coalescing: Up to `ack_coalesce_count` packets\n\n**Reference**: UE Spec v1.0.1, Table 3-33, Section 3.5.10.3, Page 256\n\n---\n\n#### 3.3.2 ROD Request (Type 0x02, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_request.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [ACK (3.3.6)](#336-ack-type-0x07-12-bytes) | [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\nIdentical to RUD Request (Section 3.3.1) with `type = 0x02`.\n\n##### Field Definitions\n\nSame as RUD Request. Only `type` field differs.\n\n##### Protocol Behavior\n\n**Delivery Mode**: ROD (Reliable Ordered Delivery) provides reliable packet delivery with strict ordering guarantees. Packets are delivered to SES in PSN order.\n\n**Key Difference from RUD**: ROD receiver MUST buffer out-of-order packets and deliver to SES only when all preceding PSNs have been received.\n\n**Ordering Guarantee**:\n- Receiver maintains expected PSN\n- Out-of-order packets are buffered (not delivered)\n- When gap is filled, buffered packets delivered in order\n- Head-of-line blocking possible if packet lost\n\n**Use Cases**:\n- Multi-packet messages requiring in-order delivery\n- Streaming data with ordering requirements\n- Operations where partial delivery is not acceptable\n\n**Reference**: UE Spec v1.0.1, Table 3-33, Section 3.5.10.3, Page 256\n\n---\n\n#### 3.3.3 RUDI Request (Type 0x04, 6 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rudi_request_response.ksy`  \n**Related Formats**: [RUDI Response (3.3.4)](#334-rudi-response-type-0x05-6-bytes) | [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5\n     +-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  |         pkt_id [31:0]     |\n     +-------+-------+-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|r|retx|rsvd|\n       | (5 bits)|(4 bit)| (1) |m| (1)|(4) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x04 (RUDI Request) | Must be 0x04 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.rsvd_m | 1 | 1[5] | Reserved (m for response) | Must be 0 for request |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.rsvd | 4 | 1[3:0] | Reserved | Must be 0 |\n| pkt_id | 32 | 2-5 | Packet Identifier | Locally unique |\n\n##### Protocol Behavior\n\n**Delivery Mode**: RUDI (Reliable Unordered Delivery with Idempotence) provides reliable delivery for idempotent operations without PDC context.\n\n**Key Characteristics**:\n- Uses packet ID instead of sequence number\n- No PDC (Packet Delivery Context) required\n- Idempotent: safe to retry without side effects\n- Smaller header (6 bytes vs 12 bytes for RUD/ROD)\n\n**Idempotence Guarantee**:\n- Receiver tracks recently processed pkt_ids\n- Duplicate pkt_ids are detected and response re-sent\n- No state corruption from retransmissions\n\n**Use Cases**:\n- Small, self-contained operations\n- Stateless request/response patterns\n- Operations where retry is safe (reads, idempotent writes)\n\n**Reference**: UE Spec v1.0.1, Table 3-39, Section 3.5.10.9, Page 262\n\n---\n\n#### 3.3.4 RUDI Response (Type 0x05, 6 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rudi_request_response.ksy`  \n**Related Formats**: [RUDI Request (3.3.3)](#333-rudi-request-type-0x04-6-bytes)\n\n##### Wire Format\n\nIdentical to RUDI Request with `type = 0x05` and `flags.m` valid.\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x05 (RUDI Response) | Must be 0x05 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.m | 1 | 1[5] | ECN marked | 1 if request was ECN marked |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.rsvd | 4 | 1[3:0] | Reserved | Must be 0 |\n| pkt_id | 32 | 2-5 | Packet Identifier | Echoed from request |\n\n##### Protocol Behavior\n\n**Response Generation**:\n1. Receiver processes RUDI Request\n2. Generates RUDI Response with same pkt_id\n3. Sets `m` flag if request packet was ECN marked\n\n**Reference**: UE Spec v1.0.1, Table 3-39, Section 3.5.10.9, Page 262\n\n---\n\n#### 3.3.5 UUD Request (Type 0x06, 6 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/uud_request.ksy`  \n**Related Formats**: None (no response generated)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5\n     +-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  |         pkt_id [31:0]     |\n     +-------+-------+-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr|     rsvd (7)    |\n       | (5 bits)|(4 bit)|                 |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x06 (UUD) | Must be 0x06 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 7 | 1[6:0] | Reserved | Must be 0 |\n| pkt_id | 32 | 2-5 | Packet Identifier | Locally unique |\n\n##### Protocol Behavior\n\n**Delivery Mode**: UUD (Unreliable Unordered Delivery) provides best-effort delivery with no reliability guarantees.\n\n**Key Characteristics**:\n- No ACKs or NACKs generated\n- No retransmissions\n- Packet loss is acceptable\n- Lowest overhead delivery mode\n\n**Use Cases**:\n- Loss-tolerant traffic (video streaming, telemetry)\n- High-frequency updates where latest value matters\n- Multicast/broadcast scenarios\n\n**Reference**: UE Spec v1.0.1, Table 3-42, Section 3.5.10.12, Page 265\n\n---\n\n#### 3.3.6 ACK (Type 0x07, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_ack.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [ACK_CC (3.3.7)](#337-ack_cc-type-0x08-28-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  |   ack_psn_offset  |    probe_opaque     →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |   cack_psn    |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|m|r|p|req|rsvd|\n       | (5 bits)|(4 bit)| (1) | |t| |   |(1) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x07 (ACK) | Must be 0x07 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | UET_HDR_NONE |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.m | 1 | 1[5] | ECN marked | 1 if any ACK'd packet was ECN marked |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.p | 1 | 1[3] | Probe response | 1 if responding to Probe CP |\n| flags.req | 2 | 1[2:1] | Request type | 0=RUD, 1=ROD |\n| flags.rsvd | 1 | 1[0] | Reserved | Must be 0 |\n| ack_psn_offset | 16 | 2-3 | Offset from CACK_PSN to ACK_PSN | Signed |\n| probe_opaque | 16 | 4-5 | Copied from Probe CP | Opaque value |\n| cack_psn | 32 | 6-9 | Cumulative ACK PSN | Highest in-order PSN |\n| spdcid | 16 | 10-11 | Source PDCID | Swapped from request |\n| dpdcid | 16 | 12-13 | Destination PDCID | Swapped from request |\n\n**Note**: Wire format shows 12 bytes but field table shows 14 bytes. Verify against spec - likely cack_psn is 16 bits or spdcid/dpdcid share bytes 10-11.\n\n##### Protocol Behavior\n\n**ACK Generation**:\n1. Receiver tracks highest in-order PSN received (CACK_PSN)\n2. ACK generated when `ar` flag set in request, or periodically\n3. `m` flag set if any ACK'd packet had ECN marking\n\n**Cumulative ACK**:\n- `cack_psn` acknowledges all PSNs ≤ this value\n- Sender can free buffers for acknowledged packets\n- Enables sliding window flow control\n\n**Reference**: UE Spec v1.0.1, Table 3-35, Section 3.5.10.5, Page 258\n\n---\n\n#### 3.3.7 ACK_CC (Type 0x08, 28 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/ack_cc.ksy`  \n**Related Formats**: [ACK (3.3.6)](#336-ack-type-0x07-12-bytes) | [ACK_CCX (3.3.8)](#338-ack_ccx-type-0x09-44-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |                    ACK Header (12 bytes)                      |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |  (ACK cont'd) |cc_typ|cc_flg|  mpr  | sack_psn_offset       →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |              sack_bitmap [63:0]                               |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        24      25      26      27\n     +-------+-------+-------+-------+\n     |       ack_cc_state [63:0]     |\n     +-------+-------+-------+-------+\n```\n\n##### Field Definitions (CC Extension, bytes 12-27)\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| cc_type | 4 | 12[7:4] | CC algorithm type | Per Section 3.6.9 |\n| cc_flags | 4 | 12[3:0] | CC flags | Reserved, must be 0 |\n| mpr | 8 | 13 | Maximum PSN Range | Flow control window |\n| sack_psn_offset | 16 | 14-15 | Offset to SACK base PSN | Signed |\n| sack_bitmap | 64 | 16-23 | Selective ACK bitmap | 1=ACK'd, 0=not ACK'd |\n| ack_cc_state | 64 | 24-27 | CC state (per cc_type) | See Section 3.6.9 |\n\n##### CC Type Values\n\n| Value | Name | Description |\n|-------|------|-------------|\n| 0x0 | CC_NSCC | Network-Signaled Congestion Control |\n| 0x1 | CC_CREDIT | RCCC/TFC Credit-based CC |\n\n##### Protocol Behavior\n\n**Selective ACK (SACK)**:\n- `sack_bitmap` covers 64 PSNs starting at `CACK_PSN + sack_psn_offset`\n- Bit N = 1 means PSN (base + N) received\n- Enables efficient loss recovery without full retransmit\n\n**Congestion Control State**:\n- `ack_cc_state` interpretation depends on `cc_type`\n- For NSCC: Contains service_time, rcv_cwnd_pend, rcvd_bytes, ooo_count\n- For CREDIT: Contains credit information\n\n**Reference**: UE Spec v1.0.1, Table 3-36, Section 3.5.10.6, Page 259\n\n---\n\n#### 3.3.8 ACK_CCX (Type 0x09, 44 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/ack_ccx.ksy`  \n**Related Formats**: [ACK_CC (3.3.7)](#337-ack_cc-type-0x08-28-bytes)\n\n##### Wire Format\n\nACK_CCX extends ACK_CC with additional 16 bytes for extended CC state.\n\n```\nBytes 0-27:  ACK_CC header (28 bytes)\nBytes 28-43: Extended CC state (16 bytes)\n```\n\n##### Additional Fields (bytes 28-43)\n\n| Field | Bits | Offset | Description |\n|-------|------|--------|-------------|\n| ack_ccx_state | 128 | 28-43 | Extended CC state |\n\n##### Protocol Behavior\n\n**Extended State**: ACK_CCX provides additional CC state for algorithms requiring more than 64 bits of feedback.\n\n**Reference**: UE Spec v1.0.1, Table 3-37, Section 3.5.10.7, Page 260\n\n---\n\n#### 3.3.9 NACK (Type 0x0A, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/nack.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [NACK_CCX (3.3.10)](#3310-nack_ccx-type-0x0c-28-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  | nack_code |vendor_code|   nack_psn [31:0] →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|m|r|nt|rsvd|\n       | (5 bits)|(4 bit)| (1) | |t|  |(3) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x0A (NACK) | Must be 0x0A |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | UET_HDR_NONE |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.m | 1 | 1[5] | ECN marked | 1 if request was ECN marked |\n| flags.retx | 1 | 1[4] | Retransmit indicator | From request |\n| flags.nt | 1 | 1[3] | NACK type | 0=RUD/ROD, 1=RUDI |\n| flags.rsvd | 3 | 1[2:0] | Reserved | Must be 0 |\n| nack_code | 8 | 2 | NACK reason code | Per Table 3-59 |\n| vendor_code | 8 | 3 | Vendor-specific code | Optional |\n| nack_psn | 32 | 4-7 | NACK'd PSN or pkt_id | Depends on nt flag |\n| spdcid | 16 | 8-9 | Source PDCID | 0 if nt=1 or PDC failure |\n| dpdcid | 16 | 10-11 | Destination PDCID | 0 if nt=1 |\n\n##### NACK Codes (Table 3-59)\n\n| Code | Name | Description |\n|------|------|-------------|\n| 0x00 | UET_NO_PKT_BUF | No packet buffer available |\n| 0x01 | UET_TRIMMED | Packet was trimmed |\n| 0x02 | UET_NO_PDC_AVAIL | No PDC resources available |\n| 0x03 | UET_INV_DPDCID | Invalid destination PDCID |\n| 0x04 | UET_PDC_HDR_MISMATCH | PDC header mismatch |\n| 0x05 | UET_PSN_OOR_WINDOW | PSN outside expected window |\n| 0x06 | UET_PSN_GAP | PSN gap detected (packet loss) |\n\n##### Protocol Behavior\n\n**NACK Generation**:\n1. Receiver detects error condition (loss, resource exhaustion, etc.)\n2. Generates NACK with appropriate nack_code\n3. Sender receives NACK and takes corrective action\n\n**Sender Response to NACK**:\n- `UET_PSN_GAP`: Retransmit missing packets\n- `UET_NO_PKT_BUF`: Back off, retry later\n- `UET_NO_PDC_AVAIL`: PDC establishment failed, retry or abort\n\n**Reference**: UE Spec v1.0.1, Table 3-40, Section 3.5.10.10, Page 263\n\n---\n\n#### 3.3.10 NACK_CCX (Type 0x0C, 28 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/nack_ccx.ksy`  \n**Related Formats**: [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\nNACK_CCX extends NACK with 16 bytes of CC state (similar to ACK_CC extension).\n\n```\nBytes 0-11:  NACK header (12 bytes)\nBytes 12-27: CC extension (16 bytes)\n```\n\n##### Protocol Behavior\n\n**Extended NACK**: NACK_CCX provides congestion control feedback along with the negative acknowledgment, enabling the sender to adjust its rate while handling the error.\n\n**Reference**: UE Spec v1.0.1, Table 3-41, Section 3.5.10.11, Page 264\n\n---\n\n#### 3.3.11 Control Packet (Type 0x0B, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_cp.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [ACK (3.3.6)](#336-ack-type-0x07-12-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |ctl|  flags  |   probe_opaque    |         PSN [31:0]  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |ctl_typ| rsvd|i|r|a|s|rsvd|\n       | (5 bits)|(4 bit)| (1) |r|t|r|y|(2) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x0B (CP) | Must be 0x0B |\n| ctl_type | 4 | 0[2:0]+1[7] | Control packet subtype | 0-9 defined |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.isrod | 1 | 1[5] | ROD indicator | 1=ROD, 0=RUD (for NOOP/Negotiation) |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.ar | 1 | 1[3] | ACK request | 0=no ACK, 1=request ACK |\n| flags.syn | 1 | 1[2] | PDC establishment | 0=normal, 1=SYN |\n| flags.rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n| probe_opaque | 16 | 2-3 | Opaque value for Probe | Echoed in ACK |\n| psn | 32 | 4-7 | Packet Sequence Number | Some CPs consume PSN |\n| spdcid | 16 | 8-9 | Source PDCID | Valid PDCID |\n| dpdcid | 16 | 10-11 | Destination PDCID | Or {pdc_info, psn_offset} |\n\n##### Control Packet Subtypes\n\n| ctl_type | Name | Direction | Description |\n|----------|------|-----------|-------------|\n| 0 | NOOP | Either | No operation |\n| 1 | ACK_REQUEST | Src→Dst | Request ACK for specific PSN |\n| 2 | CLEAR_COMMAND | Init→Tgt | Clear guaranteed delivery state |\n| 3 | CLEAR_REQUEST | Tgt→Init | Request initiator to send clear |\n| 4 | CLOSE_COMMAND | Init→Tgt | PDC is being closed |\n| 5 | CLOSE_REQUEST | Tgt→Init | Request initiator to close PDC |\n| 6 | PROBE | Src→Dst | Request PDS ACK |\n| 7 | CREDIT | Dst→Src | Carry CC credit |\n| 8 | CREDIT_REQUEST | Src→Dst | Request credit |\n| 9 | NEGOTIATION | Either | PDC negotiation |\n\n##### Protocol Behavior\n\n**PDC Lifecycle**:\n- `CLOSE_COMMAND/REQUEST`: Graceful PDC teardown\n- `CLEAR_COMMAND/REQUEST`: Clear delivery state without closing\n\n**Flow Control**:\n- `CREDIT/CREDIT_REQUEST`: Credit-based flow control\n- `PROBE`: Solicit ACK for RTT measurement or liveness check\n\n**Reference**: UE Spec v1.0.1, Table 3-38, Section 3.5.10.8, Page 261\n\n### 3.4 SES (Semantic Sublayer) Opcodes\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/opcodes.ksy`\n\n**Request Opcodes (Table 3-17)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Tagged Send | 0x00 | Send with tag matching |\n| RMA Write | 0x01 | Remote memory write |\n| RMA Read | 0x02 | Remote memory read |\n| Atomic Write | 0x03 | Atomic memory write |\n| Atomic Read | 0x04 | Atomic memory read |\n| Atomic CAS | 0x05 | Compare-and-swap |\n| Deferrable Send | 0x06 | Deferrable send |\n| Ready to Restart | 0x07 | Restart notification |\n| Small Message | 0x08 | Small message (32B header) |\n| Small RMA Write | 0x09 | Small RMA write |\n| Small RMA Read | 0x0A | Small RMA read |\n| Small Atomic Write | 0x0B | Small atomic write |\n| Small Atomic Read | 0x0C | Small atomic read |\n| Small Atomic CAS | 0x0D | Small atomic CAS |\n\n**Response Opcodes (Table 3-18)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Response | 0x00 | Standard response |\n| Response with Data | 0x01 | Response carrying data |\n| Optimized Response | 0x02 | Optimized format |\n| NACK | 0x03 | Negative acknowledgment |\n\n### 3.5 SES Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/ses/`\n\n```\nSES Request/Response Relationships:\n┌─────────────────────────────────────────────────────────────────┐\n│                                                                 │\n│  Standard Request ────┬───────────────────→ Response            │\n│  (SOM=1, 44B)         └───────────────────→ Response w/Data     │\n│       │                                                         │\n│       └──→ Continuation (SOM=0, 16B)                            │\n│                                                                 │\n│  Small Message (32B) ─────────────────────→ Response            │\n│                                                                 │\n│  + Atomic Extension (8B) ─────────────────→ Response w/Data     │\n│                                             (for fetching ops)  │\n│                                                                 │\n│  + Rendezvous Extension (32B) ────────────→ (target pulls data) │\n│                                                                 │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n| Table/Figure | Format | File | Size | Description |\n|--------------|--------|------|------|-------------|\n| Table 3-8 | Standard Request (SOM=1) | `standard_request_som1.ksy` | 44 bytes | Start of message |\n| Table 3-9 | Standard Request (SOM=0) | `standard_request_som0.ksy` | 16 bytes | Continuation |\n| Table 3-11 | Response | `response.ksy` | 16 bytes | Standard response |\n| Table 3-12 | Response with Data | `response_with_data.ksy` | 24 bytes | Data-carrying response |\n| Figure 3-14 | Small Message | `small_message.ksy` | 32 bytes | Single-packet optimized |\n| Figure 3-15 | Rendezvous Extension | `rendezvous_extension.ksy` | 32 bytes | Large message protocol |\n| Figure 3-16 | Atomic Extension | `atomic_extension.ksy` | 8 bytes | Atomic operations |\n\n#### 3.5.1 Standard Request SOM=1 (Table 3-8, 44 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/standard_request_som1.ksy`  \n**Related Formats**: [Standard Request SOM=0 (3.5.2)](#352-standard-request-som0-table-3-9-16-bytes) | [Response (3.5.3)](#353-response-table-3-11-16-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |rs|opcode |v|dc|ie|rl|hd|eo|so|    message_id     | ri_gen  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |rsvd|pid_on_fep |rsvd| resource_idx  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |                    buffer_offset [63:0]                       |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        24      25      26      27      28      29      30      31\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |        initiator [31:0]       |   match_bits / memory_key    →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        32      33      34      35      36      37      38      39\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |  (match_bits cont'd) [63:0]   |       header_data [63:0]     →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        40      41      42      43\n     +-------+-------+-------+-------+\n   → | (hdr_data)    | request_length|\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |rsvd |  opcode |v|dc|ie|rl|hd|eo|so|\n       | (2) | (6 bits)|r| | | | | | | |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| rsvd | 2 | 0[7:6] | Reserved | Must be 0 |\n| opcode | 6 | 0[5:0] | Operation code | Per Table 3-17 |\n| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n| dc | 1 | 1[5] | Delivery Complete | Defer response until globally observable |\n| ie | 1 | 1[4] | Initiator Error | Error at initiator |\n| rel | 1 | 1[3] | Relative addressing | 0=absolute, 1=relative |\n| hd | 1 | 1[2] | Header Data present | 1=header_data valid |\n| eom | 1 | 1[1] | End of Message | 1=last packet |\n| som | 1 | 1[0] | Start of Message | Must be 1 for this format |\n| message_id | 16 | 2-3 | Message identifier | 0=reserved (invalid) |\n| ri_generation | 8 | 4 | Resource Index generation | For buffer exhaustion recovery |\n| job_id | 24 | 5-7 | Job Identifier | Matches VXLAN VNI size |\n| rsvd | 4 | 8[7:4] | Reserved | Must be 0 |\n| pid_on_fep | 12 | 8[3:0]+9 | Process ID on FEP | Target process |\n| rsvd | 4 | 10[7:4] | Reserved | Must be 0 |\n| resource_index | 12 | 10[3:0]+11 | Resource Index | Target resource |\n| buffer_offset | 64 | 12-19 | Buffer offset | Or restart token for deferrable |\n| initiator | 32 | 20-23 | Initiator ID | For tagged matching |\n| match_bits | 64 | 24-31 | Match bits / Memory key | Dual-purpose field |\n| header_data | 64 | 32-39 | Header data | Completion data (if hd=1) |\n| request_length | 32 | 40-43 | Request length | Bytes to transfer |\n\n##### Field Notes\n\n**match_bits / memory_key Interpretation**:\n- For tagged operations (sends): Match bits for receive queue matching\n- For RMA operations (reads, writes): Memory key for authorization\n\n**buffer_offset Special Uses**:\n- For deferrable sends: Contains restart token (upper 32b initiator, lower 32b target)\n- For FI_MR_VIRT_ADDR: Contains absolute virtual address\n\n##### Protocol Behavior\n\n**Message Framing**:\n- `som=1, eom=1`: Single-packet message\n- `som=1, eom=0`: First packet of multi-packet message\n- Continuation packets use SOM=0 format (Table 3-9)\n\n**Addressing Modes**:\n- `rel=0` (Absolute): {JobID, PIDonFEP, resource_index} identifies target\n- `rel=1` (Relative): Addressing relative to connection context\n\n**Delivery Complete (dc)**:\n- When `dc=1`: Response deferred until data globally observable\n- Matches FI_DELIVERY_COMPLETE libfabric option\n\n**Reference**: UE Spec v1.0.1, Table 3-8, Section 3.4.2.1, Page 158\n\n---\n\n#### 3.5.2 Standard Request SOM=0 (Table 3-9, 16 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/standard_request_som0.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |rs|opcode |v|dc|ie|rl|hd|eo|so|    message_id     | ri_gen  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |       message_offset [31:0]          |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| rsvd | 2 | 0[7:6] | Reserved | Must be 0 |\n| opcode | 6 | 0[5:0] | Operation code | Same as SOM=1 packet |\n| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n| dc | 1 | 1[5] | Delivery Complete | Same as SOM=1 |\n| ie | 1 | 1[4] | Initiator Error | Error at initiator |\n| rel | 1 | 1[3] | Relative addressing | Same as SOM=1 |\n| hd | 1 | 1[2] | Header Data present | Ignored for SOM=0 |\n| eom | 1 | 1[1] | End of Message | 1=last packet |\n| som | 1 | 1[0] | Start of Message | Must be 0 for this format |\n| message_id | 16 | 2-3 | Message identifier | Same as SOM=1 packet |\n| ri_generation | 8 | 4 | Resource Index generation | Same as SOM=1 |\n| job_id | 24 | 5-7 | Job Identifier | Same as SOM=1 |\n| message_offset | 32 | 8-11 | Offset within message | Byte offset from start |\n\n##### Protocol Behavior\n\n**Continuation Packets**:\n- Used for packets 2..N of multi-packet messages\n- `message_offset` indicates position within overall message\n- Target uses offset to place data correctly in buffer\n\n**Packet Ordering**:\n- ROD delivery: Packets delivered in PSN order\n- RUD delivery: Packets may arrive out of order; target reassembles using message_offset\n\n**Reference**: UE Spec v1.0.1, Table 3-9, Section 3.4.2.1, Page 159\n\n---\n\n#### 3.5.3 Response (Table 3-11, 16 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/response.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes) | [Response with Data (3.5.4)](#354-response-with-data-table-3-12-24-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     | list|opcode |v| return_code |    message_id     | ri_gen  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |       modified_length [31:0]         |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |list |  opcode |v| return_code   |\n       | (2) | (6 bits)|r|   (6 bits)    |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| list | 2 | 0[7:6] | List indicator | 0=expected, 1=unexpected |\n| opcode | 6 | 0[5:0] | Response opcode | Per Table 3-18 |\n| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n| return_code | 6 | 1[5:0] | Return code | Per Table 3-19 |\n| message_id | 16 | 2-3 | Message identifier | From original request |\n| ri_generation | 8 | 4 | Resource Index generation | New generation on mismatch |\n| job_id | 24 | 5-7 | Job Identifier | From original request |\n| modified_length | 32 | 8-11 | Modified length | Bytes actually transferred |\n| rsvd | 32 | 12-15 | Reserved | Must be 0 |\n\n##### Return Codes (Table 3-19)\n\n| Code | Name | Description |\n|------|------|-------------|\n| 0x00 | RC_OK | Success |\n| 0x01 | RC_NO_MATCH | No matching buffer found |\n| 0x02 | RC_BUFFER_TOO_SMALL | Target buffer too small |\n| 0x03 | RC_AUTHORIZATION_FAILURE | Memory key mismatch |\n| 0x04 | RC_INVALID_OPERATION | Invalid operation |\n| 0x05 | RC_RESOURCE_EXHAUSTION | Resource exhaustion |\n| 0x06 | RC_GENERATION_MISMATCH | RI generation mismatch |\n| 0x07 | RC_TRUNCATED | Message truncated |\n\n##### Protocol Behavior\n\n**Response Generation**:\n1. Target processes request\n2. Generates response with appropriate return_code\n3. `modified_length` indicates actual bytes transferred (may be < request_length)\n\n**List Indicator**:\n- `list=0`: Payload delivered to expected list (matched posted receive)\n- `list=1`: Payload delivered to unexpected list (no matching receive)\n\n**Reference**: UE Spec v1.0.1, Table 3-11, Section 3.4.2.5, Page 167\n\n---\n\n#### 3.5.4 Response with Data (Table 3-12, 24 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/response_with_data.ksy`  \n**Related Formats**: [Response (3.5.3)](#353-response-table-3-11-16-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     | list|opcode |v| return_code | response_msg_id   | rsvd    →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |read_req_msg_id|rs|payload_len      →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |       modified_length [31:0]  |       message_offset [31:0]  |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| list | 2 | 0[7:6] | List indicator | 0=expected, 1=unexpected |\n| opcode | 6 | 0[5:0] | Response opcode | Per Table 3-18 |\n| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n| return_code | 6 | 1[5:0] | Return code | Per Table 3-19 |\n| response_message_id | 16 | 2-3 | Response message ID | For this response |\n| rsvd | 8 | 4 | Reserved | Must be 0 |\n| job_id | 24 | 5-7 | Job Identifier | From original request |\n| read_request_message_id | 16 | 8-9 | Original request msg ID | Links to request |\n| rsvd | 2 | 10[7:6] | Reserved | Must be 0 |\n| payload_length | 14 | 10[5:0]+11 | Payload in this packet | Max 16383 bytes |\n| modified_length | 32 | 12-15 | Total bytes transferred | Across all packets |\n| message_offset | 32 | 16-19 | Offset in response | For multi-packet responses |\n| rsvd | 32 | 20-23 | Reserved | Must be 0 |\n\n##### Protocol Behavior\n\n**Use Cases**:\n- RDMA Read responses (returning requested data)\n- Fetching atomic responses (returning original value)\n\n**Multi-Packet Responses**:\n- `message_offset` indicates position within overall response\n- `payload_length` indicates data in this specific packet\n- `modified_length` is total across all response packets\n\n**Reference**: UE Spec v1.0.1, Table 3-12, Section 3.4.2.5, Page 168\n\n---\n\n#### 3.5.5 Small Message (Figure 3-14, 32 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/small_message.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes) | [Response (3.5.3)](#353-response-table-3-11-16-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |opcode |v|dc|ie|rl|hd|eo|so|rs| request_length  | ri_gen  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |rsvd|pid_on_fep |rsvd| resource_idx  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |        initiator [31:0]       |        match_bits [63:0]     →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        24      25      26      27      28      29      30      31\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |  (match_bits cont'd)          |       header_data [63:0]     |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| opcode | 6 | 0[7:2] | Operation code | Per Table 3-17 |\n| version | 2 | 0[1:0] | Protocol version | 0 for v1.0.1 |\n| dc | 1 | 1[7] | Delivery Complete | Defer response |\n| ie | 1 | 1[6] | Initiator Error | Error at initiator |\n| rel | 1 | 1[5] | Relative addressing | 0=absolute, 1=relative |\n| hd | 1 | 1[4] | Header Data present | 1=header_data valid |\n| eom | 1 | 1[3] | End of Message | Must be 1 (single packet) |\n| som | 1 | 1[2] | Start of Message | Must be 1 (single packet) |\n| rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n| rsvd | 2 | 2[7:6] | Reserved | Must be 0 |\n| request_length | 14 | 2[5:0]+3 | Request length | Max 16383 bytes |\n| ri_generation | 8 | 4 | Resource Index generation | For buffer recovery |\n| job_id | 24 | 5-7 | Job Identifier | Target job |\n| rsvd | 4 | 8[7:4] | Reserved | Must be 0 |\n| pid_on_fep | 12 | 8[3:0]+9 | Process ID on FEP | Target process |\n| rsvd | 4 | 10[7:4] | Reserved | Must be 0 |\n| resource_index | 12 | 10[3:0]+11 | Resource Index | Target resource |\n| initiator | 32 | 12-15 | Initiator ID | For tagged matching |\n| match_bits | 64 | 16-23 | Match bits | For tagged matching |\n| header_data | 64 | 24-31 | Header data | Completion data |\n\n##### Protocol Behavior\n\n**Optimized Format**:\n- 32 bytes vs 44 bytes for standard request\n- Single-packet only (`som=1, eom=1` required)\n- No buffer_offset (not needed for single packet)\n- 14-bit request_length (max 16383 bytes)\n\n**Use Cases**:\n- Small tagged sends\n- Single-packet messages with matching criteria\n- Latency-sensitive operations\n\n**Reference**: UE Spec v1.0.1, Figure 3-14, Section 3.4.2.3, Page 164\n\n---\n\n#### 3.5.6 Rendezvous Extension (Figure 3-15, 32 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/rendezvous_extension.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |       eager_length [31:0]     |        memory_key [63:0]     →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |  (memory_key cont'd)          |       buffer_offset [63:0]   →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |  (buffer_offset cont'd)       |     remaining_length [31:0]  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        24      25      26      27      28      29      30      31\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → | (remaining)   |              reserved [63:0]                  |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| eager_length | 32 | 0-3 | Eager data length | Bytes pushed with request |\n| memory_key | 64 | 4-11 | Initiator memory key | For target to pull data |\n| buffer_offset | 64 | 12-19 | Initiator buffer offset | Start of remaining data |\n| remaining_length | 32 | 20-23 | Remaining data length | Bytes to pull |\n| rsvd | 64 | 24-31 | Reserved | Must be 0 |\n\n##### Protocol Behavior\n\n**Rendezvous Protocol**:\n1. Initiator sends request with eager data + rendezvous extension\n2. Target receives eager data, allocates buffer\n3. Target issues RDMA Read to pull remaining data using {memory_key, buffer_offset}\n4. Target completes operation when all data received\n\n**Two-Sided Protocol**:\n- Enables large message transfer without pre-registered buffers\n- Target controls when/how to pull remaining data\n- Reduces memory registration overhead\n\n**Constraints**:\n- MUST NOT be combined with atomic extension\n- Placed on every packet using rendezvous opcode\n\n**Reference**: UE Spec v1.0.1, Figure 3-15, Section 3.4.2.3, Page 165\n\n---\n\n#### 3.5.7 Atomic Extension (Figure 3-16, 8 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/atomic_extension.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes) | [Response with Data (3.5.4)](#354-response-with-data-table-3-12-24-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |atomic_opcode  |atomic_datatype| semantic_control  | reserved  |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| atomic_opcode | 8 | 0 | Atomic operation | Per Table 3-21 |\n| atomic_datatype | 8 | 1 | Data type | Per Table 3-22 |\n| semantic_control | 16 | 2-3 | Semantic control | Per Table 3-23 |\n| rsvd | 32 | 4-7 | Reserved | Must be 0 |\n\n##### Atomic Opcodes (Table 3-21)\n\n| Code | Name | Operation |\n|------|------|-----------|\n| 0x00 | MIN | Target = MIN(Target, Initiator) |\n| 0x01 | MAX | Target = MAX(Target, Initiator) |\n| 0x02 | SUM | Target = Target + Initiator |\n| 0x03 | DIFF | Target = Target - Initiator |\n| 0x04 | PROD | Target = Target * Initiator |\n| 0x05 | LOR | Target = Target \\|\\| Initiator |\n| 0x06 | LAND | Target = Target && Initiator |\n| 0x07 | BOR | Target = Target \\| Initiator |\n| 0x08 | BAND | Target = Target & Initiator |\n| 0x09 | LXOR | Logical XOR |\n| 0x0A | BXOR | Target = Target ^ Initiator |\n| 0x0B | READ | Initiator = Target |\n| 0x0C | WRITE | Target = Initiator |\n| 0x0D | CSWAP | Compare and swap if equal |\n| 0x0E | CSWAP_NE | Compare and swap if not equal |\n| 0x0F | CSWAP_LE | Compare and swap if ≤ |\n| 0x10 | CSWAP_LT | Compare and swap if < |\n| 0x11 | CSWAP_GE | Compare and swap if ≥ |\n| 0x12 | CSWAP_GT | Compare and swap if > |\n| 0x13 | MSWAP | Masked swap |\n| 0x14 | INVAL | Invalidate cache |\n\n##### Atomic Datatypes (Table 3-22)\n\n| Code | Name | Size |\n|------|------|------|\n| 0x00 | INT8 | 1 byte |\n| 0x01 | UINT8 | 1 byte |\n| 0x02 | INT16 | 2 bytes |\n| 0x03 | UINT16 | 2 bytes |\n| 0x04 | INT32 | 4 bytes |\n| 0x05 | UINT32 | 4 bytes |\n| 0x06 | INT64 | 8 bytes |\n| 0x07 | UINT64 | 8 bytes |\n| 0x08 | FLOAT | 4 bytes |\n| 0x09 | DOUBLE | 8 bytes |\n| 0x0A | FLOAT_COMPLEX | 8 bytes |\n| 0x0B | DOUBLE_COMPLEX | 16 bytes |\n| 0x0E | FLOAT16 | 2 bytes |\n| 0x0F | BFLOAT16 | 2 bytes |\n\n##### Protocol Behavior\n\n**Atomic Operations**:\n- Always 8 bytes and must be naturally aligned\n- Payload must be integral multiple of datatype size\n- Fetching atomics return original value in Response with Data\n\n**Constraints**:\n- MUST NOT be combined with rendezvous extension\n- Fetching atomics MUST NOT operate on more than one element\n\n**Reference**: UE Spec v1.0.1, Figure 3-16, Section 3.4.2.4, Page 165\n\n### 3.6 CMS (Congestion Management Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/cms/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Credit CP Payload | `credit_cp_payload.ksy` | Credit control packet |\n| Credit Request | `credit_request_cp_payload.ksy` | Credit request |\n| Request CC State | `req_cc_state.ksy` | Request CC state |\n| ACK CC State (NSCC) | `ack_cc_state_nscc.ksy` | NSCC algorithm state |\n| ACK CC State (RCCC/TFC) | `ack_cc_state_rccc_tfc.ksy` | RCCC/TFC state |\n\n### 3.7 TSS (Transport Security Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/tss/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Security Header | `security_header.ksy` | Encryption header |\n| IV Construction | `iv_construction.ksy` | Initialization vector |\n| Key Rotation | `protocols/key_rotation.ksy` | Key rotation protocol |\n| KDF Direct | `protocols/kdf_direct.ksy` | Direct key derivation |\n| KDF Client/Server | `protocols/kdf_client_server.ksy` | Client/server KDF |\n| KDF Cluster | `protocols/kdf_cluster.ksy` | Cluster KDF |\n| Join Secure Domain | `protocols/join_secure_domain.ksy` | Domain join |\n| TSS TX Processing | `protocols/tss_tx_processing.ksy` | Transmit processing |\n| TSS RX Processing | `protocols/tss_rx_processing.ksy` | Receive processing |\n\n### 3.8 Link Layer Formats\n\n#### LLR (Link-Level Retry)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/llr/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| LLR Preamble (64b66b) | `llr_preamble_64b66b.ksy` | 64b66b preamble |\n| LLR Preamble (MII) | `llr_preamble_mii.ksy` | MII preamble |\n| LLR Init CTLOS | `llr_init_ctlos.ksy` | Initialize LLR |\n| LLR Init Echo CTLOS | `llr_init_echo_ctlos.ksy` | Init acknowledgment |\n| LLR ACK CTLOS | `llr_ack_ctlos.ksy` | Frame acknowledgment |\n| LLR NACK CTLOS | `llr_nack_ctlos.ksy` | Retransmit request |\n\n#### CBFC (Credit-Based Flow Control)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/cbfc/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| CF Update | `cf_update.ksy` | Credit flow update |\n| CC Update | `cc_update.ksy` | Credit count update |\n| VC State Machine | `protocols/vc_state_machine.ksy` | Virtual channel FSM |\n| Lossless VC Init | `protocols/lossless_vc_init.ksy` | VC initialization |\n| Lossless VC Removal | `protocols/lossless_vc_removal.ksy` | VC teardown |\n\n#### LLDP Extensions\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/lldp/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| UE Link Negotiation TLV | `ue_link_negotiation_tlv.ksy` | Link negotiation |\n| UE CBFC TLV | `ue_cbfc_tlv.ksy` | CBFC parameters |\n\n---\n\n## 4. RoCEv2 Formats\n\n**Datamodel Directory**: `datamodel/protocols/roce/transport/`\n\n### 4.1 RoCEv2 Packet Structure\n\n```\n+-----------------------------------------------------------------------------+\n| Ethernet II Header (14 bytes)                                               |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2) = 0x0800/0x86DD            |\n+-----------------------------------------------------------------------------+\n| IP Header (20 bytes IPv4 / 40 bytes IPv6)                                   |\n|   Version, IHL, DSCP, ECN, Length, ID, Flags, TTL, Protocol=17, Checksum   |\n|   Source IP, Dest IP                                                        |\n+-----------------------------------------------------------------------------+\n| UDP Header (8 bytes)                                                        |\n|   Source Port (entropy) | Dest Port = 4791 | Length | Checksum             |\n+-----------------------------------------------------------------------------+\n| BTH - Base Transport Header (12 bytes)                                      |\n|   Opcode | Flags | P-Key | Dest QP | A | PSN                               |\n+-----------------------------------------------------------------------------+\n| Extended Headers (optional, operation-dependent)                            |\n|   RETH (16) | AETH (4) | AtomicETH (28) | ImmDt (4)                        |\n+-----------------------------------------------------------------------------+\n| Payload (0 - MTU bytes)                                                     |\n+-----------------------------------------------------------------------------+\n| ICRC (4 bytes)                                                              |\n+-----------------------------------------------------------------------------+\n```\n\n### 4.2 BTH (Base Transport Header) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/roce/transport/bth.ksy`\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| Opcode | 8 | Operation type (transport + operation) |\n| SE | 1 | Solicited Event |\n| M | 1 | Migration state |\n| Pad | 2 | Padding bytes (0-3) |\n| TVer | 4 | Transport version (must be 0) |\n| P-Key | 16 | Partition key |\n| Dest QP | 24 | Destination Queue Pair |\n| A | 1 | ACK request |\n| PSN | 24 | Packet Sequence Number |\n\n**Transport Types** (Opcode bits [7:5]):\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x00 | RC | Reliable Connection |\n| 0x20 | UC | Unreliable Connection |\n| 0x40 | RD | Reliable Datagram |\n| 0x60 | UD | Unreliable Datagram |\n\n**Operations** (Opcode bits [4:0]):\n| Value | Operation | Description |\n|-------|-----------|-------------|\n| 0x00 | SEND_FIRST | First send packet |\n| 0x01 | SEND_MIDDLE | Middle send packet |\n| 0x02 | SEND_LAST | Last send packet |\n| 0x03 | SEND_LAST_IMM | Last send with immediate |\n| 0x04 | SEND_ONLY | Single-packet send |\n| 0x05 | SEND_ONLY_IMM | Single send with immediate |\n| 0x06 | RDMA_WRITE_FIRST | First RDMA write |\n| 0x07 | RDMA_WRITE_MIDDLE | Middle RDMA write |\n| 0x08 | RDMA_WRITE_LAST | Last RDMA write |\n| 0x09 | RDMA_WRITE_LAST_IMM | Last write with immediate |\n| 0x0A | RDMA_WRITE_ONLY | Single-packet write |\n| 0x0B | RDMA_WRITE_ONLY_IMM | Single write with immediate |\n| 0x0C | RDMA_READ_REQUEST | Read request |\n| 0x0D | RDMA_READ_RESPONSE_FIRST | First read response |\n| 0x0E | RDMA_READ_RESPONSE_MIDDLE | Middle read response |\n| 0x0F | RDMA_READ_RESPONSE_LAST | Last read response |\n| 0x10 | RDMA_READ_RESPONSE_ONLY | Single read response |\n| 0x11 | ACK | Acknowledgment |\n| 0x12 | ATOMIC_ACK | Atomic acknowledgment |\n| 0x13 | CMP_SWAP | Compare and swap |\n| 0x14 | FETCH_ADD | Fetch and add |\n\n### 4.3 Extended Transport Headers\n\n| Header | File | Size | Description |\n|--------|------|------|-------------|\n| RETH | `reth.ksy` | 16 bytes | RDMA Extended Transport Header |\n| AETH | `aeth.ksy` | 4 bytes | ACK Extended Transport Header |\n| AtomicETH | `atomiceth.ksy` | 28 bytes | Atomic Extended Transport Header |\n| AtomicAckETH | `atomicacketh.ksy` | 8 bytes | Atomic ACK ETH |\n| DETH | `deth.ksy` | 8 bytes | Datagram Extended Transport Header |\n| ImmDt | `immdt.ksy` | 4 bytes | Immediate Data |\n| ICRC | `icrc.ksy` | 4 bytes | Invariant CRC |\n\n---\n\n## 5. Standard Ethernet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ethernet/`\n\n### 5.1 Ethernet II Frame\n\n**Datamodel**: `datamodel/protocols/ethernet/link/ethernet_ii.ksy`\n\n```\n+-----------------------------------------------------------------------------+\n| Preamble (7 bytes) + SFD (1 byte)  [not visible to software]               |\n+-----------------------------------------------------------------------------+\n| Ethernet Header (14 bytes)                                                  |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2)                            |\n+-----------------------------------------------------------------------------+\n| Optional VLAN Tag (4 bytes) - 802.1Q                                        |\n|   TPID (2) = 0x8100 | TCI (2) = PCP + DEI + VID                            |\n+-----------------------------------------------------------------------------+\n| Payload (46-1500 bytes, or up to 9000 for jumbo)                           |\n+-----------------------------------------------------------------------------+\n| FCS (4 bytes)                                                               |\n+-----------------------------------------------------------------------------+\n```\n\n### 5.2 Link Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| Ethernet II | `link/ethernet_ii.ksy` | Standard Ethernet frame |\n| VLAN 802.1Q | `link/vlan_802_1q.ksy` | VLAN tagging |\n\n### 5.3 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| IPv4 | `network/ipv4.ksy` | IPv4 header |\n| IPv6 | `network/ipv6.ksy` | IPv6 header |\n\n### 5.4 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| TCP | `transport/tcp.ksy` | TCP header |\n| UDP | `transport/udp.ksy` | UDP header |\n\n---\n\n## 6. Cornelis Proprietary Formats\n\n**Datamodel Directory**: `datamodel/protocols/cornelis/`\n\n### 6.1 Link Layer\n\n| Format | File | Size | Description |\n|--------|------|------|-------------|\n| UE+ Header | `link/ue_plus.ksy` | 12 bytes | Optimized L2 header |\n| Cornelis L2 Prefix | `link/cornelis_l2_prefix.ksy` | Variable | L2 prefix |\n\n### 6.2 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| UFH-16 | `network/ufh_16.ksy` | 16-bit forwarding header |\n| UFH-32 | `network/ufh_32.ksy` | 32-bit forwarding header |\n| Collective L2 | `network/collective_l2.ksy` | Collective operations header |\n| Scale-Up L2 | `network/scaleup_l2.ksy` | Scale-up deployments |\n\n#### 6.2.1 UFH-16 (Unified Forwarding Header 16-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_16.ksy`\n\nUFH-16 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 16-bit addressing.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |    Opaque (24-bit)    | Destination   |Opaque |Traffic|   Opaque      |    Source     |\n|[7:4]  |                       | (16-bit BE)   |[7:4]  |Class  |   (16-bit)    |  (16-bit BE)  |\n|SLAP   |                       |               |Z|Y|X|M|[7:0]  |               |               |\n|[3:0]  |                       |               |[3:0]  |       |               |               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1-3 | 24 | Opaque to hardware |\n| Destination | 4-5 | 16 | Destination endpoint address (big-endian) |\n| Opaque | 6 | [7:4] | Opaque to hardware |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Opaque | 8-9 | 16 | Opaque to hardware |\n| Source | 10-11 | 16 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-16 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5-14 | Reserved | Reserved for future use |\n| 15 | Extended | UFH-32 extension follows |\n\n**Usage**: Scale-up fabric forwarding, intra-pod communication, medium cluster networking (up to 65536 endpoints).\n\n#### 6.2.2 UFH-32 (Unified Forwarding Header 32-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_32.ksy`\n\nUFH-32 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 32-bit addressing for large-scale deployments.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |       |   Destination (32-bit BE)     |HopLim |Traffic|       Source (32-bit BE)      |\n|[7:4]  |Opaque |                               |[7:4]  |Class  |                               |\n|SLAP   |       |                               |Z|Y|X|M|[7:0]  |                               |\n|[3:0]  |       |                               |[3:0]  |       |                               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1 | [7:0] | Opaque to hardware |\n| Destination | 2-5 | 32 | Destination endpoint address (big-endian) |\n| Hop Limit | 6 | [7:4] | TTL/hop count |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Source | 8-11 | 32 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-32 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5 | Multicast | Multicast packet |\n| 6 | Barrier | Barrier synchronization |\n| 7 | Reduction | Reduction operation |\n| 8-14 | Reserved | Reserved for future use |\n| 15 | Vendor | Vendor-specific packet |\n\n**Usage**: Large-scale scale-up fabric forwarding (4+ billion endpoints), multi-pod communication, extended collective operations.\n\n### 6.3 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| CSIG+ | `transport/csig_plus.ksy` | Telemetry header |\n| PKEY | `transport/pkey.ksy` | Partition key |\n\n### 6.4 Encapsulation\n\n| Format | File | Description |\n|--------|------|-------------|\n| VxLAN+ | `encapsulation/vxlan_plus.ksy` | Extended VxLAN overlay |\n\n---\n\n## 7. Host-Software Interface (HSI) Formats\n\n**Datamodel Directory**: `datamodel/hw/asics/pmr/interfaces/host_interface/`\n\n### 7.1 Command Queue Segment (64 bytes)\n\n**Datamodel**: `command_queue_segment.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Bytes 2-3     | Bytes 4-7     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Opcode        | Flags         | Payload Len   | Reserved      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 8-15                    | Bytes 16-23                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Tag (64 bits)                 | Dest (64 bits)                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 24-31                   | Bytes 32-63                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Metadata (64 bits)            | Inline Data or SGL Entry      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n**Opcode Encoding**:\n| Bits | Field | Values |\n|------|-------|--------|\n| [7:4] | Family | MSG=0x1, TAGGED=0x2, RMA=0x3, ATOMIC=0x4 |\n| [3:2] | Variant | SEND=0, RECV=1, INJECT=2 |\n| [1] | Reserved | Must be 0 |\n| [0] | Data Source | INLINE=0, SGL=1 |\n\n### 7.2 Notification Formats\n\n| Format | File | Type | Size | Description |\n|--------|------|------|------|-------------|\n| Receive Notification | `receive_notification.ksy` | 0x00 | 64 bytes | Received message |\n| Send Completion | `send_completion.ksy` | 0x01 | 64 bytes | Send completed |\n| Event Notification | `event_notification.ksy` | 0x02 | 64 bytes | Async event |\n| Notification Entry | `notification_entry.ksy` | - | 64 bytes | Generic entry |\n| QW Violation Event | `qw_violation_event.ksy` | - | 64 bytes | QW alignment error |\n\n### 7.3 Receive Notification (64 bytes)\n\n**Datamodel**: `receive_notification.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x00 for receive |\n| flags | 1 | 1 | FI_INLINE, continuation |\n| status | 2 | 2 | Completion status |\n| src_id | 4 | 4 | Source endpoint ID |\n| tag | 8 | 8 | Tag value |\n| total_length | 16 | 4 | Payload length |\n| buffer_id_0 | 20 | 2 | First buffer ID |\n| buffer_id_1 | 22 | 2 | Second buffer ID |\n| buffer_offset | 24 | 2 | Offset in buffer |\n| reserved | 26 | 2 | Reserved |\n| inline_data | 28 | 35 | Inline payload |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.4 Send Completion (64 bytes)\n\n**Datamodel**: `send_completion.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x01 for send |\n| flags | 1 | 1 | Completion flags |\n| status | 2 | 2 | Completion status |\n| reserved_0 | 4 | 4 | Reserved |\n| op_context | 8 | 8 | Operation context |\n| bytes_sent | 16 | 4 | Bytes transferred |\n| reserved_1 | 20 | 43 | Reserved |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.5 Other HSI Formats\n\n| Format | File | Description |\n|--------|------|-------------|\n| SGL Entry | `sgl_entry.ksy` | Scatter-gather list entry |\n| PCIe Descriptors | `pcie/descriptors.ksy` | PCIe interface descriptors |\n\n---\n\n## 8. IP Block Descriptors\n\n**Datamodel Directory**: `datamodel/hw/ip/cornelis/`\n\n### 8.1 Collectives Engine (CE)\n\n**Datamodel**: `ce/descriptors.ksy`\n\nThe Collectives Engine uses RISC-V vector cores (VLEN=512) for hardware-accelerated collective operations.\n\n### 8.2 Electric Creek (EC)\n\n**Datamodel**: `ec/descriptors.ksy`\n\nElectric Creek is the management complex shared between PMR NIC and LNR Switch.\n\n---\n\n## 9. Work List\n\nThis section tracks issues requiring follow-up investigation or specification updates.\n\n### 9.1 Open Issues\n\n| ID | Priority | Category | Description | Status | Opened | Closed |\n|----|----------|----------|-------------|--------|--------|--------|\n| W-06-001 | Medium | Datamodel | UFH-32 lacks 16-bit entropy field; per-packet ECMP not supported; switch must derive entropy from Src+Dest hash | Deferred | 2026-01-20 | - |\n| W-07-001 | Low | Datamodel | `ack_cc.ksy` shows `ack_cc_state` as 32-bit (4 bytes) but UE Spec Table 3-36 shows 64-bit (8 bytes); verify field size | Investigation | 2026-01-22 | - |\n| W-07-002 | Low | Documentation | `collective_l2.ksy` and `scaleup_l2.ksy` marked as \"work_in_progress\" with spec_version 0.1; specifications incomplete | Spec Update | 2026-01-22 | - |\n| W-07-003 | Low | Datamodel | `ue_plus.ksy` 9-bit length field split across bytes 0-1 with unusual encoding (1 bit in byte 0, 8 bits in byte 1); verify encoding matches UE Spec | Investigation | 2026-01-22 | - |\n| W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |\n| W-05-002 | Medium | Specification | MTU values: Verify maximum MTU for each protocol | Investigation | 2026-01-10 | - |\n| W-05-003 | Medium | Documentation | CMS detailed formats: Need comprehensive documentation | Spec Update | 2026-01-10 | - |\n| W-03-002 | Low | Terminology | PDP vs PDS naming: UML uses both terms inconsistently | Spec Update | 2026-01-08 | - |\n| W-03-006 | Low | Terminology | SES vs SE: \"SES Processing Groups\" vs \"Semantic Engines\" | Spec Update | 2026-01-08 | - |\n\n### 9.2 Datamodel Gaps\n\n| ID | Priority | Description | Target Location | Status | Opened | Closed |\n|----|----------|-------------|-----------------|--------|--------|--------|\n| D-001 | High | PMR CSR definitions missing from datamodel | `datamodel/hw/asics/pmr/csrs/*.rdl` | Spec Update | 2026-01-10 | - |\n| D-002 | Medium | PMR block hierarchy YAML incomplete | `datamodel/hw/asics/pmr/blocks.yaml` | Spec Update | 2026-01-10 | - |\n| D-003 | Medium | PMR interface contracts missing | `datamodel/views/contracts/pmr-*.puml` | Spec Update | 2026-01-10 | - |\n\n### 9.3 Specification Clarifications Needed\n\n| ID | Priority | Question | Context | Status | Opened | Closed |\n|----|----------|----------|---------|--------|--------|--------|\n| Q1 | Medium | Lightweight Interface Scope | What features should be reduced in lightweight mode? | Investigation | 2026-01-10 | - |\n| Q2 | Medium | Tag Table Sizing | Should HW tag table size be per-endpoint configurable? | Investigation | 2026-01-10 | - |\n| Q3 | Medium | Multi-Packet Eager Messages | Should hardware support multi-packet eager messages? | Investigation | 2026-01-10 | - |\n| Q4 | Low | RoCE Work Queue Implementation | Confirm RoCE WQ/CQ are software-implemented | Investigation | 2026-01-10 | - |\n\n### 9.4 Closed Issues\n\n| ID | Priority | Category | Description | Resolution | Opened | Closed |\n|----|----------|----------|-------------|------------|--------|--------|\n| W-05-001 | Medium | Documentation | UE taxonomy reference | Documented in `05-packet-formats.md` | 2026-01-08 | 2026-01-10 |\n| W-02-005 | Medium | Documentation | Protocol support documentation | Documented UE+, RoCEv2, Ethernet | 2026-01-08 | 2026-01-10 |\n| W-02-006 | Medium | Documentation | Cornelis Collective Reduction Protocol | Documented in HAS §2.5.4 | 2026-01-08 | 2026-01-10 |\n| W-03-001 | Medium | Architecture | Semantic Engine count | Confirmed 64 (8x8) in UML and HAS | 2026-01-08 | 2026-01-10 |\n| W-17-005 | Low | Documentation | Port subdivision note | Added to HAS Ch17 | 2026-01-11 | 2026-01-11 |\n| W-17-006 | Medium | Documentation | MPORT interface documentation | Documented 256B @ 1.66 GHz | 2026-01-11 | 2026-01-11 |\n| W-04-005 | High | Datamodel | `ufh_16.ksy` address size: Datamodel shows 12-bit dest, should be 16-bit | UFH-16 restructured to 12-byte Ethernet MAC overlay with 16-bit destination (bytes 4-5) and 16-bit source (bytes 10-11) | 2026-01-10 | 2026-01-20 |\n| W-04-006 | High | Datamodel | `ufh_32.ksy` address size: Datamodel shows 16-bit dest, should be 32-bit | UFH-32 restructured to 12-byte Ethernet MAC overlay with 32-bit destination (bytes 2-5) and 32-bit source (bytes 8-11) | 2026-01-10 | 2026-01-20 |\n\n### 9.5 Change Log\n\n| Date | Change | Details |\n|------|--------|---------|\n| 2026-01-14 | Initial creation | Document created with PMR packet taxonomy |\n| 2026-01-20 | Review and update | Added UALink section (reference only, not PMR-supported); Added change log; Updated datamodel file counts; No new .ksy files since initial creation |\n| 2026-01-20 | UFH format details | Added detailed UFH-16 and UFH-32 format documentation in Section 6.2 (wire diagrams, field tables, type enumerations) |\n| 2026-01-20 | UFH restructuring | UFH-16 and UFH-32 restructured to 12-byte Ethernet MAC overlays; UFH-16 now 16-bit addressing, UFH-32 now 32-bit addressing; Added SLAP field constraints (Z,Y,X=001); Updated datamodel .ksy files; Closed W-04-005 and W-04-006 |\n| 2026-01-22 | Datamodel review | Added W-07-001 (ack_cc_state size mismatch), W-07-002 (collective/scaleup specs incomplete), W-07-003 (ue_plus length encoding); Identified 30+ packet formats requiring expansion |\n\n---\n\n## 10. UALink Protocol (Reference Only)\n\n**Note**: UALink is defined in the datamodel but is **NOT currently supported by PMR**. It is included here for reference as it may be relevant for future AI/ML accelerator interconnect work.\n\n**Datamodel Directory**: `datamodel/protocols/ualink/`\n\n### 10.1 UALink Overview\n\nUALink is an AI/ML accelerator interconnect protocol with 38 packet definitions across all OSI layers.\n\n| Layer | Count | Key Formats |\n|-------|-------|-------------|\n| UPLI (Upper Protocol Layer Interface) | 8 | commands.ksy, request_channel.ksy, status_codes.ksy |\n| Transaction | 9 | tl_flit.ksy, control_half_flit.ksy, data_half_flit.ksy |\n| Data Link | 12 | dl_flit.ksy, segment_header.ksy, crc.ksy, control_messages.ksy |\n| Physical | 4 | alignment_markers.ksy, control_ordered_sets.ksy, link_training.ksy |\n| Security | 5 | authentication.ksy, encryption.ksy, key_derivation.ksy |\n\n### 10.2 UALink Packet Formats\n\n#### UPLI Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Commands | `upli/commands.ksy` | UPLI command definitions |\n| Request Channel | `upli/request_channel.ksy` | Request channel format |\n| Originator Data | `upli/originator_data_channel.ksy` | Originator data channel |\n| Read Response | `upli/read_response_channel.ksy` | Read response channel |\n| Write Response | `upli/write_response_channel.ksy` | Write response channel |\n| Status Codes | `upli/status_codes.ksy` | Status code definitions |\n| Connection Handshake | `upli/protocols/connection_handshake.ksy` | Connection setup |\n| Flow Control | `upli/protocols/flow_control.ksy` | Flow control protocol |\n\n#### Transaction Layer\n| Format | File | Description |\n|--------|------|-------------|\n| TL Flit | `transaction/tl_flit.ksy` | Transaction layer flit |\n| Control Half Flit | `transaction/control_half_flit.ksy` | Control half flit |\n| Data Half Flit | `transaction/data_half_flit.ksy` | Data half flit |\n| Message Half Flit | `transaction/message_half_flit.ksy` | Message half flit |\n| Request Field | `transaction/request_field.ksy` | Request field format |\n| Response Field | `transaction/response_field.ksy` | Response field format |\n| Flow Control Field | `transaction/flow_control_field.ksy` | Flow control field |\n| Compression | `transaction/protocols/compression.ksy` | Data compression |\n| Address Cache | `transaction/protocols/address_cache.ksy` | Address caching |\n\n#### Data Link Layer\n| Format | File | Description |\n|--------|------|-------------|\n| DL Flit | `datalink/dl_flit.ksy` | Data link flit |\n| Flit Header | `datalink/flit_header.ksy` | Flit header format |\n| Segment Header | `datalink/segment_header.ksy` | Segment header |\n| CRC | `datalink/crc.ksy` | CRC calculation |\n| Control Messages | `datalink/messages/control_messages.ksy` | Control messages |\n| Basic Messages | `datalink/messages/basic_messages.ksy` | Basic messages |\n| UART Messages | `datalink/messages/uart_messages.ksy` | UART messages |\n| Vendor Defined | `datalink/messages/vendor_defined.ksy` | Vendor extensions |\n| Link Resiliency | `datalink/protocols/link_resiliency.ksy` | Link resiliency |\n| Link Level Replay | `datalink/protocols/link_level_replay.ksy` | Replay protocol |\n| Link State | `datalink/protocols/link_state.ksy` | Link state machine |\n| Link Folding | `datalink/protocols/link_folding.ksy` | Link folding |\n\n#### Physical Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Alignment Markers | `physical/alignment_markers.ksy` | Lane alignment |\n| Control Ordered Sets | `physical/control_ordered_sets.ksy` | Control sequences |\n| Reconciliation Sublayer | `physical/reconciliation_sublayer.ksy` | RS sublayer |\n| Link Training | `physical/protocols/link_training.ksy` | Link training |\n\n#### Security Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Authentication | `security/authentication.ksy` | Authentication |\n| Encryption | `security/encryption.ksy` | Encryption format |\n| IV Format | `security/iv_format.ksy` | Initialization vector |\n| Key Derivation | `security/protocols/key_derivation.ksy` | Key derivation |\n| Key Rotation | `security/protocols/key_rotation.ksy` | Key rotation |\n\n---\n\n## 11. References\n\n### Internal Documents\n- `docs/HAS/PMR/05-packet-formats.md` - PMR HAS Chapter 5\n- `docs/HAS/PMR/WORK.md` - PMR HAS Work Tracking\n- `.specify/memory/constitution.md` - Project Constitution\n\n### Datamodel Locations\n- `datamodel/protocols/ue/` - Ultra Ethernet protocols (94 .ksy files)\n- `datamodel/protocols/roce/` - RoCEv2 protocols (8 .ksy files)\n- `datamodel/protocols/ethernet/` - Standard Ethernet (6 .ksy files)\n- `datamodel/protocols/cornelis/` - Cornelis proprietary (9 .ksy files)\n- `datamodel/protocols/ualink/` - UALink protocols (38 .ksy files) - NOT supported by PMR\n- `datamodel/hw/asics/pmr/` - PMR ASIC definitions\n\n### External Specifications\n- [Ultra Ethernet Specification v1.0.1](https://ultraethernet.org/)\n- [InfiniBand Architecture Specification](https://www.infinibandta.org/)\n- IEEE 802.3 Ethernet Standard\n- UALink Specification (Ultra Accelerator Link)\n",
                "after": "# PMR (CN7000) Packet Format Taxonomy\n\n**Document**: Packet formats supported by PMR NIC ASIC  \n**Generated**: 2026-01-14  \n**Last Reviewed**: 2026-01-20  \n**Source**: `datamodel/` directory in EarlySim repository  \n**Reference**: `docs/HAS/PMR/05-packet-formats.md`\n\n---\n\n## Table of Contents\n\n1. [Overview](#1-overview)\n2. [Protocol Stack Summary](#2-protocol-stack-summary)\n3. [Ultra Ethernet+ (UE+) Formats](#3-ultra-ethernet-ue-formats)\n4. [RoCEv2 Formats](#4-rocev2-formats)\n5. [Standard Ethernet Formats](#5-standard-ethernet-formats)\n6. [Cornelis Proprietary Formats](#6-cornelis-proprietary-formats)\n7. [Host-Software Interface (HSI) Formats](#7-host-software-interface-hsi-formats)\n8. [IP Block Descriptors](#8-ip-block-descriptors)\n9. [Work List](#9-work-list)\n10. [UALink Protocol (Reference Only)](#10-ualink-protocol-reference-only)\n11. [References](#11-references)\n\n---\n\n## 1. Overview\n\nPMR (Prism River) is Cornelis Networks' 1.6 Tbps NIC ASIC (CN7000 product family). It supports multiple wire protocols with per-packet protocol selection on a single physical port.\n\n### Supported Protocols\n\n| Protocol | Version | Status | Description |\n|----------|---------|--------|-------------|\n| Ultra Ethernet+ | 1.0.1 | Full | Optimized UE with Cornelis extensions |\n| RoCEv2 | v2 | Full | RDMA over Converged Ethernet |\n| Standard Ethernet | IEEE 802.3 | Full | Traditional Ethernet with offloads |\n| Cornelis Proprietary | 1.0.0 | Full | UFH, CSIG+, VxLAN+, Collectives |\n\n### Header Efficiency Comparison\n\n| Protocol Stack | Total Headers | Efficiency (4KB payload) |\n|----------------|---------------|--------------------------|\n| UE+ (small msg) | ~20 bytes | 99.5% |\n| UE+ (standard) | ~40 bytes | 99.0% |\n| RoCEv2 (IPv4) | ~58 bytes | 98.6% |\n| RoCEv2 (IPv6) | ~78 bytes | 98.1% |\n\n---\n\n## 2. Protocol Stack Summary\n\n```\n+-----------------------------------------------------------------------------+\n|                           Application Layer                                  |\n|                    (Libfabric, Verbs, Sockets, DPDK)                         |\n+-----------------------------------------------------------------------------+\n|                           Transport Layer                                    |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UE Transport   |  |     RoCEv2       |  |    TCP/UDP       |            |\n|  |   (SES/PDS/CMS)  |  |   (BTH/RETH)     |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                           Network Layer                                      |\n|  +------------------+  +------------------+  +------------------+            |\n|  |   UFH-16/32      |  |   IPv4/IPv6      |  |   IPv4/IPv6      |            |\n|  |   (Cornelis)     |  |   + UDP          |  |                  |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                            Link Layer                                        |\n|  +------------------+  +------------------+  +------------------+            |\n|  |      UE+         |  |   Ethernet II    |  |   Ethernet II    |            |\n|  |   (12 bytes)     |  |   (14 bytes)     |  |   (14 bytes)     |            |\n|  +------------------+  +------------------+  +------------------+            |\n+-----------------------------------------------------------------------------+\n|                          Physical Layer                                      |\n|                    Hill Creek (212.5G x8 PAM4 SerDes)                        |\n+-----------------------------------------------------------------------------+\n      Ultra Ethernet+           RoCEv2              Standard Ethernet\n```\n\n---\n\n## 3. Ultra Ethernet+ (UE+) Formats\n\n### 3.1 UE+ L2 Header (12 bytes)\n\n**Datamodel**: `datamodel/protocols/cornelis/link/ue_plus.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Byte 2        | Byte 3        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n|L2|V|zyxm|Len  | Length[7:0]   | RC    | SC    | Hop Count     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 4        | Byte 5        | Byte 6        | Byte 7        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Dest LID [15:8]               | Dest LID [7:0]                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Entropy [15:8]                | Entropy [7:0]                 |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 8        | Byte 9        | Byte 10       | Byte 11       |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Source LID [15:8]             | Source LID [7:0]              |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Payload Type [15:8]           | Payload Type [7:0]            |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| L2 Type | 2 | Always 0b10 for UE+ |\n| Version | 1 | Protocol version |\n| zyxm | 4 | Routing control flags (multicast, adaptive) |\n| Length | 9 | Packet length in bytes |\n| RC | 4 | Routing Class (QoS) |\n| SC | 4 | Service Class |\n| Hop | 8 | TTL/hop count |\n| Dest LID | 16 | Destination Local Identifier |\n| Entropy | 16 | ECMP hash for load balancing |\n| Source LID | 16 | Source Local Identifier |\n| Type | 16 | Payload type (EtherType equivalent) |\n\n**Payload Types**:\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x0800 | IPv4 | IPv4 payload |\n| 0x86DD | IPv6 | IPv6 payload |\n| 0x8100 | VLAN | VLAN tagged frame |\n| 0x9000 | VxLAN+ | VxLAN+ encapsulated |\n| 0x9100 | CSIG+ | CSIG+ telemetry |\n| 0xC000 | UE PDS | Ultra Ethernet PDS |\n\n### 3.2 PDS (Packet Delivery Sublayer) Prologue (2 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/prologue.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0                        | Byte 1                        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| type[4:0] | next_hdr/ctl[3:0] | flags[6:0]                    |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| PDS Type | Value | Description |\n|----------|-------|-------------|\n| Reserved | 0 | Reserved |\n| TSS | 1 | Transport Security (encryption) |\n| RUD Request | 2 | Reliable Unordered Delivery |\n| ROD Request | 3 | Reliable Ordered Delivery |\n| RUDI Request | 4 | Reliable Unordered Immediate |\n| RUDI Response | 5 | RUDI response |\n| UUD Request | 6 | Unreliable Unordered Delivery |\n| ACK | 7 | Acknowledgment |\n| ACK_CC | 8 | ACK with congestion control |\n| ACK_CCX | 9 | ACK with extended CC |\n| NACK | 10 | Negative acknowledgment |\n| CP | 11 | Control packet |\n| NACK_CCX | 12 | NACK with extended CC |\n| RUD_CC_REQ | 13 | RUD with CC state |\n| ROD_CC_REQ | 14 | ROD with CC state |\n\n### 3.3 PDS Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/pds/`\n\n```\nPDS Request/Response Relationships:\n┌─────────────────────────────────────────────────────────────────┐\n│                                                                 │\n│  UUD Request (0x06) ──────────────────────→ (no response)       │\n│                                                                 │\n│  RUDI Request (0x04) ─────────────────────→ RUDI Response (0x05)│\n│                       └───────────────────→ NACK (0x0A)         │\n│                                                                 │\n│  RUD Request (0x01) ──┬───────────────────→ ACK (0x07)          │\n│                       ├───────────────────→ ACK_CC (0x08)       │\n│                       ├───────────────────→ ACK_CCX (0x09)      │\n│                       ├───────────────────→ NACK (0x0A)         │\n│                       └───────────────────→ NACK_CCX (0x0C)     │\n│                                                                 │\n│  ROD Request (0x02) ──┴───────────────────→ (same as RUD)       │\n│                                                                 │\n│  Control Packet (0x0B) ───────────────────→ (varies by subtype) │\n│                                                                 │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n| Type | Format | File | Size | Description |\n|------|--------|------|------|-------------|\n| 0x01 | RUD Request | `rud_rod_request.ksy` | 12 bytes | Reliable Unordered Delivery |\n| 0x02 | ROD Request | `rud_rod_request.ksy` | 12 bytes | Reliable Ordered Delivery |\n| 0x04 | RUDI Request | `rudi_request_response.ksy` | 6 bytes | Reliable Unordered Immediate |\n| 0x05 | RUDI Response | `rudi_request_response.ksy` | 6 bytes | RUDI response |\n| 0x06 | UUD Request | `uud_request.ksy` | 6 bytes | Unreliable Unordered Delivery |\n| 0x07 | ACK | `rud_rod_ack.ksy` | 12 bytes | Acknowledgment |\n| 0x08 | ACK_CC | `ack_cc.ksy` | 28 bytes | ACK with CC state |\n| 0x09 | ACK_CCX | `ack_ccx.ksy` | 44 bytes | ACK with extended CC |\n| 0x0A | NACK | `nack.ksy` | 12 bytes | Negative acknowledgment |\n| 0x0B | CP | `rud_rod_cp.ksy` | 12 bytes | Control packet (10 subtypes) |\n| 0x0C | NACK_CCX | `nack_ccx.ksy` | 28 bytes | NACK with extended CC |\n\n#### 3.3.1 RUD Request (Type 0x01, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_request.ksy`  \n**Related Formats**: [ROD Request (3.3.2)](#332-rod-request-type-0x02-12-bytes) | [ACK (3.3.6)](#336-ack-type-0x07-12-bytes) | [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |nxt|flg|       clear_psn_offset |         PSN [31:0]    →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|r|a|s|rsvd|\n       | (5 bits)|(4 bit)| (2) |t|r|y|(2) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x01 (RUD) | Must be 0x01 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 2 | 1[6:5] | Reserved | Must be 0 |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.ar | 1 | 1[3] | ACK request | 0=no ACK, 1=request ACK |\n| flags.syn | 1 | 1[2] | PDC establishment | 0=normal, 1=SYN |\n| flags.rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n| clear_psn_offset | 16 | 2-3 | CLEAR_PSN relative to PSN | Unsigned offset |\n| psn | 32 | 4-7 | Packet Sequence Number | 32-bit, wraps |\n| spdcid | 16 | 8-9 | Source PDCID | Valid PDCID |\n| dpdcid | 16 | 10-11 | Destination PDCID | See note below |\n\n##### Field Notes\n\n**dpdcid Interpretation** (depends on `syn` flag):\n- `syn=0`: Destination PDCID for established PDC\n- `syn=1`: `{pdc_info[3:0], psn_offset[11:0]}` for PDC establishment\n  - `pdc_info[0]`: use_rsv_pdc (1=reserved pool, 0=shared pool)\n  - `pdc_info[3:1]`: Reserved\n  - `psn_offset[11:0]`: Difference between PSN and Start_PSN\n\n**clear_psn_offset**: Computed as `CLEAR_PSN = PSN - clear_psn_offset`. Indicates the highest PSN that has been delivered to SES at the source.\n\n##### Protocol Behavior\n\n**Delivery Mode**: RUD (Reliable Unordered Delivery) provides reliable packet delivery without ordering guarantees. Packets may be delivered to SES out of order.\n\n**State Machine**: RUD operates within the PDC (Packet Delivery Channel) state machine defined in Section 3.5.7.\n\n**Transmission Rules**:\n1. Source assigns monotonically increasing PSN to each packet\n2. `ar` flag SHOULD be set periodically (per `ack_request_interval`)\n3. `retx` flag set when retransmitting due to timeout or NACK\n4. `syn` flag set only for first packet establishing new PDC\n\n**Receiver Processing**:\n1. Validate PDCID and PSN\n2. If PSN is new: deliver to SES immediately (no ordering)\n3. If PSN is duplicate: discard, optionally send ACK\n4. If `ar=1`: generate ACK, ACK_CC, or ACK_CCX response\n\n**Timing Constraints**:\n- Retransmit timeout: Implementation-defined (typically RTT-based)\n- ACK coalescing: Up to `ack_coalesce_count` packets\n\n**Reference**: UE Spec v1.0.1, Table 3-33, Section 3.5.10.3, Page 256\n\n---\n\n#### 3.3.2 ROD Request (Type 0x02, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_request.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [ACK (3.3.6)](#336-ack-type-0x07-12-bytes) | [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\nIdentical to RUD Request (Section 3.3.1) with `type = 0x02`.\n\n##### Field Definitions\n\nSame as RUD Request. Only `type` field differs.\n\n##### Protocol Behavior\n\n**Delivery Mode**: ROD (Reliable Ordered Delivery) provides reliable packet delivery with strict ordering guarantees. Packets are delivered to SES in PSN order.\n\n**Key Difference from RUD**: ROD receiver MUST buffer out-of-order packets and deliver to SES only when all preceding PSNs have been received.\n\n**Ordering Guarantee**:\n- Receiver maintains expected PSN\n- Out-of-order packets are buffered (not delivered)\n- When gap is filled, buffered packets delivered in order\n- Head-of-line blocking possible if packet lost\n\n**Use Cases**:\n- Multi-packet messages requiring in-order delivery\n- Streaming data with ordering requirements\n- Operations where partial delivery is not acceptable\n\n**Reference**: UE Spec v1.0.1, Table 3-33, Section 3.5.10.3, Page 256\n\n---\n\n#### 3.3.3 RUDI Request (Type 0x04, 6 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rudi_request_response.ksy`  \n**Related Formats**: [RUDI Response (3.3.4)](#334-rudi-response-type-0x05-6-bytes) | [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5\n     +-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  |         pkt_id [31:0]     |\n     +-------+-------+-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|r|retx|rsvd|\n       | (5 bits)|(4 bit)| (1) |m| (1)|(4) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x04 (RUDI Request) | Must be 0x04 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.rsvd_m | 1 | 1[5] | Reserved (m for response) | Must be 0 for request |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.rsvd | 4 | 1[3:0] | Reserved | Must be 0 |\n| pkt_id | 32 | 2-5 | Packet Identifier | Locally unique |\n\n##### Protocol Behavior\n\n**Delivery Mode**: RUDI (Reliable Unordered Delivery with Idempotence) provides reliable delivery for idempotent operations without PDC context.\n\n**Key Characteristics**:\n- Uses packet ID instead of sequence number\n- No PDC (Packet Delivery Context) required\n- Idempotent: safe to retry without side effects\n- Smaller header (6 bytes vs 12 bytes for RUD/ROD)\n\n**Idempotence Guarantee**:\n- Receiver tracks recently processed pkt_ids\n- Duplicate pkt_ids are detected and response re-sent\n- No state corruption from retransmissions\n\n**Use Cases**:\n- Small, self-contained operations\n- Stateless request/response patterns\n- Operations where retry is safe (reads, idempotent writes)\n\n**Reference**: UE Spec v1.0.1, Table 3-39, Section 3.5.10.9, Page 262\n\n---\n\n#### 3.3.4 RUDI Response (Type 0x05, 6 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rudi_request_response.ksy`  \n**Related Formats**: [RUDI Request (3.3.3)](#333-rudi-request-type-0x04-6-bytes)\n\n##### Wire Format\n\nIdentical to RUDI Request with `type = 0x05` and `flags.m` valid.\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x05 (RUDI Response) | Must be 0x05 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.m | 1 | 1[5] | ECN marked | 1 if request was ECN marked |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.rsvd | 4 | 1[3:0] | Reserved | Must be 0 |\n| pkt_id | 32 | 2-5 | Packet Identifier | Echoed from request |\n\n##### Protocol Behavior\n\n**Response Generation**:\n1. Receiver processes RUDI Request\n2. Generates RUDI Response with same pkt_id\n3. Sets `m` flag if request packet was ECN marked\n\n**Reference**: UE Spec v1.0.1, Table 3-39, Section 3.5.10.9, Page 262\n\n---\n\n#### 3.3.5 UUD Request (Type 0x06, 6 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/uud_request.ksy`  \n**Related Formats**: None (no response generated)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5\n     +-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  |         pkt_id [31:0]     |\n     +-------+-------+-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr|     rsvd (7)    |\n       | (5 bits)|(4 bit)|                 |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x06 (UUD) | Must be 0x06 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 7 | 1[6:0] | Reserved | Must be 0 |\n| pkt_id | 32 | 2-5 | Packet Identifier | Locally unique |\n\n##### Protocol Behavior\n\n**Delivery Mode**: UUD (Unreliable Unordered Delivery) provides best-effort delivery with no reliability guarantees.\n\n**Key Characteristics**:\n- No ACKs or NACKs generated\n- No retransmissions\n- Packet loss is acceptable\n- Lowest overhead delivery mode\n\n**Use Cases**:\n- Loss-tolerant traffic (video streaming, telemetry)\n- High-frequency updates where latest value matters\n- Multicast/broadcast scenarios\n\n**Reference**: UE Spec v1.0.1, Table 3-42, Section 3.5.10.12, Page 265\n\n---\n\n#### 3.3.6 ACK (Type 0x07, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_ack.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [ACK_CC (3.3.7)](#337-ack_cc-type-0x08-28-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  |   ack_psn_offset  |    probe_opaque     →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |   cack_psn    |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|m|r|p|req|rsvd|\n       | (5 bits)|(4 bit)| (1) | |t| |   |(1) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x07 (ACK) | Must be 0x07 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | UET_HDR_NONE |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.m | 1 | 1[5] | ECN marked | 1 if any ACK'd packet was ECN marked |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.p | 1 | 1[3] | Probe response | 1 if responding to Probe CP |\n| flags.req | 2 | 1[2:1] | Request type | 0=RUD, 1=ROD |\n| flags.rsvd | 1 | 1[0] | Reserved | Must be 0 |\n| ack_psn_offset | 16 | 2-3 | Offset from CACK_PSN to ACK_PSN | Signed |\n| probe_opaque | 16 | 4-5 | Copied from Probe CP | Opaque value |\n| cack_psn | 32 | 6-9 | Cumulative ACK PSN | Highest in-order PSN |\n| spdcid | 16 | 10-11 | Source PDCID | Swapped from request |\n| dpdcid | 16 | 12-13 | Destination PDCID | Swapped from request |\n\n**Note**: Wire format shows 12 bytes but field table shows 14 bytes. Verify against spec - likely cack_psn is 16 bits or spdcid/dpdcid share bytes 10-11.\n\n##### Protocol Behavior\n\n**ACK Generation**:\n1. Receiver tracks highest in-order PSN received (CACK_PSN)\n2. ACK generated when `ar` flag set in request, or periodically\n3. `m` flag set if any ACK'd packet had ECN marking\n\n**Cumulative ACK**:\n- `cack_psn` acknowledges all PSNs ≤ this value\n- Sender can free buffers for acknowledged packets\n- Enables sliding window flow control\n\n**Reference**: UE Spec v1.0.1, Table 3-35, Section 3.5.10.5, Page 258\n\n---\n\n#### 3.3.7 ACK_CC (Type 0x08, 28 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/ack_cc.ksy`  \n**Related Formats**: [ACK (3.3.6)](#336-ack-type-0x07-12-bytes) | [ACK_CCX (3.3.8)](#338-ack_ccx-type-0x09-44-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |                    ACK Header (12 bytes)                      |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |  (ACK cont'd) |cc_typ|cc_flg|  mpr  | sack_psn_offset       →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |              sack_bitmap [63:0]                               |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        24      25      26      27\n     +-------+-------+-------+-------+\n     |       ack_cc_state [63:0]     |\n     +-------+-------+-------+-------+\n```\n\n##### Field Definitions (CC Extension, bytes 12-27)\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| cc_type | 4 | 12[7:4] | CC algorithm type | Per Section 3.6.9 |\n| cc_flags | 4 | 12[3:0] | CC flags | Reserved, must be 0 |\n| mpr | 8 | 13 | Maximum PSN Range | Flow control window |\n| sack_psn_offset | 16 | 14-15 | Offset to SACK base PSN | Signed |\n| sack_bitmap | 64 | 16-23 | Selective ACK bitmap | 1=ACK'd, 0=not ACK'd |\n| ack_cc_state | 64 | 24-27 | CC state (per cc_type) | See Section 3.6.9 |\n\n##### CC Type Values\n\n| Value | Name | Description |\n|-------|------|-------------|\n| 0x0 | CC_NSCC | Network-Signaled Congestion Control |\n| 0x1 | CC_CREDIT | RCCC/TFC Credit-based CC |\n\n##### Protocol Behavior\n\n**Selective ACK (SACK)**:\n- `sack_bitmap` covers 64 PSNs starting at `CACK_PSN + sack_psn_offset`\n- Bit N = 1 means PSN (base + N) received\n- Enables efficient loss recovery without full retransmit\n\n**Congestion Control State**:\n- `ack_cc_state` interpretation depends on `cc_type`\n- For NSCC: Contains service_time, rcv_cwnd_pend, rcvd_bytes, ooo_count\n- For CREDIT: Contains credit information\n\n**Reference**: UE Spec v1.0.1, Table 3-36, Section 3.5.10.6, Page 259\n\n---\n\n#### 3.3.8 ACK_CCX (Type 0x09, 44 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/ack_ccx.ksy`  \n**Related Formats**: [ACK_CC (3.3.7)](#337-ack_cc-type-0x08-28-bytes)\n\n##### Wire Format\n\nACK_CCX extends ACK_CC with additional 16 bytes for extended CC state.\n\n```\nBytes 0-27:  ACK_CC header (28 bytes)\nBytes 28-43: Extended CC state (16 bytes)\n```\n\n##### Additional Fields (bytes 28-43)\n\n| Field | Bits | Offset | Description |\n|-------|------|--------|-------------|\n| ack_ccx_state | 128 | 28-43 | Extended CC state |\n\n##### Protocol Behavior\n\n**Extended State**: ACK_CCX provides additional CC state for algorithms requiring more than 64 bits of feedback.\n\n**Reference**: UE Spec v1.0.1, Table 3-37, Section 3.5.10.7, Page 260\n\n---\n\n#### 3.3.9 NACK (Type 0x0A, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/nack.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [NACK_CCX (3.3.10)](#3310-nack_ccx-type-0x0c-28-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  | nack_code |vendor_code|   nack_psn [31:0] →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|m|r|nt|rsvd|\n       | (5 bits)|(4 bit)| (1) | |t|  |(3) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x0A (NACK) | Must be 0x0A |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | UET_HDR_NONE |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.m | 1 | 1[5] | ECN marked | 1 if request was ECN marked |\n| flags.retx | 1 | 1[4] | Retransmit indicator | From request |\n| flags.nt | 1 | 1[3] | NACK type | 0=RUD/ROD, 1=RUDI |\n| flags.rsvd | 3 | 1[2:0] | Reserved | Must be 0 |\n| nack_code | 8 | 2 | NACK reason code | Per Table 3-59 |\n| vendor_code | 8 | 3 | Vendor-specific code | Optional |\n| nack_psn | 32 | 4-7 | NACK'd PSN or pkt_id | Depends on nt flag |\n| spdcid | 16 | 8-9 | Source PDCID | 0 if nt=1 or PDC failure |\n| dpdcid | 16 | 10-11 | Destination PDCID | 0 if nt=1 |\n\n##### NACK Codes (Table 3-59)\n\n| Code | Name | Description |\n|------|------|-------------|\n| 0x00 | UET_NO_PKT_BUF | No packet buffer available |\n| 0x01 | UET_TRIMMED | Packet was trimmed |\n| 0x02 | UET_NO_PDC_AVAIL | No PDC resources available |\n| 0x03 | UET_INV_DPDCID | Invalid destination PDCID |\n| 0x04 | UET_PDC_HDR_MISMATCH | PDC header mismatch |\n| 0x05 | UET_PSN_OOR_WINDOW | PSN outside expected window |\n| 0x06 | UET_PSN_GAP | PSN gap detected (packet loss) |\n\n##### Protocol Behavior\n\n**NACK Generation**:\n1. Receiver detects error condition (loss, resource exhaustion, etc.)\n2. Generates NACK with appropriate nack_code\n3. Sender receives NACK and takes corrective action\n\n**Sender Response to NACK**:\n- `UET_PSN_GAP`: Retransmit missing packets\n- `UET_NO_PKT_BUF`: Back off, retry later\n- `UET_NO_PDC_AVAIL`: PDC establishment failed, retry or abort\n\n**Reference**: UE Spec v1.0.1, Table 3-40, Section 3.5.10.10, Page 263\n\n---\n\n#### 3.3.10 NACK_CCX (Type 0x0C, 28 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/nack_ccx.ksy`  \n**Related Formats**: [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n\n##### Wire Format\n\nNACK_CCX extends NACK with 16 bytes of CC state (similar to ACK_CC extension).\n\n```\nBytes 0-11:  NACK header (12 bytes)\nBytes 12-27: CC extension (16 bytes)\n```\n\n##### Protocol Behavior\n\n**Extended NACK**: NACK_CCX provides congestion control feedback along with the negative acknowledgment, enabling the sender to adjust its rate while handling the error.\n\n**Reference**: UE Spec v1.0.1, Table 3-41, Section 3.5.10.11, Page 264\n\n---\n\n#### 3.3.11 Control Packet (Type 0x0B, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_cp.ksy`  \n**Related Formats**: [RUD Request (3.3.1)](#331-rud-request-type-0x01-12-bytes) | [ACK (3.3.6)](#336-ack-type-0x07-12-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |ctl|  flags  |   probe_opaque    |         PSN [31:0]  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |ctl_typ| rsvd|i|r|a|s|rsvd|\n       | (5 bits)|(4 bit)| (1) |r|t|r|y|(2) |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x0B (CP) | Must be 0x0B |\n| ctl_type | 4 | 0[2:0]+1[7] | Control packet subtype | 0-9 defined |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.isrod | 1 | 1[5] | ROD indicator | 1=ROD, 0=RUD (for NOOP/Negotiation) |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.ar | 1 | 1[3] | ACK request | 0=no ACK, 1=request ACK |\n| flags.syn | 1 | 1[2] | PDC establishment | 0=normal, 1=SYN |\n| flags.rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n| probe_opaque | 16 | 2-3 | Opaque value for Probe | Echoed in ACK |\n| psn | 32 | 4-7 | Packet Sequence Number | Some CPs consume PSN |\n| spdcid | 16 | 8-9 | Source PDCID | Valid PDCID |\n| dpdcid | 16 | 10-11 | Destination PDCID | Or {pdc_info, psn_offset} |\n\n##### Control Packet Subtypes\n\n| ctl_type | Name | Direction | Description |\n|----------|------|-----------|-------------|\n| 0 | NOOP | Either | No operation |\n| 1 | ACK_REQUEST | Src→Dst | Request ACK for specific PSN |\n| 2 | CLEAR_COMMAND | Init→Tgt | Clear guaranteed delivery state |\n| 3 | CLEAR_REQUEST | Tgt→Init | Request initiator to send clear |\n| 4 | CLOSE_COMMAND | Init→Tgt | PDC is being closed |\n| 5 | CLOSE_REQUEST | Tgt→Init | Request initiator to close PDC |\n| 6 | PROBE | Src→Dst | Request PDS ACK |\n| 7 | CREDIT | Dst→Src | Carry CC credit |\n| 8 | CREDIT_REQUEST | Src→Dst | Request credit |\n| 9 | NEGOTIATION | Either | PDC negotiation |\n\n##### Protocol Behavior\n\n**PDC Lifecycle**:\n- `CLOSE_COMMAND/REQUEST`: Graceful PDC teardown\n- `CLEAR_COMMAND/REQUEST`: Clear delivery state without closing\n\n**Flow Control**:\n- `CREDIT/CREDIT_REQUEST`: Credit-based flow control\n- `PROBE`: Solicit ACK for RTT measurement or liveness check\n\n**Reference**: UE Spec v1.0.1, Table 3-38, Section 3.5.10.8, Page 261\n\n### 3.4 SES (Semantic Sublayer) Opcodes\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/opcodes.ksy`\n\n**Request Opcodes (Table 3-17)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Tagged Send | 0x00 | Send with tag matching |\n| RMA Write | 0x01 | Remote memory write |\n| RMA Read | 0x02 | Remote memory read |\n| Atomic Write | 0x03 | Atomic memory write |\n| Atomic Read | 0x04 | Atomic memory read |\n| Atomic CAS | 0x05 | Compare-and-swap |\n| Deferrable Send | 0x06 | Deferrable send |\n| Ready to Restart | 0x07 | Restart notification |\n| Small Message | 0x08 | Small message (32B header) |\n| Small RMA Write | 0x09 | Small RMA write |\n| Small RMA Read | 0x0A | Small RMA read |\n| Small Atomic Write | 0x0B | Small atomic write |\n| Small Atomic Read | 0x0C | Small atomic read |\n| Small Atomic CAS | 0x0D | Small atomic CAS |\n\n**Response Opcodes (Table 3-18)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Response | 0x00 | Standard response |\n| Response with Data | 0x01 | Response carrying data |\n| Optimized Response | 0x02 | Optimized format |\n| NACK | 0x03 | Negative acknowledgment |\n\n### 3.5 SES Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/ses/`\n\n```\nSES Request/Response Relationships:\n┌─────────────────────────────────────────────────────────────────┐\n│                                                                 │\n│  Standard Request ────┬───────────────────→ Response            │\n│  (SOM=1, 44B)         └───────────────────→ Response w/Data     │\n│       │                                                         │\n│       └──→ Continuation (SOM=0, 16B)                            │\n│                                                                 │\n│  Small Message (32B) ─────────────────────→ Response            │\n│                                                                 │\n│  + Atomic Extension (8B) ─────────────────→ Response w/Data     │\n│                                             (for fetching ops)  │\n│                                                                 │\n│  + Rendezvous Extension (32B) ────────────→ (target pulls data) │\n│                                                                 │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n| Table/Figure | Format | File | Size | Description |\n|--------------|--------|------|------|-------------|\n| Table 3-8 | Standard Request (SOM=1) | `standard_request_som1.ksy` | 44 bytes | Start of message |\n| Table 3-9 | Standard Request (SOM=0) | `standard_request_som0.ksy` | 16 bytes | Continuation |\n| Table 3-11 | Response | `response.ksy` | 16 bytes | Standard response |\n| Table 3-12 | Response with Data | `response_with_data.ksy` | 24 bytes | Data-carrying response |\n| Figure 3-14 | Small Message | `small_message.ksy` | 32 bytes | Single-packet optimized |\n| Figure 3-15 | Rendezvous Extension | `rendezvous_extension.ksy` | 32 bytes | Large message protocol |\n| Figure 3-16 | Atomic Extension | `atomic_extension.ksy` | 8 bytes | Atomic operations |\n\n#### 3.5.1 Standard Request SOM=1 (Table 3-8, 44 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/standard_request_som1.ksy`  \n**Related Formats**: [Standard Request SOM=0 (3.5.2)](#352-standard-request-som0-table-3-9-16-bytes) | [Response (3.5.3)](#353-response-table-3-11-16-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |rs|opcode |v|dc|ie|rl|hd|eo|so|    message_id     | ri_gen  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |rsvd|pid_on_fep |rsvd| resource_idx  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |                    buffer_offset [63:0]                       |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        24      25      26      27      28      29      30      31\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |        initiator [31:0]       |   match_bits / memory_key    →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        32      33      34      35      36      37      38      39\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |  (match_bits cont'd) [63:0]   |       header_data [63:0]     →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        40      41      42      43\n     +-------+-------+-------+-------+\n   → | (hdr_data)    | request_length|\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |rsvd |  opcode |v|dc|ie|rl|hd|eo|so|\n       | (2) | (6 bits)|r| | | | | | | |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| rsvd | 2 | 0[7:6] | Reserved | Must be 0 |\n| opcode | 6 | 0[5:0] | Operation code | Per Table 3-17 |\n| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n| dc | 1 | 1[5] | Delivery Complete | Defer response until globally observable |\n| ie | 1 | 1[4] | Initiator Error | Error at initiator |\n| rel | 1 | 1[3] | Relative addressing | 0=absolute, 1=relative |\n| hd | 1 | 1[2] | Header Data present | 1=header_data valid |\n| eom | 1 | 1[1] | End of Message | 1=last packet |\n| som | 1 | 1[0] | Start of Message | Must be 1 for this format |\n| message_id | 16 | 2-3 | Message identifier | 0=reserved (invalid) |\n| ri_generation | 8 | 4 | Resource Index generation | For buffer exhaustion recovery |\n| job_id | 24 | 5-7 | Job Identifier | Matches VXLAN VNI size |\n| rsvd | 4 | 8[7:4] | Reserved | Must be 0 |\n| pid_on_fep | 12 | 8[3:0]+9 | Process ID on FEP | Target process |\n| rsvd | 4 | 10[7:4] | Reserved | Must be 0 |\n| resource_index | 12 | 10[3:0]+11 | Resource Index | Target resource |\n| buffer_offset | 64 | 12-19 | Buffer offset | Or restart token for deferrable |\n| initiator | 32 | 20-23 | Initiator ID | For tagged matching |\n| match_bits | 64 | 24-31 | Match bits / Memory key | Dual-purpose field |\n| header_data | 64 | 32-39 | Header data | Completion data (if hd=1) |\n| request_length | 32 | 40-43 | Request length | Bytes to transfer |\n\n##### Field Notes\n\n**match_bits / memory_key Interpretation**:\n- For tagged operations (sends): Match bits for receive queue matching\n- For RMA operations (reads, writes): Memory key for authorization\n\n**buffer_offset Special Uses**:\n- For deferrable sends: Contains restart token (upper 32b initiator, lower 32b target)\n- For FI_MR_VIRT_ADDR: Contains absolute virtual address\n\n##### Protocol Behavior\n\n**Message Framing**:\n- `som=1, eom=1`: Single-packet message\n- `som=1, eom=0`: First packet of multi-packet message\n- Continuation packets use SOM=0 format (Table 3-9)\n\n**Addressing Modes**:\n- `rel=0` (Absolute): {JobID, PIDonFEP, resource_index} identifies target\n- `rel=1` (Relative): Addressing relative to connection context\n\n**Delivery Complete (dc)**:\n- When `dc=1`: Response deferred until data globally observable\n- Matches FI_DELIVERY_COMPLETE libfabric option\n\n**Reference**: UE Spec v1.0.1, Table 3-8, Section 3.4.2.1, Page 158\n\n---\n\n#### 3.5.2 Standard Request SOM=0 (Table 3-9, 16 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/standard_request_som0.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |rs|opcode |v|dc|ie|rl|hd|eo|so|    message_id     | ri_gen  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |       message_offset [31:0]          |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| rsvd | 2 | 0[7:6] | Reserved | Must be 0 |\n| opcode | 6 | 0[5:0] | Operation code | Same as SOM=1 packet |\n| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n| dc | 1 | 1[5] | Delivery Complete | Same as SOM=1 |\n| ie | 1 | 1[4] | Initiator Error | Error at initiator |\n| rel | 1 | 1[3] | Relative addressing | Same as SOM=1 |\n| hd | 1 | 1[2] | Header Data present | Ignored for SOM=0 |\n| eom | 1 | 1[1] | End of Message | 1=last packet |\n| som | 1 | 1[0] | Start of Message | Must be 0 for this format |\n| message_id | 16 | 2-3 | Message identifier | Same as SOM=1 packet |\n| ri_generation | 8 | 4 | Resource Index generation | Same as SOM=1 |\n| job_id | 24 | 5-7 | Job Identifier | Same as SOM=1 |\n| message_offset | 32 | 8-11 | Offset within message | Byte offset from start |\n\n##### Protocol Behavior\n\n**Continuation Packets**:\n- Used for packets 2..N of multi-packet messages\n- `message_offset` indicates position within overall message\n- Target uses offset to place data correctly in buffer\n\n**Packet Ordering**:\n- ROD delivery: Packets delivered in PSN order\n- RUD delivery: Packets may arrive out of order; target reassembles using message_offset\n\n**Reference**: UE Spec v1.0.1, Table 3-9, Section 3.4.2.1, Page 159\n\n---\n\n#### 3.5.3 Response (Table 3-11, 16 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/response.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes) | [Response with Data (3.5.4)](#354-response-with-data-table-3-12-24-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     | list|opcode |v| return_code |    message_id     | ri_gen  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |       modified_length [31:0]         |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |list |  opcode |v| return_code   |\n       | (2) | (6 bits)|r|   (6 bits)    |\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| list | 2 | 0[7:6] | List indicator | 0=expected, 1=unexpected |\n| opcode | 6 | 0[5:0] | Response opcode | Per Table 3-18 |\n| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n| return_code | 6 | 1[5:0] | Return code | Per Table 3-19 |\n| message_id | 16 | 2-3 | Message identifier | From original request |\n| ri_generation | 8 | 4 | Resource Index generation | New generation on mismatch |\n| job_id | 24 | 5-7 | Job Identifier | From original request |\n| modified_length | 32 | 8-11 | Modified length | Bytes actually transferred |\n| rsvd | 32 | 12-15 | Reserved | Must be 0 |\n\n##### Return Codes (Table 3-19)\n\n| Code | Name | Description |\n|------|------|-------------|\n| 0x00 | RC_OK | Success |\n| 0x01 | RC_NO_MATCH | No matching buffer found |\n| 0x02 | RC_BUFFER_TOO_SMALL | Target buffer too small |\n| 0x03 | RC_AUTHORIZATION_FAILURE | Memory key mismatch |\n| 0x04 | RC_INVALID_OPERATION | Invalid operation |\n| 0x05 | RC_RESOURCE_EXHAUSTION | Resource exhaustion |\n| 0x06 | RC_GENERATION_MISMATCH | RI generation mismatch |\n| 0x07 | RC_TRUNCATED | Message truncated |\n\n##### Protocol Behavior\n\n**Response Generation**:\n1. Target processes request\n2. Generates response with appropriate return_code\n3. `modified_length` indicates actual bytes transferred (may be < request_length)\n\n**List Indicator**:\n- `list=0`: Payload delivered to expected list (matched posted receive)\n- `list=1`: Payload delivered to unexpected list (no matching receive)\n\n**Reference**: UE Spec v1.0.1, Table 3-11, Section 3.4.2.5, Page 167\n\n---\n\n#### 3.5.4 Response with Data (Table 3-12, 24 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/response_with_data.ksy`  \n**Related Formats**: [Response (3.5.3)](#353-response-table-3-11-16-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     | list|opcode |v| return_code | response_msg_id   | rsvd    →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |read_req_msg_id|rs|payload_len      →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |       modified_length [31:0]  |       message_offset [31:0]  |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| list | 2 | 0[7:6] | List indicator | 0=expected, 1=unexpected |\n| opcode | 6 | 0[5:0] | Response opcode | Per Table 3-18 |\n| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n| return_code | 6 | 1[5:0] | Return code | Per Table 3-19 |\n| response_message_id | 16 | 2-3 | Response message ID | For this response |\n| rsvd | 8 | 4 | Reserved | Must be 0 |\n| job_id | 24 | 5-7 | Job Identifier | From original request |\n| read_request_message_id | 16 | 8-9 | Original request msg ID | Links to request |\n| rsvd | 2 | 10[7:6] | Reserved | Must be 0 |\n| payload_length | 14 | 10[5:0]+11 | Payload in this packet | Max 16383 bytes |\n| modified_length | 32 | 12-15 | Total bytes transferred | Across all packets |\n| message_offset | 32 | 16-19 | Offset in response | For multi-packet responses |\n| rsvd | 32 | 20-23 | Reserved | Must be 0 |\n\n##### Protocol Behavior\n\n**Use Cases**:\n- RDMA Read responses (returning requested data)\n- Fetching atomic responses (returning original value)\n\n**Multi-Packet Responses**:\n- `message_offset` indicates position within overall response\n- `payload_length` indicates data in this specific packet\n- `modified_length` is total across all response packets\n\n**Reference**: UE Spec v1.0.1, Table 3-12, Section 3.4.2.5, Page 168\n\n---\n\n#### 3.5.5 Small Message (Figure 3-14, 32 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/small_message.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes) | [Response (3.5.3)](#353-response-table-3-11-16-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |opcode |v|dc|ie|rl|hd|eo|so|rs| request_length  | ri_gen  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |rsvd|pid_on_fep |rsvd| resource_idx  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |        initiator [31:0]       |        match_bits [63:0]     →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        24      25      26      27      28      29      30      31\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |  (match_bits cont'd)          |       header_data [63:0]     |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| opcode | 6 | 0[7:2] | Operation code | Per Table 3-17 |\n| version | 2 | 0[1:0] | Protocol version | 0 for v1.0.1 |\n| dc | 1 | 1[7] | Delivery Complete | Defer response |\n| ie | 1 | 1[6] | Initiator Error | Error at initiator |\n| rel | 1 | 1[5] | Relative addressing | 0=absolute, 1=relative |\n| hd | 1 | 1[4] | Header Data present | 1=header_data valid |\n| eom | 1 | 1[3] | End of Message | Must be 1 (single packet) |\n| som | 1 | 1[2] | Start of Message | Must be 1 (single packet) |\n| rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n| rsvd | 2 | 2[7:6] | Reserved | Must be 0 |\n| request_length | 14 | 2[5:0]+3 | Request length | Max 16383 bytes |\n| ri_generation | 8 | 4 | Resource Index generation | For buffer recovery |\n| job_id | 24 | 5-7 | Job Identifier | Target job |\n| rsvd | 4 | 8[7:4] | Reserved | Must be 0 |\n| pid_on_fep | 12 | 8[3:0]+9 | Process ID on FEP | Target process |\n| rsvd | 4 | 10[7:4] | Reserved | Must be 0 |\n| resource_index | 12 | 10[3:0]+11 | Resource Index | Target resource |\n| initiator | 32 | 12-15 | Initiator ID | For tagged matching |\n| match_bits | 64 | 16-23 | Match bits | For tagged matching |\n| header_data | 64 | 24-31 | Header data | Completion data |\n\n##### Protocol Behavior\n\n**Optimized Format**:\n- 32 bytes vs 44 bytes for standard request\n- Single-packet only (`som=1, eom=1` required)\n- No buffer_offset (not needed for single packet)\n- 14-bit request_length (max 16383 bytes)\n\n**Use Cases**:\n- Small tagged sends\n- Single-packet messages with matching criteria\n- Latency-sensitive operations\n\n**Reference**: UE Spec v1.0.1, Figure 3-14, Section 3.4.2.3, Page 164\n\n---\n\n#### 3.5.6 Rendezvous Extension (Figure 3-15, 32 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/rendezvous_extension.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |       eager_length [31:0]     |        memory_key [63:0]     →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |  (memory_key cont'd)          |       buffer_offset [63:0]   →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |  (buffer_offset cont'd)       |     remaining_length [31:0]  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        24      25      26      27      28      29      30      31\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → | (remaining)   |              reserved [63:0]                  |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| eager_length | 32 | 0-3 | Eager data length | Bytes pushed with request |\n| memory_key | 64 | 4-11 | Initiator memory key | For target to pull data |\n| buffer_offset | 64 | 12-19 | Initiator buffer offset | Start of remaining data |\n| remaining_length | 32 | 20-23 | Remaining data length | Bytes to pull |\n| rsvd | 64 | 24-31 | Reserved | Must be 0 |\n\n##### Protocol Behavior\n\n**Rendezvous Protocol**:\n1. Initiator sends request with eager data + rendezvous extension\n2. Target receives eager data, allocates buffer\n3. Target issues RDMA Read to pull remaining data using {memory_key, buffer_offset}\n4. Target completes operation when all data received\n\n**Two-Sided Protocol**:\n- Enables large message transfer without pre-registered buffers\n- Target controls when/how to pull remaining data\n- Reduces memory registration overhead\n\n**Constraints**:\n- MUST NOT be combined with atomic extension\n- Placed on every packet using rendezvous opcode\n\n**Reference**: UE Spec v1.0.1, Figure 3-15, Section 3.4.2.3, Page 165\n\n---\n\n#### 3.5.7 Atomic Extension (Figure 3-16, 8 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/atomic_extension.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.5.1)](#351-standard-request-som1-table-3-8-44-bytes) | [Response with Data (3.5.4)](#354-response-with-data-table-3-12-24-bytes)\n\n##### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |atomic_opcode  |atomic_datatype| semantic_control  | reserved  |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n##### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| atomic_opcode | 8 | 0 | Atomic operation | Per Table 3-21 |\n| atomic_datatype | 8 | 1 | Data type | Per Table 3-22 |\n| semantic_control | 16 | 2-3 | Semantic control | Per Table 3-23 |\n| rsvd | 32 | 4-7 | Reserved | Must be 0 |\n\n##### Atomic Opcodes (Table 3-21)\n\n| Code | Name | Operation |\n|------|------|-----------|\n| 0x00 | MIN | Target = MIN(Target, Initiator) |\n| 0x01 | MAX | Target = MAX(Target, Initiator) |\n| 0x02 | SUM | Target = Target + Initiator |\n| 0x03 | DIFF | Target = Target - Initiator |\n| 0x04 | PROD | Target = Target * Initiator |\n| 0x05 | LOR | Target = Target \\|\\| Initiator |\n| 0x06 | LAND | Target = Target && Initiator |\n| 0x07 | BOR | Target = Target \\| Initiator |\n| 0x08 | BAND | Target = Target & Initiator |\n| 0x09 | LXOR | Logical XOR |\n| 0x0A | BXOR | Target = Target ^ Initiator |\n| 0x0B | READ | Initiator = Target |\n| 0x0C | WRITE | Target = Initiator |\n| 0x0D | CSWAP | Compare and swap if equal |\n| 0x0E | CSWAP_NE | Compare and swap if not equal |\n| 0x0F | CSWAP_LE | Compare and swap if ≤ |\n| 0x10 | CSWAP_LT | Compare and swap if < |\n| 0x11 | CSWAP_GE | Compare and swap if ≥ |\n| 0x12 | CSWAP_GT | Compare and swap if > |\n| 0x13 | MSWAP | Masked swap |\n| 0x14 | INVAL | Invalidate cache |\n\n##### Atomic Datatypes (Table 3-22)\n\n| Code | Name | Size |\n|------|------|------|\n| 0x00 | INT8 | 1 byte |\n| 0x01 | UINT8 | 1 byte |\n| 0x02 | INT16 | 2 bytes |\n| 0x03 | UINT16 | 2 bytes |\n| 0x04 | INT32 | 4 bytes |\n| 0x05 | UINT32 | 4 bytes |\n| 0x06 | INT64 | 8 bytes |\n| 0x07 | UINT64 | 8 bytes |\n| 0x08 | FLOAT | 4 bytes |\n| 0x09 | DOUBLE | 8 bytes |\n| 0x0A | FLOAT_COMPLEX | 8 bytes |\n| 0x0B | DOUBLE_COMPLEX | 16 bytes |\n| 0x0E | FLOAT16 | 2 bytes |\n| 0x0F | BFLOAT16 | 2 bytes |\n\n##### Protocol Behavior\n\n**Atomic Operations**:\n- Always 8 bytes and must be naturally aligned\n- Payload must be integral multiple of datatype size\n- Fetching atomics return original value in Response with Data\n\n**Constraints**:\n- MUST NOT be combined with rendezvous extension\n- Fetching atomics MUST NOT operate on more than one element\n\n**Reference**: UE Spec v1.0.1, Figure 3-16, Section 3.4.2.4, Page 165\n\n### 3.6 CMS (Congestion Management Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/cms/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Credit CP Payload | `credit_cp_payload.ksy` | Credit control packet |\n| Credit Request | `credit_request_cp_payload.ksy` | Credit request |\n| Request CC State | `req_cc_state.ksy` | Request CC state |\n| ACK CC State (NSCC) | `ack_cc_state_nscc.ksy` | NSCC algorithm state |\n| ACK CC State (RCCC/TFC) | `ack_cc_state_rccc_tfc.ksy` | RCCC/TFC state |\n\n### 3.7 TSS (Transport Security Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/tss/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Security Header | `security_header.ksy` | Encryption header |\n| IV Construction | `iv_construction.ksy` | Initialization vector |\n| Key Rotation | `protocols/key_rotation.ksy` | Key rotation protocol |\n| KDF Direct | `protocols/kdf_direct.ksy` | Direct key derivation |\n| KDF Client/Server | `protocols/kdf_client_server.ksy` | Client/server KDF |\n| KDF Cluster | `protocols/kdf_cluster.ksy` | Cluster KDF |\n| Join Secure Domain | `protocols/join_secure_domain.ksy` | Domain join |\n| TSS TX Processing | `protocols/tss_tx_processing.ksy` | Transmit processing |\n| TSS RX Processing | `protocols/tss_rx_processing.ksy` | Receive processing |\n\n### 3.8 Link Layer Formats\n\n#### LLR (Link-Level Retry)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/llr/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| LLR Preamble (64b66b) | `llr_preamble_64b66b.ksy` | 64b66b preamble |\n| LLR Preamble (MII) | `llr_preamble_mii.ksy` | MII preamble |\n| LLR Init CTLOS | `llr_init_ctlos.ksy` | Initialize LLR |\n| LLR Init Echo CTLOS | `llr_init_echo_ctlos.ksy` | Init acknowledgment |\n| LLR ACK CTLOS | `llr_ack_ctlos.ksy` | Frame acknowledgment |\n| LLR NACK CTLOS | `llr_nack_ctlos.ksy` | Retransmit request |\n\n#### CBFC (Credit-Based Flow Control)\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/cbfc/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| CF Update | `cf_update.ksy` | Credit flow update |\n| CC Update | `cc_update.ksy` | Credit count update |\n| VC State Machine | `protocols/vc_state_machine.ksy` | Virtual channel FSM |\n| Lossless VC Init | `protocols/lossless_vc_init.ksy` | VC initialization |\n| Lossless VC Removal | `protocols/lossless_vc_removal.ksy` | VC teardown |\n\n#### LLDP Extensions\n\n**Datamodel Directory**: `datamodel/protocols/ue/link/lldp/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| UE Link Negotiation TLV | `ue_link_negotiation_tlv.ksy` | Link negotiation |\n| UE CBFC TLV | `ue_cbfc_tlv.ksy` | CBFC parameters |\n\n---\n\n## 4. RoCEv2 Formats\n\n**Datamodel Directory**: `datamodel/protocols/roce/transport/`\n\n### 4.1 RoCEv2 Packet Structure\n\n```\n+-----------------------------------------------------------------------------+\n| Ethernet II Header (14 bytes)                                               |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2) = 0x0800/0x86DD            |\n+-----------------------------------------------------------------------------+\n| IP Header (20 bytes IPv4 / 40 bytes IPv6)                                   |\n|   Version, IHL, DSCP, ECN, Length, ID, Flags, TTL, Protocol=17, Checksum   |\n|   Source IP, Dest IP                                                        |\n+-----------------------------------------------------------------------------+\n| UDP Header (8 bytes)                                                        |\n|   Source Port (entropy) | Dest Port = 4791 | Length | Checksum             |\n+-----------------------------------------------------------------------------+\n| BTH - Base Transport Header (12 bytes)                                      |\n|   Opcode | Flags | P-Key | Dest QP | A | PSN                               |\n+-----------------------------------------------------------------------------+\n| Extended Headers (optional, operation-dependent)                            |\n|   RETH (16) | AETH (4) | AtomicETH (28) | ImmDt (4)                        |\n+-----------------------------------------------------------------------------+\n| Payload (0 - MTU bytes)                                                     |\n+-----------------------------------------------------------------------------+\n| ICRC (4 bytes)                                                              |\n+-----------------------------------------------------------------------------+\n```\n\n### 4.2 BTH (Base Transport Header) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/roce/transport/bth.ksy`\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| Opcode | 8 | Operation type (transport + operation) |\n| SE | 1 | Solicited Event |\n| M | 1 | Migration state |\n| Pad | 2 | Padding bytes (0-3) |\n| TVer | 4 | Transport version (must be 0) |\n| P-Key | 16 | Partition key |\n| Dest QP | 24 | Destination Queue Pair |\n| A | 1 | ACK request |\n| PSN | 24 | Packet Sequence Number |\n\n**Transport Types** (Opcode bits [7:5]):\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x00 | RC | Reliable Connection |\n| 0x20 | UC | Unreliable Connection |\n| 0x40 | RD | Reliable Datagram |\n| 0x60 | UD | Unreliable Datagram |\n\n**Operations** (Opcode bits [4:0]):\n| Value | Operation | Description |\n|-------|-----------|-------------|\n| 0x00 | SEND_FIRST | First send packet |\n| 0x01 | SEND_MIDDLE | Middle send packet |\n| 0x02 | SEND_LAST | Last send packet |\n| 0x03 | SEND_LAST_IMM | Last send with immediate |\n| 0x04 | SEND_ONLY | Single-packet send |\n| 0x05 | SEND_ONLY_IMM | Single send with immediate |\n| 0x06 | RDMA_WRITE_FIRST | First RDMA write |\n| 0x07 | RDMA_WRITE_MIDDLE | Middle RDMA write |\n| 0x08 | RDMA_WRITE_LAST | Last RDMA write |\n| 0x09 | RDMA_WRITE_LAST_IMM | Last write with immediate |\n| 0x0A | RDMA_WRITE_ONLY | Single-packet write |\n| 0x0B | RDMA_WRITE_ONLY_IMM | Single write with immediate |\n| 0x0C | RDMA_READ_REQUEST | Read request |\n| 0x0D | RDMA_READ_RESPONSE_FIRST | First read response |\n| 0x0E | RDMA_READ_RESPONSE_MIDDLE | Middle read response |\n| 0x0F | RDMA_READ_RESPONSE_LAST | Last read response |\n| 0x10 | RDMA_READ_RESPONSE_ONLY | Single read response |\n| 0x11 | ACK | Acknowledgment |\n| 0x12 | ATOMIC_ACK | Atomic acknowledgment |\n| 0x13 | CMP_SWAP | Compare and swap |\n| 0x14 | FETCH_ADD | Fetch and add |\n\n### 4.3 Extended Transport Headers\n\n| Header | File | Size | Description |\n|--------|------|------|-------------|\n| RETH | `reth.ksy` | 16 bytes | RDMA Extended Transport Header |\n| AETH | `aeth.ksy` | 4 bytes | ACK Extended Transport Header |\n| AtomicETH | `atomiceth.ksy` | 28 bytes | Atomic Extended Transport Header |\n| AtomicAckETH | `atomicacketh.ksy` | 8 bytes | Atomic ACK ETH |\n| DETH | `deth.ksy` | 8 bytes | Datagram Extended Transport Header |\n| ImmDt | `immdt.ksy` | 4 bytes | Immediate Data |\n| ICRC | `icrc.ksy` | 4 bytes | Invariant CRC |\n\n---\n\n## 5. Standard Ethernet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ethernet/`\n\n### 5.1 Ethernet II Frame\n\n**Datamodel**: `datamodel/protocols/ethernet/link/ethernet_ii.ksy`\n\n```\n+-----------------------------------------------------------------------------+\n| Preamble (7 bytes) + SFD (1 byte)  [not visible to software]               |\n+-----------------------------------------------------------------------------+\n| Ethernet Header (14 bytes)                                                  |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2)                            |\n+-----------------------------------------------------------------------------+\n| Optional VLAN Tag (4 bytes) - 802.1Q                                        |\n|   TPID (2) = 0x8100 | TCI (2) = PCP + DEI + VID                            |\n+-----------------------------------------------------------------------------+\n| Payload (46-1500 bytes, or up to 9000 for jumbo)                           |\n+-----------------------------------------------------------------------------+\n| FCS (4 bytes)                                                               |\n+-----------------------------------------------------------------------------+\n```\n\n### 5.2 Link Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| Ethernet II | `link/ethernet_ii.ksy` | Standard Ethernet frame |\n| VLAN 802.1Q | `link/vlan_802_1q.ksy` | VLAN tagging |\n\n### 5.3 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| IPv4 | `network/ipv4.ksy` | IPv4 header |\n| IPv6 | `network/ipv6.ksy` | IPv6 header |\n\n### 5.4 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| TCP | `transport/tcp.ksy` | TCP header |\n| UDP | `transport/udp.ksy` | UDP header |\n\n---\n\n## 6. Cornelis Proprietary Formats\n\n**Datamodel Directory**: `datamodel/protocols/cornelis/`\n\n### 6.1 Link Layer\n\n| Format | File | Size | Description |\n|--------|------|------|-------------|\n| UE+ Header | `link/ue_plus.ksy` | 12 bytes | Optimized L2 header |\n| Cornelis L2 Prefix | `link/cornelis_l2_prefix.ksy` | Variable | L2 prefix |\n\n### 6.2 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| UFH-16 | `network/ufh_16.ksy` | 16-bit forwarding header |\n| UFH-32 | `network/ufh_32.ksy` | 32-bit forwarding header |\n| Collective L2 | `network/collective_l2.ksy` | Collective operations header |\n| Scale-Up L2 | `network/scaleup_l2.ksy` | Scale-up deployments |\n\n#### 6.2.1 UFH-16 (Unified Forwarding Header 16-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_16.ksy`\n\nUFH-16 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 16-bit addressing.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |    Opaque (24-bit)    | Destination   |Opaque |Traffic|   Opaque      |    Source     |\n|[7:4]  |                       | (16-bit BE)   |[7:4]  |Class  |   (16-bit)    |  (16-bit BE)  |\n|SLAP   |                       |               |Z|Y|X|M|[7:0]  |               |               |\n|[3:0]  |                       |               |[3:0]  |       |               |               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1-3 | 24 | Opaque to hardware |\n| Destination | 4-5 | 16 | Destination endpoint address (big-endian) |\n| Opaque | 6 | [7:4] | Opaque to hardware |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Opaque | 8-9 | 16 | Opaque to hardware |\n| Source | 10-11 | 16 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-16 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5-14 | Reserved | Reserved for future use |\n| 15 | Extended | UFH-32 extension follows |\n\n**Usage**: Scale-up fabric forwarding, intra-pod communication, medium cluster networking (up to 65536 endpoints).\n\n#### 6.2.2 UFH-32 (Unified Forwarding Header 32-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_32.ksy`\n\nUFH-32 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 32-bit addressing for large-scale deployments.\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |       |   Destination (32-bit BE)     |HopLim |Traffic|       Source (32-bit BE)      |\n|[7:4]  |Opaque |                               |[7:4]  |Class  |                               |\n|SLAP   |       |                               |Z|Y|X|M|[7:0]  |                               |\n|[3:0]  |       |                               |[3:0]  |       |                               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1 | [7:0] | Opaque to hardware |\n| Destination | 2-5 | 32 | Destination endpoint address (big-endian) |\n| Hop Limit | 6 | [7:4] | TTL/hop count |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Source | 8-11 | 32 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n**UFH-32 Type Values**:\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5 | Multicast | Multicast packet |\n| 6 | Barrier | Barrier synchronization |\n| 7 | Reduction | Reduction operation |\n| 8-14 | Reserved | Reserved for future use |\n| 15 | Vendor | Vendor-specific packet |\n\n**Usage**: Large-scale scale-up fabric forwarding (4+ billion endpoints), multi-pod communication, extended collective operations.\n\n### 6.3 Transport Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| CSIG+ | `transport/csig_plus.ksy` | Telemetry header |\n| PKEY | `transport/pkey.ksy` | Partition key |\n\n### 6.4 Encapsulation\n\n| Format | File | Description |\n|--------|------|-------------|\n| VxLAN+ | `encapsulation/vxlan_plus.ksy` | Extended VxLAN overlay |\n\n---\n\n## 7. Host-Software Interface (HSI) Formats\n\n**Datamodel Directory**: `datamodel/hw/asics/pmr/interfaces/host_interface/`\n\n### 7.1 Command Queue Segment (64 bytes)\n\n**Datamodel**: `command_queue_segment.ksy`\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Bytes 2-3     | Bytes 4-7     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Opcode        | Flags         | Payload Len   | Reserved      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 8-15                    | Bytes 16-23                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Tag (64 bits)                 | Dest (64 bits)                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Bytes 24-31                   | Bytes 32-63                   |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Metadata (64 bits)            | Inline Data or SGL Entry      |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n**Opcode Encoding**:\n| Bits | Field | Values |\n|------|-------|--------|\n| [7:4] | Family | MSG=0x1, TAGGED=0x2, RMA=0x3, ATOMIC=0x4 |\n| [3:2] | Variant | SEND=0, RECV=1, INJECT=2 |\n| [1] | Reserved | Must be 0 |\n| [0] | Data Source | INLINE=0, SGL=1 |\n\n### 7.2 Notification Formats\n\n| Format | File | Type | Size | Description |\n|--------|------|------|------|-------------|\n| Receive Notification | `receive_notification.ksy` | 0x00 | 64 bytes | Received message |\n| Send Completion | `send_completion.ksy` | 0x01 | 64 bytes | Send completed |\n| Event Notification | `event_notification.ksy` | 0x02 | 64 bytes | Async event |\n| Notification Entry | `notification_entry.ksy` | - | 64 bytes | Generic entry |\n| QW Violation Event | `qw_violation_event.ksy` | - | 64 bytes | QW alignment error |\n\n### 7.3 Receive Notification (64 bytes)\n\n**Datamodel**: `receive_notification.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x00 for receive |\n| flags | 1 | 1 | FI_INLINE, continuation |\n| status | 2 | 2 | Completion status |\n| src_id | 4 | 4 | Source endpoint ID |\n| tag | 8 | 8 | Tag value |\n| total_length | 16 | 4 | Payload length |\n| buffer_id_0 | 20 | 2 | First buffer ID |\n| buffer_id_1 | 22 | 2 | Second buffer ID |\n| buffer_offset | 24 | 2 | Offset in buffer |\n| reserved | 26 | 2 | Reserved |\n| inline_data | 28 | 35 | Inline payload |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.4 Send Completion (64 bytes)\n\n**Datamodel**: `send_completion.ksy`\n\n| Field | Offset | Size | Description |\n|-------|--------|------|-------------|\n| type | 0 | 1 | 0x01 for send |\n| flags | 1 | 1 | Completion flags |\n| status | 2 | 2 | Completion status |\n| reserved_0 | 4 | 4 | Reserved |\n| op_context | 8 | 8 | Operation context |\n| bytes_sent | 16 | 4 | Bytes transferred |\n| reserved_1 | 20 | 43 | Reserved |\n| marker | 63 | 1 | Prime marker (1-13) |\n\n### 7.5 Other HSI Formats\n\n| Format | File | Description |\n|--------|------|-------------|\n| SGL Entry | `sgl_entry.ksy` | Scatter-gather list entry |\n| PCIe Descriptors | `pcie/descriptors.ksy` | PCIe interface descriptors |\n\n---\n\n## 8. IP Block Descriptors\n\n**Datamodel Directory**: `datamodel/hw/ip/cornelis/`\n\n### 8.1 Collectives Engine (CE)\n\n**Datamodel**: `ce/descriptors.ksy`\n\nThe Collectives Engine uses RISC-V vector cores (VLEN=512) for hardware-accelerated collective operations.\n\n### 8.2 Electric Creek (EC)\n\n**Datamodel**: `ec/descriptors.ksy`\n\nElectric Creek is the management complex shared between PMR NIC and LNR Switch.\n\n---\n\n## 9. Work List\n\nThis section tracks issues requiring follow-up investigation or specification updates.\n\n### 9.1 Open Issues\n\n| ID | Priority | Category | Description | Status | Opened | Closed |\n|----|----------|----------|-------------|--------|--------|--------|\n| W-06-001 | Medium | Datamodel | UFH-32 lacks 16-bit entropy field; per-packet ECMP not supported; switch must derive entropy from Src+Dest hash | Deferred | 2026-01-20 | - |\n| W-07-001 | Low | Datamodel | `ack_cc.ksy` shows `ack_cc_state` as 32-bit (4 bytes) but UE Spec Table 3-36 shows 64-bit (8 bytes); verify field size | Investigation | 2026-01-22 | - |\n| W-07-002 | Low | Documentation | `collective_l2.ksy` and `scaleup_l2.ksy` marked as \"work_in_progress\" with spec_version 0.1; specifications incomplete | Spec Update | 2026-01-22 | - |\n| W-07-003 | Low | Datamodel | `ue_plus.ksy` 9-bit length field split across bytes 0-1 with unusual encoding (1 bit in byte 0, 8 bits in byte 1); verify encoding matches UE Spec | Investigation | 2026-01-22 | - |\n| W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |\n| W-05-002 | Medium | Specification | MTU values: Verify maximum MTU for each protocol | Investigation | 2026-01-10 | - |\n| W-05-003 | Medium | Documentation | CMS detailed formats: Need comprehensive documentation | Spec Update | 2026-01-10 | - |\n| W-03-002 | Low | Terminology | PDP vs PDS naming: UML uses both terms inconsistently | Spec Update | 2026-01-08 | - |\n| W-03-006 | Low | Terminology | SES vs SE: \"SES Processing Groups\" vs \"Semantic Engines\" | Spec Update | 2026-01-08 | - |\n\n### 9.2 Datamodel Gaps\n\n| ID | Priority | Description | Target Location | Status | Opened | Closed |\n|----|----------|-------------|-----------------|--------|--------|--------|\n| D-001 | High | PMR CSR definitions missing from datamodel | `datamodel/hw/asics/pmr/csrs/*.rdl` | Spec Update | 2026-01-10 | - |\n| D-002 | Medium | PMR block hierarchy YAML incomplete | `datamodel/hw/asics/pmr/blocks.yaml` | Spec Update | 2026-01-10 | - |\n| D-003 | Medium | PMR interface contracts missing | `datamodel/views/contracts/pmr-*.puml` | Spec Update | 2026-01-10 | - |\n\n### 9.3 Specification Clarifications Needed\n\n| ID | Priority | Question | Context | Status | Opened | Closed |\n|----|----------|----------|---------|--------|--------|--------|\n| Q1 | Medium | Lightweight Interface Scope | What features should be reduced in lightweight mode? | Investigation | 2026-01-10 | - |\n| Q2 | Medium | Tag Table Sizing | Should HW tag table size be per-endpoint configurable? | Investigation | 2026-01-10 | - |\n| Q3 | Medium | Multi-Packet Eager Messages | Should hardware support multi-packet eager messages? | Investigation | 2026-01-10 | - |\n| Q4 | Low | RoCE Work Queue Implementation | Confirm RoCE WQ/CQ are software-implemented | Investigation | 2026-01-10 | - |\n\n### 9.4 Closed Issues\n\n| ID | Priority | Category | Description | Resolution | Opened | Closed |\n|----|----------|----------|-------------|------------|--------|--------|\n| W-05-001 | Medium | Documentation | UE taxonomy reference | Documented in `05-packet-formats.md` | 2026-01-08 | 2026-01-10 |\n| W-02-005 | Medium | Documentation | Protocol support documentation | Documented UE+, RoCEv2, Ethernet | 2026-01-08 | 2026-01-10 |\n| W-02-006 | Medium | Documentation | Cornelis Collective Reduction Protocol | Documented in HAS §2.5.4 | 2026-01-08 | 2026-01-10 |\n| W-03-001 | Medium | Architecture | Semantic Engine count | Confirmed 64 (8x8) in UML and HAS | 2026-01-08 | 2026-01-10 |\n| W-17-005 | Low | Documentation | Port subdivision note | Added to HAS Ch17 | 2026-01-11 | 2026-01-11 |\n| W-17-006 | Medium | Documentation | MPORT interface documentation | Documented 256B @ 1.66 GHz | 2026-01-11 | 2026-01-11 |\n| W-04-005 | High | Datamodel | `ufh_16.ksy` address size: Datamodel shows 12-bit dest, should be 16-bit | UFH-16 restructured to 12-byte Ethernet MAC overlay with 16-bit destination (bytes 4-5) and 16-bit source (bytes 10-11) | 2026-01-10 | 2026-01-20 |\n| W-04-006 | High | Datamodel | `ufh_32.ksy` address size: Datamodel shows 16-bit dest, should be 32-bit | UFH-32 restructured to 12-byte Ethernet MAC overlay with 32-bit destination (bytes 2-5) and 32-bit source (bytes 8-11) | 2026-01-10 | 2026-01-20 |\n\n### 9.5 Change Log\n\n| Date | Change | Details |\n|------|--------|---------|\n| 2026-01-14 | Initial creation | Document created with PMR packet taxonomy |\n| 2026-01-20 | Review and update | Added UALink section (reference only, not PMR-supported); Added change log; Updated datamodel file counts; No new .ksy files since initial creation |\n| 2026-01-20 | UFH format details | Added detailed UFH-16 and UFH-32 format documentation in Section 6.2 (wire diagrams, field tables, type enumerations) |\n| 2026-01-20 | UFH restructuring | UFH-16 and UFH-32 restructured to 12-byte Ethernet MAC overlays; UFH-16 now 16-bit addressing, UFH-32 now 32-bit addressing; Added SLAP field constraints (Z,Y,X=001); Updated datamodel .ksy files; Closed W-04-005 and W-04-006 |\n| 2026-01-22 | Datamodel review | Added W-07-001 (ack_cc_state size mismatch), W-07-002 (collective/scaleup specs incomplete), W-07-003 (ue_plus length encoding); Identified 30+ packet formats requiring expansion |\n| 2026-01-22 | Phase 1 expansion | Expanded PDS formats (3.3.1-3.3.11): RUD, ROD, RUDI, UUD, ACK, ACK_CC, ACK_CCX, NACK, NACK_CCX, Control Packet with wire diagrams, field tables, protocol behavior, and cross-references. Expanded SES formats (3.5.1-3.5.7): Standard Request SOM=1/SOM=0, Response, Response with Data, Small Message, Rendezvous Extension, Atomic Extension. Added request/response relationship diagrams. Total ~1200 lines added. |\n\n---\n\n## 10. UALink Protocol (Reference Only)\n\n**Note**: UALink is defined in the datamodel but is **NOT currently supported by PMR**. It is included here for reference as it may be relevant for future AI/ML accelerator interconnect work.\n\n**Datamodel Directory**: `datamodel/protocols/ualink/`\n\n### 10.1 UALink Overview\n\nUALink is an AI/ML accelerator interconnect protocol with 38 packet definitions across all OSI layers.\n\n| Layer | Count | Key Formats |\n|-------|-------|-------------|\n| UPLI (Upper Protocol Layer Interface) | 8 | commands.ksy, request_channel.ksy, status_codes.ksy |\n| Transaction | 9 | tl_flit.ksy, control_half_flit.ksy, data_half_flit.ksy |\n| Data Link | 12 | dl_flit.ksy, segment_header.ksy, crc.ksy, control_messages.ksy |\n| Physical | 4 | alignment_markers.ksy, control_ordered_sets.ksy, link_training.ksy |\n| Security | 5 | authentication.ksy, encryption.ksy, key_derivation.ksy |\n\n### 10.2 UALink Packet Formats\n\n#### UPLI Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Commands | `upli/commands.ksy` | UPLI command definitions |\n| Request Channel | `upli/request_channel.ksy` | Request channel format |\n| Originator Data | `upli/originator_data_channel.ksy` | Originator data channel |\n| Read Response | `upli/read_response_channel.ksy` | Read response channel |\n| Write Response | `upli/write_response_channel.ksy` | Write response channel |\n| Status Codes | `upli/status_codes.ksy` | Status code definitions |\n| Connection Handshake | `upli/protocols/connection_handshake.ksy` | Connection setup |\n| Flow Control | `upli/protocols/flow_control.ksy` | Flow control protocol |\n\n#### Transaction Layer\n| Format | File | Description |\n|--------|------|-------------|\n| TL Flit | `transaction/tl_flit.ksy` | Transaction layer flit |\n| Control Half Flit | `transaction/control_half_flit.ksy` | Control half flit |\n| Data Half Flit | `transaction/data_half_flit.ksy` | Data half flit |\n| Message Half Flit | `transaction/message_half_flit.ksy` | Message half flit |\n| Request Field | `transaction/request_field.ksy` | Request field format |\n| Response Field | `transaction/response_field.ksy` | Response field format |\n| Flow Control Field | `transaction/flow_control_field.ksy` | Flow control field |\n| Compression | `transaction/protocols/compression.ksy` | Data compression |\n| Address Cache | `transaction/protocols/address_cache.ksy` | Address caching |\n\n#### Data Link Layer\n| Format | File | Description |\n|--------|------|-------------|\n| DL Flit | `datalink/dl_flit.ksy` | Data link flit |\n| Flit Header | `datalink/flit_header.ksy` | Flit header format |\n| Segment Header | `datalink/segment_header.ksy` | Segment header |\n| CRC | `datalink/crc.ksy` | CRC calculation |\n| Control Messages | `datalink/messages/control_messages.ksy` | Control messages |\n| Basic Messages | `datalink/messages/basic_messages.ksy` | Basic messages |\n| UART Messages | `datalink/messages/uart_messages.ksy` | UART messages |\n| Vendor Defined | `datalink/messages/vendor_defined.ksy` | Vendor extensions |\n| Link Resiliency | `datalink/protocols/link_resiliency.ksy` | Link resiliency |\n| Link Level Replay | `datalink/protocols/link_level_replay.ksy` | Replay protocol |\n| Link State | `datalink/protocols/link_state.ksy` | Link state machine |\n| Link Folding | `datalink/protocols/link_folding.ksy` | Link folding |\n\n#### Physical Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Alignment Markers | `physical/alignment_markers.ksy` | Lane alignment |\n| Control Ordered Sets | `physical/control_ordered_sets.ksy` | Control sequences |\n| Reconciliation Sublayer | `physical/reconciliation_sublayer.ksy` | RS sublayer |\n| Link Training | `physical/protocols/link_training.ksy` | Link training |\n\n#### Security Layer\n| Format | File | Description |\n|--------|------|-------------|\n| Authentication | `security/authentication.ksy` | Authentication |\n| Encryption | `security/encryption.ksy` | Encryption format |\n| IV Format | `security/iv_format.ksy` | Initialization vector |\n| Key Derivation | `security/protocols/key_derivation.ksy` | Key derivation |\n| Key Rotation | `security/protocols/key_rotation.ksy` | Key rotation |\n\n---\n\n## 11. References\n\n### Internal Documents\n- `docs/HAS/PMR/05-packet-formats.md` - PMR HAS Chapter 5\n- `docs/HAS/PMR/WORK.md` - PMR HAS Work Tracking\n- `.specify/memory/constitution.md` - Project Constitution\n\n### Datamodel Locations\n- `datamodel/protocols/ue/` - Ultra Ethernet protocols (94 .ksy files)\n- `datamodel/protocols/roce/` - RoCEv2 protocols (8 .ksy files)\n- `datamodel/protocols/ethernet/` - Standard Ethernet (6 .ksy files)\n- `datamodel/protocols/cornelis/` - Cornelis proprietary (9 .ksy files)\n- `datamodel/protocols/ualink/` - UALink protocols (38 .ksy files) - NOT supported by PMR\n- `datamodel/hw/asics/pmr/` - PMR ASIC definitions\n\n### External Specifications\n- [Ultra Ethernet Specification v1.0.1](https://ultraethernet.org/)\n- [InfiniBand Architecture Specification](https://www.infinibandta.org/)\n- IEEE 802.3 Ethernet Standard\n- UALink Specification (Ultra Accelerator Link)\n",
                "additions": 1,
                "deletions": 0
              },
              "truncated": false
            },
            "time": {
              "start": 1769123908141,
              "end": 1769123908241
            }
          }
        },
        {
          "id": "prt_be8008a95001hj07GFEg15VaQa",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be800508b001BLBtapAvCJwdMV",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 106757,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be8008b01001RGc5CLE7Vmp0ts",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769123908353,
          "completed": 1769123924271
        },
        "parentID": "msg_be7faadd7001qnhXPM5tKghXUR",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 106766,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be8008f4d001ZcbrzPOA496JlB",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be8008b01001RGc5CLE7Vmp0ts",
          "type": "step-start"
        },
        {
          "id": "prt_be800c8c8001ucIAMVHzjjmsLy",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be8008b01001RGc5CLE7Vmp0ts",
          "type": "tool",
          "callID": "toolu_01EHS6KyDZsSvx58eFX5fVez",
          "tool": "todowrite",
          "state": {
            "status": "completed",
            "input": {
              "todos": [
                {
                  "id": "p1-1",
                  "content": "Read current packet_taxonomy.md Section 3 structure",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-2",
                  "content": "Expand PDS 3.3.1 UUD Request (Type 0x00)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-3",
                  "content": "Expand PDS 3.3.2 RUDI Request/Response (Type 0x01)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-4",
                  "content": "Expand PDS 3.3.3 RUD Request (Type 0x02)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-5",
                  "content": "Expand PDS 3.3.4 ROD Request (Type 0x03)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-6",
                  "content": "Expand PDS 3.3.5 Control Packet (Type 0x04)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-7",
                  "content": "Expand PDS 3.3.6 ACK (Type 0x08)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-8",
                  "content": "Expand PDS 3.3.7 ACK_CC (Type 0x09)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-9",
                  "content": "Expand PDS 3.3.8 ACK_CCX (Type 0x0A)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-10",
                  "content": "Expand PDS 3.3.9 NACK (Type 0x0C)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-11",
                  "content": "Expand PDS 3.3.10 NACK_CCX (Type 0x0D)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-12",
                  "content": "Expand SES 3.5.1 Standard Request SOM=1 (Table 3-8)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-13",
                  "content": "Expand SES 3.5.2 Standard Request SOM=0 (Table 3-9)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-14",
                  "content": "Expand SES 3.5.3 Response (Table 3-11)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-15",
                  "content": "Expand SES 3.5.4 Response with Data (Table 3-12)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-16",
                  "content": "Expand SES 3.5.5 Optimized Response with Data (Figure 3-13)",
                  "status": "cancelled",
                  "priority": "medium"
                },
                {
                  "id": "p1-17",
                  "content": "Expand SES 3.5.6 Small Message (Figure 3-14)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-18",
                  "content": "Expand SES 3.5.7 Rendezvous Extension (Figure 3-15)",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "p1-19",
                  "content": "Expand SES 3.5.8 Atomic Extension (Figure 3-16)",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "p1-20",
                  "content": "Add cross-reference diagrams to section headers",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "p1-21",
                  "content": "Validation pass against .ksy files",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-22",
                  "content": "Update change log",
                  "status": "completed",
                  "priority": "medium"
                }
              ]
            },
            "output": "[\n  {\n    \"id\": \"p1-1\",\n    \"content\": \"Read current packet_taxonomy.md Section 3 structure\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-2\",\n    \"content\": \"Expand PDS 3.3.1 UUD Request (Type 0x00)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-3\",\n    \"content\": \"Expand PDS 3.3.2 RUDI Request/Response (Type 0x01)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-4\",\n    \"content\": \"Expand PDS 3.3.3 RUD Request (Type 0x02)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-5\",\n    \"content\": \"Expand PDS 3.3.4 ROD Request (Type 0x03)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-6\",\n    \"content\": \"Expand PDS 3.3.5 Control Packet (Type 0x04)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-7\",\n    \"content\": \"Expand PDS 3.3.6 ACK (Type 0x08)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-8\",\n    \"content\": \"Expand PDS 3.3.7 ACK_CC (Type 0x09)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-9\",\n    \"content\": \"Expand PDS 3.3.8 ACK_CCX (Type 0x0A)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-10\",\n    \"content\": \"Expand PDS 3.3.9 NACK (Type 0x0C)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-11\",\n    \"content\": \"Expand PDS 3.3.10 NACK_CCX (Type 0x0D)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-12\",\n    \"content\": \"Expand SES 3.5.1 Standard Request SOM=1 (Table 3-8)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-13\",\n    \"content\": \"Expand SES 3.5.2 Standard Request SOM=0 (Table 3-9)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-14\",\n    \"content\": \"Expand SES 3.5.3 Response (Table 3-11)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-15\",\n    \"content\": \"Expand SES 3.5.4 Response with Data (Table 3-12)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-16\",\n    \"content\": \"Expand SES 3.5.5 Optimized Response with Data (Figure 3-13)\",\n    \"status\": \"cancelled\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p1-17\",\n    \"content\": \"Expand SES 3.5.6 Small Message (Figure 3-14)\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-18\",\n    \"content\": \"Expand SES 3.5.7 Rendezvous Extension (Figure 3-15)\",\n    \"status\": \"completed\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p1-19\",\n    \"content\": \"Expand SES 3.5.8 Atomic Extension (Figure 3-16)\",\n    \"status\": \"completed\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p1-20\",\n    \"content\": \"Add cross-reference diagrams to section headers\",\n    \"status\": \"completed\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p1-21\",\n    \"content\": \"Validation pass against .ksy files\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p1-22\",\n    \"content\": \"Update change log\",\n    \"status\": \"completed\",\n    \"priority\": \"medium\"\n  }\n]",
            "title": "1 todos",
            "metadata": {
              "todos": [
                {
                  "id": "p1-1",
                  "content": "Read current packet_taxonomy.md Section 3 structure",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-2",
                  "content": "Expand PDS 3.3.1 UUD Request (Type 0x00)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-3",
                  "content": "Expand PDS 3.3.2 RUDI Request/Response (Type 0x01)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-4",
                  "content": "Expand PDS 3.3.3 RUD Request (Type 0x02)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-5",
                  "content": "Expand PDS 3.3.4 ROD Request (Type 0x03)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-6",
                  "content": "Expand PDS 3.3.5 Control Packet (Type 0x04)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-7",
                  "content": "Expand PDS 3.3.6 ACK (Type 0x08)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-8",
                  "content": "Expand PDS 3.3.7 ACK_CC (Type 0x09)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-9",
                  "content": "Expand PDS 3.3.8 ACK_CCX (Type 0x0A)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-10",
                  "content": "Expand PDS 3.3.9 NACK (Type 0x0C)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-11",
                  "content": "Expand PDS 3.3.10 NACK_CCX (Type 0x0D)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-12",
                  "content": "Expand SES 3.5.1 Standard Request SOM=1 (Table 3-8)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-13",
                  "content": "Expand SES 3.5.2 Standard Request SOM=0 (Table 3-9)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-14",
                  "content": "Expand SES 3.5.3 Response (Table 3-11)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-15",
                  "content": "Expand SES 3.5.4 Response with Data (Table 3-12)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-16",
                  "content": "Expand SES 3.5.5 Optimized Response with Data (Figure 3-13)",
                  "status": "cancelled",
                  "priority": "medium"
                },
                {
                  "id": "p1-17",
                  "content": "Expand SES 3.5.6 Small Message (Figure 3-14)",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-18",
                  "content": "Expand SES 3.5.7 Rendezvous Extension (Figure 3-15)",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "p1-19",
                  "content": "Expand SES 3.5.8 Atomic Extension (Figure 3-16)",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "p1-20",
                  "content": "Add cross-reference diagrams to section headers",
                  "status": "completed",
                  "priority": "medium"
                },
                {
                  "id": "p1-21",
                  "content": "Validation pass against .ksy files",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p1-22",
                  "content": "Update change log",
                  "status": "completed",
                  "priority": "medium"
                }
              ],
              "truncated": false
            },
            "time": {
              "start": 1769123924173,
              "end": 1769123924259
            }
          }
        },
        {
          "id": "prt_be800c925001oHMH3MeVFGn23c",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be8008b01001RGc5CLE7Vmp0ts",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 106766,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be800c979001Dx9e8T48PrwFHY",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769123924345,
          "completed": 1769123943832
        },
        "parentID": "msg_be7faadd7001qnhXPM5tKghXUR",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 107787,
          "output": 883,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "stop"
      },
      "parts": [
        {
          "id": "prt_be800ce0b001Bbn7NlC9nuawJJ",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be800c979001Dx9e8T48PrwFHY",
          "type": "step-start"
        },
        {
          "id": "prt_be8011567001AB36G7LWE15A8n",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be800c979001Dx9e8T48PrwFHY",
          "type": "text",
          "text": "## Phase 1 Complete\n\nI've implemented the revised plan for expanding PDS and SES packet formats in `analysis/packet_taxonomy.md`. Here's a summary of what was added:\n\n### PDS Formats Expanded (Section 3.3)\n\n| Subsection | Format | Size | Key Features |\n|------------|--------|------|--------------|\n| 3.3.1 | RUD Request (Type 0x01) | 12 bytes | Wire diagram, field table, PDC establishment, protocol behavior |\n| 3.3.2 | ROD Request (Type 0x02) | 12 bytes | Ordering guarantees, head-of-line blocking notes |\n| 3.3.3 | RUDI Request (Type 0x04) | 6 bytes | Idempotence, packet ID vs sequence number |\n| 3.3.4 | RUDI Response (Type 0x05) | 6 bytes | ECN marking, response generation |\n| 3.3.5 | UUD Request (Type 0x06) | 6 bytes | Best-effort delivery, no ACKs |\n| 3.3.6 | ACK (Type 0x07) | 12 bytes | Cumulative ACK, ECN feedback |\n| 3.3.7 | ACK_CC (Type 0x08) | 28 bytes | SACK bitmap, CC state, NSCC/CREDIT types |\n| 3.3.8 | ACK_CCX (Type 0x09) | 44 bytes | Extended CC state |\n| 3.3.9 | NACK (Type 0x0A) | 12 bytes | NACK codes table, error handling |\n| 3.3.10 | NACK_CCX (Type 0x0C) | 28 bytes | Extended NACK with CC |\n| 3.3.11 | Control Packet (Type 0x0B) | 12 bytes | 10 subtypes (NOOP, Probe, Credit, Close, etc.) |\n\n### SES Formats Expanded (Section 3.5)\n\n| Subsection | Format | Size | Key Features |\n|------------|--------|------|--------------|\n| 3.5.1 | Standard Request SOM=1 (Table 3-8) | 44 bytes | Full field table, addressing modes, delivery complete |\n| 3.5.2 | Standard Request SOM=0 (Table 3-9) | 16 bytes | Continuation packets, message_offset |\n| 3.5.3 | Response (Table 3-11) | 16 bytes | Return codes table, list indicator |\n| 3.5.4 | Response with Data (Table 3-12) | 24 bytes | Multi-packet responses, payload_length |\n| 3.5.5 | Small Message (Figure 3-14) | 32 bytes | Optimized single-packet format |\n| 3.5.6 | Rendezvous Extension (Figure 3-15) | 32 bytes | Two-sided protocol, eager/pull model |\n| 3.5.7 | Atomic Extension (Figure 3-16) | 8 bytes | 21 atomic opcodes, 16 datatypes |\n\n### Additional Features Added\n\n1. **Cross-reference diagrams** showing request/response relationships for both PDS and SES\n2. **Protocol behavior notes** for each format (state machines, timing, use cases)\n3. **Related format links** enabling navigation between related packets\n4. **Enumeration tables** for opcodes, NACK codes, return codes, atomic operations\n5. **Change log entry** documenting the Phase 1 expansion\n\n### Statistics\n\n- **~1200 lines added** to packet_taxonomy.md\n- **18 packet formats** fully expanded with wire diagrams and field tables\n- **1 format cancelled** (Optimized Response with Data - deferred to Phase 2)",
          "time": {
            "start": 1769123943825,
            "end": 1769123943825
          }
        },
        {
          "id": "prt_be8011593001s3v4ZVXH4M48Cg",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be800c979001Dx9e8T48PrwFHY",
          "type": "step-finish",
          "reason": "stop",
          "cost": 0,
          "tokens": {
            "input": 107787,
            "output": 883,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be8035a95001zDCfqwv6rIw1eq",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "user",
        "time": {
          "created": 1769124092572
        },
        "summary": {
          "title": "Phase 2 planning discussion",
          "diffs": []
        },
        "agent": "Planner-Sisyphus",
        "model": {
          "providerID": "cornelis",
          "modelID": "developer-opus"
        }
      },
      "parts": [
        {
          "id": "prt_be8035a960019alvPjMZK07TLm",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be8035a95001zDCfqwv6rIw1eq",
          "type": "text",
          "text": "please plan phase 2"
        }
      ]
    },
    {
      "info": {
        "id": "msg_be8035ae6001bVz0OAvmURzdp6",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769124092646,
          "completed": 1769124158801
        },
        "parentID": "msg_be8035a95001zDCfqwv6rIw1eq",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Planner-Sisyphus",
        "agent": "Planner-Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 102277,
          "output": 3975,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "stop"
      },
      "parts": [
        {
          "id": "prt_be80360e0001WXq3giERgmBPqe",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be8035ae6001bVz0OAvmURzdp6",
          "type": "step-start"
        },
        {
          "id": "prt_be8045d16001C28GiLsLYgoxL3",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be8035ae6001bVz0OAvmURzdp6",
          "type": "text",
          "text": "## Phase 2 Plan: Expand CMS, TSS, Cornelis Proprietary, RoCEv2, Link Layer, and HSI Formats\n\n### Objective\nComplete the packet format expansion by documenting the remaining protocol layers: Congestion Management (CMS), Transport Security (TSS), Cornelis proprietary formats, RoCEv2 extended headers, Link Layer (LLR, CBFC, LLDP), and Host-Software Interface (HSI).\n\n---\n\n### Scope\n\n#### CMS Formats (Section 3.6.x) - 5 packets\n\n| Format | Size | Priority | Rationale |\n|--------|------|----------|-----------|\n| ACK CC State (NSCC) | 8 bytes | High | Primary congestion control algorithm |\n| ACK CC State (RCCC/TFC) | 8 bytes | Medium | Credit-based CC alternative |\n| Request CC State | 8 bytes | Medium | Source-side CC state |\n| Credit CP Payload | Variable | Medium | Credit control packet payload |\n| Credit Request CP Payload | Variable | Low | Credit request payload |\n\n#### TSS Formats (Section 3.7.x) - 2 packets\n\n| Format | Size | Priority | Rationale |\n|--------|------|----------|-----------|\n| Security Header | 12-16 bytes | High | Encryption header (AES-GCM) |\n| IV Construction | 12 bytes | Medium | Initialization vector format |\n\n#### Cornelis Proprietary Formats (Section 6.x) - 4 packets\n\n| Format | Size | Priority | Rationale |\n|--------|------|----------|-----------|\n| CSIG+ Telemetry | 4 bytes | High | In-band network telemetry |\n| VxLAN+ | 4 bytes | High | Fabric-aware overlay |\n| Collective L2 | 4 bytes | Medium | HW-accelerated collectives (WIP) |\n| Scale-Up L2 | 4 bytes | Medium | GPU cluster interconnect (WIP) |\n\n#### RoCEv2 Extended Headers (Section 4.x) - 3 packets\n\n| Format | Size | Priority | Rationale |\n|--------|------|----------|-----------|\n| RETH (RDMA Extended) | 16 bytes | High | RDMA read/write operations |\n| AETH (ACK Extended) | 4 bytes | High | ACK/NAK responses |\n| AtomicETH | 28 bytes | Medium | Atomic operations |\n\n#### Link Layer Formats (Section 3.8.x) - 6 packets\n\n| Format | Size | Priority | Rationale |\n|--------|------|----------|-----------|\n| LLR ACK CtlOS | 8 bytes | High | Link-level acknowledgment |\n| LLR NACK CtlOS | 8 bytes | High | Link-level retransmit request |\n| LLR Init CtlOS | 8 bytes | Medium | LLR initialization |\n| LLR Init Echo CtlOS | 8 bytes | Medium | LLR init acknowledgment |\n| CBFC CF Update | 8 bytes | Medium | Credit freed update |\n| CBFC CC Update | 8 bytes | Medium | Credit consumed update |\n| UE Link Negotiation TLV | Variable | Low | LLDP negotiation |\n\n#### HSI Formats (Section 7.x) - 4 packets\n\n| Format | Size | Priority | Rationale |\n|--------|------|----------|-----------|\n| Event Notification | 64 bytes | High | Async error/event reporting |\n| SGL Entry | 32 bytes | High | Scatter-gather list entry |\n| Completion Entry | 64 bytes | High | Operation completion |\n| Command Queue Segment | 64 bytes | Medium | Already partially documented |\n\n---\n\n### Document Structure Changes\n\n```\n## 3. Ultra Ethernet+ (UE+) Formats\n   ### 3.6 CMS (Congestion Management Sublayer)\n      #### 3.6.1 ACK CC State - NSCC (8 bytes)        <-- NEW\n      #### 3.6.2 ACK CC State - RCCC/TFC (8 bytes)    <-- NEW\n      #### 3.6.3 Request CC State (8 bytes)           <-- NEW\n      #### 3.6.4 Credit CP Payload                    <-- NEW\n      #### 3.6.5 Credit Request CP Payload            <-- NEW\n   \n   ### 3.7 TSS (Transport Security Sublayer)\n      #### 3.7.1 Security Header (12-16 bytes)        <-- NEW\n      #### 3.7.2 IV Construction (12 bytes)           <-- NEW\n   \n   ### 3.8 Link Layer Formats\n      #### 3.8.1 LLR Formats\n         ##### 3.8.1.1 LLR ACK CtlOS (8 bytes)        <-- NEW\n         ##### 3.8.1.2 LLR NACK CtlOS (8 bytes)       <-- NEW\n         ##### 3.8.1.3 LLR Init CtlOS (8 bytes)       <-- NEW\n         ##### 3.8.1.4 LLR Init Echo CtlOS (8 bytes)  <-- NEW\n      #### 3.8.2 CBFC Formats\n         ##### 3.8.2.1 CF Update (8 bytes)            <-- NEW\n         ##### 3.8.2.2 CC Update (8 bytes)            <-- NEW\n      #### 3.8.3 LLDP Extensions\n         ##### 3.8.3.1 UE Link Negotiation TLV        <-- NEW\n\n## 4. RoCEv2 Formats\n   ### 4.2 RoCEv2 Extended Headers\n      #### 4.2.1 RETH (16 bytes)                      <-- NEW\n      #### 4.2.2 AETH (4 bytes)                       <-- NEW\n      #### 4.2.3 AtomicETH (28 bytes)                 <-- NEW\n\n## 6. Cornelis Proprietary Formats\n   ### 6.3 Transport Layer\n      #### 6.3.1 CSIG+ Telemetry (4 bytes)            <-- NEW\n   ### 6.4 Encapsulation\n      #### 6.4.1 VxLAN+ (4 bytes)                     <-- NEW\n   ### 6.5 Network Layer Extensions\n      #### 6.5.1 Collective L2 (4 bytes)              <-- NEW\n      #### 6.5.2 Scale-Up L2 (4 bytes)                <-- NEW\n\n## 7. Host-Software Interface (HSI) Formats\n   ### 7.2 Notification Queue Formats\n      #### 7.2.1 Event Notification (64 bytes)        <-- NEW\n      #### 7.2.2 Completion Entry (64 bytes)          <-- NEW\n   ### 7.3 Scatter-Gather Formats\n      #### 7.3.1 SGL Entry (32 bytes)                 <-- NEW\n```\n\n---\n\n### Cross-Reference Diagrams to Add\n\n```\nCMS State Flow:\n┌─────────────────────────────────────────────────────────────────┐\n│                                                                 │\n│  Request CC State ────────────────→ (carried in RUD/ROD_CC_REQ) │\n│       │                                                         │\n│       └──→ ACK CC State (NSCC) ───→ (carried in ACK_CC/ACK_CCX) │\n│            ACK CC State (RCCC) ───→ (carried in ACK_CC/ACK_CCX) │\n│                                                                 │\n│  Credit CP Payload ───────────────→ (carried in CP type=7)      │\n│  Credit Request CP Payload ───────→ (carried in CP type=8)      │\n│                                                                 │\n└─────────────────────────────────────────────────────────────────┘\n\nLLR State Machine:\n┌─────────────────────────────────────────────────────────────────┐\n│                                                                 │\n│  LLR Init CtlOS ──────────────────→ LLR Init Echo CtlOS         │\n│       │                                   │                     │\n│       └───────────── (link ready) ────────┘                     │\n│                          │                                      │\n│                          ▼                                      │\n│  Data Frames ─────────────────────→ LLR ACK CtlOS               │\n│       │                                                         │\n│       └── (error/timeout) ────────→ LLR NACK CtlOS              │\n│                                                                 │\n└─────────────────────────────────────────────────────────────────┘\n\nRoCEv2 Packet Composition:\n┌─────────────────────────────────────────────────────────────────┐\n│                                                                 │\n│  RDMA Write:  BTH + RETH + [Payload] + ICRC                     │\n│  RDMA Read:   BTH + RETH + ICRC (request)                       │\n│               BTH + AETH + [Payload] + ICRC (response)          │\n│  Atomic:      BTH + AtomicETH + ICRC (request)                  │\n│               BTH + AETH + AtomicAckETH + ICRC (response)       │\n│  ACK/NAK:     BTH + AETH + ICRC                                 │\n│                                                                 │\n└─────────────────────────────────────────────────────────────────┘\n\nHSI Data Flow:\n┌─────────────────────────────────────────────────────────────────┐\n│                                                                 │\n│  Host → NIC:  Command Queue Segment + SGL Entry(s)              │\n│                                                                 │\n│  NIC → Host:  Completion Entry (success)                        │\n│               Event Notification (error/async)                  │\n│                                                                 │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n---\n\n### Implementation Order\n\n| Phase | Section | Packets | Est. Lines | Priority |\n|-------|---------|---------|------------|----------|\n| 2a | CMS (3.6.x) | 5 | ~300 | High |\n| 2b | TSS (3.7.x) | 2 | ~150 | High |\n| 2c | RoCEv2 (4.2.x) | 3 | ~250 | High |\n| 2d | Link Layer (3.8.x) | 7 | ~400 | Medium |\n| 2e | Cornelis (6.x) | 4 | ~300 | Medium |\n| 2f | HSI (7.x) | 4 | ~350 | High |\n| **Total** | | **25** | **~1750** | |\n\n---\n\n### Detailed Task Breakdown\n\n#### Phase 2a: CMS Formats\n1. Read `ack_cc_state_nscc.ksy` - extract NSCC state fields\n2. Read `ack_cc_state_rccc_tfc.ksy` - extract credit-based CC fields\n3. Read `req_cc_state.ksy` - extract request CC state\n4. Read `credit_cp_payload.ksy` - extract credit payload\n5. Read `credit_request_cp_payload.ksy` - extract credit request\n6. Add CMS state flow diagram\n7. Document NSCC algorithm parameters (service_time, rcv_cwnd_pend, etc.)\n\n#### Phase 2b: TSS Formats\n1. Read `security_header.ksy` - extract encryption header fields\n2. Document IV construction (SSI + TSC)\n3. Document AES-GCM integration\n4. Add security domain concepts\n\n#### Phase 2c: RoCEv2 Extended Headers\n1. Read `reth.ksy` - RDMA extended transport header\n2. Read `aeth.ksy` - ACK extended transport header\n3. Read `atomiceth.ksy` - Atomic extended transport header\n4. Add RoCEv2 packet composition diagram\n5. Document syndrome field encoding (ACK types, NAK codes)\n\n#### Phase 2d: Link Layer Formats\n1. Read `llr_ack_ctlos.ksy` - LLR ACK format\n2. Read `llr_nack_ctlos.ksy` - LLR NACK format\n3. Read `llr_init_ctlos.ksy` - LLR init format\n4. Read `llr_init_echo_ctlos.ksy` - LLR init echo format\n5. Read `cf_update.ksy` - CBFC credit freed\n6. Read `cc_update.ksy` - CBFC credit consumed\n7. Read `ue_link_negotiation_tlv.ksy` - LLDP TLV\n8. Add LLR state machine diagram\n9. Document 64B/66B block format\n\n#### Phase 2e: Cornelis Proprietary Formats\n1. Read `csig_plus.ksy` - telemetry header\n2. Read `vxlan_plus.ksy` - VxLAN extension\n3. Read `collective_l2.ksy` - collective operations (note WIP status)\n4. Read `scaleup_l2.ksy` - scale-up networking (note WIP status)\n5. Document telemetry types and flags\n6. Document VNI encoding\n\n#### Phase 2f: HSI Formats\n1. Read `event_notification.ksy` - async event format\n2. Read `sgl_entry.ksy` - scatter-gather entry\n3. Read completion entry format (if .ksy exists)\n4. Add HSI data flow diagram\n5. Document event types and severity levels\n6. Document inline vs indirect SGL modes\n\n---\n\n### Dependencies\n\n1. **Source of Truth**: `.ksy` files in `earlysim/datamodel/`\n2. **Validation**: Cross-reference against UE Spec v1.0.1 and IB Spec\n3. **Existing Content**: Must integrate with Phase 1 expansions\n4. **Work Items**: May identify new discrepancies (add to Section 9.1)\n\n---\n\n### Risks & Mitigations\n\n| Risk | Impact | Mitigation |\n|------|--------|------------|\n| Collective/Scale-Up specs incomplete | Low | Document as WIP, note spec_version 0.1 |\n| HSI formats may be PMR-specific | Low | Note PMR-specific constraints |\n| RoCEv2 formats well-documented elsewhere | Low | Focus on PMR-specific usage |\n| Document length growing | Medium | Consider splitting into sub-documents in Phase 3 |\n\n---\n\n### Success Criteria\n\n1. All 25 packet formats have wire diagrams and field tables\n2. All fields match .ksy definitions\n3. Spec references included for each format\n4. Cross-reference diagrams added for each subsystem\n5. Any discrepancies logged as work items\n6. Change log updated\n7. Total document remains navigable (TOC links work)\n\n---\n\n### Questions for Review\n\n1. **HSI Scope**: Should we include all HSI formats or focus on the most critical (Event, Completion, SGL)?\n2. **RoCEv2 Depth**: Should we document full BTH or just the extended headers (RETH, AETH, AtomicETH)?\n3. **WIP Formats**: For Collective L2 and Scale-Up L2, should we document current state or defer until specs complete?\n4. **Document Split**: At ~3000 lines total, should we consider splitting into multiple documents?\n\nPlease confirm this plan or provide feedback before I proceed with Phase 2 implementation.",
          "time": {
            "start": 1769124158796,
            "end": 1769124158796
          }
        },
        {
          "id": "prt_be8045d4e001HVQKU6BTIJY3IH",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be8035ae6001bVz0OAvmURzdp6",
          "type": "step-finish",
          "reason": "stop",
          "cost": 0,
          "tokens": {
            "input": 102277,
            "output": 3975,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be807f73e001BSxWp1NkDZ23K0",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "user",
        "time": {
          "created": 1769124394819
        },
        "summary": {
          "title": "HSI formats, BT full doc, WIP formats status and work items",
          "diffs": []
        },
        "agent": "Planner-Sisyphus",
        "model": {
          "providerID": "cornelis",
          "modelID": "developer-opus"
        }
      },
      "parts": [
        {
          "id": "prt_be807f73e002HKAzS6hKPRAo4s",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be807f73e001BSxWp1NkDZ23K0",
          "type": "text",
          "text": "1. Please include all HSI formats  2. document full BT  3. document current state of WIP formats and indicate that they are WIP; create work items to close WIP formats  4. Yes please split into multiple documents at logical breakpoints. Consider creating a master document that describes the 'sub-documents'"
        }
      ]
    },
    {
      "info": {
        "id": "msg_be807f78e001cpXodm6SXG9COU",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769124394894,
          "completed": 1769124448979
        },
        "parentID": "msg_be807f73e001BSxWp1NkDZ23K0",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Planner-Sisyphus",
        "agent": "Planner-Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 106355,
          "output": 3145,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "stop"
      },
      "parts": [
        {
          "id": "prt_be807fee7001koe4VzoU2W6Ox1",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be807f78e001cpXodm6SXG9COU",
          "type": "step-start"
        },
        {
          "id": "prt_be808cac50014zGNa0RhD48zuw",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be807f78e001cpXodm6SXG9COU",
          "type": "text",
          "text": "## Phase 2 Plan: Revised with Document Split\n\n### Confirmed Requirements\n\n| # | Requirement | Decision |\n|---|-------------|----------|\n| 1 | HSI Scope | Include ALL HSI formats |\n| 2 | RoCEv2 Depth | Document full BTH + extended headers |\n| 3 | WIP Formats | Document current state, mark as WIP, create work items |\n| 4 | Document Split | Split into multiple documents with master index |\n\n---\n\n### Document Architecture\n\n#### Proposed Structure\n\n```\nanalysis/\n├── packet_taxonomy.md              # Master index document\n├── packet_taxonomy_ue_pds.md       # UE+ PDS formats (Phase 1 content)\n├── packet_taxonomy_ue_ses.md       # UE+ SES formats (Phase 1 content)\n├── packet_taxonomy_ue_cms_tss.md   # UE+ CMS + TSS formats (Phase 2a/2b)\n├── packet_taxonomy_ue_link.md      # UE+ Link Layer (LLR, CBFC, LLDP) (Phase 2d)\n├── packet_taxonomy_rocev2.md       # RoCEv2 formats (Phase 2c)\n├── packet_taxonomy_cornelis.md     # Cornelis proprietary (UFH, CSIG+, etc.) (Phase 2e)\n├── packet_taxonomy_hsi.md          # Host-Software Interface (Phase 2f)\n└── packet_taxonomy_ualink.md       # UALink (reference only, existing content)\n```\n\n#### Master Document Structure (`packet_taxonomy.md`)\n\n```markdown\n# PMR (CN7000) Packet Format Taxonomy\n\n## Overview\n## Protocol Stack Summary\n## Document Index\n\n| Document | Scope | Formats | Status |\n|----------|-------|---------|--------|\n| [UE+ PDS Formats](packet_taxonomy_ue_pds.md) | Packet Delivery Sublayer | 11 | Complete |\n| [UE+ SES Formats](packet_taxonomy_ue_ses.md) | Semantic Sublayer | 7 | Complete |\n| [UE+ CMS/TSS Formats](packet_taxonomy_ue_cms_tss.md) | Congestion/Security | 7 | Phase 2 |\n| [UE+ Link Layer](packet_taxonomy_ue_link.md) | LLR, CBFC, LLDP | 7 | Phase 2 |\n| [RoCEv2 Formats](packet_taxonomy_rocev2.md) | BTH + Extended Headers | 4 | Phase 2 |\n| [Cornelis Proprietary](packet_taxonomy_cornelis.md) | UFH, CSIG+, VxLAN+, etc. | 6 | Phase 2 |\n| [HSI Formats](packet_taxonomy_hsi.md) | Host-Software Interface | 8 | Phase 2 |\n| [UALink (Reference)](packet_taxonomy_ualink.md) | AI/ML Interconnect | 38 | Reference |\n\n## Quick Reference Tables (consolidated)\n## Work List (consolidated)\n## Change Log (consolidated)\n## References\n```\n\n---\n\n### Phase 2 Implementation Plan\n\n#### Phase 2.0: Document Split (Pre-requisite)\n1. Create master document structure\n2. Extract PDS content (3.3.x) → `packet_taxonomy_ue_pds.md`\n3. Extract SES content (3.5.x) → `packet_taxonomy_ue_ses.md`\n4. Extract existing Cornelis content (6.x) → `packet_taxonomy_cornelis.md`\n5. Extract existing UALink content (10.x) → `packet_taxonomy_ualink.md`\n6. Extract existing HSI content (7.x) → `packet_taxonomy_hsi.md`\n7. Extract existing RoCEv2 content (4.x) → `packet_taxonomy_rocev2.md`\n8. Refactor master document with index and consolidated sections\n9. Update all cross-references to use relative links\n\n#### Phase 2a: CMS Formats (`packet_taxonomy_ue_cms_tss.md`)\n| Format | Size | Source |\n|--------|------|--------|\n| ACK CC State - NSCC | 8 bytes | `ack_cc_state_nscc.ksy` |\n| ACK CC State - RCCC/TFC | 8 bytes | `ack_cc_state_rccc_tfc.ksy` |\n| Request CC State | 8 bytes | `req_cc_state.ksy` |\n| Credit CP Payload | Variable | `credit_cp_payload.ksy` |\n| Credit Request CP Payload | Variable | `credit_request_cp_payload.ksy` |\n\n#### Phase 2b: TSS Formats (`packet_taxonomy_ue_cms_tss.md`)\n| Format | Size | Source |\n|--------|------|--------|\n| Security Header | 12-16 bytes | `security_header.ksy` |\n| IV Construction | 12 bytes | Documentation only |\n\n#### Phase 2c: RoCEv2 Formats (`packet_taxonomy_rocev2.md`)\n| Format | Size | Source |\n|--------|------|--------|\n| BTH (Base Transport Header) | 12 bytes | `bth.ksy` |\n| RETH (RDMA Extended) | 16 bytes | `reth.ksy` |\n| AETH (ACK Extended) | 4 bytes | `aeth.ksy` |\n| AtomicETH | 28 bytes | `atomiceth.ksy` |\n\n#### Phase 2d: Link Layer Formats (`packet_taxonomy_ue_link.md`)\n| Format | Size | Source |\n|--------|------|--------|\n| LLR ACK CtlOS | 8 bytes | `llr_ack_ctlos.ksy` |\n| LLR NACK CtlOS | 8 bytes | `llr_nack_ctlos.ksy` |\n| LLR Init CtlOS | 8 bytes | `llr_init_ctlos.ksy` |\n| LLR Init Echo CtlOS | 8 bytes | `llr_init_echo_ctlos.ksy` |\n| CBFC CF Update | 8 bytes | `cf_update.ksy` |\n| CBFC CC Update | 8 bytes | `cc_update.ksy` |\n| UE Link Negotiation TLV | Variable | `ue_link_negotiation_tlv.ksy` |\n\n#### Phase 2e: Cornelis Proprietary (`packet_taxonomy_cornelis.md`)\n| Format | Size | Source | Status |\n|--------|------|--------|--------|\n| UFH-16 | 12 bytes | Existing | Complete |\n| UFH-32 | 12 bytes | Existing | Complete |\n| CSIG+ Telemetry | 4 bytes | `csig_plus.ksy` | New |\n| VxLAN+ | 4 bytes | `vxlan_plus.ksy` | New |\n| Collective L2 | 4 bytes | `collective_l2.ksy` | **WIP** |\n| Scale-Up L2 | 4 bytes | `scaleup_l2.ksy` | **WIP** |\n\n#### Phase 2f: HSI Formats (`packet_taxonomy_hsi.md`)\n| Format | Size | Source |\n|--------|------|--------|\n| Command Queue Segment | 64 bytes | `command_queue_segment.ksy` |\n| Continuation Segment | 64 bytes | `continuation_segment.ksy` |\n| SGL Entry | 32 bytes | `sgl_entry.ksy` |\n| Completion Entry | 64 bytes | `completion_entry.ksy` |\n| Event Notification | 64 bytes | `event_notification.ksy` |\n| Doorbell | 8 bytes | `doorbell.ksy` |\n| Context Table Entry | Variable | `context_table_entry.ksy` |\n| Memory Region Descriptor | Variable | `memory_region.ksy` |\n\n---\n\n### New Work Items for WIP Formats\n\n| ID | Priority | Category | Description | Status | Opened |\n|----|----------|----------|-------------|--------|--------|\n| W-08-001 | Medium | Specification | `collective_l2.ksy` spec_version 0.1 - complete specification for HW-accelerated collectives | Spec Update | 2026-01-22 |\n| W-08-002 | Medium | Specification | `scaleup_l2.ksy` spec_version 0.1 - complete specification for scale-up networking | Spec Update | 2026-01-22 |\n\n---\n\n### Estimated Effort\n\n| Phase | Document | Packets | Est. Lines | Complexity |\n|-------|----------|---------|------------|------------|\n| 2.0 | Document split | - | ~200 (master) | Medium |\n| 2a | CMS formats | 5 | ~350 | High (CC algorithms) |\n| 2b | TSS formats | 2 | ~200 | Medium (crypto) |\n| 2c | RoCEv2 formats | 4 | ~400 | Medium (well-documented) |\n| 2d | Link Layer | 7 | ~450 | High (64B/66B encoding) |\n| 2e | Cornelis proprietary | 4 new | ~350 | Medium (2 WIP) |\n| 2f | HSI formats | 8 | ~500 | High (HW interface) |\n| **Total** | | **30** | **~2450** | |\n\n---\n\n### Document Templates\n\n#### Sub-Document Header Template\n\n```markdown\n# PMR Packet Taxonomy: [Layer Name]\n\n**Parent Document**: [packet_taxonomy.md](packet_taxonomy.md)  \n**Scope**: [Brief description]  \n**Datamodel Directory**: `datamodel/protocols/[path]/`  \n**Last Updated**: 2026-01-22\n\n---\n\n## Table of Contents\n[Auto-generated TOC]\n\n---\n\n## Overview\n[Layer description, relationship to other layers]\n\n## Packet Format Summary\n[Summary table with all formats in this document]\n\n## Detailed Formats\n[Individual format sections]\n\n## Cross-References\n[Links to related formats in other documents]\n\n## References\n[Spec references specific to this layer]\n```\n\n#### WIP Format Template\n\n```markdown\n#### X.X.X Format Name (Size, **WIP**)\n\n> ⚠️ **Work In Progress**: This format is based on spec_version 0.1. \n> The specification is incomplete. See [W-08-00X](packet_taxonomy.md#91-open-issues).\n\n**Datamodel**: `datamodel/protocols/.../format.ksy`  \n**Spec Status**: Draft (v0.1)  \n**Related Work Item**: W-08-00X\n\n##### Current Wire Format\n[Document current understanding]\n\n##### Known Gaps\n- [ ] Gap 1\n- [ ] Gap 2\n\n##### Protocol Behavior (Preliminary)\n[Document what is known]\n```\n\n---\n\n### Implementation Order\n\n```\nPhase 2.0: Document Split\n    ├── Create master document\n    ├── Extract PDS → packet_taxonomy_ue_pds.md\n    ├── Extract SES → packet_taxonomy_ue_ses.md\n    ├── Extract Cornelis → packet_taxonomy_cornelis.md\n    ├── Extract RoCEv2 → packet_taxonomy_rocev2.md\n    ├── Extract HSI → packet_taxonomy_hsi.md\n    ├── Extract UALink → packet_taxonomy_ualink.md\n    └── Update cross-references\n\nPhase 2a-2b: CMS + TSS\n    └── Create packet_taxonomy_ue_cms_tss.md\n\nPhase 2c: RoCEv2\n    └── Expand packet_taxonomy_rocev2.md (add BTH, RETH, AETH, AtomicETH)\n\nPhase 2d: Link Layer\n    └── Create packet_taxonomy_ue_link.md\n\nPhase 2e: Cornelis Proprietary\n    └── Expand packet_taxonomy_cornelis.md (add CSIG+, VxLAN+, Collective, ScaleUp)\n\nPhase 2f: HSI\n    └── Expand packet_taxonomy_hsi.md (add all HSI formats)\n\nFinal: Validation & Cleanup\n    ├── Verify all cross-references\n    ├── Update master document index\n    ├── Add new work items\n    └── Update change log\n```\n\n---\n\n### Success Criteria\n\n1. Master document provides clear navigation to all sub-documents\n2. Each sub-document is self-contained with proper header/footer\n3. All 30 new packet formats documented with wire diagrams\n4. WIP formats clearly marked with work item references\n5. Cross-references work across documents (relative links)\n6. Work items W-08-001 and W-08-002 added for WIP specs\n7. Change log updated in master document\n8. Total content organized into ~8 manageable documents\n\n---\n\n### Questions Resolved\n\n| Question | Resolution |\n|----------|------------|\n| HSI Scope | All 8 HSI formats included |\n| RoCEv2 Depth | Full BTH + 3 extended headers |\n| WIP Formats | Document current state, mark WIP, create work items |\n| Document Split | 8 sub-documents + 1 master index |\n\n---\n\nPlease confirm this revised plan and I will begin with **Phase 2.0: Document Split**.",
          "time": {
            "start": 1769124448975,
            "end": 1769124448975
          }
        },
        {
          "id": "prt_be808cad0001oeQjFb6Y84cfj0",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be807f78e001cpXodm6SXG9COU",
          "type": "step-finish",
          "reason": "stop",
          "cost": 0,
          "tokens": {
            "input": 106355,
            "output": 3145,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be80bfd40001700UtaNDuhl2uY",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "user",
        "time": {
          "created": 1769124658501
        },
        "summary": {
          "title": "Execute Phase 2 instructions",
          "diffs": []
        },
        "agent": "Sisyphus",
        "model": {
          "providerID": "cornelis",
          "modelID": "developer-opus"
        }
      },
      "parts": [
        {
          "id": "prt_be80bfd40002Sw3EfZQ7MpayGq",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be80bfd40001700UtaNDuhl2uY",
          "type": "text",
          "text": "Execute Phase 2"
        }
      ]
    },
    {
      "info": {
        "id": "msg_be80bfd94001lJtM8TLjIcyojm",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769124658580,
          "completed": 1769124670499
        },
        "parentID": "msg_be80bfd40001700UtaNDuhl2uY",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 76674,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be80c02d70019RUjXnUTs50q7T",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be80bfd94001lJtM8TLjIcyojm",
          "type": "step-start"
        },
        {
          "id": "prt_be80c2bb5001ao69vOK48raOe5",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be80bfd94001lJtM8TLjIcyojm",
          "type": "tool",
          "callID": "toolu_016Uq8ye7epFDhyT1D3wZUGv",
          "tool": "todowrite",
          "state": {
            "status": "completed",
            "input": {
              "todos": [
                {
                  "id": "p2-0-1",
                  "content": "Phase 2.0: Create master document structure",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "p2-0-2",
                  "content": "Phase 2.0: Extract PDS content to packet_taxonomy_ue_pds.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-0-3",
                  "content": "Phase 2.0: Extract SES content to packet_taxonomy_ue_ses.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-0-4",
                  "content": "Phase 2.0: Extract Cornelis content to packet_taxonomy_cornelis.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-0-5",
                  "content": "Phase 2.0: Extract RoCEv2 content to packet_taxonomy_rocev2.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-0-6",
                  "content": "Phase 2.0: Extract HSI content to packet_taxonomy_hsi.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-0-7",
                  "content": "Phase 2.0: Extract UALink content to packet_taxonomy_ualink.md",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p2-0-8",
                  "content": "Phase 2.0: Refactor master document with index",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-a",
                  "content": "Phase 2a: Create CMS formats in packet_taxonomy_ue_cms_tss.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-b",
                  "content": "Phase 2b: Add TSS formats to packet_taxonomy_ue_cms_tss.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-c",
                  "content": "Phase 2c: Expand RoCEv2 with BTH, RETH, AETH, AtomicETH",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-d",
                  "content": "Phase 2d: Create Link Layer formats in packet_taxonomy_ue_link.md",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p2-e",
                  "content": "Phase 2e: Expand Cornelis with CSIG+, VxLAN+, Collective, ScaleUp",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p2-f",
                  "content": "Phase 2f: Expand HSI with all formats",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-final",
                  "content": "Phase 2 Final: Validation, work items, change log",
                  "status": "pending",
                  "priority": "high"
                }
              ]
            },
            "output": "[\n  {\n    \"id\": \"p2-0-1\",\n    \"content\": \"Phase 2.0: Create master document structure\",\n    \"status\": \"in_progress\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-0-2\",\n    \"content\": \"Phase 2.0: Extract PDS content to packet_taxonomy_ue_pds.md\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-0-3\",\n    \"content\": \"Phase 2.0: Extract SES content to packet_taxonomy_ue_ses.md\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-0-4\",\n    \"content\": \"Phase 2.0: Extract Cornelis content to packet_taxonomy_cornelis.md\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-0-5\",\n    \"content\": \"Phase 2.0: Extract RoCEv2 content to packet_taxonomy_rocev2.md\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-0-6\",\n    \"content\": \"Phase 2.0: Extract HSI content to packet_taxonomy_hsi.md\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-0-7\",\n    \"content\": \"Phase 2.0: Extract UALink content to packet_taxonomy_ualink.md\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p2-0-8\",\n    \"content\": \"Phase 2.0: Refactor master document with index\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-a\",\n    \"content\": \"Phase 2a: Create CMS formats in packet_taxonomy_ue_cms_tss.md\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-b\",\n    \"content\": \"Phase 2b: Add TSS formats to packet_taxonomy_ue_cms_tss.md\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-c\",\n    \"content\": \"Phase 2c: Expand RoCEv2 with BTH, RETH, AETH, AtomicETH\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-d\",\n    \"content\": \"Phase 2d: Create Link Layer formats in packet_taxonomy_ue_link.md\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p2-e\",\n    \"content\": \"Phase 2e: Expand Cornelis with CSIG+, VxLAN+, Collective, ScaleUp\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p2-f\",\n    \"content\": \"Phase 2f: Expand HSI with all formats\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-final\",\n    \"content\": \"Phase 2 Final: Validation, work items, change log\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  }\n]",
            "title": "15 todos",
            "metadata": {
              "todos": [
                {
                  "id": "p2-0-1",
                  "content": "Phase 2.0: Create master document structure",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "p2-0-2",
                  "content": "Phase 2.0: Extract PDS content to packet_taxonomy_ue_pds.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-0-3",
                  "content": "Phase 2.0: Extract SES content to packet_taxonomy_ue_ses.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-0-4",
                  "content": "Phase 2.0: Extract Cornelis content to packet_taxonomy_cornelis.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-0-5",
                  "content": "Phase 2.0: Extract RoCEv2 content to packet_taxonomy_rocev2.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-0-6",
                  "content": "Phase 2.0: Extract HSI content to packet_taxonomy_hsi.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-0-7",
                  "content": "Phase 2.0: Extract UALink content to packet_taxonomy_ualink.md",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p2-0-8",
                  "content": "Phase 2.0: Refactor master document with index",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-a",
                  "content": "Phase 2a: Create CMS formats in packet_taxonomy_ue_cms_tss.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-b",
                  "content": "Phase 2b: Add TSS formats to packet_taxonomy_ue_cms_tss.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-c",
                  "content": "Phase 2c: Expand RoCEv2 with BTH, RETH, AETH, AtomicETH",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-d",
                  "content": "Phase 2d: Create Link Layer formats in packet_taxonomy_ue_link.md",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p2-e",
                  "content": "Phase 2e: Expand Cornelis with CSIG+, VxLAN+, Collective, ScaleUp",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p2-f",
                  "content": "Phase 2f: Expand HSI with all formats",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-final",
                  "content": "Phase 2 Final: Validation, work items, change log",
                  "status": "pending",
                  "priority": "high"
                }
              ],
              "truncated": false
            },
            "time": {
              "start": 1769124670393,
              "end": 1769124670487
            }
          }
        },
        {
          "id": "prt_be80c2c19001CAWKYAijDDvik4",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be80bfd94001lJtM8TLjIcyojm",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 76674,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be80c2c8d0016VcyiyoPPsThkX",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769124670605,
          "completed": 1769124676918
        },
        "parentID": "msg_be80bfd40001700UtaNDuhl2uY",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 77436,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be80c30fe001fAl6xhirkCEZtI",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be80c2c8d0016VcyiyoPPsThkX",
          "type": "step-start"
        },
        {
          "id": "prt_be80c44c4001cVfRIFOAaUNMlT",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be80c2c8d0016VcyiyoPPsThkX",
          "type": "tool",
          "callID": "toolu_012e3fXCw5iszk7MMkM1X6xB",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
              "offset": 0,
              "limit": 100
            },
            "output": "<file>\n00001| # PMR (CN7000) Packet Format Taxonomy\n00002| \n00003| **Document**: Packet formats supported by PMR NIC ASIC  \n00004| **Generated**: 2026-01-14  \n00005| **Last Reviewed**: 2026-01-20  \n00006| **Source**: `datamodel/` directory in EarlySim repository  \n00007| **Reference**: `docs/HAS/PMR/05-packet-formats.md`\n00008| \n00009| ---\n00010| \n00011| ## Table of Contents\n00012| \n00013| 1. [Overview](#1-overview)\n00014| 2. [Protocol Stack Summary](#2-protocol-stack-summary)\n00015| 3. [Ultra Ethernet+ (UE+) Formats](#3-ultra-ethernet-ue-formats)\n00016| 4. [RoCEv2 Formats](#4-rocev2-formats)\n00017| 5. [Standard Ethernet Formats](#5-standard-ethernet-formats)\n00018| 6. [Cornelis Proprietary Formats](#6-cornelis-proprietary-formats)\n00019| 7. [Host-Software Interface (HSI) Formats](#7-host-software-interface-hsi-formats)\n00020| 8. [IP Block Descriptors](#8-ip-block-descriptors)\n00021| 9. [Work List](#9-work-list)\n00022| 10. [UALink Protocol (Reference Only)](#10-ualink-protocol-reference-only)\n00023| 11. [References](#11-references)\n00024| \n00025| ---\n00026| \n00027| ## 1. Overview\n00028| \n00029| PMR (Prism River) is Cornelis Networks' 1.6 Tbps NIC ASIC (CN7000 product family). It supports multiple wire protocols with per-packet protocol selection on a single physical port.\n00030| \n00031| ### Supported Protocols\n00032| \n00033| | Protocol | Version | Status | Description |\n00034| |----------|---------|--------|-------------|\n00035| | Ultra Ethernet+ | 1.0.1 | Full | Optimized UE with Cornelis extensions |\n00036| | RoCEv2 | v2 | Full | RDMA over Converged Ethernet |\n00037| | Standard Ethernet | IEEE 802.3 | Full | Traditional Ethernet with offloads |\n00038| | Cornelis Proprietary | 1.0.0 | Full | UFH, CSIG+, VxLAN+, Collectives |\n00039| \n00040| ### Header Efficiency Comparison\n00041| \n00042| | Protocol Stack | Total Headers | Efficiency (4KB payload) |\n00043| |----------------|---------------|--------------------------|\n00044| | UE+ (small msg) | ~20 bytes | 99.5% |\n00045| | UE+ (standard) | ~40 bytes | 99.0% |\n00046| | RoCEv2 (IPv4) | ~58 bytes | 98.6% |\n00047| | RoCEv2 (IPv6) | ~78 bytes | 98.1% |\n00048| \n00049| ---\n00050| \n00051| ## 2. Protocol Stack Summary\n00052| \n00053| ```\n00054| +-----------------------------------------------------------------------------+\n00055| |                           Application Layer                                  |\n00056| |                    (Libfabric, Verbs, Sockets, DPDK)                         |\n00057| +-----------------------------------------------------------------------------+\n00058| |                           Transport Layer                                    |\n00059| |  +------------------+  +------------------+  +------------------+            |\n00060| |  |   UE Transport   |  |     RoCEv2       |  |    TCP/UDP       |            |\n00061| |  |   (SES/PDS/CMS)  |  |   (BTH/RETH)     |  |                  |            |\n00062| |  +------------------+  +------------------+  +------------------+            |\n00063| +-----------------------------------------------------------------------------+\n00064| |                           Network Layer                                      |\n00065| |  +------------------+  +------------------+  +------------------+            |\n00066| |  |   UFH-16/32      |  |   IPv4/IPv6      |  |   IPv4/IPv6      |            |\n00067| |  |   (Cornelis)     |  |   + UDP          |  |                  |            |\n00068| |  +------------------+  +------------------+  +------------------+            |\n00069| +-----------------------------------------------------------------------------+\n00070| |                            Link Layer                                        |\n00071| |  +------------------+  +------------------+  +------------------+            |\n00072| |  |      UE+         |  |   Ethernet II    |  |   Ethernet II    |            |\n00073| |  |   (12 bytes)     |  |   (14 bytes)     |  |   (14 bytes)     |            |\n00074| |  +------------------+  +------------------+  +------------------+            |\n00075| +-----------------------------------------------------------------------------+\n00076| |                          Physical Layer                                      |\n00077| |                    Hill Creek (212.5G x8 PAM4 SerDes)                        |\n00078| +-----------------------------------------------------------------------------+\n00079|       Ultra Ethernet+           RoCEv2              Standard Ethernet\n00080| ```\n00081| \n00082| ---\n00083| \n00084| ## 3. Ultra Ethernet+ (UE+) Formats\n00085| \n00086| ### 3.1 UE+ L2 Header (12 bytes)\n00087| \n00088| **Datamodel**: `datamodel/protocols/cornelis/link/ue_plus.ksy`\n00089| \n00090| ```\n00091| +-------+-------+-------+-------+-------+-------+-------+-------+\n00092| | Byte 0        | Byte 1        | Byte 2        | Byte 3        |\n00093| +-------+-------+-------+-------+-------+-------+-------+-------+\n00094| |L2|V|zyxm|Len  | Length[7:0]   | RC    | SC    | Hop Count     |\n00095| +-------+-------+-------+-------+-------+-------+-------+-------+\n00096| | Byte 4        | Byte 5        | Byte 6        | Byte 7        |\n00097| +-------+-------+-------+-------+-------+-------+-------+-------+\n00098| | Dest LID [15:8]               | Dest LID [7:0]                |\n00099| +-------+-------+-------+-------+-------+-------+-------+-------+\n00100| | Entropy [15:8]                | Entropy [7:0]                 |\n\n(File has more lines. Use 'offset' parameter to read beyond line 100)\n</file>",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy.md",
            "metadata": {
              "preview": "# PMR (CN7000) Packet Format Taxonomy\n\n**Document**: Packet formats supported by PMR NIC ASIC  \n**Generated**: 2026-01-14  \n**Last Reviewed**: 2026-01-20  \n**Source**: `datamodel/` directory in EarlySim repository  \n**Reference**: `docs/HAS/PMR/05-packet-formats.md`\n\n---\n\n## Table of Contents\n\n1. [Overview](#1-overview)\n2. [Protocol Stack Summary](#2-protocol-stack-summary)\n3. [Ultra Ethernet+ (UE+) Formats](#3-ultra-ethernet-ue-formats)\n4. [RoCEv2 Formats](#4-rocev2-formats)\n5. [Standard Ethernet Formats](#5-standard-ethernet-formats)\n6. [Cornelis Proprietary Formats](#6-cornelis-proprietary-formats)\n7. [Host-Software Interface (HSI) Formats](#7-host-software-interface-hsi-formats)\n8. [IP Block Descriptors](#8-ip-block-descriptors)",
              "truncated": true
            },
            "time": {
              "start": 1769124676808,
              "end": 1769124676906
            }
          }
        },
        {
          "id": "prt_be80c452c001N7PbSQLfr2hXk1",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be80c2c8d0016VcyiyoPPsThkX",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 77436,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be80c4590001P6JOzbKFmxqyOj",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769124677008,
          "completed": 1769124682835
        },
        "parentID": "msg_be80bfd40001700UtaNDuhl2uY",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 79276,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be80c49be001BrCo0GdTBpwFO5",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be80c4590001P6JOzbKFmxqyOj",
          "type": "step-start"
        },
        {
          "id": "prt_be80c5bec001fzFEN2LZd9x08S",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be80c4590001P6JOzbKFmxqyOj",
          "type": "tool",
          "callID": "toolu_01DjyusESLvv7HzPAvx6U4Z4",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
              "offset": 160,
              "limit": 100
            },
            "output": "<file>\n00161| | RUD_CC_REQ | 13 | RUD with CC state |\n00162| | ROD_CC_REQ | 14 | ROD with CC state |\n00163| \n00164| ### 3.3 PDS Packet Formats\n00165| \n00166| **Datamodel Directory**: `datamodel/protocols/ue/transport/pds/`\n00167| \n00168| ```\n00169| PDS Request/Response Relationships:\n00170| ┌─────────────────────────────────────────────────────────────────┐\n00171| │                                                                 │\n00172| │  UUD Request (0x06) ──────────────────────→ (no response)       │\n00173| │                                                                 │\n00174| │  RUDI Request (0x04) ─────────────────────→ RUDI Response (0x05)│\n00175| │                       └───────────────────→ NACK (0x0A)         │\n00176| │                                                                 │\n00177| │  RUD Request (0x01) ──┬───────────────────→ ACK (0x07)          │\n00178| │                       ├───────────────────→ ACK_CC (0x08)       │\n00179| │                       ├───────────────────→ ACK_CCX (0x09)      │\n00180| │                       ├───────────────────→ NACK (0x0A)         │\n00181| │                       └───────────────────→ NACK_CCX (0x0C)     │\n00182| │                                                                 │\n00183| │  ROD Request (0x02) ──┴───────────────────→ (same as RUD)       │\n00184| │                                                                 │\n00185| │  Control Packet (0x0B) ───────────────────→ (varies by subtype) │\n00186| │                                                                 │\n00187| └─────────────────────────────────────────────────────────────────┘\n00188| ```\n00189| \n00190| | Type | Format | File | Size | Description |\n00191| |------|--------|------|------|-------------|\n00192| | 0x01 | RUD Request | `rud_rod_request.ksy` | 12 bytes | Reliable Unordered Delivery |\n00193| | 0x02 | ROD Request | `rud_rod_request.ksy` | 12 bytes | Reliable Ordered Delivery |\n00194| | 0x04 | RUDI Request | `rudi_request_response.ksy` | 6 bytes | Reliable Unordered Immediate |\n00195| | 0x05 | RUDI Response | `rudi_request_response.ksy` | 6 bytes | RUDI response |\n00196| | 0x06 | UUD Request | `uud_request.ksy` | 6 bytes | Unreliable Unordered Delivery |\n00197| | 0x07 | ACK | `rud_rod_ack.ksy` | 12 bytes | Acknowledgment |\n00198| | 0x08 | ACK_CC | `ack_cc.ksy` | 28 bytes | ACK with CC state |\n00199| | 0x09 | ACK_CCX | `ack_ccx.ksy` | 44 bytes | ACK with extended CC |\n00200| | 0x0A | NACK | `nack.ksy` | 12 bytes | Negative acknowledgment |\n00201| | 0x0B | CP | `rud_rod_cp.ksy` | 12 bytes | Control packet (10 subtypes) |\n00202| | 0x0C | NACK_CCX | `nack_ccx.ksy` | 28 bytes | NACK with extended CC |\n00203| \n00204| #### 3.3.1 RUD Request (Type 0x01, 12 bytes)\n00205| \n00206| **Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_request.ksy`  \n00207| **Related Formats**: [ROD Request (3.3.2)](#332-rod-request-type-0x02-12-bytes) | [ACK (3.3.6)](#336-ack-type-0x07-12-bytes) | [NACK (3.3.9)](#339-nack-type-0x0a-12-bytes)\n00208| \n00209| ##### Wire Format\n00210| \n00211| ```\n00212| Byte:    0       1       2       3       4       5       6       7\n00213|      +-------+-------+-------+-------+-------+-------+-------+-------+\n00214|      |type |nxt|flg|       clear_psn_offset |         PSN [31:0]    →\n00215|      +-------+-------+-------+-------+-------+-------+-------+-------+\n00216|          8       9      10      11\n00217|      +-------+-------+-------+-------+\n00218|    → |    spdcid     |    dpdcid     |\n00219|      +-------+-------+-------+-------+\n00220| \n00221| Byte 0-1 Detail:\n00222|   Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n00223|        |  type   |nxt_hdr| rsvd|r|a|s|rsvd|\n00224|        | (5 bits)|(4 bit)| (2) |t|r|y|(2) |\n00225| ```\n00226| \n00227| ##### Field Definitions\n00228| \n00229| | Field | Bits | Offset | Description | Constraints |\n00230| |-------|------|--------|-------------|-------------|\n00231| | type | 5 | 0[7:3] | PDS type = 0x01 (RUD) | Must be 0x01 |\n00232| | next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n00233| | flags.rsvd | 2 | 1[6:5] | Reserved | Must be 0 |\n00234| | flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n00235| | flags.ar | 1 | 1[3] | ACK request | 0=no ACK, 1=request ACK |\n00236| | flags.syn | 1 | 1[2] | PDC establishment | 0=normal, 1=SYN |\n00237| | flags.rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n00238| | clear_psn_offset | 16 | 2-3 | CLEAR_PSN relative to PSN | Unsigned offset |\n00239| | psn | 32 | 4-7 | Packet Sequence Number | 32-bit, wraps |\n00240| | spdcid | 16 | 8-9 | Source PDCID | Valid PDCID |\n00241| | dpdcid | 16 | 10-11 | Destination PDCID | See note below |\n00242| \n00243| ##### Field Notes\n00244| \n00245| **dpdcid Interpretation** (depends on `syn` flag):\n00246| - `syn=0`: Destination PDCID for established PDC\n00247| - `syn=1`: `{pdc_info[3:0], psn_offset[11:0]}` for PDC establishment\n00248|   - `pdc_info[0]`: use_rsv_pdc (1=reserved pool, 0=shared pool)\n00249|   - `pdc_info[3:1]`: Reserved\n00250|   - `psn_offset[11:0]`: Difference between PSN and Start_PSN\n00251| \n00252| **clear_psn_offset**: Computed as `CLEAR_PSN = PSN - clear_psn_offset`. Indicates the highest PSN that has been delivered to SES at the source.\n00253| \n00254| ##### Protocol Behavior\n00255| \n00256| **Delivery Mode**: RUD (Reliable Unordered Delivery) provides reliable packet delivery without ordering guarantees. Packets may be delivered to SES out of order.\n00257| \n00258| **State Machine**: RUD operates within the PDC (Packet Delivery Channel) state machine defined in Section 3.5.7.\n00259| \n00260| **Transmission Rules**:\n\n(File has more lines. Use 'offset' parameter to read beyond line 260)\n</file>",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy.md",
            "metadata": {
              "preview": "| RUD_CC_REQ | 13 | RUD with CC state |\n| ROD_CC_REQ | 14 | ROD with CC state |\n\n### 3.3 PDS Packet Formats\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/pds/`\n\n```\nPDS Request/Response Relationships:\n┌─────────────────────────────────────────────────────────────────┐\n│                                                                 │\n│  UUD Request (0x06) ──────────────────────→ (no response)       │\n│                                                                 │\n│  RUDI Request (0x04) ─────────────────────→ RUDI Response (0x05)│\n│                       └───────────────────→ NACK (0x0A)         │\n│                                                                 │\n│  RUD Request (0x01) ──┬───────────────────→ ACK (0x07)          │\n│                       ├───────────────────→ ACK_CC (0x08)       │\n│                       ├───────────────────→ ACK_CCX (0x09)      │\n│                       ├───────────────────→ NACK (0x0A)         │",
              "truncated": true
            },
            "time": {
              "start": 1769124682735,
              "end": 1769124682825
            }
          }
        },
        {
          "id": "prt_be80c5c4a001zgXqDCxso7k5Gr",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be80c4590001P6JOzbKFmxqyOj",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 79276,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be80c5cab00163443XuCzDhfvn",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769124682923,
          "completed": 1769125145104
        },
        "parentID": "msg_be80bfd40001700UtaNDuhl2uY",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 81175,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be80c60df001nVoeIPVEP4og8C",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be80c5cab00163443XuCzDhfvn",
          "type": "step-start"
        },
        {
          "id": "prt_be80c7852001H08oKfhHb5yGes",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be80c5cab00163443XuCzDhfvn",
          "type": "tool",
          "callID": "toolu_016ehRgibCfD5BqNWYfChjTW",
          "tool": "bash",
          "state": {
            "status": "completed",
            "input": {
              "command": "wc -l /home/matkins/CN7000/analysis/packet_taxonomy.md",
              "description": "Count lines in packet_taxonomy.md"
            },
            "output": "1886 /home/matkins/CN7000/analysis/packet_taxonomy.md\n",
            "title": "Count lines in packet_taxonomy.md",
            "metadata": {
              "output": "1886 /home/matkins/CN7000/analysis/packet_taxonomy.md\n",
              "exit": 0,
              "description": "Count lines in packet_taxonomy.md",
              "truncated": false
            },
            "time": {
              "start": 1769124690020,
              "end": 1769125145086
            }
          }
        },
        {
          "id": "prt_be8136a00001VDIilPVgyP7II6",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be80c5cab00163443XuCzDhfvn",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 81175,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be8136a74001xZVx5nu4tvAz9D",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769125145204,
          "completed": 1769125152594
        },
        "parentID": "msg_be80bfd40001700UtaNDuhl2uY",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 81193,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be81371eb001sWnn3wW6RSv7Qp",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be8136a74001xZVx5nu4tvAz9D",
          "type": "step-start"
        },
        {
          "id": "prt_be81386d4001czPSFloLvayRqv",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be8136a74001xZVx5nu4tvAz9D",
          "type": "tool",
          "callID": "toolu_01RGVsv8ytHvLx1zALeircVL",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
              "offset": 750,
              "limit": 50
            },
            "output": "<file>\n00751| \n00752| ### 3.4 SES (Semantic Sublayer) Opcodes\n00753| \n00754| **Datamodel**: `datamodel/protocols/ue/transport/ses/opcodes.ksy`\n00755| \n00756| **Request Opcodes (Table 3-17)**:\n00757| \n00758| | Opcode | Value | Description |\n00759| |--------|-------|-------------|\n00760| | Tagged Send | 0x00 | Send with tag matching |\n00761| | RMA Write | 0x01 | Remote memory write |\n00762| | RMA Read | 0x02 | Remote memory read |\n00763| | Atomic Write | 0x03 | Atomic memory write |\n00764| | Atomic Read | 0x04 | Atomic memory read |\n00765| | Atomic CAS | 0x05 | Compare-and-swap |\n00766| | Deferrable Send | 0x06 | Deferrable send |\n00767| | Ready to Restart | 0x07 | Restart notification |\n00768| | Small Message | 0x08 | Small message (32B header) |\n00769| | Small RMA Write | 0x09 | Small RMA write |\n00770| | Small RMA Read | 0x0A | Small RMA read |\n00771| | Small Atomic Write | 0x0B | Small atomic write |\n00772| | Small Atomic Read | 0x0C | Small atomic read |\n00773| | Small Atomic CAS | 0x0D | Small atomic CAS |\n00774| \n00775| **Response Opcodes (Table 3-18)**:\n00776| \n00777| | Opcode | Value | Description |\n00778| |--------|-------|-------------|\n00779| | Response | 0x00 | Standard response |\n00780| | Response with Data | 0x01 | Response carrying data |\n00781| | Optimized Response | 0x02 | Optimized format |\n00782| | NACK | 0x03 | Negative acknowledgment |\n00783| \n00784| ### 3.5 SES Packet Formats\n00785| \n00786| **Datamodel Directory**: `datamodel/protocols/ue/transport/ses/`\n00787| \n00788| ```\n00789| SES Request/Response Relationships:\n00790| ┌─────────────────────────────────────────────────────────────────┐\n00791| │                                                                 │\n00792| │  Standard Request ────┬───────────────────→ Response            │\n00793| │  (SOM=1, 44B)         └───────────────────→ Response w/Data     │\n00794| │       │                                                         │\n00795| │       └──→ Continuation (SOM=0, 16B)                            │\n00796| │                                                                 │\n00797| │  Small Message (32B) ─────────────────────→ Response            │\n00798| │                                                                 │\n00799| │  + Atomic Extension (8B) ─────────────────→ Response w/Data     │\n00800| │                                             (for fetching ops)  │\n\n(File has more lines. Use 'offset' parameter to read beyond line 800)\n</file>",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy.md",
            "metadata": {
              "preview": "\n### 3.4 SES (Semantic Sublayer) Opcodes\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/opcodes.ksy`\n\n**Request Opcodes (Table 3-17)**:\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Tagged Send | 0x00 | Send with tag matching |\n| RMA Write | 0x01 | Remote memory write |\n| RMA Read | 0x02 | Remote memory read |\n| Atomic Write | 0x03 | Atomic memory write |\n| Atomic Read | 0x04 | Atomic memory read |\n| Atomic CAS | 0x05 | Compare-and-swap |\n| Deferrable Send | 0x06 | Deferrable send |\n| Ready to Restart | 0x07 | Restart notification |\n| Small Message | 0x08 | Small message (32B header) |\n| Small RMA Write | 0x09 | Small RMA write |\n| Small RMA Read | 0x0A | Small RMA read |",
              "truncated": true
            },
            "time": {
              "start": 1769125152472,
              "end": 1769125152583
            }
          }
        },
        {
          "id": "prt_be8138749001xPw8hD5tfEz7dC",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be8136a74001xZVx5nu4tvAz9D",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 81193,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be81387a3001Hif2h2tKCyBTOF",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769125152675,
          "completed": 1769125158678
        },
        "parentID": "msg_be80bfd40001700UtaNDuhl2uY",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 82015,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be8138bd1001RpdyUy4lDNrxPm",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81387a3001Hif2h2tKCyBTOF",
          "type": "step-start"
        },
        {
          "id": "prt_be8139e9e001Infn4GByQZEU8X",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81387a3001Hif2h2tKCyBTOF",
          "type": "tool",
          "callID": "toolu_01DWSxj3qzXnnZAWQ3NPjrVF",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
              "offset": 1280,
              "limit": 80
            },
            "output": "<file>\n01281| \n01282| **Constraints**:\n01283| - MUST NOT be combined with rendezvous extension\n01284| - Fetching atomics MUST NOT operate on more than one element\n01285| \n01286| **Reference**: UE Spec v1.0.1, Figure 3-16, Section 3.4.2.4, Page 165\n01287| \n01288| ### 3.6 CMS (Congestion Management Sublayer)\n01289| \n01290| **Datamodel Directory**: `datamodel/protocols/ue/transport/cms/`\n01291| \n01292| | Format | File | Description |\n01293| |--------|------|-------------|\n01294| | Credit CP Payload | `credit_cp_payload.ksy` | Credit control packet |\n01295| | Credit Request | `credit_request_cp_payload.ksy` | Credit request |\n01296| | Request CC State | `req_cc_state.ksy` | Request CC state |\n01297| | ACK CC State (NSCC) | `ack_cc_state_nscc.ksy` | NSCC algorithm state |\n01298| | ACK CC State (RCCC/TFC) | `ack_cc_state_rccc_tfc.ksy` | RCCC/TFC state |\n01299| \n01300| ### 3.7 TSS (Transport Security Sublayer)\n01301| \n01302| **Datamodel Directory**: `datamodel/protocols/ue/transport/tss/`\n01303| \n01304| | Format | File | Description |\n01305| |--------|------|-------------|\n01306| | Security Header | `security_header.ksy` | Encryption header |\n01307| | IV Construction | `iv_construction.ksy` | Initialization vector |\n01308| | Key Rotation | `protocols/key_rotation.ksy` | Key rotation protocol |\n01309| | KDF Direct | `protocols/kdf_direct.ksy` | Direct key derivation |\n01310| | KDF Client/Server | `protocols/kdf_client_server.ksy` | Client/server KDF |\n01311| | KDF Cluster | `protocols/kdf_cluster.ksy` | Cluster KDF |\n01312| | Join Secure Domain | `protocols/join_secure_domain.ksy` | Domain join |\n01313| | TSS TX Processing | `protocols/tss_tx_processing.ksy` | Transmit processing |\n01314| | TSS RX Processing | `protocols/tss_rx_processing.ksy` | Receive processing |\n01315| \n01316| ### 3.8 Link Layer Formats\n01317| \n01318| #### LLR (Link-Level Retry)\n01319| \n01320| **Datamodel Directory**: `datamodel/protocols/ue/link/llr/`\n01321| \n01322| | Format | File | Description |\n01323| |--------|------|-------------|\n01324| | LLR Preamble (64b66b) | `llr_preamble_64b66b.ksy` | 64b66b preamble |\n01325| | LLR Preamble (MII) | `llr_preamble_mii.ksy` | MII preamble |\n01326| | LLR Init CTLOS | `llr_init_ctlos.ksy` | Initialize LLR |\n01327| | LLR Init Echo CTLOS | `llr_init_echo_ctlos.ksy` | Init acknowledgment |\n01328| | LLR ACK CTLOS | `llr_ack_ctlos.ksy` | Frame acknowledgment |\n01329| | LLR NACK CTLOS | `llr_nack_ctlos.ksy` | Retransmit request |\n01330| \n01331| #### CBFC (Credit-Based Flow Control)\n01332| \n01333| **Datamodel Directory**: `datamodel/protocols/ue/link/cbfc/`\n01334| \n01335| | Format | File | Description |\n01336| |--------|------|-------------|\n01337| | CF Update | `cf_update.ksy` | Credit flow update |\n01338| | CC Update | `cc_update.ksy` | Credit count update |\n01339| | VC State Machine | `protocols/vc_state_machine.ksy` | Virtual channel FSM |\n01340| | Lossless VC Init | `protocols/lossless_vc_init.ksy` | VC initialization |\n01341| | Lossless VC Removal | `protocols/lossless_vc_removal.ksy` | VC teardown |\n01342| \n01343| #### LLDP Extensions\n01344| \n01345| **Datamodel Directory**: `datamodel/protocols/ue/link/lldp/`\n01346| \n01347| | Format | File | Description |\n01348| |--------|------|-------------|\n01349| | UE Link Negotiation TLV | `ue_link_negotiation_tlv.ksy` | Link negotiation |\n01350| | UE CBFC TLV | `ue_cbfc_tlv.ksy` | CBFC parameters |\n01351| \n01352| ---\n01353| \n01354| ## 4. RoCEv2 Formats\n01355| \n01356| **Datamodel Directory**: `datamodel/protocols/roce/transport/`\n01357| \n01358| ### 4.1 RoCEv2 Packet Structure\n01359| \n01360| ```\n\n(File has more lines. Use 'offset' parameter to read beyond line 1360)\n</file>",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy.md",
            "metadata": {
              "preview": "\n**Constraints**:\n- MUST NOT be combined with rendezvous extension\n- Fetching atomics MUST NOT operate on more than one element\n\n**Reference**: UE Spec v1.0.1, Figure 3-16, Section 3.4.2.4, Page 165\n\n### 3.6 CMS (Congestion Management Sublayer)\n\n**Datamodel Directory**: `datamodel/protocols/ue/transport/cms/`\n\n| Format | File | Description |\n|--------|------|-------------|\n| Credit CP Payload | `credit_cp_payload.ksy` | Credit control packet |\n| Credit Request | `credit_request_cp_payload.ksy` | Credit request |\n| Request CC State | `req_cc_state.ksy` | Request CC state |\n| ACK CC State (NSCC) | `ack_cc_state_nscc.ksy` | NSCC algorithm state |\n| ACK CC State (RCCC/TFC) | `ack_cc_state_rccc_tfc.ksy` | RCCC/TFC state |\n\n### 3.7 TSS (Transport Security Sublayer)",
              "truncated": true
            },
            "time": {
              "start": 1769125158560,
              "end": 1769125158667
            }
          }
        },
        {
          "id": "prt_be8139f0c001YpTD83Tj7jD0g1",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81387a3001Hif2h2tKCyBTOF",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 82015,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be8139f69001481mYrHKOearke",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769125158761,
          "completed": 1769125165104
        },
        "parentID": "msg_be80bfd40001700UtaNDuhl2uY",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 83242,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be813a37e001kmafp4ncNvx9Km",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be8139f69001481mYrHKOearke",
          "type": "step-start"
        },
        {
          "id": "prt_be813b7c6001NYFtrC3lCJC4iJ",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be8139f69001481mYrHKOearke",
          "type": "tool",
          "callID": "toolu_01MHuAfCwy492a9RzHkaqucP",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
              "offset": 1350,
              "limit": 150
            },
            "output": "<file>\n01351| \n01352| ---\n01353| \n01354| ## 4. RoCEv2 Formats\n01355| \n01356| **Datamodel Directory**: `datamodel/protocols/roce/transport/`\n01357| \n01358| ### 4.1 RoCEv2 Packet Structure\n01359| \n01360| ```\n01361| +-----------------------------------------------------------------------------+\n01362| | Ethernet II Header (14 bytes)                                               |\n01363| |   Dest MAC (6) | Source MAC (6) | EtherType (2) = 0x0800/0x86DD            |\n01364| +-----------------------------------------------------------------------------+\n01365| | IP Header (20 bytes IPv4 / 40 bytes IPv6)                                   |\n01366| |   Version, IHL, DSCP, ECN, Length, ID, Flags, TTL, Protocol=17, Checksum   |\n01367| |   Source IP, Dest IP                                                        |\n01368| +-----------------------------------------------------------------------------+\n01369| | UDP Header (8 bytes)                                                        |\n01370| |   Source Port (entropy) | Dest Port = 4791 | Length | Checksum             |\n01371| +-----------------------------------------------------------------------------+\n01372| | BTH - Base Transport Header (12 bytes)                                      |\n01373| |   Opcode | Flags | P-Key | Dest QP | A | PSN                               |\n01374| +-----------------------------------------------------------------------------+\n01375| | Extended Headers (optional, operation-dependent)                            |\n01376| |   RETH (16) | AETH (4) | AtomicETH (28) | ImmDt (4)                        |\n01377| +-----------------------------------------------------------------------------+\n01378| | Payload (0 - MTU bytes)                                                     |\n01379| +-----------------------------------------------------------------------------+\n01380| | ICRC (4 bytes)                                                              |\n01381| +-----------------------------------------------------------------------------+\n01382| ```\n01383| \n01384| ### 4.2 BTH (Base Transport Header) - 12 bytes\n01385| \n01386| **Datamodel**: `datamodel/protocols/roce/transport/bth.ksy`\n01387| \n01388| | Field | Bits | Description |\n01389| |-------|------|-------------|\n01390| | Opcode | 8 | Operation type (transport + operation) |\n01391| | SE | 1 | Solicited Event |\n01392| | M | 1 | Migration state |\n01393| | Pad | 2 | Padding bytes (0-3) |\n01394| | TVer | 4 | Transport version (must be 0) |\n01395| | P-Key | 16 | Partition key |\n01396| | Dest QP | 24 | Destination Queue Pair |\n01397| | A | 1 | ACK request |\n01398| | PSN | 24 | Packet Sequence Number |\n01399| \n01400| **Transport Types** (Opcode bits [7:5]):\n01401| | Value | Type | Description |\n01402| |-------|------|-------------|\n01403| | 0x00 | RC | Reliable Connection |\n01404| | 0x20 | UC | Unreliable Connection |\n01405| | 0x40 | RD | Reliable Datagram |\n01406| | 0x60 | UD | Unreliable Datagram |\n01407| \n01408| **Operations** (Opcode bits [4:0]):\n01409| | Value | Operation | Description |\n01410| |-------|-----------|-------------|\n01411| | 0x00 | SEND_FIRST | First send packet |\n01412| | 0x01 | SEND_MIDDLE | Middle send packet |\n01413| | 0x02 | SEND_LAST | Last send packet |\n01414| | 0x03 | SEND_LAST_IMM | Last send with immediate |\n01415| | 0x04 | SEND_ONLY | Single-packet send |\n01416| | 0x05 | SEND_ONLY_IMM | Single send with immediate |\n01417| | 0x06 | RDMA_WRITE_FIRST | First RDMA write |\n01418| | 0x07 | RDMA_WRITE_MIDDLE | Middle RDMA write |\n01419| | 0x08 | RDMA_WRITE_LAST | Last RDMA write |\n01420| | 0x09 | RDMA_WRITE_LAST_IMM | Last write with immediate |\n01421| | 0x0A | RDMA_WRITE_ONLY | Single-packet write |\n01422| | 0x0B | RDMA_WRITE_ONLY_IMM | Single write with immediate |\n01423| | 0x0C | RDMA_READ_REQUEST | Read request |\n01424| | 0x0D | RDMA_READ_RESPONSE_FIRST | First read response |\n01425| | 0x0E | RDMA_READ_RESPONSE_MIDDLE | Middle read response |\n01426| | 0x0F | RDMA_READ_RESPONSE_LAST | Last read response |\n01427| | 0x10 | RDMA_READ_RESPONSE_ONLY | Single read response |\n01428| | 0x11 | ACK | Acknowledgment |\n01429| | 0x12 | ATOMIC_ACK | Atomic acknowledgment |\n01430| | 0x13 | CMP_SWAP | Compare and swap |\n01431| | 0x14 | FETCH_ADD | Fetch and add |\n01432| \n01433| ### 4.3 Extended Transport Headers\n01434| \n01435| | Header | File | Size | Description |\n01436| |--------|------|------|-------------|\n01437| | RETH | `reth.ksy` | 16 bytes | RDMA Extended Transport Header |\n01438| | AETH | `aeth.ksy` | 4 bytes | ACK Extended Transport Header |\n01439| | AtomicETH | `atomiceth.ksy` | 28 bytes | Atomic Extended Transport Header |\n01440| | AtomicAckETH | `atomicacketh.ksy` | 8 bytes | Atomic ACK ETH |\n01441| | DETH | `deth.ksy` | 8 bytes | Datagram Extended Transport Header |\n01442| | ImmDt | `immdt.ksy` | 4 bytes | Immediate Data |\n01443| | ICRC | `icrc.ksy` | 4 bytes | Invariant CRC |\n01444| \n01445| ---\n01446| \n01447| ## 5. Standard Ethernet Formats\n01448| \n01449| **Datamodel Directory**: `datamodel/protocols/ethernet/`\n01450| \n01451| ### 5.1 Ethernet II Frame\n01452| \n01453| **Datamodel**: `datamodel/protocols/ethernet/link/ethernet_ii.ksy`\n01454| \n01455| ```\n01456| +-----------------------------------------------------------------------------+\n01457| | Preamble (7 bytes) + SFD (1 byte)  [not visible to software]               |\n01458| +-----------------------------------------------------------------------------+\n01459| | Ethernet Header (14 bytes)                                                  |\n01460| |   Dest MAC (6) | Source MAC (6) | EtherType (2)                            |\n01461| +-----------------------------------------------------------------------------+\n01462| | Optional VLAN Tag (4 bytes) - 802.1Q                                        |\n01463| |   TPID (2) = 0x8100 | TCI (2) = PCP + DEI + VID                            |\n01464| +-----------------------------------------------------------------------------+\n01465| | Payload (46-1500 bytes, or up to 9000 for jumbo)                           |\n01466| +-----------------------------------------------------------------------------+\n01467| | FCS (4 bytes)                                                               |\n01468| +-----------------------------------------------------------------------------+\n01469| ```\n01470| \n01471| ### 5.2 Link Layer\n01472| \n01473| | Format | File | Description |\n01474| |--------|------|-------------|\n01475| | Ethernet II | `link/ethernet_ii.ksy` | Standard Ethernet frame |\n01476| | VLAN 802.1Q | `link/vlan_802_1q.ksy` | VLAN tagging |\n01477| \n01478| ### 5.3 Network Layer\n01479| \n01480| | Format | File | Description |\n01481| |--------|------|-------------|\n01482| | IPv4 | `network/ipv4.ksy` | IPv4 header |\n01483| | IPv6 | `network/ipv6.ksy` | IPv6 header |\n01484| \n01485| ### 5.4 Transport Layer\n01486| \n01487| | Format | File | Description |\n01488| |--------|------|-------------|\n01489| | TCP | `transport/tcp.ksy` | TCP header |\n01490| | UDP | `transport/udp.ksy` | UDP header |\n01491| \n01492| ---\n01493| \n01494| ## 6. Cornelis Proprietary Formats\n01495| \n01496| **Datamodel Directory**: `datamodel/protocols/cornelis/`\n01497| \n01498| ### 6.1 Link Layer\n01499| \n01500| | Format | File | Size | Description |\n\n(File has more lines. Use 'offset' parameter to read beyond line 1500)\n</file>",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy.md",
            "metadata": {
              "preview": "\n---\n\n## 4. RoCEv2 Formats\n\n**Datamodel Directory**: `datamodel/protocols/roce/transport/`\n\n### 4.1 RoCEv2 Packet Structure\n\n```\n+-----------------------------------------------------------------------------+\n| Ethernet II Header (14 bytes)                                               |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2) = 0x0800/0x86DD            |\n+-----------------------------------------------------------------------------+\n| IP Header (20 bytes IPv4 / 40 bytes IPv6)                                   |\n|   Version, IHL, DSCP, ECN, Length, ID, Flags, TTL, Protocol=17, Checksum   |\n|   Source IP, Dest IP                                                        |\n+-----------------------------------------------------------------------------+\n| UDP Header (8 bytes)                                                        |\n|   Source Port (entropy) | Dest Port = 4791 | Length | Checksum             |",
              "truncated": true
            },
            "time": {
              "start": 1769125165000,
              "end": 1769125165094
            }
          }
        },
        {
          "id": "prt_be813b827001CuiQvoph8svXyu",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be8139f69001481mYrHKOearke",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 83242,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be813b880001IPXUolWwOMdzha",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769125165185,
          "completed": 1769125170988
        },
        "parentID": "msg_be80bfd40001700UtaNDuhl2uY",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 85684,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be813bd9b0019p7qQFVL6I2DMU",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be813b880001IPXUolWwOMdzha",
          "type": "step-start"
        },
        {
          "id": "prt_be813ceba001vAAd2UGeMc8Jte",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be813b880001IPXUolWwOMdzha",
          "type": "tool",
          "callID": "toolu_01RyTND4oPeTtAsgpnmW1uyX",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
              "offset": 1500,
              "limit": 200
            },
            "output": "<file>\n01501| |--------|------|------|-------------|\n01502| | UE+ Header | `link/ue_plus.ksy` | 12 bytes | Optimized L2 header |\n01503| | Cornelis L2 Prefix | `link/cornelis_l2_prefix.ksy` | Variable | L2 prefix |\n01504| \n01505| ### 6.2 Network Layer\n01506| \n01507| | Format | File | Description |\n01508| |--------|------|-------------|\n01509| | UFH-16 | `network/ufh_16.ksy` | 16-bit forwarding header |\n01510| | UFH-32 | `network/ufh_32.ksy` | 32-bit forwarding header |\n01511| | Collective L2 | `network/collective_l2.ksy` | Collective operations header |\n01512| | Scale-Up L2 | `network/scaleup_l2.ksy` | Scale-up deployments |\n01513| \n01514| #### 6.2.1 UFH-16 (Unified Forwarding Header 16-bit Addressing) - 12 bytes\n01515| \n01516| **Datamodel**: `datamodel/protocols/cornelis/network/ufh_16.ksy`\n01517| \n01518| UFH-16 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 16-bit addressing.\n01519| \n01520| ```\n01521|          MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n01522| +-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n01523| | Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n01524| +-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n01525| |Type|  |    Opaque (24-bit)    | Destination   |Opaque |Traffic|   Opaque      |    Source     |\n01526| |[7:4]  |                       | (16-bit BE)   |[7:4]  |Class  |   (16-bit)    |  (16-bit BE)  |\n01527| |SLAP   |                       |               |Z|Y|X|M|[7:0]  |               |               |\n01528| |[3:0]  |                       |               |[3:0]  |       |               |               |\n01529| +-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n01530| ```\n01531| \n01532| | Field | Byte(s) | Bits | Description |\n01533| |-------|---------|------|-------------|\n01534| | Type | 0 | [7:4] | Packet type for forwarding decisions |\n01535| | SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n01536| | Opaque | 1-3 | 24 | Opaque to hardware |\n01537| | Destination | 4-5 | 16 | Destination endpoint address (big-endian) |\n01538| | Opaque | 6 | [7:4] | Opaque to hardware |\n01539| | SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n01540| | Traffic Class | 7 | [7:0] | QoS / priority classification |\n01541| | Opaque | 8-9 | 16 | Opaque to hardware |\n01542| | Source | 10-11 | 16 | Source endpoint address (big-endian) |\n01543| \n01544| **SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n01545| \n01546| **UFH-16 Type Values**:\n01547| \n01548| | Value | Type | Description |\n01549| |-------|------|-------------|\n01550| | 0 | Data | Data packet |\n01551| | 1 | Control | Control packet |\n01552| | 2 | Collective | Collective operation packet |\n01553| | 3 | Credit | Credit/flow control |\n01554| | 4 | Management | Management packet |\n01555| | 5-14 | Reserved | Reserved for future use |\n01556| | 15 | Extended | UFH-32 extension follows |\n01557| \n01558| **Usage**: Scale-up fabric forwarding, intra-pod communication, medium cluster networking (up to 65536 endpoints).\n01559| \n01560| #### 6.2.2 UFH-32 (Unified Forwarding Header 32-bit Addressing) - 12 bytes\n01561| \n01562| **Datamodel**: `datamodel/protocols/cornelis/network/ufh_32.ksy`\n01563| \n01564| UFH-32 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 32-bit addressing for large-scale deployments.\n01565| \n01566| ```\n01567|          MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n01568| +-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n01569| | Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n01570| +-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n01571| |Type|  |       |   Destination (32-bit BE)     |HopLim |Traffic|       Source (32-bit BE)      |\n01572| |[7:4]  |Opaque |                               |[7:4]  |Class  |                               |\n01573| |SLAP   |       |                               |Z|Y|X|M|[7:0]  |                               |\n01574| |[3:0]  |       |                               |[3:0]  |       |                               |\n01575| +-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n01576| ```\n01577| \n01578| | Field | Byte(s) | Bits | Description |\n01579| |-------|---------|------|-------------|\n01580| | Type | 0 | [7:4] | Packet type for forwarding decisions |\n01581| | SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n01582| | Opaque | 1 | [7:0] | Opaque to hardware |\n01583| | Destination | 2-5 | 32 | Destination endpoint address (big-endian) |\n01584| | Hop Limit | 6 | [7:4] | TTL/hop count |\n01585| | SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n01586| | Traffic Class | 7 | [7:0] | QoS / priority classification |\n01587| | Source | 8-11 | 32 | Source endpoint address (big-endian) |\n01588| \n01589| **SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n01590| \n01591| **UFH-32 Type Values**:\n01592| \n01593| | Value | Type | Description |\n01594| |-------|------|-------------|\n01595| | 0 | Data | Data packet |\n01596| | 1 | Control | Control packet |\n01597| | 2 | Collective | Collective operation packet |\n01598| | 3 | Credit | Credit/flow control |\n01599| | 4 | Management | Management packet |\n01600| | 5 | Multicast | Multicast packet |\n01601| | 6 | Barrier | Barrier synchronization |\n01602| | 7 | Reduction | Reduction operation |\n01603| | 8-14 | Reserved | Reserved for future use |\n01604| | 15 | Vendor | Vendor-specific packet |\n01605| \n01606| **Usage**: Large-scale scale-up fabric forwarding (4+ billion endpoints), multi-pod communication, extended collective operations.\n01607| \n01608| ### 6.3 Transport Layer\n01609| \n01610| | Format | File | Description |\n01611| |--------|------|-------------|\n01612| | CSIG+ | `transport/csig_plus.ksy` | Telemetry header |\n01613| | PKEY | `transport/pkey.ksy` | Partition key |\n01614| \n01615| ### 6.4 Encapsulation\n01616| \n01617| | Format | File | Description |\n01618| |--------|------|-------------|\n01619| | VxLAN+ | `encapsulation/vxlan_plus.ksy` | Extended VxLAN overlay |\n01620| \n01621| ---\n01622| \n01623| ## 7. Host-Software Interface (HSI) Formats\n01624| \n01625| **Datamodel Directory**: `datamodel/hw/asics/pmr/interfaces/host_interface/`\n01626| \n01627| ### 7.1 Command Queue Segment (64 bytes)\n01628| \n01629| **Datamodel**: `command_queue_segment.ksy`\n01630| \n01631| ```\n01632| +-------+-------+-------+-------+-------+-------+-------+-------+\n01633| | Byte 0        | Byte 1        | Bytes 2-3     | Bytes 4-7     |\n01634| +-------+-------+-------+-------+-------+-------+-------+-------+\n01635| | Opcode        | Flags         | Payload Len   | Reserved      |\n01636| +-------+-------+-------+-------+-------+-------+-------+-------+\n01637| | Bytes 8-15                    | Bytes 16-23                   |\n01638| +-------+-------+-------+-------+-------+-------+-------+-------+\n01639| | Tag (64 bits)                 | Dest (64 bits)                |\n01640| +-------+-------+-------+-------+-------+-------+-------+-------+\n01641| | Bytes 24-31                   | Bytes 32-63                   |\n01642| +-------+-------+-------+-------+-------+-------+-------+-------+\n01643| | Metadata (64 bits)            | Inline Data or SGL Entry      |\n01644| +-------+-------+-------+-------+-------+-------+-------+-------+\n01645| ```\n01646| \n01647| **Opcode Encoding**:\n01648| | Bits | Field | Values |\n01649| |------|-------|--------|\n01650| | [7:4] | Family | MSG=0x1, TAGGED=0x2, RMA=0x3, ATOMIC=0x4 |\n01651| | [3:2] | Variant | SEND=0, RECV=1, INJECT=2 |\n01652| | [1] | Reserved | Must be 0 |\n01653| | [0] | Data Source | INLINE=0, SGL=1 |\n01654| \n01655| ### 7.2 Notification Formats\n01656| \n01657| | Format | File | Type | Size | Description |\n01658| |--------|------|------|------|-------------|\n01659| | Receive Notification | `receive_notification.ksy` | 0x00 | 64 bytes | Received message |\n01660| | Send Completion | `send_completion.ksy` | 0x01 | 64 bytes | Send completed |\n01661| | Event Notification | `event_notification.ksy` | 0x02 | 64 bytes | Async event |\n01662| | Notification Entry | `notification_entry.ksy` | - | 64 bytes | Generic entry |\n01663| | QW Violation Event | `qw_violation_event.ksy` | - | 64 bytes | QW alignment error |\n01664| \n01665| ### 7.3 Receive Notification (64 bytes)\n01666| \n01667| **Datamodel**: `receive_notification.ksy`\n01668| \n01669| | Field | Offset | Size | Description |\n01670| |-------|--------|------|-------------|\n01671| | type | 0 | 1 | 0x00 for receive |\n01672| | flags | 1 | 1 | FI_INLINE, continuation |\n01673| | status | 2 | 2 | Completion status |\n01674| | src_id | 4 | 4 | Source endpoint ID |\n01675| | tag | 8 | 8 | Tag value |\n01676| | total_length | 16 | 4 | Payload length |\n01677| | buffer_id_0 | 20 | 2 | First buffer ID |\n01678| | buffer_id_1 | 22 | 2 | Second buffer ID |\n01679| | buffer_offset | 24 | 2 | Offset in buffer |\n01680| | reserved | 26 | 2 | Reserved |\n01681| | inline_data | 28 | 35 | Inline payload |\n01682| | marker | 63 | 1 | Prime marker (1-13) |\n01683| \n01684| ### 7.4 Send Completion (64 bytes)\n01685| \n01686| **Datamodel**: `send_completion.ksy`\n01687| \n01688| | Field | Offset | Size | Description |\n01689| |-------|--------|------|-------------|\n01690| | type | 0 | 1 | 0x01 for send |\n01691| | flags | 1 | 1 | Completion flags |\n01692| | status | 2 | 2 | Completion status |\n01693| | reserved_0 | 4 | 4 | Reserved |\n01694| | op_context | 8 | 8 | Operation context |\n01695| | bytes_sent | 16 | 4 | Bytes transferred |\n01696| | reserved_1 | 20 | 43 | Reserved |\n01697| | marker | 63 | 1 | Prime marker (1-13) |\n01698| \n01699| ### 7.5 Other HSI Formats\n01700| \n\n(File has more lines. Use 'offset' parameter to read beyond line 1700)\n</file>",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy.md",
            "metadata": {
              "preview": "|--------|------|------|-------------|\n| UE+ Header | `link/ue_plus.ksy` | 12 bytes | Optimized L2 header |\n| Cornelis L2 Prefix | `link/cornelis_l2_prefix.ksy` | Variable | L2 prefix |\n\n### 6.2 Network Layer\n\n| Format | File | Description |\n|--------|------|-------------|\n| UFH-16 | `network/ufh_16.ksy` | 16-bit forwarding header |\n| UFH-32 | `network/ufh_32.ksy` | 32-bit forwarding header |\n| Collective L2 | `network/collective_l2.ksy` | Collective operations header |\n| Scale-Up L2 | `network/scaleup_l2.ksy` | Scale-up deployments |\n\n#### 6.2.1 UFH-16 (Unified Forwarding Header 16-bit Addressing) - 12 bytes\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_16.ksy`\n\nUFH-16 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 16-bit addressing.\n\n```",
              "truncated": true
            },
            "time": {
              "start": 1769125170878,
              "end": 1769125170976
            }
          }
        },
        {
          "id": "prt_be813cf22001d94nCgasoWT74M",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be813b880001IPXUolWwOMdzha",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 85684,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be813cf7e0016pGDUo0ABQdkML",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769125171070,
          "completed": 1769125177435
        },
        "parentID": "msg_be80bfd40001700UtaNDuhl2uY",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 89107,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be813d409001QJhuXzLDLVtdIu",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be813cf7e0016pGDUo0ABQdkML",
          "type": "step-start"
        },
        {
          "id": "prt_be813e7e4001bpyjeweouFOlAP",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be813cf7e0016pGDUo0ABQdkML",
          "type": "tool",
          "callID": "toolu_01MwkjkvWLMQVgVvoKLBpqBY",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy.md",
              "offset": 1700,
              "limit": 200
            },
            "output": "<file>\n01701| | Format | File | Description |\n01702| |--------|------|-------------|\n01703| | SGL Entry | `sgl_entry.ksy` | Scatter-gather list entry |\n01704| | PCIe Descriptors | `pcie/descriptors.ksy` | PCIe interface descriptors |\n01705| \n01706| ---\n01707| \n01708| ## 8. IP Block Descriptors\n01709| \n01710| **Datamodel Directory**: `datamodel/hw/ip/cornelis/`\n01711| \n01712| ### 8.1 Collectives Engine (CE)\n01713| \n01714| **Datamodel**: `ce/descriptors.ksy`\n01715| \n01716| The Collectives Engine uses RISC-V vector cores (VLEN=512) for hardware-accelerated collective operations.\n01717| \n01718| ### 8.2 Electric Creek (EC)\n01719| \n01720| **Datamodel**: `ec/descriptors.ksy`\n01721| \n01722| Electric Creek is the management complex shared between PMR NIC and LNR Switch.\n01723| \n01724| ---\n01725| \n01726| ## 9. Work List\n01727| \n01728| This section tracks issues requiring follow-up investigation or specification updates.\n01729| \n01730| ### 9.1 Open Issues\n01731| \n01732| | ID | Priority | Category | Description | Status | Opened | Closed |\n01733| |----|----------|----------|-------------|--------|--------|--------|\n01734| | W-06-001 | Medium | Datamodel | UFH-32 lacks 16-bit entropy field; per-packet ECMP not supported; switch must derive entropy from Src+Dest hash | Deferred | 2026-01-20 | - |\n01735| | W-07-001 | Low | Datamodel | `ack_cc.ksy` shows `ack_cc_state` as 32-bit (4 bytes) but UE Spec Table 3-36 shows 64-bit (8 bytes); verify field size | Investigation | 2026-01-22 | - |\n01736| | W-07-002 | Low | Documentation | `collective_l2.ksy` and `scaleup_l2.ksy` marked as \"work_in_progress\" with spec_version 0.1; specifications incomplete | Spec Update | 2026-01-22 | - |\n01737| | W-07-003 | Low | Datamodel | `ue_plus.ksy` 9-bit length field split across bytes 0-1 with unusual encoding (1 bit in byte 0, 8 bits in byte 1); verify encoding matches UE Spec | Investigation | 2026-01-22 | - |\n01738| | W-04-004 | High | Datamodel | `ue_plus.ksy` LID size: Datamodel shows 16-bit LID, should be 24-bit per HAS | Investigation | 2026-01-10 | - |\n01739| | W-05-002 | Medium | Specification | MTU values: Verify maximum MTU for each protocol | Investigation | 2026-01-10 | - |\n01740| | W-05-003 | Medium | Documentation | CMS detailed formats: Need comprehensive documentation | Spec Update | 2026-01-10 | - |\n01741| | W-03-002 | Low | Terminology | PDP vs PDS naming: UML uses both terms inconsistently | Spec Update | 2026-01-08 | - |\n01742| | W-03-006 | Low | Terminology | SES vs SE: \"SES Processing Groups\" vs \"Semantic Engines\" | Spec Update | 2026-01-08 | - |\n01743| \n01744| ### 9.2 Datamodel Gaps\n01745| \n01746| | ID | Priority | Description | Target Location | Status | Opened | Closed |\n01747| |----|----------|-------------|-----------------|--------|--------|--------|\n01748| | D-001 | High | PMR CSR definitions missing from datamodel | `datamodel/hw/asics/pmr/csrs/*.rdl` | Spec Update | 2026-01-10 | - |\n01749| | D-002 | Medium | PMR block hierarchy YAML incomplete | `datamodel/hw/asics/pmr/blocks.yaml` | Spec Update | 2026-01-10 | - |\n01750| | D-003 | Medium | PMR interface contracts missing | `datamodel/views/contracts/pmr-*.puml` | Spec Update | 2026-01-10 | - |\n01751| \n01752| ### 9.3 Specification Clarifications Needed\n01753| \n01754| | ID | Priority | Question | Context | Status | Opened | Closed |\n01755| |----|----------|----------|---------|--------|--------|--------|\n01756| | Q1 | Medium | Lightweight Interface Scope | What features should be reduced in lightweight mode? | Investigation | 2026-01-10 | - |\n01757| | Q2 | Medium | Tag Table Sizing | Should HW tag table size be per-endpoint configurable? | Investigation | 2026-01-10 | - |\n01758| | Q3 | Medium | Multi-Packet Eager Messages | Should hardware support multi-packet eager messages? | Investigation | 2026-01-10 | - |\n01759| | Q4 | Low | RoCE Work Queue Implementation | Confirm RoCE WQ/CQ are software-implemented | Investigation | 2026-01-10 | - |\n01760| \n01761| ### 9.4 Closed Issues\n01762| \n01763| | ID | Priority | Category | Description | Resolution | Opened | Closed |\n01764| |----|----------|----------|-------------|------------|--------|--------|\n01765| | W-05-001 | Medium | Documentation | UE taxonomy reference | Documented in `05-packet-formats.md` | 2026-01-08 | 2026-01-10 |\n01766| | W-02-005 | Medium | Documentation | Protocol support documentation | Documented UE+, RoCEv2, Ethernet | 2026-01-08 | 2026-01-10 |\n01767| | W-02-006 | Medium | Documentation | Cornelis Collective Reduction Protocol | Documented in HAS §2.5.4 | 2026-01-08 | 2026-01-10 |\n01768| | W-03-001 | Medium | Architecture | Semantic Engine count | Confirmed 64 (8x8) in UML and HAS | 2026-01-08 | 2026-01-10 |\n01769| | W-17-005 | Low | Documentation | Port subdivision note | Added to HAS Ch17 | 2026-01-11 | 2026-01-11 |\n01770| | W-17-006 | Medium | Documentation | MPORT interface documentation | Documented 256B @ 1.66 GHz | 2026-01-11 | 2026-01-11 |\n01771| | W-04-005 | High | Datamodel | `ufh_16.ksy` address size: Datamodel shows 12-bit dest, should be 16-bit | UFH-16 restructured to 12-byte Ethernet MAC overlay with 16-bit destination (bytes 4-5) and 16-bit source (bytes 10-11) | 2026-01-10 | 2026-01-20 |\n01772| | W-04-006 | High | Datamodel | `ufh_32.ksy` address size: Datamodel shows 16-bit dest, should be 32-bit | UFH-32 restructured to 12-byte Ethernet MAC overlay with 32-bit destination (bytes 2-5) and 32-bit source (bytes 8-11) | 2026-01-10 | 2026-01-20 |\n01773| \n01774| ### 9.5 Change Log\n01775| \n01776| | Date | Change | Details |\n01777| |------|--------|---------|\n01778| | 2026-01-14 | Initial creation | Document created with PMR packet taxonomy |\n01779| | 2026-01-20 | Review and update | Added UALink section (reference only, not PMR-supported); Added change log; Updated datamodel file counts; No new .ksy files since initial creation |\n01780| | 2026-01-20 | UFH format details | Added detailed UFH-16 and UFH-32 format documentation in Section 6.2 (wire diagrams, field tables, type enumerations) |\n01781| | 2026-01-20 | UFH restructuring | UFH-16 and UFH-32 restructured to 12-byte Ethernet MAC overlays; UFH-16 now 16-bit addressing, UFH-32 now 32-bit addressing; Added SLAP field constraints (Z,Y,X=001); Updated datamodel .ksy files; Closed W-04-005 and W-04-006 |\n01782| | 2026-01-22 | Datamodel review | Added W-07-001 (ack_cc_state size mismatch), W-07-002 (collective/scaleup specs incomplete), W-07-003 (ue_plus length encoding); Identified 30+ packet formats requiring expansion |\n01783| | 2026-01-22 | Phase 1 expansion | Expanded PDS formats (3.3.1-3.3.11): RUD, ROD, RUDI, UUD, ACK, ACK_CC, ACK_CCX, NACK, NACK_CCX, Control Packet with wire diagrams, field tables, protocol behavior, and cross-references. Expanded SES formats (3.5.1-3.5.7): Standard Request SOM=1/SOM=0, Response, Response with Data, Small Message, Rendezvous Extension, Atomic Extension. Added request/response relationship diagrams. Total ~1200 lines added. |\n01784| \n01785| ---\n01786| \n01787| ## 10. UALink Protocol (Reference Only)\n01788| \n01789| **Note**: UALink is defined in the datamodel but is **NOT currently supported by PMR**. It is included here for reference as it may be relevant for future AI/ML accelerator interconnect work.\n01790| \n01791| **Datamodel Directory**: `datamodel/protocols/ualink/`\n01792| \n01793| ### 10.1 UALink Overview\n01794| \n01795| UALink is an AI/ML accelerator interconnect protocol with 38 packet definitions across all OSI layers.\n01796| \n01797| | Layer | Count | Key Formats |\n01798| |-------|-------|-------------|\n01799| | UPLI (Upper Protocol Layer Interface) | 8 | commands.ksy, request_channel.ksy, status_codes.ksy |\n01800| | Transaction | 9 | tl_flit.ksy, control_half_flit.ksy, data_half_flit.ksy |\n01801| | Data Link | 12 | dl_flit.ksy, segment_header.ksy, crc.ksy, control_messages.ksy |\n01802| | Physical | 4 | alignment_markers.ksy, control_ordered_sets.ksy, link_training.ksy |\n01803| | Security | 5 | authentication.ksy, encryption.ksy, key_derivation.ksy |\n01804| \n01805| ### 10.2 UALink Packet Formats\n01806| \n01807| #### UPLI Layer\n01808| | Format | File | Description |\n01809| |--------|------|-------------|\n01810| | Commands | `upli/commands.ksy` | UPLI command definitions |\n01811| | Request Channel | `upli/request_channel.ksy` | Request channel format |\n01812| | Originator Data | `upli/originator_data_channel.ksy` | Originator data channel |\n01813| | Read Response | `upli/read_response_channel.ksy` | Read response channel |\n01814| | Write Response | `upli/write_response_channel.ksy` | Write response channel |\n01815| | Status Codes | `upli/status_codes.ksy` | Status code definitions |\n01816| | Connection Handshake | `upli/protocols/connection_handshake.ksy` | Connection setup |\n01817| | Flow Control | `upli/protocols/flow_control.ksy` | Flow control protocol |\n01818| \n01819| #### Transaction Layer\n01820| | Format | File | Description |\n01821| |--------|------|-------------|\n01822| | TL Flit | `transaction/tl_flit.ksy` | Transaction layer flit |\n01823| | Control Half Flit | `transaction/control_half_flit.ksy` | Control half flit |\n01824| | Data Half Flit | `transaction/data_half_flit.ksy` | Data half flit |\n01825| | Message Half Flit | `transaction/message_half_flit.ksy` | Message half flit |\n01826| | Request Field | `transaction/request_field.ksy` | Request field format |\n01827| | Response Field | `transaction/response_field.ksy` | Response field format |\n01828| | Flow Control Field | `transaction/flow_control_field.ksy` | Flow control field |\n01829| | Compression | `transaction/protocols/compression.ksy` | Data compression |\n01830| | Address Cache | `transaction/protocols/address_cache.ksy` | Address caching |\n01831| \n01832| #### Data Link Layer\n01833| | Format | File | Description |\n01834| |--------|------|-------------|\n01835| | DL Flit | `datalink/dl_flit.ksy` | Data link flit |\n01836| | Flit Header | `datalink/flit_header.ksy` | Flit header format |\n01837| | Segment Header | `datalink/segment_header.ksy` | Segment header |\n01838| | CRC | `datalink/crc.ksy` | CRC calculation |\n01839| | Control Messages | `datalink/messages/control_messages.ksy` | Control messages |\n01840| | Basic Messages | `datalink/messages/basic_messages.ksy` | Basic messages |\n01841| | UART Messages | `datalink/messages/uart_messages.ksy` | UART messages |\n01842| | Vendor Defined | `datalink/messages/vendor_defined.ksy` | Vendor extensions |\n01843| | Link Resiliency | `datalink/protocols/link_resiliency.ksy` | Link resiliency |\n01844| | Link Level Replay | `datalink/protocols/link_level_replay.ksy` | Replay protocol |\n01845| | Link State | `datalink/protocols/link_state.ksy` | Link state machine |\n01846| | Link Folding | `datalink/protocols/link_folding.ksy` | Link folding |\n01847| \n01848| #### Physical Layer\n01849| | Format | File | Description |\n01850| |--------|------|-------------|\n01851| | Alignment Markers | `physical/alignment_markers.ksy` | Lane alignment |\n01852| | Control Ordered Sets | `physical/control_ordered_sets.ksy` | Control sequences |\n01853| | Reconciliation Sublayer | `physical/reconciliation_sublayer.ksy` | RS sublayer |\n01854| | Link Training | `physical/protocols/link_training.ksy` | Link training |\n01855| \n01856| #### Security Layer\n01857| | Format | File | Description |\n01858| |--------|------|-------------|\n01859| | Authentication | `security/authentication.ksy` | Authentication |\n01860| | Encryption | `security/encryption.ksy` | Encryption format |\n01861| | IV Format | `security/iv_format.ksy` | Initialization vector |\n01862| | Key Derivation | `security/protocols/key_derivation.ksy` | Key derivation |\n01863| | Key Rotation | `security/protocols/key_rotation.ksy` | Key rotation |\n01864| \n01865| ---\n01866| \n01867| ## 11. References\n01868| \n01869| ### Internal Documents\n01870| - `docs/HAS/PMR/05-packet-formats.md` - PMR HAS Chapter 5\n01871| - `docs/HAS/PMR/WORK.md` - PMR HAS Work Tracking\n01872| - `.specify/memory/constitution.md` - Project Constitution\n01873| \n01874| ### Datamodel Locations\n01875| - `datamodel/protocols/ue/` - Ultra Ethernet protocols (94 .ksy files)\n01876| - `datamodel/protocols/roce/` - RoCEv2 protocols (8 .ksy files)\n01877| - `datamodel/protocols/ethernet/` - Standard Ethernet (6 .ksy files)\n01878| - `datamodel/protocols/cornelis/` - Cornelis proprietary (9 .ksy files)\n01879| - `datamodel/protocols/ualink/` - UALink protocols (38 .ksy files) - NOT supported by PMR\n01880| - `datamodel/hw/asics/pmr/` - PMR ASIC definitions\n01881| \n01882| ### External Specifications\n01883| - [Ultra Ethernet Specification v1.0.1](https://ultraethernet.org/)\n01884| - [InfiniBand Architecture Specification](https://www.infinibandta.org/)\n01885| - IEEE 802.3 Ethernet Standard\n01886| - UALink Specification (Ultra Accelerator Link)\n01887| \n\n(End of file - total 1887 lines)\n</file>",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy.md",
            "metadata": {
              "preview": "| Format | File | Description |\n|--------|------|-------------|\n| SGL Entry | `sgl_entry.ksy` | Scatter-gather list entry |\n| PCIe Descriptors | `pcie/descriptors.ksy` | PCIe interface descriptors |\n\n---\n\n## 8. IP Block Descriptors\n\n**Datamodel Directory**: `datamodel/hw/ip/cornelis/`\n\n### 8.1 Collectives Engine (CE)\n\n**Datamodel**: `ce/descriptors.ksy`\n\nThe Collectives Engine uses RISC-V vector cores (VLEN=512) for hardware-accelerated collective operations.\n\n### 8.2 Electric Creek (EC)\n\n**Datamodel**: `ec/descriptors.ksy`",
              "truncated": false
            },
            "time": {
              "start": 1769125177319,
              "end": 1769125177422
            }
          }
        },
        {
          "id": "prt_be813e850001Ah12JbDvcc5PU2",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be813cf7e0016pGDUo0ABQdkML",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 89107,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be813e8bc001bg8fTRiV9VqOBl",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769125177532,
          "completed": 1769125314955
        },
        "parentID": "msg_be80bfd40001700UtaNDuhl2uY",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 93385,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be813edb5001zYfkV4yBXg5pSg",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be813e8bc001bg8fTRiV9VqOBl",
          "type": "step-start"
        },
        {
          "id": "prt_be81600e8001Aj0gk8iol0X50G",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be813e8bc001bg8fTRiV9VqOBl",
          "type": "tool",
          "callID": "toolu_01KiAG4qPpge59Rt7urjKHhz",
          "tool": "write",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy_ue_pds.md",
              "content": "# PMR Packet Taxonomy: UE+ PDS Formats\n\n**Parent Document**: [packet_taxonomy.md](packet_taxonomy.md)  \n**Scope**: Ultra Ethernet+ Packet Delivery Sublayer (PDS) packet formats  \n**Datamodel Directory**: `datamodel/protocols/ue/transport/pds/`  \n**Last Updated**: 2026-01-22\n\n---\n\n## Table of Contents\n\n1. [Overview](#1-overview)\n2. [PDS Prologue](#2-pds-prologue)\n3. [PDS Packet Formats](#3-pds-packet-formats)\n   - [3.1 RUD Request (Type 0x01)](#31-rud-request-type-0x01-12-bytes)\n   - [3.2 ROD Request (Type 0x02)](#32-rod-request-type-0x02-12-bytes)\n   - [3.3 RUDI Request (Type 0x04)](#33-rudi-request-type-0x04-6-bytes)\n   - [3.4 RUDI Response (Type 0x05)](#34-rudi-response-type-0x05-6-bytes)\n   - [3.5 UUD Request (Type 0x06)](#35-uud-request-type-0x06-6-bytes)\n   - [3.6 ACK (Type 0x07)](#36-ack-type-0x07-12-bytes)\n   - [3.7 ACK_CC (Type 0x08)](#37-ack_cc-type-0x08-28-bytes)\n   - [3.8 ACK_CCX (Type 0x09)](#38-ack_ccx-type-0x09-44-bytes)\n   - [3.9 NACK (Type 0x0A)](#39-nack-type-0x0a-12-bytes)\n   - [3.10 NACK_CCX (Type 0x0C)](#310-nack_ccx-type-0x0c-28-bytes)\n   - [3.11 Control Packet (Type 0x0B)](#311-control-packet-type-0x0b-12-bytes)\n4. [Cross-References](#4-cross-references)\n5. [References](#5-references)\n\n---\n\n## 1. Overview\n\nThe Packet Delivery Sublayer (PDS) provides reliable and unreliable packet delivery services for Ultra Ethernet+. PDS sits between the network layer (UE+ L2 header) and the semantic layer (SES).\n\n### Delivery Modes\n\n| Mode | Type Values | Reliability | Ordering | Use Case |\n|------|-------------|-------------|----------|----------|\n| RUD | 0x01 | Reliable | Unordered | General RDMA |\n| ROD | 0x02 | Reliable | Ordered | Streaming, multi-packet |\n| RUDI | 0x04, 0x05 | Reliable | Unordered | Idempotent operations |\n| UUD | 0x06 | Unreliable | Unordered | Best-effort traffic |\n\n### Request/Response Relationships\n\n```\nPDS Request/Response Relationships:\n┌─────────────────────────────────────────────────────────────────┐\n│                                                                 │\n│  UUD Request (0x06) ──────────────────────→ (no response)       │\n│                                                                 │\n│  RUDI Request (0x04) ─────────────────────→ RUDI Response (0x05)│\n│                       └───────────────────→ NACK (0x0A)         │\n│                                                                 │\n│  RUD Request (0x01) ──┬───────────────────→ ACK (0x07)          │\n│                       ├───────────────────→ ACK_CC (0x08)       │\n│                       ├───────────────────→ ACK_CCX (0x09)      │\n│                       ├───────────────────→ NACK (0x0A)         │\n│                       └───────────────────→ NACK_CCX (0x0C)     │\n│                                                                 │\n│  ROD Request (0x02) ──┴───────────────────→ (same as RUD)       │\n│                                                                 │\n│  Control Packet (0x0B) ───────────────────→ (varies by subtype) │\n│                                                                 │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n---\n\n## 2. PDS Prologue\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/prologue.ksy`\n\nAll PDS packets begin with a 2-byte prologue containing the packet type and flags.\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0                        | Byte 1                        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| type[4:0] | next_hdr/ctl[3:0] | flags[6:0]                    |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n### PDS Type Values\n\n| PDS Type | Value | Description |\n|----------|-------|-------------|\n| Reserved | 0 | Reserved |\n| TSS | 1 | Transport Security (encryption) |\n| RUD Request | 2 | Reliable Unordered Delivery |\n| ROD Request | 3 | Reliable Ordered Delivery |\n| RUDI Request | 4 | Reliable Unordered Immediate |\n| RUDI Response | 5 | RUDI response |\n| UUD Request | 6 | Unreliable Unordered Delivery |\n| ACK | 7 | Acknowledgment |\n| ACK_CC | 8 | ACK with congestion control |\n| ACK_CCX | 9 | ACK with extended CC |\n| NACK | 10 | Negative acknowledgment |\n| CP | 11 | Control packet |\n| NACK_CCX | 12 | NACK with extended CC |\n| RUD_CC_REQ | 13 | RUD with CC state |\n| ROD_CC_REQ | 14 | ROD with CC state |\n\n---\n\n## 3. PDS Packet Formats\n\n### Format Summary\n\n| Type | Format | File | Size | Description |\n|------|--------|------|------|-------------|\n| 0x01 | RUD Request | `rud_rod_request.ksy` | 12 bytes | Reliable Unordered Delivery |\n| 0x02 | ROD Request | `rud_rod_request.ksy` | 12 bytes | Reliable Ordered Delivery |\n| 0x04 | RUDI Request | `rudi_request_response.ksy` | 6 bytes | Reliable Unordered Immediate |\n| 0x05 | RUDI Response | `rudi_request_response.ksy` | 6 bytes | RUDI response |\n| 0x06 | UUD Request | `uud_request.ksy` | 6 bytes | Unreliable Unordered Delivery |\n| 0x07 | ACK | `rud_rod_ack.ksy` | 12 bytes | Acknowledgment |\n| 0x08 | ACK_CC | `ack_cc.ksy` | 28 bytes | ACK with CC state |\n| 0x09 | ACK_CCX | `ack_ccx.ksy` | 44 bytes | ACK with extended CC |\n| 0x0A | NACK | `nack.ksy` | 12 bytes | Negative acknowledgment |\n| 0x0B | CP | `rud_rod_cp.ksy` | 12 bytes | Control packet (10 subtypes) |\n| 0x0C | NACK_CCX | `nack_ccx.ksy` | 28 bytes | NACK with extended CC |\n\n---\n\n### 3.1 RUD Request (Type 0x01, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_request.ksy`  \n**Related Formats**: [ROD Request (3.2)](#32-rod-request-type-0x02-12-bytes) | [ACK (3.6)](#36-ack-type-0x07-12-bytes) | [NACK (3.9)](#39-nack-type-0x0a-12-bytes)\n\n#### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |nxt|flg|       clear_psn_offset |         PSN [31:0]    →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|r|a|s|rsvd|\n       | (5 bits)|(4 bit)| (2) |t|r|y|(2) |\n```\n\n#### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x01 (RUD) | Must be 0x01 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 2 | 1[6:5] | Reserved | Must be 0 |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.ar | 1 | 1[3] | ACK request | 0=no ACK, 1=request ACK |\n| flags.syn | 1 | 1[2] | PDC establishment | 0=normal, 1=SYN |\n| flags.rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n| clear_psn_offset | 16 | 2-3 | CLEAR_PSN relative to PSN | Unsigned offset |\n| psn | 32 | 4-7 | Packet Sequence Number | 32-bit, wraps |\n| spdcid | 16 | 8-9 | Source PDCID | Valid PDCID |\n| dpdcid | 16 | 10-11 | Destination PDCID | See note below |\n\n#### Field Notes\n\n**dpdcid Interpretation** (depends on `syn` flag):\n- `syn=0`: Destination PDCID for established PDC\n- `syn=1`: `{pdc_info[3:0], psn_offset[11:0]}` for PDC establishment\n  - `pdc_info[0]`: use_rsv_pdc (1=reserved pool, 0=shared pool)\n  - `pdc_info[3:1]`: Reserved\n  - `psn_offset[11:0]`: Difference between PSN and Start_PSN\n\n**clear_psn_offset**: Computed as `CLEAR_PSN = PSN - clear_psn_offset`. Indicates the highest PSN that has been delivered to SES at the source.\n\n#### Protocol Behavior\n\n**Delivery Mode**: RUD (Reliable Unordered Delivery) provides reliable packet delivery without ordering guarantees. Packets may be delivered to SES out of order.\n\n**State Machine**: RUD operates within the PDC (Packet Delivery Channel) state machine defined in Section 3.5.7.\n\n**Transmission Rules**:\n1. Source assigns monotonically increasing PSN to each packet\n2. `ar` flag SHOULD be set periodically (per `ack_request_interval`)\n3. `retx` flag set when retransmitting due to timeout or NACK\n4. `syn` flag set only for first packet establishing new PDC\n\n**Receiver Processing**:\n1. Validate PDCID and PSN\n2. If PSN is new: deliver to SES immediately (no ordering)\n3. If PSN is duplicate: discard, optionally send ACK\n4. If `ar=1`: generate ACK, ACK_CC, or ACK_CCX response\n\n**Timing Constraints**:\n- Retransmit timeout: Implementation-defined (typically RTT-based)\n- ACK coalescing: Up to `ack_coalesce_count` packets\n\n**Reference**: UE Spec v1.0.1, Table 3-33, Section 3.5.10.3, Page 256\n\n---\n\n### 3.2 ROD Request (Type 0x02, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_request.ksy`  \n**Related Formats**: [RUD Request (3.1)](#31-rud-request-type-0x01-12-bytes) | [ACK (3.6)](#36-ack-type-0x07-12-bytes) | [NACK (3.9)](#39-nack-type-0x0a-12-bytes)\n\n#### Wire Format\n\nIdentical to RUD Request (Section 3.1) with `type = 0x02`.\n\n#### Field Definitions\n\nSame as RUD Request. Only `type` field differs.\n\n#### Protocol Behavior\n\n**Delivery Mode**: ROD (Reliable Ordered Delivery) provides reliable packet delivery with strict ordering guarantees. Packets are delivered to SES in PSN order.\n\n**Key Difference from RUD**: ROD receiver MUST buffer out-of-order packets and deliver to SES only when all preceding PSNs have been received.\n\n**Ordering Guarantee**:\n- Receiver maintains expected PSN\n- Out-of-order packets are buffered (not delivered)\n- When gap is filled, buffered packets delivered in order\n- Head-of-line blocking possible if packet lost\n\n**Use Cases**:\n- Multi-packet messages requiring in-order delivery\n- Streaming data with ordering requirements\n- Operations where partial delivery is not acceptable\n\n**Reference**: UE Spec v1.0.1, Table 3-33, Section 3.5.10.3, Page 256\n\n---\n\n### 3.3 RUDI Request (Type 0x04, 6 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rudi_request_response.ksy`  \n**Related Formats**: [RUDI Response (3.4)](#34-rudi-response-type-0x05-6-bytes) | [NACK (3.9)](#39-nack-type-0x0a-12-bytes)\n\n#### Wire Format\n\n```\nByte:    0       1       2       3       4       5\n     +-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  |         pkt_id [31:0]     |\n     +-------+-------+-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|r|retx|rsvd|\n       | (5 bits)|(4 bit)| (1) |m| (1)|(4) |\n```\n\n#### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x04 (RUDI Request) | Must be 0x04 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.rsvd_m | 1 | 1[5] | Reserved (m for response) | Must be 0 for request |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.rsvd | 4 | 1[3:0] | Reserved | Must be 0 |\n| pkt_id | 32 | 2-5 | Packet Identifier | Locally unique |\n\n#### Protocol Behavior\n\n**Delivery Mode**: RUDI (Reliable Unordered Delivery with Idempotence) provides reliable delivery for idempotent operations without PDC context.\n\n**Key Characteristics**:\n- Uses packet ID instead of sequence number\n- No PDC (Packet Delivery Context) required\n- Idempotent: safe to retry without side effects\n- Smaller header (6 bytes vs 12 bytes for RUD/ROD)\n\n**Idempotence Guarantee**:\n- Receiver tracks recently processed pkt_ids\n- Duplicate pkt_ids are detected and response re-sent\n- No state corruption from retransmissions\n\n**Use Cases**:\n- Small, self-contained operations\n- Stateless request/response patterns\n- Operations where retry is safe (reads, idempotent writes)\n\n**Reference**: UE Spec v1.0.1, Table 3-39, Section 3.5.10.9, Page 262\n\n---\n\n### 3.4 RUDI Response (Type 0x05, 6 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rudi_request_response.ksy`  \n**Related Formats**: [RUDI Request (3.3)](#33-rudi-request-type-0x04-6-bytes)\n\n#### Wire Format\n\nIdentical to RUDI Request with `type = 0x05` and `flags.m` valid.\n\n#### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x05 (RUDI Response) | Must be 0x05 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.m | 1 | 1[5] | ECN marked | 1 if request was ECN marked |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.rsvd | 4 | 1[3:0] | Reserved | Must be 0 |\n| pkt_id | 32 | 2-5 | Packet Identifier | Echoed from request |\n\n#### Protocol Behavior\n\n**Response Generation**:\n1. Receiver processes RUDI Request\n2. Generates RUDI Response with same pkt_id\n3. Sets `m` flag if request packet was ECN marked\n\n**Reference**: UE Spec v1.0.1, Table 3-39, Section 3.5.10.9, Page 262\n\n---\n\n### 3.5 UUD Request (Type 0x06, 6 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/uud_request.ksy`  \n**Related Formats**: None (no response generated)\n\n#### Wire Format\n\n```\nByte:    0       1       2       3       4       5\n     +-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  |         pkt_id [31:0]     |\n     +-------+-------+-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr|     rsvd (7)    |\n       | (5 bits)|(4 bit)|                 |\n```\n\n#### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x06 (UUD) | Must be 0x06 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | Per Table 3-16 |\n| flags.rsvd | 7 | 1[6:0] | Reserved | Must be 0 |\n| pkt_id | 32 | 2-5 | Packet Identifier | Locally unique |\n\n#### Protocol Behavior\n\n**Delivery Mode**: UUD (Unreliable Unordered Delivery) provides best-effort delivery with no reliability guarantees.\n\n**Key Characteristics**:\n- No ACKs or NACKs generated\n- No retransmissions\n- Packet loss is acceptable\n- Lowest overhead delivery mode\n\n**Use Cases**:\n- Loss-tolerant traffic (video streaming, telemetry)\n- High-frequency updates where latest value matters\n- Multicast/broadcast scenarios\n\n**Reference**: UE Spec v1.0.1, Table 3-42, Section 3.5.10.12, Page 265\n\n---\n\n### 3.6 ACK (Type 0x07, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_ack.ksy`  \n**Related Formats**: [RUD Request (3.1)](#31-rud-request-type-0x01-12-bytes) | [ACK_CC (3.7)](#37-ack_cc-type-0x08-28-bytes)\n\n#### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  |   ack_psn_offset  |    probe_opaque     →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |   cack_psn    |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|m|r|p|req|rsvd|\n       | (5 bits)|(4 bit)| (1) | |t| |   |(1) |\n```\n\n#### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x07 (ACK) | Must be 0x07 |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | UET_HDR_NONE |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.m | 1 | 1[5] | ECN marked | 1 if any ACK'd packet was ECN marked |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.p | 1 | 1[3] | Probe response | 1 if responding to Probe CP |\n| flags.req | 2 | 1[2:1] | Request type | 0=RUD, 1=ROD |\n| flags.rsvd | 1 | 1[0] | Reserved | Must be 0 |\n| ack_psn_offset | 16 | 2-3 | Offset from CACK_PSN to ACK_PSN | Signed |\n| probe_opaque | 16 | 4-5 | Copied from Probe CP | Opaque value |\n| cack_psn | 32 | 6-9 | Cumulative ACK PSN | Highest in-order PSN |\n| spdcid | 16 | 10-11 | Source PDCID | Swapped from request |\n| dpdcid | 16 | 12-13 | Destination PDCID | Swapped from request |\n\n#### Protocol Behavior\n\n**ACK Generation**:\n1. Receiver tracks highest in-order PSN received (CACK_PSN)\n2. ACK generated when `ar` flag set in request, or periodically\n3. `m` flag set if any ACK'd packet had ECN marking\n\n**Cumulative ACK**:\n- `cack_psn` acknowledges all PSNs ≤ this value\n- Sender can free buffers for acknowledged packets\n- Enables sliding window flow control\n\n**Reference**: UE Spec v1.0.1, Table 3-35, Section 3.5.10.5, Page 258\n\n---\n\n### 3.7 ACK_CC (Type 0x08, 28 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/ack_cc.ksy`  \n**Related Formats**: [ACK (3.6)](#36-ack-type-0x07-12-bytes) | [ACK_CCX (3.8)](#38-ack_ccx-type-0x09-44-bytes) | [CMS Formats](packet_taxonomy_ue_cms_tss.md)\n\n#### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |                    ACK Header (12 bytes)                      |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |  (ACK cont'd) |cc_typ|cc_flg|  mpr  | sack_psn_offset       →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |              sack_bitmap [63:0]                               |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        24      25      26      27\n     +-------+-------+-------+-------+\n     |       ack_cc_state [63:0]     |\n     +-------+-------+-------+-------+\n```\n\n#### Field Definitions (CC Extension, bytes 12-27)\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| cc_type | 4 | 12[7:4] | CC algorithm type | Per Section 3.6.9 |\n| cc_flags | 4 | 12[3:0] | CC flags | Reserved, must be 0 |\n| mpr | 8 | 13 | Maximum PSN Range | Flow control window |\n| sack_psn_offset | 16 | 14-15 | Offset to SACK base PSN | Signed |\n| sack_bitmap | 64 | 16-23 | Selective ACK bitmap | 1=ACK'd, 0=not ACK'd |\n| ack_cc_state | 64 | 24-27 | CC state (per cc_type) | See Section 3.6.9 |\n\n#### CC Type Values\n\n| Value | Name | Description |\n|-------|------|-------------|\n| 0x0 | CC_NSCC | Network-Signaled Congestion Control |\n| 0x1 | CC_CREDIT | RCCC/TFC Credit-based CC |\n\n#### Protocol Behavior\n\n**Selective ACK (SACK)**:\n- `sack_bitmap` covers 64 PSNs starting at `CACK_PSN + sack_psn_offset`\n- Bit N = 1 means PSN (base + N) received\n- Enables efficient loss recovery without full retransmit\n\n**Congestion Control State**:\n- `ack_cc_state` interpretation depends on `cc_type`\n- For NSCC: Contains service_time, rcv_cwnd_pend, rcvd_bytes, ooo_count\n- For CREDIT: Contains credit information\n\n**Reference**: UE Spec v1.0.1, Table 3-36, Section 3.5.10.6, Page 259\n\n---\n\n### 3.8 ACK_CCX (Type 0x09, 44 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/ack_ccx.ksy`  \n**Related Formats**: [ACK_CC (3.7)](#37-ack_cc-type-0x08-28-bytes)\n\n#### Wire Format\n\nACK_CCX extends ACK_CC with additional 16 bytes for extended CC state.\n\n```\nBytes 0-27:  ACK_CC header (28 bytes)\nBytes 28-43: Extended CC state (16 bytes)\n```\n\n#### Additional Fields (bytes 28-43)\n\n| Field | Bits | Offset | Description |\n|-------|------|--------|-------------|\n| ack_ccx_state | 128 | 28-43 | Extended CC state |\n\n#### Protocol Behavior\n\n**Extended State**: ACK_CCX provides additional CC state for algorithms requiring more than 64 bits of feedback.\n\n**Reference**: UE Spec v1.0.1, Table 3-37, Section 3.5.10.7, Page 260\n\n---\n\n### 3.9 NACK (Type 0x0A, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/nack.ksy`  \n**Related Formats**: [RUD Request (3.1)](#31-rud-request-type-0x01-12-bytes) | [NACK_CCX (3.10)](#310-nack_ccx-type-0x0c-28-bytes)\n\n#### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |nxt|  flags  | nack_code |vendor_code|   nack_psn [31:0] →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |nxt_hdr| rsvd|m|r|nt|rsvd|\n       | (5 bits)|(4 bit)| (1) | |t|  |(3) |\n```\n\n#### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x0A (NACK) | Must be 0x0A |\n| next_hdr | 4 | 0[2:0]+1[7] | SES header type | UET_HDR_NONE |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.m | 1 | 1[5] | ECN marked | 1 if request was ECN marked |\n| flags.retx | 1 | 1[4] | Retransmit indicator | From request |\n| flags.nt | 1 | 1[3] | NACK type | 0=RUD/ROD, 1=RUDI |\n| flags.rsvd | 3 | 1[2:0] | Reserved | Must be 0 |\n| nack_code | 8 | 2 | NACK reason code | Per Table 3-59 |\n| vendor_code | 8 | 3 | Vendor-specific code | Optional |\n| nack_psn | 32 | 4-7 | NACK'd PSN or pkt_id | Depends on nt flag |\n| spdcid | 16 | 8-9 | Source PDCID | 0 if nt=1 or PDC failure |\n| dpdcid | 16 | 10-11 | Destination PDCID | 0 if nt=1 |\n\n#### NACK Codes (Table 3-59)\n\n| Code | Name | Description |\n|------|------|-------------|\n| 0x00 | UET_NO_PKT_BUF | No packet buffer available |\n| 0x01 | UET_TRIMMED | Packet was trimmed |\n| 0x02 | UET_NO_PDC_AVAIL | No PDC resources available |\n| 0x03 | UET_INV_DPDCID | Invalid destination PDCID |\n| 0x04 | UET_PDC_HDR_MISMATCH | PDC header mismatch |\n| 0x05 | UET_PSN_OOR_WINDOW | PSN outside expected window |\n| 0x06 | UET_PSN_GAP | PSN gap detected (packet loss) |\n\n#### Protocol Behavior\n\n**NACK Generation**:\n1. Receiver detects error condition (loss, resource exhaustion, etc.)\n2. Generates NACK with appropriate nack_code\n3. Sender receives NACK and takes corrective action\n\n**Sender Response to NACK**:\n- `UET_PSN_GAP`: Retransmit missing packets\n- `UET_NO_PKT_BUF`: Back off, retry later\n- `UET_NO_PDC_AVAIL`: PDC establishment failed, retry or abort\n\n**Reference**: UE Spec v1.0.1, Table 3-40, Section 3.5.10.10, Page 263\n\n---\n\n### 3.10 NACK_CCX (Type 0x0C, 28 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/nack_ccx.ksy`  \n**Related Formats**: [NACK (3.9)](#39-nack-type-0x0a-12-bytes)\n\n#### Wire Format\n\nNACK_CCX extends NACK with 16 bytes of CC state (similar to ACK_CC extension).\n\n```\nBytes 0-11:  NACK header (12 bytes)\nBytes 12-27: CC extension (16 bytes)\n```\n\n#### Protocol Behavior\n\n**Extended NACK**: NACK_CCX provides congestion control feedback along with the negative acknowledgment, enabling the sender to adjust its rate while handling the error.\n\n**Reference**: UE Spec v1.0.1, Table 3-41, Section 3.5.10.11, Page 264\n\n---\n\n### 3.11 Control Packet (Type 0x0B, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/pds/rud_rod_cp.ksy`  \n**Related Formats**: [RUD Request (3.1)](#31-rud-request-type-0x01-12-bytes) | [ACK (3.6)](#36-ack-type-0x07-12-bytes)\n\n#### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |type |ctl|  flags  |   probe_opaque    |         PSN [31:0]  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |    spdcid     |    dpdcid     |\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |  type   |ctl_typ| rsvd|i|r|a|s|rsvd|\n       | (5 bits)|(4 bit)| (1) |r|t|r|y|(2) |\n```\n\n#### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| type | 5 | 0[7:3] | PDS type = 0x0B (CP) | Must be 0x0B |\n| ctl_type | 4 | 0[2:0]+1[7] | Control packet subtype | 0-9 defined |\n| flags.rsvd | 1 | 1[6] | Reserved | Must be 0 |\n| flags.isrod | 1 | 1[5] | ROD indicator | 1=ROD, 0=RUD (for NOOP/Negotiation) |\n| flags.retx | 1 | 1[4] | Retransmit indicator | 0=original, 1=retransmit |\n| flags.ar | 1 | 1[3] | ACK request | 0=no ACK, 1=request ACK |\n| flags.syn | 1 | 1[2] | PDC establishment | 0=normal, 1=SYN |\n| flags.rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n| probe_opaque | 16 | 2-3 | Opaque value for Probe | Echoed in ACK |\n| psn | 32 | 4-7 | Packet Sequence Number | Some CPs consume PSN |\n| spdcid | 16 | 8-9 | Source PDCID | Valid PDCID |\n| dpdcid | 16 | 10-11 | Destination PDCID | Or {pdc_info, psn_offset} |\n\n#### Control Packet Subtypes\n\n| ctl_type | Name | Direction | Description |\n|----------|------|-----------|-------------|\n| 0 | NOOP | Either | No operation |\n| 1 | ACK_REQUEST | Src→Dst | Request ACK for specific PSN |\n| 2 | CLEAR_COMMAND | Init→Tgt | Clear guaranteed delivery state |\n| 3 | CLEAR_REQUEST | Tgt→Init | Request initiator to send clear |\n| 4 | CLOSE_COMMAND | Init→Tgt | PDC is being closed |\n| 5 | CLOSE_REQUEST | Tgt→Init | Request initiator to close PDC |\n| 6 | PROBE | Src→Dst | Request PDS ACK |\n| 7 | CREDIT | Dst→Src | Carry CC credit |\n| 8 | CREDIT_REQUEST | Src→Dst | Request credit |\n| 9 | NEGOTIATION | Either | PDC negotiation |\n\n#### Protocol Behavior\n\n**PDC Lifecycle**:\n- `CLOSE_COMMAND/REQUEST`: Graceful PDC teardown\n- `CLEAR_COMMAND/REQUEST`: Clear delivery state without closing\n\n**Flow Control**:\n- `CREDIT/CREDIT_REQUEST`: Credit-based flow control\n- `PROBE`: Solicit ACK for RTT measurement or liveness check\n\n**Reference**: UE Spec v1.0.1, Table 3-38, Section 3.5.10.8, Page 261\n\n---\n\n## 4. Cross-References\n\n### Related Documents\n\n| Document | Content |\n|----------|---------|\n| [packet_taxonomy.md](packet_taxonomy.md) | Master index |\n| [packet_taxonomy_ue_ses.md](packet_taxonomy_ue_ses.md) | SES formats (carried by PDS) |\n| [packet_taxonomy_ue_cms_tss.md](packet_taxonomy_ue_cms_tss.md) | CMS/TSS formats (CC state details) |\n| [packet_taxonomy_ue_link.md](packet_taxonomy_ue_link.md) | Link layer formats |\n\n### Datamodel Files\n\n| File | Description |\n|------|-------------|\n| `prologue.ksy` | PDS prologue (2 bytes) |\n| `rud_rod_request.ksy` | RUD/ROD request (12 bytes) |\n| `rudi_request_response.ksy` | RUDI request/response (6 bytes) |\n| `uud_request.ksy` | UUD request (6 bytes) |\n| `rud_rod_ack.ksy` | ACK (12 bytes) |\n| `ack_cc.ksy` | ACK_CC (28 bytes) |\n| `ack_ccx.ksy` | ACK_CCX (44 bytes) |\n| `nack.ksy` | NACK (12 bytes) |\n| `nack_ccx.ksy` | NACK_CCX (28 bytes) |\n| `rud_rod_cp.ksy` | Control Packet (12 bytes) |\n\n---\n\n## 5. References\n\n- UE Specification v1.0.1, Chapter 3 (Transport Layer)\n- UE Specification v1.0.1, Section 3.5 (PDS)\n- UE Specification v1.0.1, Tables 3-33 through 3-42\n"
            },
            "output": "Wrote file successfully.",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy_ue_pds.md",
            "metadata": {
              "diagnostics": {},
              "filepath": "/home/matkins/CN7000/analysis/packet_taxonomy_ue_pds.md",
              "exists": false,
              "truncated": false
            },
            "time": {
              "start": 1769125314812,
              "end": 1769125314946
            }
          }
        },
        {
          "id": "prt_be8160184001QlEkZJLoM4sVPi",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be813e8bc001bg8fTRiV9VqOBl",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 93385,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be8160223001vgefkF0MuKuemj",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769125315108,
          "completed": 1769125330239
        },
        "parentID": "msg_be80bfd40001700UtaNDuhl2uY",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 93393,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be8160779001sAfnU0OR0j2NDQ",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be8160223001vgefkF0MuKuemj",
          "type": "step-start"
        },
        {
          "id": "prt_be8163cca001r4v1yXU2ZkkjdR",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be8160223001vgefkF0MuKuemj",
          "type": "tool",
          "callID": "toolu_01GP4hgC9Zrwx5SRJiGSz6ku",
          "tool": "todowrite",
          "state": {
            "status": "completed",
            "input": {
              "todos": [
                {
                  "id": "p2-0-1",
                  "content": "Phase 2.0: Create master document structure",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "p2-0-2",
                  "content": "Phase 2.0: Extract PDS content to packet_taxonomy_ue_pds.md",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p2-0-3",
                  "content": "Phase 2.0: Extract SES content to packet_taxonomy_ue_ses.md",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "p2-0-4",
                  "content": "Phase 2.0: Extract Cornelis content to packet_taxonomy_cornelis.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-0-5",
                  "content": "Phase 2.0: Extract RoCEv2 content to packet_taxonomy_rocev2.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-0-6",
                  "content": "Phase 2.0: Extract HSI content to packet_taxonomy_hsi.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-0-7",
                  "content": "Phase 2.0: Extract UALink content to packet_taxonomy_ualink.md",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p2-0-8",
                  "content": "Phase 2.0: Refactor master document with index",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-a",
                  "content": "Phase 2a: Create CMS formats in packet_taxonomy_ue_cms_tss.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-b",
                  "content": "Phase 2b: Add TSS formats to packet_taxonomy_ue_cms_tss.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-c",
                  "content": "Phase 2c: Expand RoCEv2 with BTH, RETH, AETH, AtomicETH",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-d",
                  "content": "Phase 2d: Create Link Layer formats in packet_taxonomy_ue_link.md",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p2-e",
                  "content": "Phase 2e: Expand Cornelis with CSIG+, VxLAN+, Collective, ScaleUp",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p2-f",
                  "content": "Phase 2f: Expand HSI with all formats",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-final",
                  "content": "Phase 2 Final: Validation, work items, change log",
                  "status": "pending",
                  "priority": "high"
                }
              ]
            },
            "output": "[\n  {\n    \"id\": \"p2-0-1\",\n    \"content\": \"Phase 2.0: Create master document structure\",\n    \"status\": \"in_progress\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-0-2\",\n    \"content\": \"Phase 2.0: Extract PDS content to packet_taxonomy_ue_pds.md\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-0-3\",\n    \"content\": \"Phase 2.0: Extract SES content to packet_taxonomy_ue_ses.md\",\n    \"status\": \"in_progress\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-0-4\",\n    \"content\": \"Phase 2.0: Extract Cornelis content to packet_taxonomy_cornelis.md\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-0-5\",\n    \"content\": \"Phase 2.0: Extract RoCEv2 content to packet_taxonomy_rocev2.md\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-0-6\",\n    \"content\": \"Phase 2.0: Extract HSI content to packet_taxonomy_hsi.md\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-0-7\",\n    \"content\": \"Phase 2.0: Extract UALink content to packet_taxonomy_ualink.md\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p2-0-8\",\n    \"content\": \"Phase 2.0: Refactor master document with index\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-a\",\n    \"content\": \"Phase 2a: Create CMS formats in packet_taxonomy_ue_cms_tss.md\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-b\",\n    \"content\": \"Phase 2b: Add TSS formats to packet_taxonomy_ue_cms_tss.md\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-c\",\n    \"content\": \"Phase 2c: Expand RoCEv2 with BTH, RETH, AETH, AtomicETH\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-d\",\n    \"content\": \"Phase 2d: Create Link Layer formats in packet_taxonomy_ue_link.md\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p2-e\",\n    \"content\": \"Phase 2e: Expand Cornelis with CSIG+, VxLAN+, Collective, ScaleUp\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p2-f\",\n    \"content\": \"Phase 2f: Expand HSI with all formats\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-final\",\n    \"content\": \"Phase 2 Final: Validation, work items, change log\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  }\n]",
            "title": "14 todos",
            "metadata": {
              "todos": [
                {
                  "id": "p2-0-1",
                  "content": "Phase 2.0: Create master document structure",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "p2-0-2",
                  "content": "Phase 2.0: Extract PDS content to packet_taxonomy_ue_pds.md",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p2-0-3",
                  "content": "Phase 2.0: Extract SES content to packet_taxonomy_ue_ses.md",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "p2-0-4",
                  "content": "Phase 2.0: Extract Cornelis content to packet_taxonomy_cornelis.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-0-5",
                  "content": "Phase 2.0: Extract RoCEv2 content to packet_taxonomy_rocev2.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-0-6",
                  "content": "Phase 2.0: Extract HSI content to packet_taxonomy_hsi.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-0-7",
                  "content": "Phase 2.0: Extract UALink content to packet_taxonomy_ualink.md",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p2-0-8",
                  "content": "Phase 2.0: Refactor master document with index",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-a",
                  "content": "Phase 2a: Create CMS formats in packet_taxonomy_ue_cms_tss.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-b",
                  "content": "Phase 2b: Add TSS formats to packet_taxonomy_ue_cms_tss.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-c",
                  "content": "Phase 2c: Expand RoCEv2 with BTH, RETH, AETH, AtomicETH",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-d",
                  "content": "Phase 2d: Create Link Layer formats in packet_taxonomy_ue_link.md",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p2-e",
                  "content": "Phase 2e: Expand Cornelis with CSIG+, VxLAN+, Collective, ScaleUp",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p2-f",
                  "content": "Phase 2f: Expand HSI with all formats",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-final",
                  "content": "Phase 2 Final: Validation, work items, change log",
                  "status": "pending",
                  "priority": "high"
                }
              ],
              "truncated": false
            },
            "time": {
              "start": 1769125330126,
              "end": 1769125330227
            }
          }
        },
        {
          "id": "prt_be8163d34001IN2jnEEP2tloVY",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be8160223001vgefkF0MuKuemj",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 93393,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be8163da8001q1Sp8HuWYGWZqM",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769125330344,
          "completed": 1769125447897
        },
        "parentID": "msg_be80bfd40001700UtaNDuhl2uY",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 94157,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be81641fe001xlEEIMgMJOiL9k",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be8163da8001q1Sp8HuWYGWZqM",
          "type": "step-start"
        },
        {
          "id": "prt_be8180851001eHvjLvhaIlQ5IS",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be8163da8001q1Sp8HuWYGWZqM",
          "type": "tool",
          "callID": "toolu_01XXT5JMgXzdLgXXz9fKDPa8",
          "tool": "write",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy_ue_ses.md",
              "content": "# PMR Packet Taxonomy: UE+ SES Formats\n\n**Parent Document**: [packet_taxonomy.md](packet_taxonomy.md)  \n**Scope**: Ultra Ethernet+ Semantic Sublayer (SES) packet formats  \n**Datamodel Directory**: `datamodel/protocols/ue/transport/ses/`  \n**Last Updated**: 2026-01-22\n\n---\n\n## Table of Contents\n\n1. [Overview](#1-overview)\n2. [SES Opcodes](#2-ses-opcodes)\n3. [SES Packet Formats](#3-ses-packet-formats)\n   - [3.1 Standard Request SOM=1 (Table 3-8)](#31-standard-request-som1-table-3-8-44-bytes)\n   - [3.2 Standard Request SOM=0 (Table 3-9)](#32-standard-request-som0-table-3-9-16-bytes)\n   - [3.3 Response (Table 3-11)](#33-response-table-3-11-16-bytes)\n   - [3.4 Response with Data (Table 3-12)](#34-response-with-data-table-3-12-24-bytes)\n   - [3.5 Small Message (Figure 3-14)](#35-small-message-figure-3-14-32-bytes)\n   - [3.6 Rendezvous Extension (Figure 3-15)](#36-rendezvous-extension-figure-3-15-32-bytes)\n   - [3.7 Atomic Extension (Figure 3-16)](#37-atomic-extension-figure-3-16-8-bytes)\n4. [Cross-References](#4-cross-references)\n5. [References](#5-references)\n\n---\n\n## 1. Overview\n\nThe Semantic Sublayer (SES) provides the semantic meaning for Ultra Ethernet+ operations. SES headers are carried within PDS packets and define the operation type, addressing, and data transfer parameters.\n\n### SES Header Types\n\n| next_hdr Value | Header Type | Size | Description |\n|----------------|-------------|------|-------------|\n| 0x0 | Standard Header SOM=1 | 44 bytes | Start of message |\n| 0x1 | Standard Header SOM=0 | 16 bytes | Continuation |\n| 0x2 | Optimized Non-Matching | Variable | Optimized format |\n| 0x3 | Small Message/RMA | 32 bytes | Single-packet optimized |\n| 0x4 | Response | 16 bytes | Standard response |\n| 0x5 | Response with Data | 24 bytes | Data-carrying response |\n| 0x6 | Optimized Response | 16 bytes | Optimized format |\n\n### Request/Response Relationships\n\n```\nSES Request/Response Relationships:\n┌─────────────────────────────────────────────────────────────────┐\n│                                                                 │\n│  Standard Request ────┬───────────────────→ Response            │\n│  (SOM=1, 44B)         └───────────────────→ Response w/Data     │\n│       │                                                         │\n│       └──→ Continuation (SOM=0, 16B)                            │\n│                                                                 │\n│  Small Message (32B) ─────────────────────→ Response            │\n│                                                                 │\n│  + Atomic Extension (8B) ─────────────────→ Response w/Data     │\n│                                             (for fetching ops)  │\n│                                                                 │\n│  + Rendezvous Extension (32B) ────────────→ (target pulls data) │\n│                                                                 │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n---\n\n## 2. SES Opcodes\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/opcodes.ksy`\n\n### Request Opcodes (Table 3-17)\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Tagged Send | 0x00 | Send with tag matching |\n| RMA Write | 0x01 | Remote memory write |\n| RMA Read | 0x02 | Remote memory read |\n| Atomic Write | 0x03 | Atomic memory write |\n| Atomic Read | 0x04 | Atomic memory read |\n| Atomic CAS | 0x05 | Compare-and-swap |\n| Deferrable Send | 0x06 | Deferrable send |\n| Ready to Restart | 0x07 | Restart notification |\n| Small Message | 0x08 | Small message (32B header) |\n| Small RMA Write | 0x09 | Small RMA write |\n| Small RMA Read | 0x0A | Small RMA read |\n| Small Atomic Write | 0x0B | Small atomic write |\n| Small Atomic Read | 0x0C | Small atomic read |\n| Small Atomic CAS | 0x0D | Small atomic CAS |\n\n### Response Opcodes (Table 3-18)\n\n| Opcode | Value | Description |\n|--------|-------|-------------|\n| Response | 0x00 | Standard response |\n| Response with Data | 0x01 | Response carrying data |\n| Optimized Response | 0x02 | Optimized format |\n| NACK | 0x03 | Negative acknowledgment |\n\n---\n\n## 3. SES Packet Formats\n\n### Format Summary\n\n| Table/Figure | Format | File | Size | Description |\n|--------------|--------|------|------|-------------|\n| Table 3-8 | Standard Request (SOM=1) | `standard_request_som1.ksy` | 44 bytes | Start of message |\n| Table 3-9 | Standard Request (SOM=0) | `standard_request_som0.ksy` | 16 bytes | Continuation |\n| Table 3-11 | Response | `response.ksy` | 16 bytes | Standard response |\n| Table 3-12 | Response with Data | `response_with_data.ksy` | 24 bytes | Data-carrying response |\n| Figure 3-14 | Small Message | `small_message.ksy` | 32 bytes | Single-packet optimized |\n| Figure 3-15 | Rendezvous Extension | `rendezvous_extension.ksy` | 32 bytes | Large message protocol |\n| Figure 3-16 | Atomic Extension | `atomic_extension.ksy` | 8 bytes | Atomic operations |\n\n---\n\n### 3.1 Standard Request SOM=1 (Table 3-8, 44 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/standard_request_som1.ksy`  \n**Related Formats**: [Standard Request SOM=0 (3.2)](#32-standard-request-som0-table-3-9-16-bytes) | [Response (3.3)](#33-response-table-3-11-16-bytes)\n\n#### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |rs|opcode |v|dc|ie|rl|hd|eo|so|    message_id     | ri_gen  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |rsvd|pid_on_fep |rsvd| resource_idx  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |                    buffer_offset [63:0]                       |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        24      25      26      27      28      29      30      31\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |        initiator [31:0]       |   match_bits / memory_key    →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        32      33      34      35      36      37      38      39\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |  (match_bits cont'd) [63:0]   |       header_data [63:0]     →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        40      41      42      43\n     +-------+-------+-------+-------+\n   → | (hdr_data)    | request_length|\n     +-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |rsvd |  opcode |v|dc|ie|rl|hd|eo|so|\n       | (2) | (6 bits)|r| | | | | | | |\n```\n\n#### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| rsvd | 2 | 0[7:6] | Reserved | Must be 0 |\n| opcode | 6 | 0[5:0] | Operation code | Per Table 3-17 |\n| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n| dc | 1 | 1[5] | Delivery Complete | Defer response until globally observable |\n| ie | 1 | 1[4] | Initiator Error | Error at initiator |\n| rel | 1 | 1[3] | Relative addressing | 0=absolute, 1=relative |\n| hd | 1 | 1[2] | Header Data present | 1=header_data valid |\n| eom | 1 | 1[1] | End of Message | 1=last packet |\n| som | 1 | 1[0] | Start of Message | Must be 1 for this format |\n| message_id | 16 | 2-3 | Message identifier | 0=reserved (invalid) |\n| ri_generation | 8 | 4 | Resource Index generation | For buffer exhaustion recovery |\n| job_id | 24 | 5-7 | Job Identifier | Matches VXLAN VNI size |\n| rsvd | 4 | 8[7:4] | Reserved | Must be 0 |\n| pid_on_fep | 12 | 8[3:0]+9 | Process ID on FEP | Target process |\n| rsvd | 4 | 10[7:4] | Reserved | Must be 0 |\n| resource_index | 12 | 10[3:0]+11 | Resource Index | Target resource |\n| buffer_offset | 64 | 12-19 | Buffer offset | Or restart token for deferrable |\n| initiator | 32 | 20-23 | Initiator ID | For tagged matching |\n| match_bits | 64 | 24-31 | Match bits / Memory key | Dual-purpose field |\n| header_data | 64 | 32-39 | Header data | Completion data (if hd=1) |\n| request_length | 32 | 40-43 | Request length | Bytes to transfer |\n\n#### Field Notes\n\n**match_bits / memory_key Interpretation**:\n- For tagged operations (sends): Match bits for receive queue matching\n- For RMA operations (reads, writes): Memory key for authorization\n\n**buffer_offset Special Uses**:\n- For deferrable sends: Contains restart token (upper 32b initiator, lower 32b target)\n- For FI_MR_VIRT_ADDR: Contains absolute virtual address\n\n#### Protocol Behavior\n\n**Message Framing**:\n- `som=1, eom=1`: Single-packet message\n- `som=1, eom=0`: First packet of multi-packet message\n- Continuation packets use SOM=0 format (Table 3-9)\n\n**Addressing Modes**:\n- `rel=0` (Absolute): {JobID, PIDonFEP, resource_index} identifies target\n- `rel=1` (Relative): Addressing relative to connection context\n\n**Delivery Complete (dc)**:\n- When `dc=1`: Response deferred until data globally observable\n- Matches FI_DELIVERY_COMPLETE libfabric option\n\n**Reference**: UE Spec v1.0.1, Table 3-8, Section 3.4.2.1, Page 158\n\n---\n\n### 3.2 Standard Request SOM=0 (Table 3-9, 16 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/standard_request_som0.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.1)](#31-standard-request-som1-table-3-8-44-bytes)\n\n#### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |rs|opcode |v|dc|ie|rl|hd|eo|so|    message_id     | ri_gen  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |       message_offset [31:0]          |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n#### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| rsvd | 2 | 0[7:6] | Reserved | Must be 0 |\n| opcode | 6 | 0[5:0] | Operation code | Same as SOM=1 packet |\n| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n| dc | 1 | 1[5] | Delivery Complete | Same as SOM=1 |\n| ie | 1 | 1[4] | Initiator Error | Error at initiator |\n| rel | 1 | 1[3] | Relative addressing | Same as SOM=1 |\n| hd | 1 | 1[2] | Header Data present | Ignored for SOM=0 |\n| eom | 1 | 1[1] | End of Message | 1=last packet |\n| som | 1 | 1[0] | Start of Message | Must be 0 for this format |\n| message_id | 16 | 2-3 | Message identifier | Same as SOM=1 packet |\n| ri_generation | 8 | 4 | Resource Index generation | Same as SOM=1 |\n| job_id | 24 | 5-7 | Job Identifier | Same as SOM=1 |\n| message_offset | 32 | 8-11 | Offset within message | Byte offset from start |\n\n#### Protocol Behavior\n\n**Continuation Packets**:\n- Used for packets 2..N of multi-packet messages\n- `message_offset` indicates position within overall message\n- Target uses offset to place data correctly in buffer\n\n**Packet Ordering**:\n- ROD delivery: Packets delivered in PSN order\n- RUD delivery: Packets may arrive out of order; target reassembles using message_offset\n\n**Reference**: UE Spec v1.0.1, Table 3-9, Section 3.4.2.1, Page 159\n\n---\n\n### 3.3 Response (Table 3-11, 16 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/response.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.1)](#31-standard-request-som1-table-3-8-44-bytes) | [Response with Data (3.4)](#34-response-with-data-table-3-12-24-bytes)\n\n#### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     | list|opcode |v| return_code |    message_id     | ri_gen  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |       modified_length [31:0]         |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n\nByte 0-1 Detail:\n  Bit:  7 6 5 4 3 2 1 0 | 7 6 5 4 3 2 1 0\n       |list |  opcode |v| return_code   |\n       | (2) | (6 bits)|r|   (6 bits)    |\n```\n\n#### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| list | 2 | 0[7:6] | List indicator | 0=expected, 1=unexpected |\n| opcode | 6 | 0[5:0] | Response opcode | Per Table 3-18 |\n| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n| return_code | 6 | 1[5:0] | Return code | Per Table 3-19 |\n| message_id | 16 | 2-3 | Message identifier | From original request |\n| ri_generation | 8 | 4 | Resource Index generation | New generation on mismatch |\n| job_id | 24 | 5-7 | Job Identifier | From original request |\n| modified_length | 32 | 8-11 | Modified length | Bytes actually transferred |\n| rsvd | 32 | 12-15 | Reserved | Must be 0 |\n\n#### Return Codes (Table 3-19)\n\n| Code | Name | Description |\n|------|------|-------------|\n| 0x00 | RC_OK | Success |\n| 0x01 | RC_NO_MATCH | No matching buffer found |\n| 0x02 | RC_BUFFER_TOO_SMALL | Target buffer too small |\n| 0x03 | RC_AUTHORIZATION_FAILURE | Memory key mismatch |\n| 0x04 | RC_INVALID_OPERATION | Invalid operation |\n| 0x05 | RC_RESOURCE_EXHAUSTION | Resource exhaustion |\n| 0x06 | RC_GENERATION_MISMATCH | RI generation mismatch |\n| 0x07 | RC_TRUNCATED | Message truncated |\n\n#### Protocol Behavior\n\n**Response Generation**:\n1. Target processes request\n2. Generates response with appropriate return_code\n3. `modified_length` indicates actual bytes transferred (may be < request_length)\n\n**List Indicator**:\n- `list=0`: Payload delivered to expected list (matched posted receive)\n- `list=1`: Payload delivered to unexpected list (no matching receive)\n\n**Reference**: UE Spec v1.0.1, Table 3-11, Section 3.4.2.5, Page 167\n\n---\n\n### 3.4 Response with Data (Table 3-12, 24 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/response_with_data.ksy`  \n**Related Formats**: [Response (3.3)](#33-response-table-3-11-16-bytes)\n\n#### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     | list|opcode |v| return_code | response_msg_id   | rsvd    →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |read_req_msg_id|rs|payload_len      →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |       modified_length [31:0]  |       message_offset [31:0]  |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n#### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| list | 2 | 0[7:6] | List indicator | 0=expected, 1=unexpected |\n| opcode | 6 | 0[5:0] | Response opcode | Per Table 3-18 |\n| version | 2 | 1[7:6] | Protocol version | 0 for v1.0.1 |\n| return_code | 6 | 1[5:0] | Return code | Per Table 3-19 |\n| response_message_id | 16 | 2-3 | Response message ID | For this response |\n| rsvd | 8 | 4 | Reserved | Must be 0 |\n| job_id | 24 | 5-7 | Job Identifier | From original request |\n| read_request_message_id | 16 | 8-9 | Original request msg ID | Links to request |\n| rsvd | 2 | 10[7:6] | Reserved | Must be 0 |\n| payload_length | 14 | 10[5:0]+11 | Payload in this packet | Max 16383 bytes |\n| modified_length | 32 | 12-15 | Total bytes transferred | Across all packets |\n| message_offset | 32 | 16-19 | Offset in response | For multi-packet responses |\n| rsvd | 32 | 20-23 | Reserved | Must be 0 |\n\n#### Protocol Behavior\n\n**Use Cases**:\n- RDMA Read responses (returning requested data)\n- Fetching atomic responses (returning original value)\n\n**Multi-Packet Responses**:\n- `message_offset` indicates position within overall response\n- `payload_length` indicates data in this specific packet\n- `modified_length` is total across all response packets\n\n**Reference**: UE Spec v1.0.1, Table 3-12, Section 3.4.2.5, Page 168\n\n---\n\n### 3.5 Small Message (Figure 3-14, 32 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/small_message.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.1)](#31-standard-request-som1-table-3-8-44-bytes) | [Response (3.3)](#33-response-table-3-11-16-bytes)\n\n#### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |opcode |v|dc|ie|rl|hd|eo|so|rs| request_length  | ri_gen  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |      job_id [23:0]    |rsvd|pid_on_fep |rsvd| resource_idx  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |        initiator [31:0]       |        match_bits [63:0]     →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        24      25      26      27      28      29      30      31\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |  (match_bits cont'd)          |       header_data [63:0]     |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n#### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| opcode | 6 | 0[7:2] | Operation code | Per Table 3-17 |\n| version | 2 | 0[1:0] | Protocol version | 0 for v1.0.1 |\n| dc | 1 | 1[7] | Delivery Complete | Defer response |\n| ie | 1 | 1[6] | Initiator Error | Error at initiator |\n| rel | 1 | 1[5] | Relative addressing | 0=absolute, 1=relative |\n| hd | 1 | 1[4] | Header Data present | 1=header_data valid |\n| eom | 1 | 1[3] | End of Message | Must be 1 (single packet) |\n| som | 1 | 1[2] | Start of Message | Must be 1 (single packet) |\n| rsvd | 2 | 1[1:0] | Reserved | Must be 0 |\n| rsvd | 2 | 2[7:6] | Reserved | Must be 0 |\n| request_length | 14 | 2[5:0]+3 | Request length | Max 16383 bytes |\n| ri_generation | 8 | 4 | Resource Index generation | For buffer recovery |\n| job_id | 24 | 5-7 | Job Identifier | Target job |\n| rsvd | 4 | 8[7:4] | Reserved | Must be 0 |\n| pid_on_fep | 12 | 8[3:0]+9 | Process ID on FEP | Target process |\n| rsvd | 4 | 10[7:4] | Reserved | Must be 0 |\n| resource_index | 12 | 10[3:0]+11 | Resource Index | Target resource |\n| initiator | 32 | 12-15 | Initiator ID | For tagged matching |\n| match_bits | 64 | 16-23 | Match bits | For tagged matching |\n| header_data | 64 | 24-31 | Header data | Completion data |\n\n#### Protocol Behavior\n\n**Optimized Format**:\n- 32 bytes vs 44 bytes for standard request\n- Single-packet only (`som=1, eom=1` required)\n- No buffer_offset (not needed for single packet)\n- 14-bit request_length (max 16383 bytes)\n\n**Use Cases**:\n- Small tagged sends\n- Single-packet messages with matching criteria\n- Latency-sensitive operations\n\n**Reference**: UE Spec v1.0.1, Figure 3-14, Section 3.4.2.3, Page 164\n\n---\n\n### 3.6 Rendezvous Extension (Figure 3-15, 32 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/rendezvous_extension.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.1)](#31-standard-request-som1-table-3-8-44-bytes)\n\n#### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |       eager_length [31:0]     |        memory_key [63:0]     →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |  (memory_key cont'd)          |       buffer_offset [63:0]   →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |  (buffer_offset cont'd)       |     remaining_length [31:0]  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        24      25      26      27      28      29      30      31\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → | (remaining)   |              reserved [63:0]                  |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n#### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| eager_length | 32 | 0-3 | Eager data length | Bytes pushed with request |\n| memory_key | 64 | 4-11 | Initiator memory key | For target to pull data |\n| buffer_offset | 64 | 12-19 | Initiator buffer offset | Start of remaining data |\n| remaining_length | 32 | 20-23 | Remaining data length | Bytes to pull |\n| rsvd | 64 | 24-31 | Reserved | Must be 0 |\n\n#### Protocol Behavior\n\n**Rendezvous Protocol**:\n1. Initiator sends request with eager data + rendezvous extension\n2. Target receives eager data, allocates buffer\n3. Target issues RDMA Read to pull remaining data using {memory_key, buffer_offset}\n4. Target completes operation when all data received\n\n**Two-Sided Protocol**:\n- Enables large message transfer without pre-registered buffers\n- Target controls when/how to pull remaining data\n- Reduces memory registration overhead\n\n**Constraints**:\n- MUST NOT be combined with atomic extension\n- Placed on every packet using rendezvous opcode\n\n**Reference**: UE Spec v1.0.1, Figure 3-15, Section 3.4.2.3, Page 165\n\n---\n\n### 3.7 Atomic Extension (Figure 3-16, 8 bytes)\n\n**Datamodel**: `datamodel/protocols/ue/transport/ses/atomic_extension.ksy`  \n**Related Formats**: [Standard Request SOM=1 (3.1)](#31-standard-request-som1-table-3-8-44-bytes) | [Response with Data (3.4)](#34-response-with-data-table-3-12-24-bytes)\n\n#### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |atomic_opcode  |atomic_datatype| semantic_control  | reserved  |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n#### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| atomic_opcode | 8 | 0 | Atomic operation | Per Table 3-21 |\n| atomic_datatype | 8 | 1 | Data type | Per Table 3-22 |\n| semantic_control | 16 | 2-3 | Semantic control | Per Table 3-23 |\n| rsvd | 32 | 4-7 | Reserved | Must be 0 |\n\n#### Atomic Opcodes (Table 3-21)\n\n| Code | Name | Operation |\n|------|------|-----------|\n| 0x00 | MIN | Target = MIN(Target, Initiator) |\n| 0x01 | MAX | Target = MAX(Target, Initiator) |\n| 0x02 | SUM | Target = Target + Initiator |\n| 0x03 | DIFF | Target = Target - Initiator |\n| 0x04 | PROD | Target = Target * Initiator |\n| 0x05 | LOR | Target = Target \\|\\| Initiator |\n| 0x06 | LAND | Target = Target && Initiator |\n| 0x07 | BOR | Target = Target \\| Initiator |\n| 0x08 | BAND | Target = Target & Initiator |\n| 0x09 | LXOR | Logical XOR |\n| 0x0A | BXOR | Target = Target ^ Initiator |\n| 0x0B | READ | Initiator = Target |\n| 0x0C | WRITE | Target = Initiator |\n| 0x0D | CSWAP | Compare and swap if equal |\n| 0x0E | CSWAP_NE | Compare and swap if not equal |\n| 0x0F | CSWAP_LE | Compare and swap if ≤ |\n| 0x10 | CSWAP_LT | Compare and swap if < |\n| 0x11 | CSWAP_GE | Compare and swap if ≥ |\n| 0x12 | CSWAP_GT | Compare and swap if > |\n| 0x13 | MSWAP | Masked swap |\n| 0x14 | INVAL | Invalidate cache |\n\n#### Atomic Datatypes (Table 3-22)\n\n| Code | Name | Size |\n|------|------|------|\n| 0x00 | INT8 | 1 byte |\n| 0x01 | UINT8 | 1 byte |\n| 0x02 | INT16 | 2 bytes |\n| 0x03 | UINT16 | 2 bytes |\n| 0x04 | INT32 | 4 bytes |\n| 0x05 | UINT32 | 4 bytes |\n| 0x06 | INT64 | 8 bytes |\n| 0x07 | UINT64 | 8 bytes |\n| 0x08 | FLOAT | 4 bytes |\n| 0x09 | DOUBLE | 8 bytes |\n| 0x0A | FLOAT_COMPLEX | 8 bytes |\n| 0x0B | DOUBLE_COMPLEX | 16 bytes |\n| 0x0E | FLOAT16 | 2 bytes |\n| 0x0F | BFLOAT16 | 2 bytes |\n\n#### Protocol Behavior\n\n**Atomic Operations**:\n- Always 8 bytes and must be naturally aligned\n- Payload must be integral multiple of datatype size\n- Fetching atomics return original value in Response with Data\n\n**Constraints**:\n- MUST NOT be combined with rendezvous extension\n- Fetching atomics MUST NOT operate on more than one element\n\n**Reference**: UE Spec v1.0.1, Figure 3-16, Section 3.4.2.4, Page 165\n\n---\n\n## 4. Cross-References\n\n### Related Documents\n\n| Document | Content |\n|----------|---------|\n| [packet_taxonomy.md](packet_taxonomy.md) | Master index |\n| [packet_taxonomy_ue_pds.md](packet_taxonomy_ue_pds.md) | PDS formats (carries SES) |\n| [packet_taxonomy_ue_cms_tss.md](packet_taxonomy_ue_cms_tss.md) | CMS/TSS formats |\n\n### Datamodel Files\n\n| File | Description |\n|------|-------------|\n| `opcodes.ksy` | SES opcode definitions |\n| `standard_request_som1.ksy` | Standard request SOM=1 (44 bytes) |\n| `standard_request_som0.ksy` | Standard request SOM=0 (16 bytes) |\n| `response.ksy` | Response (16 bytes) |\n| `response_with_data.ksy` | Response with data (24 bytes) |\n| `small_message.ksy` | Small message (32 bytes) |\n| `rendezvous_extension.ksy` | Rendezvous extension (32 bytes) |\n| `atomic_extension.ksy` | Atomic extension (8 bytes) |\n\n---\n\n## 5. References\n\n- UE Specification v1.0.1, Chapter 3 (Transport Layer)\n- UE Specification v1.0.1, Section 3.4 (SES)\n- UE Specification v1.0.1, Tables 3-8 through 3-23\n- UE Specification v1.0.1, Figures 3-14 through 3-16\n"
            },
            "output": "Wrote file successfully.",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy_ue_ses.md",
            "metadata": {
              "diagnostics": {},
              "filepath": "/home/matkins/CN7000/analysis/packet_taxonomy_ue_ses.md",
              "exists": false,
              "truncated": false
            },
            "time": {
              "start": 1769125447768,
              "end": 1769125447885
            }
          }
        },
        {
          "id": "prt_be81808cf001lP0fUk5ajsaUUr",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be8163da8001q1Sp8HuWYGWZqM",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 94157,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be81809450019LVi7UJHNaBKyC",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769125448005,
          "completed": 1769125467294
        },
        "parentID": "msg_be80bfd40001700UtaNDuhl2uY",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 94165,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be8180e29001crkJLdGJzZF87C",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81809450019LVi7UJHNaBKyC",
          "type": "step-start"
        },
        {
          "id": "prt_be818543c001E5AFZ5UuJY4P0j",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81809450019LVi7UJHNaBKyC",
          "type": "tool",
          "callID": "toolu_01AfCZ8hvRx5ijpz6j4fMhZq",
          "tool": "todowrite",
          "state": {
            "status": "completed",
            "input": {
              "todos": [
                {
                  "id": "p2-0-1",
                  "content": "Phase 2.0: Create master document structure",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "p2-0-2",
                  "content": "Phase 2.0: Extract PDS content to packet_taxonomy_ue_pds.md",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p2-0-3",
                  "content": "Phase 2.0: Extract SES content to packet_taxonomy_ue_ses.md",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p2-0-4",
                  "content": "Phase 2.0: Extract Cornelis content to packet_taxonomy_cornelis.md",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "p2-0-5",
                  "content": "Phase 2.0: Extract RoCEv2 content to packet_taxonomy_rocev2.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-0-6",
                  "content": "Phase 2.0: Extract HSI content to packet_taxonomy_hsi.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-0-7",
                  "content": "Phase 2.0: Extract UALink content to packet_taxonomy_ualink.md",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p2-0-8",
                  "content": "Phase 2.0: Refactor master document with index",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-a",
                  "content": "Phase 2a: Create CMS formats in packet_taxonomy_ue_cms_tss.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-b",
                  "content": "Phase 2b: Add TSS formats to packet_taxonomy_ue_cms_tss.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-c",
                  "content": "Phase 2c: Expand RoCEv2 with BTH, RETH, AETH, AtomicETH",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-d",
                  "content": "Phase 2d: Create Link Layer formats in packet_taxonomy_ue_link.md",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p2-e",
                  "content": "Phase 2e: Expand Cornelis with CSIG+, VxLAN+, Collective, ScaleUp",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p2-f",
                  "content": "Phase 2f: Expand HSI with all formats",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-final",
                  "content": "Phase 2 Final: Validation, work items, change log",
                  "status": "pending",
                  "priority": "high"
                }
              ]
            },
            "output": "[\n  {\n    \"id\": \"p2-0-1\",\n    \"content\": \"Phase 2.0: Create master document structure\",\n    \"status\": \"in_progress\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-0-2\",\n    \"content\": \"Phase 2.0: Extract PDS content to packet_taxonomy_ue_pds.md\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-0-3\",\n    \"content\": \"Phase 2.0: Extract SES content to packet_taxonomy_ue_ses.md\",\n    \"status\": \"completed\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-0-4\",\n    \"content\": \"Phase 2.0: Extract Cornelis content to packet_taxonomy_cornelis.md\",\n    \"status\": \"in_progress\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-0-5\",\n    \"content\": \"Phase 2.0: Extract RoCEv2 content to packet_taxonomy_rocev2.md\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-0-6\",\n    \"content\": \"Phase 2.0: Extract HSI content to packet_taxonomy_hsi.md\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-0-7\",\n    \"content\": \"Phase 2.0: Extract UALink content to packet_taxonomy_ualink.md\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p2-0-8\",\n    \"content\": \"Phase 2.0: Refactor master document with index\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-a\",\n    \"content\": \"Phase 2a: Create CMS formats in packet_taxonomy_ue_cms_tss.md\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-b\",\n    \"content\": \"Phase 2b: Add TSS formats to packet_taxonomy_ue_cms_tss.md\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-c\",\n    \"content\": \"Phase 2c: Expand RoCEv2 with BTH, RETH, AETH, AtomicETH\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-d\",\n    \"content\": \"Phase 2d: Create Link Layer formats in packet_taxonomy_ue_link.md\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p2-e\",\n    \"content\": \"Phase 2e: Expand Cornelis with CSIG+, VxLAN+, Collective, ScaleUp\",\n    \"status\": \"pending\",\n    \"priority\": \"medium\"\n  },\n  {\n    \"id\": \"p2-f\",\n    \"content\": \"Phase 2f: Expand HSI with all formats\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  },\n  {\n    \"id\": \"p2-final\",\n    \"content\": \"Phase 2 Final: Validation, work items, change log\",\n    \"status\": \"pending\",\n    \"priority\": \"high\"\n  }\n]",
            "title": "13 todos",
            "metadata": {
              "todos": [
                {
                  "id": "p2-0-1",
                  "content": "Phase 2.0: Create master document structure",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "p2-0-2",
                  "content": "Phase 2.0: Extract PDS content to packet_taxonomy_ue_pds.md",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p2-0-3",
                  "content": "Phase 2.0: Extract SES content to packet_taxonomy_ue_ses.md",
                  "status": "completed",
                  "priority": "high"
                },
                {
                  "id": "p2-0-4",
                  "content": "Phase 2.0: Extract Cornelis content to packet_taxonomy_cornelis.md",
                  "status": "in_progress",
                  "priority": "high"
                },
                {
                  "id": "p2-0-5",
                  "content": "Phase 2.0: Extract RoCEv2 content to packet_taxonomy_rocev2.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-0-6",
                  "content": "Phase 2.0: Extract HSI content to packet_taxonomy_hsi.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-0-7",
                  "content": "Phase 2.0: Extract UALink content to packet_taxonomy_ualink.md",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p2-0-8",
                  "content": "Phase 2.0: Refactor master document with index",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-a",
                  "content": "Phase 2a: Create CMS formats in packet_taxonomy_ue_cms_tss.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-b",
                  "content": "Phase 2b: Add TSS formats to packet_taxonomy_ue_cms_tss.md",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-c",
                  "content": "Phase 2c: Expand RoCEv2 with BTH, RETH, AETH, AtomicETH",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-d",
                  "content": "Phase 2d: Create Link Layer formats in packet_taxonomy_ue_link.md",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p2-e",
                  "content": "Phase 2e: Expand Cornelis with CSIG+, VxLAN+, Collective, ScaleUp",
                  "status": "pending",
                  "priority": "medium"
                },
                {
                  "id": "p2-f",
                  "content": "Phase 2f: Expand HSI with all formats",
                  "status": "pending",
                  "priority": "high"
                },
                {
                  "id": "p2-final",
                  "content": "Phase 2 Final: Validation, work items, change log",
                  "status": "pending",
                  "priority": "high"
                }
              ],
              "truncated": false
            },
            "time": {
              "start": 1769125467198,
              "end": 1769125467280
            }
          }
        },
        {
          "id": "prt_be81854910015YRNr80MViVqkM",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81809450019LVi7UJHNaBKyC",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 94165,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be81854eb001nB8AeHNT6PKmMN",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769125467371,
          "completed": 1769125479113
        },
        "parentID": "msg_be80bfd40001700UtaNDuhl2uY",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 94929,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be8185913001Si4k3OKig4jcf9",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81854eb001nB8AeHNT6PKmMN",
          "type": "step-start"
        },
        {
          "id": "prt_be8188225001k27ZkUDGvyIYMc",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81854eb001nB8AeHNT6PKmMN",
          "type": "tool",
          "callID": "toolu_013PMeHVNU24GdxGrSzCzMzh",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/cornelis/transport/csig_plus.ksy"
            },
            "output": "<file>\n00001| # CSIG+ (Cornelis Signal Plus) Telemetry Header\n00002| # Cornelis Networks proprietary 4-byte telemetry extension\n00003| # Reference: CN7000 Packet Taxonomy\n00004| #\n00005| # CSIG+ extends the UE PDS type field to carry in-band telemetry\n00006| # information for network monitoring and diagnostics.\n00007| \n00008| meta:\n00009|   id: csig_plus\n00010|   title: CSIG+ Telemetry Header\n00011|   endian: be\n00012|   bit-endian: be\n00013|   ks-version: \"0.10\"\n00014| \n00015| doc: |\n00016|   CSIG+ (Cornelis Signal Plus) Telemetry Header - 4 bytes\n00017| \n00018|   Cornelis proprietary in-band telemetry header that extends UE PDS packets\n00019|   to carry network monitoring and diagnostic information. CSIG+ uses the\n00020|   UE PDS type field extension mechanism.\n00021| \n00022|   Header Layout (4 bytes):\n00023|     Byte 0:     Version[7:4] | Type[3:0]\n00024|     Byte 1:     Flags[7:0]\n00025|     Bytes 2-3:  Telemetry Data[15:0]\n00026| \n00027|   CSIG+ enables:\n00028|   - In-band network telemetry (INT)\n00029|   - Per-hop latency measurement\n00030|   - Queue depth monitoring\n00031|   - Congestion notification\n00032|   - Path tracing\n00033| \n00034|   When present, CSIG+ is placed after the UE+ L2 header and before\n00035|   the payload. The UE+ type field is set to 0x9100 to indicate CSIG+.\n00036| \n00037| doc-ref:\n00038|   - \"CN7000 Packet Taxonomy\"\n00039|   - \"Cornelis Networks CSIG+ Specification\"\n00040| \n00041| x-spec:\n00042|   section: \"CSIG+ Telemetry\"\n00043|   spec_version: \"1.0\"\n00044| \n00045| x-packet:\n00046|   layer: \"transport\"\n00047|   sublayer: \"telemetry\"\n00048|   category: \"header\"\n00049|   size_bytes: 4\n00050|   size_bits: 32\n00051| \n00052|   constraints:\n00053|     - \"Version must be 0 for current specification\"\n00054|     - \"Type identifies telemetry data format\"\n00055| \n00056|   usage:\n00057|     - \"In-band network telemetry\"\n00058|     - \"Per-hop latency tracking\"\n00059|     - \"Congestion monitoring\"\n00060|     - \"Path verification\"\n00061| \n00062| seq:\n00063|   # Byte 0: Version[7:4] | Type[3:0]\n00064|   - id: version\n00065|     type: b4\n00066|     doc: |\n00067|       Version (4 bits).\n00068|       CSIG+ protocol version.\n00069|       Current version is 0.\n00070|     x-required: true\n00071|     x-constraint: \"value == 0\"\n00072| \n00073|   - id: telemetry_type\n00074|     type: b4\n00075|     enum: csig_type_enum\n00076|     doc: |\n00077|       Telemetry Type (4 bits).\n00078|       Identifies the type of telemetry data.\n00079| \n00080|       Types:\n00081|       - 0: Latency measurement\n00082|       - 1: Queue depth\n00083|       - 2: Congestion notification\n00084|       - 3: Path trace\n00085|       - 4: Timestamp\n00086|       - 5-14: Reserved\n00087|       - 15: Custom/vendor-specific\n00088|     x-required: true\n00089| \n00090|   # Byte 1: Flags[7:0]\n00091|   - id: flags\n00092|     type: u1\n00093|     doc: |\n00094|       Flags (8 bits).\n00095|       Control flags for telemetry processing.\n00096| \n00097|       Bit 7: Accumulate (add hop data vs replace)\n00098|       Bit 6: Report (generate telemetry report)\n00099|       Bit 5: Sink (final hop for telemetry)\n00100|       Bit 4: Source (originating hop)\n00101|       Bits 3-0: Type-specific flags\n00102|     x-required: true\n00103| \n00104|   # Bytes 2-3: Telemetry Data[15:0]\n00105|   - id: telemetry_data\n00106|     type: u2\n00107|     doc: |\n00108|       Telemetry Data (16 bits).\n00109|       Type-specific telemetry payload.\n00110| \n00111|       For Latency (type 0):\n00112|         - Accumulated latency in nanoseconds (16-bit)\n00113| \n00114|       For Queue Depth (type 1):\n00115|         - Queue occupancy percentage (8-bit) + Queue ID (8-bit)\n00116| \n00117|       For Congestion (type 2):\n00118|         - ECN bits (2-bit) + Congestion level (6-bit) + Reserved (8-bit)\n00119| \n00120|       For Path Trace (type 3):\n00121|         - Switch ID (16-bit)\n00122| \n00123|       For Timestamp (type 4):\n00124|         - Truncated timestamp (16-bit)\n00125|     x-required: true\n00126| \n00127| instances:\n00128|   header_size:\n00129|     value: 4\n00130|     doc: \"CSIG+ header size in bytes\"\n00131| \n00132|   accumulate:\n00133|     value: \"(flags & 0x80) != 0\"\n00134|     doc: \"True if telemetry should be accumulated\"\n00135| \n00136|   report:\n00137|     value: \"(flags & 0x40) != 0\"\n00138|     doc: \"True if telemetry report should be generated\"\n00139| \n00140|   is_sink:\n00141|     value: \"(flags & 0x20) != 0\"\n00142|     doc: \"True if this is the final telemetry hop\"\n00143| \n00144|   is_source:\n00145|     value: \"(flags & 0x10) != 0\"\n00146|     doc: \"True if this is the originating telemetry hop\"\n00147| \n00148|   type_flags:\n00149|     value: \"flags & 0x0F\"\n00150|     doc: \"Type-specific flag bits\"\n00151| \n00152| enums:\n00153|   csig_type_enum:\n00154|     0:\n00155|       id: latency\n00156|       doc: \"Latency measurement (nanoseconds)\"\n00157|     1:\n00158|       id: queue_depth\n00159|       doc: \"Queue depth/occupancy\"\n00160|     2:\n00161|       id: congestion\n00162|       doc: \"Congestion notification\"\n00163|     3:\n00164|       id: path_trace\n00165|       doc: \"Path tracing (switch IDs)\"\n00166|     4:\n00167|       id: timestamp\n00168|       doc: \"Timestamp data\"\n00169|     5:\n00170|       id: reserved_5\n00171|       doc: \"Reserved\"\n00172|     6:\n00173|       id: reserved_6\n00174|       doc: \"Reserved\"\n00175|     7:\n00176|       id: reserved_7\n00177|       doc: \"Reserved\"\n00178|     8:\n00179|       id: reserved_8\n00180|       doc: \"Reserved\"\n00181|     9:\n00182|       id: reserved_9\n00183|       doc: \"Reserved\"\n00184|     10:\n00185|       id: reserved_10\n00186|       doc: \"Reserved\"\n00187|     11:\n00188|       id: reserved_11\n00189|       doc: \"Reserved\"\n00190|     12:\n00191|       id: reserved_12\n00192|       doc: \"Reserved\"\n00193|     13:\n00194|       id: reserved_13\n00195|       doc: \"Reserved\"\n00196|     14:\n00197|       id: reserved_14\n00198|       doc: \"Reserved\"\n00199|     15:\n00200|       id: custom\n00201|       doc: \"Custom/vendor-specific telemetry\"\n00202| \n\n(End of file - total 202 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/cornelis/transport/csig_plus.ksy",
            "metadata": {
              "preview": "# CSIG+ (Cornelis Signal Plus) Telemetry Header\n# Cornelis Networks proprietary 4-byte telemetry extension\n# Reference: CN7000 Packet Taxonomy\n#\n# CSIG+ extends the UE PDS type field to carry in-band telemetry\n# information for network monitoring and diagnostics.\n\nmeta:\n  id: csig_plus\n  title: CSIG+ Telemetry Header\n  endian: be\n  bit-endian: be\n  ks-version: \"0.10\"\n\ndoc: |\n  CSIG+ (Cornelis Signal Plus) Telemetry Header - 4 bytes\n\n  Cornelis proprietary in-band telemetry header that extends UE PDS packets\n  to carry network monitoring and diagnostic information. CSIG+ uses the\n  UE PDS type field extension mechanism.",
              "truncated": false
            },
            "time": {
              "start": 1769125478952,
              "end": 1769125479075
            }
          }
        },
        {
          "id": "prt_be818822a001nMgzM8qkKK1X04",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81854eb001nB8AeHNT6PKmMN",
          "type": "tool",
          "callID": "toolu_013x2sWNoDCWgYvuhrZ6pwv1",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/cornelis/encapsulation/vxlan_plus.ksy"
            },
            "output": "<file>\n00001| # VxLAN+ (VxLAN Plus) Encapsulation Header\n00002| # Cornelis Networks proprietary 4-byte extension to VxLAN\n00003| # Reference: CN7000 Packet Taxonomy\n00004| #\n00005| # VxLAN+ extends standard VxLAN with fabric-aware features\n00006| # using the UE PDS type field extension mechanism.\n00007| \n00008| meta:\n00009|   id: vxlan_plus\n00010|   title: VxLAN+ Encapsulation Header\n00011|   endian: be\n00012|   bit-endian: be\n00013|   ks-version: \"0.10\"\n00014| \n00015| doc: |\n00016|   VxLAN+ (VxLAN Plus) Encapsulation Header - 4 bytes\n00017| \n00018|   Cornelis proprietary extension to VxLAN (Virtual eXtensible LAN)\n00019|   that adds fabric-aware overlay networking features. VxLAN+ uses\n00020|   the UE PDS type field extension mechanism.\n00021| \n00022|   VxLAN+ extends standard VxLAN (RFC 7348) with:\n00023|   - Fabric-level tenant isolation\n00024|   - Enhanced load balancing entropy\n00025|   - Priority/QoS integration with fabric\n00026|   - Extended VNI space\n00027| \n00028|   Header Layout (4 bytes):\n00029|     Byte 0:     Flags[7:0]\n00030|     Byte 1:     VNI[23:16] (high byte)\n00031|     Byte 2:     VNI[15:8] (middle byte)\n00032|     Byte 3:     VNI[7:0] | Reserved[7:4] | Priority[3:0] (low nibble reused)\n00033| \n00034|   Note: Standard VxLAN has 8-byte header with VNI in bytes 4-6.\n00035|   VxLAN+ uses 4 bytes with compressed format for fabric efficiency.\n00036| \n00037|   When UE+ type field is 0x9000, VxLAN+ header follows.\n00038| \n00039| doc-ref:\n00040|   - \"CN7000 Packet Taxonomy\"\n00041|   - \"RFC 7348 (VxLAN)\"\n00042|   - \"Cornelis Networks VxLAN+ Specification\"\n00043| \n00044| x-spec:\n00045|   section: \"VxLAN+ Encapsulation\"\n00046|   spec_version: \"1.0\"\n00047| \n00048| x-packet:\n00049|   layer: \"encapsulation\"\n00050|   sublayer: \"overlay\"\n00051|   category: \"header\"\n00052|   size_bytes: 4\n00053|   size_bits: 32\n00054| \n00055|   constraints:\n00056|     - \"VNI must be valid (0 to 16,777,215)\"\n00057|     - \"I flag must be set for valid VNI\"\n00058| \n00059|   usage:\n00060|     - \"Overlay network encapsulation\"\n00061|     - \"Multi-tenant fabric isolation\"\n00062|     - \"VM/container networking\"\n00063|     - \"Data center interconnect\"\n00064| \n00065| seq:\n00066|   # Byte 0: Flags[7:0]\n00067|   - id: flags\n00068|     type: u1\n00069|     doc: |\n00070|       Flags (8 bits).\n00071|       VxLAN+ control flags.\n00072| \n00073|       Bit 7: I - VNI valid indicator (must be 1)\n00074|       Bit 6: P - Policy applied indicator\n00075|       Bit 5: B - BUM (Broadcast/Unknown/Multicast) indicator\n00076|       Bit 4: O - OAM frame indicator\n00077|       Bits 3-0: Reserved (must be 0)\n00078| \n00079|       The I flag must be set for the VNI field to be valid.\n00080|     x-required: true\n00081|     x-constraint: \"(value & 0x80) != 0\"  # I flag must be set\n00082| \n00083|   # Bytes 1-3: VNI[23:0] with Priority in low nibble\n00084|   - id: vni_high\n00085|     type: u1\n00086|     doc: |\n00087|       VNI High Byte (8 bits).\n00088|       Bits 23:16 of 24-bit Virtual Network Identifier.\n00089|     x-required: true\n00090| \n00091|   - id: vni_mid\n00092|     type: u1\n00093|     doc: |\n00094|       VNI Middle Byte (8 bits).\n00095|       Bits 15:8 of 24-bit Virtual Network Identifier.\n00096|     x-required: true\n00097| \n00098|   - id: vni_low_and_priority\n00099|     type: u1\n00100|     doc: |\n00101|       VNI Low Nibble and Priority (8 bits).\n00102|       Bits 7:4 - VNI bits 7:4 (low nibble of VNI)\n00103|       Bits 3:0 - Fabric priority level\n00104| \n00105|       Note: VNI bits 3:0 are always 0 in VxLAN+, giving\n00106|       effective VNI granularity of 16 (VNI mod 16 == 0).\n00107|     x-required: true\n00108| \n00109| instances:\n00110|   header_size:\n00111|     value: 4\n00112|     doc: \"VxLAN+ header size in bytes\"\n00113| \n00114|   vni:\n00115|     value: \"(vni_high << 16) | (vni_mid << 8) | (vni_low_and_priority & 0xF0)\"\n00116|     doc: \"24-bit Virtual Network Identifier (with low nibble masked)\"\n00117| \n00118|   priority:\n00119|     value: \"vni_low_and_priority & 0x0F\"\n00120|     doc: \"4-bit fabric priority level\"\n00121| \n00122|   vni_valid:\n00123|     value: \"(flags & 0x80) != 0\"\n00124|     doc: \"True if VNI is valid (I flag set)\"\n00125| \n00126|   policy_applied:\n00127|     value: \"(flags & 0x40) != 0\"\n00128|     doc: \"True if policy has been applied\"\n00129| \n00130|   is_bum:\n00131|     value: \"(flags & 0x20) != 0\"\n00132|     doc: \"True if BUM (Broadcast/Unknown/Multicast) traffic\"\n00133| \n00134|   is_oam:\n00135|     value: \"(flags & 0x10) != 0\"\n00136|     doc: \"True if OAM (Operations/Admin/Maintenance) frame\"\n00137| \n\n(End of file - total 137 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/cornelis/encapsulation/vxlan_plus.ksy",
            "metadata": {
              "preview": "# VxLAN+ (VxLAN Plus) Encapsulation Header\n# Cornelis Networks proprietary 4-byte extension to VxLAN\n# Reference: CN7000 Packet Taxonomy\n#\n# VxLAN+ extends standard VxLAN with fabric-aware features\n# using the UE PDS type field extension mechanism.\n\nmeta:\n  id: vxlan_plus\n  title: VxLAN+ Encapsulation Header\n  endian: be\n  bit-endian: be\n  ks-version: \"0.10\"\n\ndoc: |\n  VxLAN+ (VxLAN Plus) Encapsulation Header - 4 bytes\n\n  Cornelis proprietary extension to VxLAN (Virtual eXtensible LAN)\n  that adds fabric-aware overlay networking features. VxLAN+ uses\n  the UE PDS type field extension mechanism.",
              "truncated": false
            },
            "time": {
              "start": 1769125478955,
              "end": 1769125479104
            }
          }
        },
        {
          "id": "prt_be818822c001mf8eyTxdcHCecc",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81854eb001nB8AeHNT6PKmMN",
          "type": "tool",
          "callID": "toolu_01TRhfG1an1k2jU1wGjfECsL",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/cornelis/network/collective_l2.ksy"
            },
            "output": "<file>\n00001| # Collective L2 Header\n00002| # Cornelis Networks proprietary collective operations header\n00003| # Reference: CN7000 Packet Taxonomy\n00004| #\n00005| # Collective L2 provides hardware-accelerated collective operations\n00006| # for HPC workloads including reductions, barriers, and broadcasts.\n00007| \n00008| meta:\n00009|   id: collective_l2\n00010|   title: Collective L2 Operations Header\n00011|   endian: be\n00012|   bit-endian: be\n00013|   ks-version: \"0.10\"\n00014| \n00015| doc: |\n00016|   Collective L2 Operations Header - 4 bytes\n00017| \n00018|   Cornelis proprietary header for hardware-accelerated collective\n00019|   operations. Supports common HPC collective patterns at the\n00020|   fabric level for improved performance.\n00021| \n00022|   Header Layout (4 bytes):\n00023|     Byte 0:     Op[7:4] | Flags[3:0]\n00024|     Byte 1:     Group ID[7:0]\n00025|     Byte 2:     Sequence[7:0]\n00026|     Byte 3:     Data Type[7:4] | Count[3:0]\n00027| \n00028|   Collective L2 provides:\n00029|   - Hardware-accelerated reductions (sum, min, max, etc.)\n00030|   - Barrier synchronization\n00031|   - Broadcast/scatter/gather\n00032|   - All-to-all operations\n00033|   - Tree-based and ring-based topologies\n00034| \n00035|   Status: Specification in progress (per CN7000 Packet Taxonomy)\n00036| \n00037| doc-ref:\n00038|   - \"CN7000 Packet Taxonomy\"\n00039|   - \"Cornelis Networks Collective Specification (WIP)\"\n00040| \n00041| x-spec:\n00042|   section: \"Collective L2 Operations\"\n00043|   spec_version: \"0.1\"\n00044|   status: \"work_in_progress\"\n00045| \n00046| x-packet:\n00047|   layer: \"network\"\n00048|   sublayer: \"collective\"\n00049|   category: \"header\"\n00050|   size_bytes: 4\n00051|   size_bits: 32\n00052| \n00053|   constraints:\n00054|     - \"Group ID must be valid for the operation\"\n00055|     - \"Sequence number for ordering\"\n00056|     - \"Data type must match payload format\"\n00057| \n00058|   usage:\n00059|     - \"MPI collective operations\"\n00060|     - \"Hardware-accelerated reductions\"\n00061|     - \"Barrier synchronization\"\n00062|     - \"Broadcast operations\"\n00063| \n00064| seq:\n00065|   # Byte 0: Op[7:4] | Flags[3:0]\n00066|   - id: operation\n00067|     type: b4\n00068|     enum: collective_op_enum\n00069|     doc: |\n00070|       Collective Operation (4 bits).\n00071|       Identifies the collective operation type.\n00072| \n00073|       Operations:\n00074|       - 0: Barrier\n00075|       - 1: Broadcast\n00076|       - 2: Reduce (to root)\n00077|       - 3: All-reduce\n00078|       - 4: Scatter\n00079|       - 5: Gather\n00080|       - 6: All-gather\n00081|       - 7: All-to-all\n00082|       - 8: Scan (prefix)\n00083|       - 9: Reduce-scatter\n00084|       - 10-14: Reserved\n00085|       - 15: Custom\n00086|     x-required: true\n00087| \n00088|   - id: flags\n00089|     type: b4\n00090|     doc: |\n00091|       Operation Flags (4 bits).\n00092|       Control flags for collective operation.\n00093| \n00094|       Bit 3: In-place operation\n00095|       Bit 2: Completion notification required\n00096|       Bit 1: Tree-based topology (vs ring)\n00097|       Bit 0: Root indicator\n00098|     x-required: true\n00099| \n00100|   # Byte 1: Group ID[7:0]\n00101|   - id: group_id\n00102|     type: u1\n00103|     doc: |\n00104|       Collective Group ID (8 bits).\n00105|       Identifies the group participating in the collective.\n00106|       Groups are pre-configured with member lists.\n00107|     x-required: true\n00108| \n00109|   # Byte 2: Sequence[7:0]\n00110|   - id: sequence\n00111|     type: u1\n00112|     doc: |\n00113|       Sequence Number (8 bits).\n00114|       Ordering number for the collective operation.\n00115|       Ensures proper sequencing of multi-phase operations.\n00116|     x-required: true\n00117| \n00118|   # Byte 3: Data Type[7:4] | Count[3:0]\n00119|   - id: data_type\n00120|     type: b4\n00121|     enum: collective_dtype_enum\n00122|     doc: |\n00123|       Data Type (4 bits).\n00124|       Identifies the element data type for the operation.\n00125| \n00126|       Types:\n00127|       - 0: INT8\n00128|       - 1: INT16\n00129|       - 2: INT32\n00130|       - 3: INT64\n00131|       - 4: UINT8\n00132|       - 5: UINT16\n00133|       - 6: UINT32\n00134|       - 7: UINT64\n00135|       - 8: FLOAT16\n00136|       - 9: FLOAT32\n00137|       - 10: FLOAT64\n00138|       - 11: BFLOAT16\n00139|       - 12-14: Reserved\n00140|       - 15: Custom\n00141|     x-required: true\n00142| \n00143|   - id: count_exponent\n00144|     type: b4\n00145|     doc: |\n00146|       Count Exponent (4 bits).\n00147|       Element count as power of 2.\n00148|       Actual count = 2^count_exponent.\n00149|       Range: 1 to 32768 elements.\n00150|     x-required: true\n00151| \n00152| instances:\n00153|   header_size:\n00154|     value: 4\n00155|     doc: \"Collective L2 header size in bytes\"\n00156| \n00157|   element_count:\n00158|     value: \"1 << count_exponent\"\n00159|     doc: \"Number of elements in operation\"\n00160| \n00161|   is_in_place:\n00162|     value: \"(flags & 0x08) != 0\"\n00163|     doc: \"True if in-place operation\"\n00164| \n00165|   needs_completion:\n00166|     value: \"(flags & 0x04) != 0\"\n00167|     doc: \"True if completion notification required\"\n00168| \n00169|   is_tree_topology:\n00170|     value: \"(flags & 0x02) != 0\"\n00171|     doc: \"True if tree-based topology\"\n00172| \n00173|   is_root:\n00174|     value: \"(flags & 0x01) != 0\"\n00175|     doc: \"True if this node is root\"\n00176| \n00177| enums:\n00178|   collective_op_enum:\n00179|     0:\n00180|       id: barrier\n00181|       doc: \"Barrier synchronization\"\n00182|     1:\n00183|       id: broadcast\n00184|       doc: \"Broadcast from root\"\n00185|     2:\n00186|       id: reduce\n00187|       doc: \"Reduce to root\"\n00188|     3:\n00189|       id: all_reduce\n00190|       doc: \"All-reduce (reduce + broadcast)\"\n00191|     4:\n00192|       id: scatter\n00193|       doc: \"Scatter from root\"\n00194|     5:\n00195|       id: gather\n00196|       doc: \"Gather to root\"\n00197|     6:\n00198|       id: all_gather\n00199|       doc: \"All-gather (gather + broadcast)\"\n00200|     7:\n00201|       id: all_to_all\n00202|       doc: \"All-to-all exchange\"\n00203|     8:\n00204|       id: scan\n00205|       doc: \"Prefix scan\"\n00206|     9:\n00207|       id: reduce_scatter\n00208|       doc: \"Reduce-scatter\"\n00209|     10:\n00210|       id: reserved_10\n00211|       doc: \"Reserved\"\n00212|     11:\n00213|       id: reserved_11\n00214|       doc: \"Reserved\"\n00215|     12:\n00216|       id: reserved_12\n00217|       doc: \"Reserved\"\n00218|     13:\n00219|       id: reserved_13\n00220|       doc: \"Reserved\"\n00221|     14:\n00222|       id: reserved_14\n00223|       doc: \"Reserved\"\n00224|     15:\n00225|       id: custom\n00226|       doc: \"Custom operation\"\n00227| \n00228|   collective_dtype_enum:\n00229|     0:\n00230|       id: int8\n00231|       doc: \"Signed 8-bit integer\"\n00232|     1:\n00233|       id: int16\n00234|       doc: \"Signed 16-bit integer\"\n00235|     2:\n00236|       id: int32\n00237|       doc: \"Signed 32-bit integer\"\n00238|     3:\n00239|       id: int64\n00240|       doc: \"Signed 64-bit integer\"\n00241|     4:\n00242|       id: uint8\n00243|       doc: \"Unsigned 8-bit integer\"\n00244|     5:\n00245|       id: uint16\n00246|       doc: \"Unsigned 16-bit integer\"\n00247|     6:\n00248|       id: uint32\n00249|       doc: \"Unsigned 32-bit integer\"\n00250|     7:\n00251|       id: uint64\n00252|       doc: \"Unsigned 64-bit integer\"\n00253|     8:\n00254|       id: float16\n00255|       doc: \"16-bit floating point\"\n00256|     9:\n00257|       id: float32\n00258|       doc: \"32-bit floating point\"\n00259|     10:\n00260|       id: float64\n00261|       doc: \"64-bit floating point\"\n00262|     11:\n00263|       id: bfloat16\n00264|       doc: \"Brain floating point 16\"\n00265|     12:\n00266|       id: reserved_12\n00267|       doc: \"Reserved\"\n00268|     13:\n00269|       id: reserved_13\n00270|       doc: \"Reserved\"\n00271|     14:\n00272|       id: reserved_14\n00273|       doc: \"Reserved\"\n00274|     15:\n00275|       id: custom\n00276|       doc: \"Custom data type\"\n00277| \n\n(End of file - total 277 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/cornelis/network/collective_l2.ksy",
            "metadata": {
              "preview": "# Collective L2 Header\n# Cornelis Networks proprietary collective operations header\n# Reference: CN7000 Packet Taxonomy\n#\n# Collective L2 provides hardware-accelerated collective operations\n# for HPC workloads including reductions, barriers, and broadcasts.\n\nmeta:\n  id: collective_l2\n  title: Collective L2 Operations Header\n  endian: be\n  bit-endian: be\n  ks-version: \"0.10\"\n\ndoc: |\n  Collective L2 Operations Header - 4 bytes\n\n  Cornelis proprietary header for hardware-accelerated collective\n  operations. Supports common HPC collective patterns at the\n  fabric level for improved performance.",
              "truncated": false
            },
            "time": {
              "start": 1769125478957,
              "end": 1769125479062
            }
          }
        },
        {
          "id": "prt_be818822e001AeckdaUlG7uzPX",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81854eb001nB8AeHNT6PKmMN",
          "type": "tool",
          "callID": "toolu_019t3kmyLfCvMxJrsLpZEY83",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/cornelis/network/scaleup_l2.ksy"
            },
            "output": "<file>\n00001| # Scale-Up L2 Header\n00002| # Cornelis Networks proprietary scale-up networking header\n00003| # Reference: CN7000 Packet Taxonomy\n00004| #\n00005| # Scale-Up L2 provides optimized networking for tightly-coupled\n00006| # compute environments such as GPU clusters and HPC pods.\n00007| \n00008| meta:\n00009|   id: scaleup_l2\n00010|   title: Scale-Up L2 Networking Header\n00011|   endian: be\n00012|   bit-endian: be\n00013|   ks-version: \"0.10\"\n00014| \n00015| doc: |\n00016|   Scale-Up L2 Networking Header - 4 bytes\n00017| \n00018|   Cornelis proprietary header for scale-up networking in\n00019|   tightly-coupled compute environments. Optimized for\n00020|   low-latency, high-bandwidth communication within a\n00021|   single compute domain (pod, rack, or chassis).\n00022| \n00023|   Header Layout (4 bytes):\n00024|     Byte 0:     Version[7:6] | Type[5:2] | Priority[1:0]\n00025|     Byte 1:     Source Node[7:0]\n00026|     Byte 2:     Dest Node[7:0]\n00027|     Byte 3:     Flags[7:4] | Channel[3:0]\n00028| \n00029|   Scale-Up L2 provides:\n00030|   - Direct node-to-node addressing (256 nodes)\n00031|   - Multiple virtual channels per link\n00032|   - Hardware priority levels\n00033|   - GPU-direct and NVLink integration support\n00034| \n00035|   Status: Specification in progress (per CN7000 Packet Taxonomy)\n00036| \n00037| doc-ref:\n00038|   - \"CN7000 Packet Taxonomy\"\n00039|   - \"Cornelis Networks Scale-Up Specification (WIP)\"\n00040| \n00041| x-spec:\n00042|   section: \"Scale-Up L2 Networking\"\n00043|   spec_version: \"0.1\"\n00044|   status: \"work_in_progress\"\n00045| \n00046| x-packet:\n00047|   layer: \"network\"\n00048|   sublayer: \"scaleup\"\n00049|   category: \"header\"\n00050|   size_bytes: 4\n00051|   size_bits: 32\n00052| \n00053|   constraints:\n00054|     - \"Version must be 0 for current specification\"\n00055|     - \"Node IDs are local to the scale-up domain\"\n00056|     - \"Channel must be configured on the link\"\n00057| \n00058|   usage:\n00059|     - \"GPU cluster interconnect\"\n00060|     - \"HPC scale-up networking\"\n00061|     - \"AI/ML training clusters\"\n00062|     - \"Tightly-coupled compute\"\n00063| \n00064| seq:\n00065|   # Byte 0: Version[7:6] | Type[5:2] | Priority[1:0]\n00066|   - id: version\n00067|     type: b2\n00068|     doc: |\n00069|       Protocol Version (2 bits).\n00070|       Scale-Up L2 protocol version.\n00071|       Current version is 0.\n00072|     x-required: true\n00073|     x-constraint: \"value == 0\"\n00074| \n00075|   - id: packet_type\n00076|     type: b4\n00077|     enum: scaleup_type_enum\n00078|     doc: |\n00079|       Packet Type (4 bits).\n00080|       Identifies the scale-up packet type.\n00081| \n00082|       Types:\n00083|       - 0: Data transfer\n00084|       - 1: Credit return\n00085|       - 2: RDMA read request\n00086|       - 3: RDMA read response\n00087|       - 4: RDMA write\n00088|       - 5: Atomic operation\n00089|       - 6: Completion notification\n00090|       - 7: Flow control\n00091|       - 8-14: Reserved\n00092|       - 15: Management\n00093|     x-required: true\n00094| \n00095|   - id: priority\n00096|     type: b2\n00097|     doc: |\n00098|       Priority Level (2 bits).\n00099|       Hardware priority for scheduling.\n00100|       0 = lowest, 3 = highest.\n00101|     x-required: true\n00102| \n00103|   # Byte 1: Source Node[7:0]\n00104|   - id: source_node\n00105|     type: u1\n00106|     doc: |\n00107|       Source Node ID (8 bits).\n00108|       Local node identifier within the scale-up domain.\n00109|       Supports up to 256 nodes per domain.\n00110|     x-required: true\n00111| \n00112|   # Byte 2: Dest Node[7:0]\n00113|   - id: dest_node\n00114|     type: u1\n00115|     doc: |\n00116|       Destination Node ID (8 bits).\n00117|       Target node identifier within the scale-up domain.\n00118|     x-required: true\n00119| \n00120|   # Byte 3: Flags[7:4] | Channel[3:0]\n00121|   - id: flags\n00122|     type: b4\n00123|     doc: |\n00124|       Control Flags (4 bits).\n00125|       Packet handling flags.\n00126| \n00127|       Bit 3: Last packet indicator\n00128|       Bit 2: First packet indicator\n00129|       Bit 1: GPU-direct enable\n00130|       Bit 0: Zero-copy enable\n00131|     x-required: true\n00132| \n00133|   - id: channel\n00134|     type: b4\n00135|     doc: |\n00136|       Virtual Channel (4 bits).\n00137|       Virtual channel ID for the transfer.\n00138|       Allows multiple independent streams per link.\n00139|       16 channels per link pair.\n00140|     x-required: true\n00141| \n00142| instances:\n00143|   header_size:\n00144|     value: 4\n00145|     doc: \"Scale-Up L2 header size in bytes\"\n00146| \n00147|   is_last:\n00148|     value: \"(flags & 0x08) != 0\"\n00149|     doc: \"True if last packet in transfer\"\n00150| \n00151|   is_first:\n00152|     value: \"(flags & 0x04) != 0\"\n00153|     doc: \"True if first packet in transfer\"\n00154| \n00155|   gpu_direct:\n00156|     value: \"(flags & 0x02) != 0\"\n00157|     doc: \"True if GPU-direct enabled\"\n00158| \n00159|   zero_copy:\n00160|     value: \"(flags & 0x01) != 0\"\n00161|     doc: \"True if zero-copy enabled\"\n00162| \n00163|   is_data:\n00164|     value: \"packet_type == scaleup_type_enum::data\"\n00165|     doc: \"True if data transfer\"\n00166| \n00167|   is_rdma:\n00168|     value: \"(packet_type == scaleup_type_enum::rdma_read_req) or (packet_type == scaleup_type_enum::rdma_read_resp) or (packet_type == scaleup_type_enum::rdma_write)\"\n00169|     doc: \"True if RDMA operation\"\n00170| \n00171| enums:\n00172|   scaleup_type_enum:\n00173|     0:\n00174|       id: data\n00175|       doc: \"Data transfer\"\n00176|     1:\n00177|       id: credit\n00178|       doc: \"Credit return\"\n00179|     2:\n00180|       id: rdma_read_req\n00181|       doc: \"RDMA read request\"\n00182|     3:\n00183|       id: rdma_read_resp\n00184|       doc: \"RDMA read response\"\n00185|     4:\n00186|       id: rdma_write\n00187|       doc: \"RDMA write\"\n00188|     5:\n00189|       id: atomic\n00190|       doc: \"Atomic operation\"\n00191|     6:\n00192|       id: completion\n00193|       doc: \"Completion notification\"\n00194|     7:\n00195|       id: flow_control\n00196|       doc: \"Flow control\"\n00197|     8:\n00198|       id: reserved_8\n00199|       doc: \"Reserved\"\n00200|     9:\n00201|       id: reserved_9\n00202|       doc: \"Reserved\"\n00203|     10:\n00204|       id: reserved_10\n00205|       doc: \"Reserved\"\n00206|     11:\n00207|       id: reserved_11\n00208|       doc: \"Reserved\"\n00209|     12:\n00210|       id: reserved_12\n00211|       doc: \"Reserved\"\n00212|     13:\n00213|       id: reserved_13\n00214|       doc: \"Reserved\"\n00215|     14:\n00216|       id: reserved_14\n00217|       doc: \"Reserved\"\n00218|     15:\n00219|       id: management\n00220|       doc: \"Management packet\"\n00221| \n\n(End of file - total 221 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/cornelis/network/scaleup_l2.ksy",
            "metadata": {
              "preview": "# Scale-Up L2 Header\n# Cornelis Networks proprietary scale-up networking header\n# Reference: CN7000 Packet Taxonomy\n#\n# Scale-Up L2 provides optimized networking for tightly-coupled\n# compute environments such as GPU clusters and HPC pods.\n\nmeta:\n  id: scaleup_l2\n  title: Scale-Up L2 Networking Header\n  endian: be\n  bit-endian: be\n  ks-version: \"0.10\"\n\ndoc: |\n  Scale-Up L2 Networking Header - 4 bytes\n\n  Cornelis proprietary header for scale-up networking in\n  tightly-coupled compute environments. Optimized for\n  low-latency, high-bandwidth communication within a",
              "truncated": false
            },
            "time": {
              "start": 1769125478958,
              "end": 1769125479086
            }
          }
        },
        {
          "id": "prt_be81882c1001Pqw6JlHKRiNksB",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81854eb001nB8AeHNT6PKmMN",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 94929,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be818830a001WAr6m4Dh9B472K",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769125479178,
          "completed": 1769125577540
        },
        "parentID": "msg_be80bfd40001700UtaNDuhl2uY",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 103382,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be818884b001SWcyp7yG6dwQTN",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be818830a001WAr6m4Dh9B472K",
          "type": "step-start"
        },
        {
          "id": "prt_be81a029e001NbxYtmlaAWrs4o",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be818830a001WAr6m4Dh9B472K",
          "type": "tool",
          "callID": "toolu_0129YpgAPLBGdZYsg7Ueza98",
          "tool": "write",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy_cornelis.md",
              "content": "# PMR Packet Taxonomy: Cornelis Proprietary Formats\n\n**Parent Document**: [packet_taxonomy.md](packet_taxonomy.md)  \n**Scope**: Cornelis Networks proprietary packet formats (UFH, CSIG+, VxLAN+, Collectives, Scale-Up)  \n**Datamodel Directory**: `datamodel/protocols/cornelis/`  \n**Last Updated**: 2026-01-22\n\n---\n\n## Table of Contents\n\n1. [Overview](#1-overview)\n2. [Link Layer](#2-link-layer)\n   - [2.1 UE+ Header](#21-ue-header-12-bytes)\n3. [Network Layer](#3-network-layer)\n   - [3.1 UFH-16](#31-ufh-16-12-bytes)\n   - [3.2 UFH-32](#32-ufh-32-12-bytes)\n   - [3.3 Collective L2 (WIP)](#33-collective-l2-4-bytes-wip)\n   - [3.4 Scale-Up L2 (WIP)](#34-scale-up-l2-4-bytes-wip)\n4. [Transport Layer](#4-transport-layer)\n   - [4.1 CSIG+ Telemetry](#41-csig-telemetry-4-bytes)\n5. [Encapsulation](#5-encapsulation)\n   - [5.1 VxLAN+](#51-vxlan-4-bytes)\n6. [Cross-References](#6-cross-references)\n7. [References](#7-references)\n\n---\n\n## 1. Overview\n\nCornelis Networks proprietary formats extend standard protocols with optimizations for high-performance computing and AI/ML workloads. These formats are designed for:\n\n- **Efficiency**: Reduced header overhead for scale-up fabrics\n- **Telemetry**: In-band network monitoring and diagnostics\n- **Collectives**: Hardware-accelerated collective operations\n- **Overlay**: Fabric-aware multi-tenant networking\n\n### Format Summary\n\n| Layer | Format | Size | Status | Description |\n|-------|--------|------|--------|-------------|\n| Link | UE+ Header | 12 bytes | Complete | Optimized L2 header |\n| Network | UFH-16 | 12 bytes | Complete | 16-bit forwarding header |\n| Network | UFH-32 | 12 bytes | Complete | 32-bit forwarding header |\n| Network | Collective L2 | 4 bytes | **WIP** | HW-accelerated collectives |\n| Network | Scale-Up L2 | 4 bytes | **WIP** | GPU cluster interconnect |\n| Transport | CSIG+ | 4 bytes | Complete | In-band telemetry |\n| Encapsulation | VxLAN+ | 4 bytes | Complete | Fabric-aware overlay |\n\n---\n\n## 2. Link Layer\n\n### 2.1 UE+ Header (12 bytes)\n\n**Datamodel**: `datamodel/protocols/cornelis/link/ue_plus.ksy`  \n**Related Formats**: [UFH-16 (3.1)](#31-ufh-16-12-bytes) | [UFH-32 (3.2)](#32-ufh-32-12-bytes)\n\n#### Wire Format\n\n```\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0        | Byte 1        | Byte 2        | Byte 3        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n|L2|V|zyxm|Len  | Length[7:0]   | RC    | SC    | Hop Count     |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 4        | Byte 5        | Byte 6        | Byte 7        |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Dest LID [15:8]               | Dest LID [7:0]                |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Entropy [15:8]                | Entropy [7:0]                 |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 8        | Byte 9        | Byte 10       | Byte 11       |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Source LID [15:8]             | Source LID [7:0]              |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n| Payload Type [15:8]           | Payload Type [7:0]            |\n+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n#### Field Definitions\n\n| Field | Bits | Description |\n|-------|------|-------------|\n| L2 Type | 2 | Always 0b10 for UE+ |\n| Version | 1 | Protocol version |\n| zyxm | 4 | Routing control flags (multicast, adaptive) |\n| Length | 9 | Packet length in bytes |\n| RC | 4 | Routing Class (QoS) |\n| SC | 4 | Service Class |\n| Hop | 8 | TTL/hop count |\n| Dest LID | 16 | Destination Local Identifier |\n| Entropy | 16 | ECMP hash for load balancing |\n| Source LID | 16 | Source Local Identifier |\n| Type | 16 | Payload type (EtherType equivalent) |\n\n#### Payload Types\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x0800 | IPv4 | IPv4 payload |\n| 0x86DD | IPv6 | IPv6 payload |\n| 0x8100 | VLAN | VLAN tagged frame |\n| 0x9000 | VxLAN+ | VxLAN+ encapsulated |\n| 0x9100 | CSIG+ | CSIG+ telemetry |\n| 0xC000 | UE PDS | Ultra Ethernet PDS |\n\n---\n\n## 3. Network Layer\n\n### 3.1 UFH-16 (12 bytes)\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_16.ksy`  \n**Related Formats**: [UFH-32 (3.2)](#32-ufh-32-12-bytes)\n\nUFH-16 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 16-bit addressing.\n\n#### Wire Format\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |    Opaque (24-bit)    | Destination   |Opaque |Traffic|   Opaque      |    Source     |\n|[7:4]  |                       | (16-bit BE)   |[7:4]  |Class  |   (16-bit)    |  (16-bit BE)  |\n|SLAP   |                       |               |Z|Y|X|M|[7:0]  |               |               |\n|[3:0]  |                       |               |[3:0]  |       |               |               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n#### Field Definitions\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1-3 | 24 | Opaque to hardware |\n| Destination | 4-5 | 16 | Destination endpoint address (big-endian) |\n| Opaque | 6 | [7:4] | Opaque to hardware |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Opaque | 8-9 | 16 | Opaque to hardware |\n| Source | 10-11 | 16 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n#### UFH-16 Type Values\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5-14 | Reserved | Reserved for future use |\n| 15 | Extended | UFH-32 extension follows |\n\n**Usage**: Scale-up fabric forwarding, intra-pod communication, medium cluster networking (up to 65536 endpoints).\n\n---\n\n### 3.2 UFH-32 (12 bytes)\n\n**Datamodel**: `datamodel/protocols/cornelis/network/ufh_32.ksy`  \n**Related Formats**: [UFH-16 (3.1)](#31-ufh-16-12-bytes)\n\nUFH-32 overlays the Ethernet MAC Destination (bytes 0-5) and MAC Source (bytes 6-11) fields to provide efficient scale-up fabric forwarding with 32-bit addressing for large-scale deployments.\n\n#### Wire Format\n\n```\n         MAC Destination (bytes 0-5)              MAC Source (bytes 6-11)\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| Byte 0| Byte 1| Byte 2| Byte 3| Byte 4| Byte 5| Byte 6| Byte 7| Byte 8| Byte 9|Byte 10|Byte 11|\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n|Type|  |       |   Destination (32-bit BE)     |HopLim |Traffic|       Source (32-bit BE)      |\n|[7:4]  |Opaque |                               |[7:4]  |Class  |                               |\n|SLAP   |       |                               |Z|Y|X|M|[7:0]  |                               |\n|[3:0]  |       |                               |[3:0]  |       |                               |\n+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n#### Field Definitions\n\n| Field | Byte(s) | Bits | Description |\n|-------|---------|------|-------------|\n| Type | 0 | [7:4] | Packet type for forwarding decisions |\n| SLAP (dest) | 0 | [3:0] | Z,Y,X,M bits for MAC Dest; Z,Y,X=001 (constrained) |\n| Opaque | 1 | [7:0] | Opaque to hardware |\n| Destination | 2-5 | 32 | Destination endpoint address (big-endian) |\n| Hop Limit | 6 | [7:4] | TTL/hop count |\n| SLAP (src) | 6 | [3:0] | Z,Y,X,M bits for MAC Src; Z,Y,X=001 (constrained) |\n| Traffic Class | 7 | [7:0] | QoS / priority classification |\n| Source | 8-11 | 32 | Source endpoint address (big-endian) |\n\n**SLAP Field Constraint**: Z,Y,X bits MUST be 001. M bit may be 0 or 1. Valid values: 0x2 or 0x3.\n\n#### UFH-32 Type Values\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data packet |\n| 1 | Control | Control packet |\n| 2 | Collective | Collective operation packet |\n| 3 | Credit | Credit/flow control |\n| 4 | Management | Management packet |\n| 5 | Multicast | Multicast packet |\n| 6 | Barrier | Barrier synchronization |\n| 7 | Reduction | Reduction operation |\n| 8-14 | Reserved | Reserved for future use |\n| 15 | Vendor | Vendor-specific packet |\n\n**Usage**: Large-scale scale-up fabric forwarding (4+ billion endpoints), multi-pod communication, extended collective operations.\n\n---\n\n### 3.3 Collective L2 (4 bytes, **WIP**)\n\n> ⚠️ **Work In Progress**: This format is based on spec_version 0.1. \n> The specification is incomplete. See [W-08-001](packet_taxonomy.md#91-open-issues).\n\n**Datamodel**: `datamodel/protocols/cornelis/network/collective_l2.ksy`  \n**Spec Status**: Draft (v0.1)  \n**Related Work Item**: W-08-001\n\n#### Wire Format\n\n```\nByte:    0       1       2       3\n     +-------+-------+-------+-------+\n     |op |flg| grp_id|  seq  |dt |cnt|\n     +-------+-------+-------+-------+\n\nByte 0 Detail:\n  Bit:  7 6 5 4 3 2 1 0\n       |  op   | flags |\n       |(4 bit)|(4 bit)|\n\nByte 3 Detail:\n  Bit:  7 6 5 4 3 2 1 0\n       |dtype  |cnt_exp|\n       |(4 bit)|(4 bit)|\n```\n\n#### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| operation | 4 | 0[7:4] | Collective operation type | Per enum below |\n| flags | 4 | 0[3:0] | Operation flags | See below |\n| group_id | 8 | 1 | Collective group ID | Pre-configured group |\n| sequence | 8 | 2 | Sequence number | For ordering |\n| data_type | 4 | 3[7:4] | Element data type | Per enum below |\n| count_exponent | 4 | 3[3:0] | Element count (2^n) | 1 to 32768 elements |\n\n#### Flags\n\n| Bit | Name | Description |\n|-----|------|-------------|\n| 3 | in_place | In-place operation |\n| 2 | completion | Completion notification required |\n| 1 | tree | Tree-based topology (vs ring) |\n| 0 | root | This node is root |\n\n#### Collective Operations\n\n| Value | Operation | Description |\n|-------|-----------|-------------|\n| 0 | Barrier | Barrier synchronization |\n| 1 | Broadcast | Broadcast from root |\n| 2 | Reduce | Reduce to root |\n| 3 | All-reduce | Reduce + broadcast |\n| 4 | Scatter | Scatter from root |\n| 5 | Gather | Gather to root |\n| 6 | All-gather | Gather + broadcast |\n| 7 | All-to-all | All-to-all exchange |\n| 8 | Scan | Prefix scan |\n| 9 | Reduce-scatter | Reduce-scatter |\n| 10-14 | Reserved | Reserved |\n| 15 | Custom | Custom operation |\n\n#### Data Types\n\n| Value | Type | Size |\n|-------|------|------|\n| 0 | INT8 | 1 byte |\n| 1 | INT16 | 2 bytes |\n| 2 | INT32 | 4 bytes |\n| 3 | INT64 | 8 bytes |\n| 4 | UINT8 | 1 byte |\n| 5 | UINT16 | 2 bytes |\n| 6 | UINT32 | 4 bytes |\n| 7 | UINT64 | 8 bytes |\n| 8 | FLOAT16 | 2 bytes |\n| 9 | FLOAT32 | 4 bytes |\n| 10 | FLOAT64 | 8 bytes |\n| 11 | BFLOAT16 | 2 bytes |\n| 12-14 | Reserved | - |\n| 15 | Custom | Variable |\n\n#### Known Gaps\n\n- [ ] Reduction operation encoding not fully specified\n- [ ] Group configuration protocol not defined\n- [ ] Multi-phase operation sequencing incomplete\n- [ ] Error handling not specified\n\n#### Protocol Behavior (Preliminary)\n\n**Hardware Acceleration**: Collective L2 enables hardware-accelerated MPI collective operations at the fabric level.\n\n**Use Cases**:\n- MPI_Allreduce, MPI_Barrier, MPI_Bcast\n- AI/ML gradient aggregation\n- HPC synchronization primitives\n\n---\n\n### 3.4 Scale-Up L2 (4 bytes, **WIP**)\n\n> ⚠️ **Work In Progress**: This format is based on spec_version 0.1. \n> The specification is incomplete. See [W-08-002](packet_taxonomy.md#91-open-issues).\n\n**Datamodel**: `datamodel/protocols/cornelis/network/scaleup_l2.ksy`  \n**Spec Status**: Draft (v0.1)  \n**Related Work Item**: W-08-002\n\n#### Wire Format\n\n```\nByte:    0       1       2       3\n     +-------+-------+-------+-------+\n     |v|type |pr| src_node| dst_node|flg|ch |\n     +-------+-------+-------+-------+\n\nByte 0 Detail:\n  Bit:  7 6 5 4 3 2 1 0\n       |ver|  type |pri|\n       |(2)|(4 bit)|(2)|\n\nByte 3 Detail:\n  Bit:  7 6 5 4 3 2 1 0\n       | flags |channel|\n       |(4 bit)|(4 bit)|\n```\n\n#### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| version | 2 | 0[7:6] | Protocol version | Must be 0 |\n| packet_type | 4 | 0[5:2] | Packet type | Per enum below |\n| priority | 2 | 0[1:0] | Priority level | 0-3 (3=highest) |\n| source_node | 8 | 1 | Source node ID | 0-255 |\n| dest_node | 8 | 2 | Destination node ID | 0-255 |\n| flags | 4 | 3[7:4] | Control flags | See below |\n| channel | 4 | 3[3:0] | Virtual channel | 0-15 |\n\n#### Flags\n\n| Bit | Name | Description |\n|-----|------|-------------|\n| 3 | last | Last packet in transfer |\n| 2 | first | First packet in transfer |\n| 1 | gpu_direct | GPU-direct enabled |\n| 0 | zero_copy | Zero-copy enabled |\n\n#### Packet Types\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0 | Data | Data transfer |\n| 1 | Credit | Credit return |\n| 2 | RDMA Read Req | RDMA read request |\n| 3 | RDMA Read Resp | RDMA read response |\n| 4 | RDMA Write | RDMA write |\n| 5 | Atomic | Atomic operation |\n| 6 | Completion | Completion notification |\n| 7 | Flow Control | Flow control |\n| 8-14 | Reserved | Reserved |\n| 15 | Management | Management packet |\n\n#### Known Gaps\n\n- [ ] GPU-direct integration details not specified\n- [ ] NVLink interoperability not defined\n- [ ] Credit management protocol incomplete\n- [ ] Multi-rail support not specified\n\n#### Protocol Behavior (Preliminary)\n\n**Scale-Up Domain**: Scale-Up L2 provides optimized networking within a tightly-coupled compute domain (up to 256 nodes).\n\n**Use Cases**:\n- GPU cluster interconnect\n- AI/ML training clusters\n- HPC scale-up networking\n\n---\n\n## 4. Transport Layer\n\n### 4.1 CSIG+ Telemetry (4 bytes)\n\n**Datamodel**: `datamodel/protocols/cornelis/transport/csig_plus.ksy`\n\nCSIG+ (Cornelis Signal Plus) provides in-band network telemetry for monitoring and diagnostics.\n\n#### Wire Format\n\n```\nByte:    0       1       2       3\n     +-------+-------+-------+-------+\n     |ver|typ| flags |  telemetry_data |\n     +-------+-------+-------+-------+\n\nByte 0 Detail:\n  Bit:  7 6 5 4 3 2 1 0\n       |version|  type |\n       |(4 bit)|(4 bit)|\n```\n\n#### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| version | 4 | 0[7:4] | CSIG+ version | Must be 0 |\n| telemetry_type | 4 | 0[3:0] | Telemetry type | Per enum below |\n| flags | 8 | 1 | Control flags | See below |\n| telemetry_data | 16 | 2-3 | Type-specific data | Per type |\n\n#### Flags\n\n| Bit | Name | Description |\n|-----|------|-------------|\n| 7 | accumulate | Add hop data (vs replace) |\n| 6 | report | Generate telemetry report |\n| 5 | sink | Final hop for telemetry |\n| 4 | source | Originating hop |\n| 3-0 | type_flags | Type-specific flags |\n\n#### Telemetry Types\n\n| Value | Type | Data Format |\n|-------|------|-------------|\n| 0 | Latency | Accumulated latency (16-bit ns) |\n| 1 | Queue Depth | Queue % (8-bit) + Queue ID (8-bit) |\n| 2 | Congestion | ECN (2-bit) + Level (6-bit) + Rsvd (8-bit) |\n| 3 | Path Trace | Switch ID (16-bit) |\n| 4 | Timestamp | Truncated timestamp (16-bit) |\n| 5-14 | Reserved | Reserved |\n| 15 | Custom | Vendor-specific |\n\n#### Protocol Behavior\n\n**In-Band Telemetry**: CSIG+ enables per-hop telemetry collection without out-of-band management traffic.\n\n**Use Cases**:\n- Per-hop latency measurement\n- Queue depth monitoring\n- Congestion detection\n- Path verification\n\n**Reference**: Cornelis Networks CSIG+ Specification\n\n---\n\n## 5. Encapsulation\n\n### 5.1 VxLAN+ (4 bytes)\n\n**Datamodel**: `datamodel/protocols/cornelis/encapsulation/vxlan_plus.ksy`\n\nVxLAN+ extends standard VxLAN (RFC 7348) with fabric-aware overlay networking features.\n\n#### Wire Format\n\n```\nByte:    0       1       2       3\n     +-------+-------+-------+-------+\n     | flags |vni_hi |vni_mid|vni_lo|pri|\n     +-------+-------+-------+-------+\n\nByte 0 Detail:\n  Bit:  7 6 5 4 3 2 1 0\n       |I|P|B|O| rsvd  |\n```\n\n#### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| flags.I | 1 | 0[7] | VNI valid | Must be 1 |\n| flags.P | 1 | 0[6] | Policy applied | Informational |\n| flags.B | 1 | 0[5] | BUM traffic | Broadcast/Unknown/Multicast |\n| flags.O | 1 | 0[4] | OAM frame | Operations/Admin/Maintenance |\n| flags.rsvd | 4 | 0[3:0] | Reserved | Must be 0 |\n| vni_high | 8 | 1 | VNI bits [23:16] | - |\n| vni_mid | 8 | 2 | VNI bits [15:8] | - |\n| vni_low | 4 | 3[7:4] | VNI bits [7:4] | Low nibble |\n| priority | 4 | 3[3:0] | Fabric priority | 0-15 |\n\n**Note**: VNI bits [3:0] are always 0 in VxLAN+, giving effective VNI granularity of 16.\n\n#### Computed Fields\n\n| Field | Computation | Description |\n|-------|-------------|-------------|\n| vni | `(vni_high << 16) \\| (vni_mid << 8) \\| (vni_low & 0xF0)` | 24-bit VNI |\n| priority | `vni_low & 0x0F` | 4-bit priority |\n\n#### Protocol Behavior\n\n**Fabric-Aware Overlay**: VxLAN+ integrates overlay networking with fabric QoS and policy.\n\n**Use Cases**:\n- Multi-tenant fabric isolation\n- VM/container networking\n- Data center interconnect\n\n**Reference**: RFC 7348 (VxLAN), Cornelis Networks VxLAN+ Specification\n\n---\n\n## 6. Cross-References\n\n### Related Documents\n\n| Document | Content |\n|----------|---------|\n| [packet_taxonomy.md](packet_taxonomy.md) | Master index |\n| [packet_taxonomy_ue_pds.md](packet_taxonomy_ue_pds.md) | UE+ PDS formats |\n| [packet_taxonomy_ue_ses.md](packet_taxonomy_ue_ses.md) | UE+ SES formats |\n\n### Datamodel Files\n\n| File | Description |\n|------|-------------|\n| `link/ue_plus.ksy` | UE+ L2 header (12 bytes) |\n| `network/ufh_16.ksy` | UFH-16 (12 bytes) |\n| `network/ufh_32.ksy` | UFH-32 (12 bytes) |\n| `network/collective_l2.ksy` | Collective L2 (4 bytes, WIP) |\n| `network/scaleup_l2.ksy` | Scale-Up L2 (4 bytes, WIP) |\n| `transport/csig_plus.ksy` | CSIG+ telemetry (4 bytes) |\n| `encapsulation/vxlan_plus.ksy` | VxLAN+ (4 bytes) |\n\n---\n\n## 7. References\n\n- CN7000 Packet Taxonomy\n- Cornelis Networks CSIG+ Specification\n- Cornelis Networks VxLAN+ Specification\n- RFC 7348 (VxLAN)\n- IEEE 802.1Q (VLAN)\n"
            },
            "output": "Wrote file successfully.",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy_cornelis.md",
            "metadata": {
              "diagnostics": {},
              "filepath": "/home/matkins/CN7000/analysis/packet_taxonomy_cornelis.md",
              "exists": false,
              "truncated": false
            },
            "time": {
              "start": 1769125577382,
              "end": 1769125577528
            }
          }
        },
        {
          "id": "prt_be81a0339001r3enef5CFGZ2S3",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be818830a001WAr6m4Dh9B472K",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 103382,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be81a03bc001aYZSs5vWmuFHfF",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769125577660,
          "completed": 1769125589044
        },
        "parentID": "msg_be80bfd40001700UtaNDuhl2uY",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 103390,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be81a09a100121sN0SExVL4fsW",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81a03bc001aYZSs5vWmuFHfF",
          "type": "step-start"
        },
        {
          "id": "prt_be81a2f78001lUFbtfBH0Aku3o",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81a03bc001aYZSs5vWmuFHfF",
          "type": "tool",
          "callID": "toolu_01FQn4a3F8RuVsrcE1DouyiC",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/roce/transport/bth.ksy"
            },
            "output": "<file>\n00001| meta:\n00002|   id: roce_bth\n00003|   title: RoCEv2 Base Transport Header\n00004|   ks-version: \"0.10\"\n00005|   endian: be\n00006| \n00007| doc: |\n00008|   RoCEv2 Base Transport Header (BTH) - 12 bytes\n00009| \n00010|   The BTH is present in all RoCEv2 packets and follows the UDP header.\n00011|   RoCEv2 uses UDP port 4791 (0x12B7) as the destination port.\n00012| \n00013|   Reference: InfiniBand Architecture Specification Vol 1, Section 9.2\n00014|   Reference: RoCEv2 Annex A17 (IBTA)\n00015| \n00016|   Packet structure for RoCEv2:\n00017|     Ethernet II | IPv4/IPv6 | UDP (port 4791) | BTH | [Extended Headers] | Payload | ICRC\n00018| \n00019|   Opcode encoding (8 bits):\n00020|     - Bits [7:5]: Transport type (RC=0, UC=1, RD=2, UD=3)\n00021|     - Bits [4:0]: Operation (SEND, RDMA_WRITE, RDMA_READ, etc.)\n00022| \n00023| seq:\n00024|   - id: opcode\n00025|     type: u1\n00026|     doc: |\n00027|       Operation code (8 bits)\n00028|       Upper 3 bits: Transport type\n00029|         0x00 = RC (Reliable Connection)\n00030|         0x20 = UC (Unreliable Connection)\n00031|         0x40 = RD (Reliable Datagram)\n00032|         0x60 = UD (Unreliable Datagram)\n00033|       Lower 5 bits: Operation\n00034|         0x00 = SEND_FIRST\n00035|         0x01 = SEND_MIDDLE\n00036|         0x02 = SEND_LAST\n00037|         0x03 = SEND_LAST_IMM\n00038|         0x04 = SEND_ONLY\n00039|         0x05 = SEND_ONLY_IMM\n00040|         0x06 = RDMA_WRITE_FIRST\n00041|         0x07 = RDMA_WRITE_MIDDLE\n00042|         0x08 = RDMA_WRITE_LAST\n00043|         0x09 = RDMA_WRITE_LAST_IMM\n00044|         0x0A = RDMA_WRITE_ONLY\n00045|         0x0B = RDMA_WRITE_ONLY_IMM\n00046|         0x0C = RDMA_READ_REQUEST\n00047|         0x0D = RDMA_READ_RESPONSE_FIRST\n00048|         0x0E = RDMA_READ_RESPONSE_MIDDLE\n00049|         0x0F = RDMA_READ_RESPONSE_LAST\n00050|         0x10 = RDMA_READ_RESPONSE_ONLY\n00051|         0x11 = ACK\n00052|         0x12 = ATOMIC_ACK\n00053|         0x13 = CMP_SWAP\n00054|         0x14 = FETCH_ADD\n00055| \n00056|   - id: flags\n00057|     type: u1\n00058|     doc: |\n00059|       Flags byte containing:\n00060|         - SE (bit 7): Solicited Event - request completion notification\n00061|         - M (bit 6): Migration state (MigReq)\n00062|         - Pad Count (bits 5-4): Number of pad bytes (0-3)\n00063|         - TVer (bits 3-0): Transport Header Version (must be 0)\n00064| \n00065|   - id: pkey\n00066|     type: u2\n00067|     doc: |\n00068|       Partition Key (16 bits)\n00069|       Used for security partitioning in InfiniBand fabrics.\n00070|       Bit 15 is membership type (full=1, limited=0).\n00071|       Bits 14-0 are the partition key value.\n00072| \n00073|   - id: reserved\n00074|     type: b8\n00075|     doc: Reserved field (8 bits, must be zero)\n00076| \n00077|   - id: dest_qp\n00078|     type: b24\n00079|     doc: |\n00080|       Destination Queue Pair number (24 bits)\n00081|       Identifies the target QP on the receiving node.\n00082|       Valid range: 0 to 2^24-1\n00083|       QP 0 and 1 are reserved for special management purposes.\n00084| \n00085|   - id: ack_req\n00086|     type: b1\n00087|     doc: |\n00088|       Acknowledge Request (1 bit)\n00089|       When set, requests an ACK from the responder.\n00090|       Used for reliable transports (RC, RD).\n00091| \n00092|   - id: reserved2\n00093|     type: b7\n00094|     doc: Reserved field (7 bits, must be zero)\n00095| \n00096|   - id: psn\n00097|     type: b24\n00098|     doc: |\n00099|       Packet Sequence Number (24 bits)\n00100|       Used for ordering and duplicate detection.\n00101|       Wraps around at 2^24.\n00102| \n00103| instances:\n00104|   transport_type:\n00105|     value: (opcode >> 5) & 0x07\n00106|     doc: Transport type extracted from opcode (RC=0, UC=1, RD=2, UD=3)\n00107| \n00108|   operation:\n00109|     value: opcode & 0x1f\n00110|     doc: Operation type extracted from opcode\n00111| \n00112|   solicited_event:\n00113|     value: (flags >> 7) & 0x01\n00114|     doc: Solicited Event flag\n00115| \n00116|   mig_req:\n00117|     value: (flags >> 6) & 0x01\n00118|     doc: Migration Request flag\n00119| \n00120|   pad_count:\n00121|     value: (flags >> 4) & 0x03\n00122|     doc: Number of pad bytes at end of payload (0-3)\n00123| \n00124|   tver:\n00125|     value: flags & 0x0f\n00126|     doc: Transport Header Version (must be 0)\n00127| \n00128|   header_size:\n00129|     value: 12\n00130|     doc: BTH header size in bytes\n00131| \n00132|   is_rc:\n00133|     value: transport_type == 0\n00134|     doc: True if Reliable Connection transport\n00135| \n00136|   is_uc:\n00137|     value: transport_type == 1\n00138|     doc: True if Unreliable Connection transport\n00139| \n00140|   is_rd:\n00141|     value: transport_type == 2\n00142|     doc: True if Reliable Datagram transport\n00143| \n00144|   is_ud:\n00145|     value: transport_type == 3\n00146|     doc: True if Unreliable Datagram transport\n00147| \n00148|   is_send:\n00149|     value: operation >= 0 and operation <= 5\n00150|     doc: True if this is a SEND operation\n00151| \n00152|   is_rdma_write:\n00153|     value: operation >= 6 and operation <= 11\n00154|     doc: True if this is an RDMA WRITE operation\n00155| \n00156|   is_rdma_read:\n00157|     value: operation >= 12 and operation <= 16\n00158|     doc: True if this is an RDMA READ operation\n00159| \n00160|   is_atomic:\n00161|     value: operation >= 18 and operation <= 20\n00162|     doc: True if this is an atomic operation\n00163| \n00164|   has_immediate:\n00165|     value: operation == 3 or operation == 5 or operation == 9 or operation == 11\n00166|     doc: True if packet includes immediate data\n00167| \n00168| enums:\n00169|   transport_types:\n00170|     0: rc\n00171|     1: uc\n00172|     2: rd\n00173|     3: ud\n00174| \n00175|   operations:\n00176|     0x00: send_first\n00177|     0x01: send_middle\n00178|     0x02: send_last\n00179|     0x03: send_last_imm\n00180|     0x04: send_only\n00181|     0x05: send_only_imm\n00182|     0x06: rdma_write_first\n00183|     0x07: rdma_write_middle\n00184|     0x08: rdma_write_last\n00185|     0x09: rdma_write_last_imm\n00186|     0x0a: rdma_write_only\n00187|     0x0b: rdma_write_only_imm\n00188|     0x0c: rdma_read_request\n00189|     0x0d: rdma_read_response_first\n00190|     0x0e: rdma_read_response_middle\n00191|     0x0f: rdma_read_response_last\n00192|     0x10: rdma_read_response_only\n00193|     0x11: ack\n00194|     0x12: atomic_ack\n00195|     0x13: cmp_swap\n00196|     0x14: fetch_add\n00197| \n\n(End of file - total 197 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/roce/transport/bth.ksy",
            "metadata": {
              "preview": "meta:\n  id: roce_bth\n  title: RoCEv2 Base Transport Header\n  ks-version: \"0.10\"\n  endian: be\n\ndoc: |\n  RoCEv2 Base Transport Header (BTH) - 12 bytes\n\n  The BTH is present in all RoCEv2 packets and follows the UDP header.\n  RoCEv2 uses UDP port 4791 (0x12B7) as the destination port.\n\n  Reference: InfiniBand Architecture Specification Vol 1, Section 9.2\n  Reference: RoCEv2 Annex A17 (IBTA)\n\n  Packet structure for RoCEv2:\n    Ethernet II | IPv4/IPv6 | UDP (port 4791) | BTH | [Extended Headers] | Payload | ICRC\n\n  Opcode encoding (8 bits):\n    - Bits [7:5]: Transport type (RC=0, UC=1, RD=2, UD=3)",
              "truncated": false
            },
            "time": {
              "start": 1769125588858,
              "end": 1769125589001
            }
          }
        },
        {
          "id": "prt_be81a2f7c001rMBkHVBuHZ3qS4",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81a03bc001aYZSs5vWmuFHfF",
          "type": "tool",
          "callID": "toolu_01WfRQ9scteJuyWP22wdRpSV",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/roce/transport/reth.ksy"
            },
            "output": "<file>\n00001| meta:\n00002|   id: roce_reth\n00003|   title: RoCEv2 RDMA Extended Transport Header\n00004|   ks-version: \"0.10\"\n00005|   endian: be\n00006| \n00007| doc: |\n00008|   RoCEv2 RDMA Extended Transport Header (RETH) - 16 bytes\n00009| \n00010|   Present in RDMA READ Request and RDMA WRITE First/Only packets.\n00011|   Specifies the remote memory region to read from or write to.\n00012| \n00013|   Reference: InfiniBand Architecture Specification Vol 1, Section 9.3\n00014| \n00015|   Used with opcodes:\n00016|     - RDMA_WRITE_FIRST (0x06)\n00017|     - RDMA_WRITE_ONLY (0x0A)\n00018|     - RDMA_WRITE_ONLY_IMM (0x0B)\n00019|     - RDMA_READ_REQUEST (0x0C)\n00020| \n00021|   Packet structure:\n00022|     BTH | RETH | [Payload] | ICRC\n00023| \n00024| seq:\n00025|   - id: virtual_address\n00026|     type: u8\n00027|     doc: |\n00028|       Virtual Address (64 bits)\n00029|       Starting address in remote memory region where data will be\n00030|       read from (RDMA READ) or written to (RDMA WRITE).\n00031| \n00032|   - id: rkey\n00033|     type: u4\n00034|     doc: |\n00035|       Remote Key (32 bits)\n00036|       Authorization key for accessing the remote memory region.\n00037|       Must match an rkey registered on the remote node.\n00038| \n00039|   - id: dma_length\n00040|     type: u4\n00041|     doc: |\n00042|       DMA Length (32 bits)\n00043|       Total number of bytes to transfer.\n00044|       For multi-packet operations, this is the total length\n00045|       across all packets in the sequence.\n00046| \n00047| instances:\n00048|   header_size:\n00049|     value: 16\n00050|     doc: RETH header size in bytes\n00051| \n00052|   is_valid_length:\n00053|     value: dma_length > 0\n00054|     doc: True if DMA length is non-zero (valid transfer)\n00055| \n00056|   max_dma_length:\n00057|     value: 0x80000000\n00058|     doc: Maximum DMA length (2GB per RDMA operation)\n00059| \n\n(End of file - total 59 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/roce/transport/reth.ksy",
            "metadata": {
              "preview": "meta:\n  id: roce_reth\n  title: RoCEv2 RDMA Extended Transport Header\n  ks-version: \"0.10\"\n  endian: be\n\ndoc: |\n  RoCEv2 RDMA Extended Transport Header (RETH) - 16 bytes\n\n  Present in RDMA READ Request and RDMA WRITE First/Only packets.\n  Specifies the remote memory region to read from or write to.\n\n  Reference: InfiniBand Architecture Specification Vol 1, Section 9.3\n\n  Used with opcodes:\n    - RDMA_WRITE_FIRST (0x06)\n    - RDMA_WRITE_ONLY (0x0A)\n    - RDMA_WRITE_ONLY_IMM (0x0B)\n    - RDMA_READ_REQUEST (0x0C)\n",
              "truncated": false
            },
            "time": {
              "start": 1769125588861,
              "end": 1769125588989
            }
          }
        },
        {
          "id": "prt_be81a2f7e001Sh6055kbJjSKb2",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81a03bc001aYZSs5vWmuFHfF",
          "type": "tool",
          "callID": "toolu_01BfjLpfT4uibifWWoygn6sM",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/roce/transport/aeth.ksy"
            },
            "output": "<file>\n00001| meta:\n00002|   id: roce_aeth\n00003|   title: RoCEv2 ACK Extended Transport Header\n00004|   ks-version: \"0.10\"\n00005|   endian: be\n00006| \n00007| doc: |\n00008|   RoCEv2 ACK Extended Transport Header (AETH) - 4 bytes\n00009| \n00010|   Present in ACK, RDMA READ Response, and Atomic ACK packets.\n00011|   Contains acknowledgment information and credit updates.\n00012| \n00013|   Reference: InfiniBand Architecture Specification Vol 1, Section 9.4\n00014| \n00015|   Used with opcodes:\n00016|     - ACK (0x11)\n00017|     - ATOMIC_ACK (0x12)\n00018|     - RDMA_READ_RESPONSE_FIRST (0x0D)\n00019|     - RDMA_READ_RESPONSE_MIDDLE (0x0E)\n00020|     - RDMA_READ_RESPONSE_LAST (0x0F)\n00021|     - RDMA_READ_RESPONSE_ONLY (0x10)\n00022| \n00023|   Packet structure:\n00024|     BTH | AETH | [Payload/AtomicAckETH] | ICRC\n00025| \n00026| seq:\n00027|   - id: syndrome\n00028|     type: u1\n00029|     doc: |\n00030|       Syndrome field (8 bits)\n00031|       Encodes ACK type and additional information:\n00032|         - Bits [7:6]: ACK type\n00033|           00 = ACK (positive acknowledgment)\n00034|           01 = RNR NAK (Receiver Not Ready)\n00035|           10 = Reserved\n00036|           11 = NAK (Negative acknowledgment)\n00037|         - Bits [5:0]: Meaning depends on ACK type\n00038|           For ACK: Credit count (number of additional WQEs receiver can accept)\n00039|           For RNR NAK: RNR NAK timeout value\n00040|           For NAK: NAK error code\n00041| \n00042|   - id: msn\n00043|     type: b24\n00044|     doc: |\n00045|       Message Sequence Number (24 bits)\n00046|       Identifies which message is being acknowledged.\n00047|       Incremented for each new message sent on the QP.\n00048| \n00049| instances:\n00050|   header_size:\n00051|     value: 4\n00052|     doc: AETH header size in bytes\n00053| \n00054|   ack_type:\n00055|     value: (syndrome >> 6) & 0x03\n00056|     doc: ACK type (0=ACK, 1=RNR_NAK, 3=NAK)\n00057| \n00058|   credit_count:\n00059|     value: syndrome & 0x1f\n00060|     doc: Credit count for ACK type (max 31)\n00061| \n00062|   rnr_timeout:\n00063|     value: syndrome & 0x1f\n00064|     doc: RNR NAK timeout value for RNR_NAK type\n00065| \n00066|   nak_code:\n00067|     value: syndrome & 0x1f\n00068|     doc: NAK error code for NAK type\n00069| \n00070|   is_ack:\n00071|     value: ack_type == 0\n00072|     doc: True if this is a positive ACK\n00073| \n00074|   is_rnr_nak:\n00075|     value: ack_type == 1\n00076|     doc: True if this is an RNR NAK (Receiver Not Ready)\n00077| \n00078|   is_nak:\n00079|     value: ack_type == 3\n00080|     doc: True if this is a NAK (error)\n00081| \n00082| enums:\n00083|   ack_types:\n00084|     0: ack\n00085|     1: rnr_nak\n00086|     2: reserved\n00087|     3: nak\n00088| \n00089|   nak_codes:\n00090|     0x00: psn_seq_error\n00091|     0x01: invalid_request\n00092|     0x02: remote_access_error\n00093|     0x03: remote_op_error\n00094|     0x04: invalid_rd_request\n00095| \n00096|   rnr_timeout_values:\n00097|     0x00: t_655_36_ms\n00098|     0x01: t_0_01_ms\n00099|     0x02: t_0_02_ms\n00100|     0x03: t_0_03_ms\n00101|     0x04: t_0_04_ms\n00102|     0x05: t_0_06_ms\n00103|     0x06: t_0_08_ms\n00104|     0x07: t_0_12_ms\n00105|     0x08: t_0_16_ms\n00106|     0x09: t_0_24_ms\n00107|     0x0a: t_0_32_ms\n00108|     0x0b: t_0_48_ms\n00109|     0x0c: t_0_64_ms\n00110|     0x0d: t_0_96_ms\n00111|     0x0e: t_1_28_ms\n00112|     0x0f: t_1_92_ms\n00113|     0x10: t_2_56_ms\n00114|     0x11: t_3_84_ms\n00115|     0x12: t_5_12_ms\n00116|     0x13: t_7_68_ms\n00117|     0x14: t_10_24_ms\n00118|     0x15: t_15_36_ms\n00119|     0x16: t_20_48_ms\n00120|     0x17: t_30_72_ms\n00121|     0x18: t_40_96_ms\n00122|     0x19: t_61_44_ms\n00123|     0x1a: t_81_92_ms\n00124|     0x1b: t_122_88_ms\n00125|     0x1c: t_163_84_ms\n00126|     0x1d: t_245_76_ms\n00127|     0x1e: t_327_68_ms\n00128|     0x1f: t_491_52_ms\n00129| \n\n(End of file - total 129 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/roce/transport/aeth.ksy",
            "metadata": {
              "preview": "meta:\n  id: roce_aeth\n  title: RoCEv2 ACK Extended Transport Header\n  ks-version: \"0.10\"\n  endian: be\n\ndoc: |\n  RoCEv2 ACK Extended Transport Header (AETH) - 4 bytes\n\n  Present in ACK, RDMA READ Response, and Atomic ACK packets.\n  Contains acknowledgment information and credit updates.\n\n  Reference: InfiniBand Architecture Specification Vol 1, Section 9.4\n\n  Used with opcodes:\n    - ACK (0x11)\n    - ATOMIC_ACK (0x12)\n    - RDMA_READ_RESPONSE_FIRST (0x0D)\n    - RDMA_READ_RESPONSE_MIDDLE (0x0E)\n    - RDMA_READ_RESPONSE_LAST (0x0F)",
              "truncated": false
            },
            "time": {
              "start": 1769125588862,
              "end": 1769125589013
            }
          }
        },
        {
          "id": "prt_be81a2f7f0017bcUMF6O7boAbN",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81a03bc001aYZSs5vWmuFHfF",
          "type": "tool",
          "callID": "toolu_01XvWEFxkGDy87D4ggwnb9eL",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/earlysim/datamodel/protocols/roce/transport/atomiceth.ksy"
            },
            "output": "<file>\n00001| meta:\n00002|   id: roce_atomiceth\n00003|   title: RoCEv2 Atomic Extended Transport Header\n00004|   ks-version: \"0.10\"\n00005|   endian: be\n00006| \n00007| doc: |\n00008|   RoCEv2 Atomic Extended Transport Header (AtomicETH) - 28 bytes\n00009| \n00010|   Present in atomic operation request packets.\n00011|   Specifies the remote memory address and operands for\n00012|   compare-and-swap or fetch-and-add operations.\n00013| \n00014|   Reference: InfiniBand Architecture Specification Vol 1, Section 9.8\n00015| \n00016|   Used with opcodes:\n00017|     - CMP_SWAP (0x13): Compare and Swap\n00018|     - FETCH_ADD (0x14): Fetch and Add\n00019| \n00020|   Packet structure:\n00021|     BTH | AtomicETH | ICRC\n00022| \n00023|   Atomic operations are always 8 bytes and must be naturally aligned.\n00024| \n00025| seq:\n00026|   - id: virtual_address\n00027|     type: u8\n00028|     doc: |\n00029|       Virtual Address (64 bits)\n00030|       Address in remote memory where atomic operation is performed.\n00031|       Must be 8-byte aligned.\n00032| \n00033|   - id: rkey\n00034|     type: u4\n00035|     doc: |\n00036|       Remote Key (32 bits)\n00037|       Authorization key for accessing the remote memory region.\n00038| \n00039|   - id: swap_or_add_data\n00040|     type: u8\n00041|     doc: |\n00042|       Swap/Add Data (64 bits)\n00043|       For CMP_SWAP: Value to write if comparison succeeds\n00044|       For FETCH_ADD: Value to add to the remote location\n00045| \n00046|   - id: compare_data\n00047|     type: u8\n00048|     doc: |\n00049|       Compare Data (64 bits)\n00050|       For CMP_SWAP: Value to compare against remote location\n00051|       For FETCH_ADD: Must be zero (unused)\n00052| \n00053| instances:\n00054|   header_size:\n00055|     value: 28\n00056|     doc: AtomicETH header size in bytes\n00057| \n00058|   is_aligned:\n00059|     value: (virtual_address & 0x07) == 0\n00060|     doc: True if address is 8-byte aligned (required for atomics)\n00061| \n00062|   atomic_size:\n00063|     value: 8\n00064|     doc: Atomic operations are always 8 bytes\n00065| \n\n(End of file - total 65 lines)\n</file>",
            "title": "home/matkins/CN7000/earlysim/datamodel/protocols/roce/transport/atomiceth.ksy",
            "metadata": {
              "preview": "meta:\n  id: roce_atomiceth\n  title: RoCEv2 Atomic Extended Transport Header\n  ks-version: \"0.10\"\n  endian: be\n\ndoc: |\n  RoCEv2 Atomic Extended Transport Header (AtomicETH) - 28 bytes\n\n  Present in atomic operation request packets.\n  Specifies the remote memory address and operands for\n  compare-and-swap or fetch-and-add operations.\n\n  Reference: InfiniBand Architecture Specification Vol 1, Section 9.8\n\n  Used with opcodes:\n    - CMP_SWAP (0x13): Compare and Swap\n    - FETCH_ADD (0x14): Fetch and Add\n\n  Packet structure:",
              "truncated": false
            },
            "time": {
              "start": 1769125588863,
              "end": 1769125589031
            }
          }
        },
        {
          "id": "prt_be81a3029001ed0EKNuhRqd968",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81a03bc001aYZSs5vWmuFHfF",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 103390,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be81a308d001whS7eqbeQcICsg",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769125589133,
          "completed": 1769125667048
        },
        "parentID": "msg_be80bfd40001700UtaNDuhl2uY",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 108167,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "tool-calls"
      },
      "parts": [
        {
          "id": "prt_be81a354f001kAiaVAYZ0O9g7I",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81a308d001whS7eqbeQcICsg",
          "type": "step-start"
        },
        {
          "id": "prt_be81b6064001ADyTFopR3Kg3i6",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81a308d001whS7eqbeQcICsg",
          "type": "tool",
          "callID": "toolu_01JScrgPs9Myq9tvGJb9e5ZT",
          "tool": "write",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/matkins/CN7000/analysis/packet_taxonomy_rocev2.md",
              "content": "# PMR Packet Taxonomy: RoCEv2 Formats\n\n**Parent Document**: [packet_taxonomy.md](packet_taxonomy.md)  \n**Scope**: RDMA over Converged Ethernet v2 (RoCEv2) packet formats  \n**Datamodel Directory**: `datamodel/protocols/roce/transport/`  \n**Last Updated**: 2026-01-22\n\n---\n\n## Table of Contents\n\n1. [Overview](#1-overview)\n2. [RoCEv2 Packet Structure](#2-rocev2-packet-structure)\n3. [Base Transport Header (BTH)](#3-base-transport-header-bth-12-bytes)\n4. [Extended Transport Headers](#4-extended-transport-headers)\n   - [4.1 RETH (RDMA Extended)](#41-reth-rdma-extended-transport-header-16-bytes)\n   - [4.2 AETH (ACK Extended)](#42-aeth-ack-extended-transport-header-4-bytes)\n   - [4.3 AtomicETH](#43-atomiceth-atomic-extended-transport-header-28-bytes)\n   - [4.4 Other Headers](#44-other-headers)\n5. [Packet Composition](#5-packet-composition)\n6. [Cross-References](#6-cross-references)\n7. [References](#7-references)\n\n---\n\n## 1. Overview\n\nRoCEv2 (RDMA over Converged Ethernet v2) enables RDMA operations over standard Ethernet networks using UDP/IP encapsulation. PMR provides full hardware support for RoCEv2 operations.\n\n### Key Characteristics\n\n| Feature | Value |\n|---------|-------|\n| UDP Destination Port | 4791 (0x12B7) |\n| Transport Types | RC, UC, RD, UD |\n| Max PSN | 2^24 (16,777,216) |\n| Max QP | 2^24 (16,777,216) |\n| Atomic Size | 8 bytes (64-bit) |\n\n### Transport Types\n\n| Type | Value | Description |\n|------|-------|-------------|\n| RC | 0x00 | Reliable Connection |\n| UC | 0x20 | Unreliable Connection |\n| RD | 0x40 | Reliable Datagram |\n| UD | 0x60 | Unreliable Datagram |\n\n---\n\n## 2. RoCEv2 Packet Structure\n\n```\n+-----------------------------------------------------------------------------+\n| Ethernet II Header (14 bytes)                                               |\n|   Dest MAC (6) | Source MAC (6) | EtherType (2) = 0x0800/0x86DD            |\n+-----------------------------------------------------------------------------+\n| IP Header (20 bytes IPv4 / 40 bytes IPv6)                                   |\n|   Version, IHL, DSCP, ECN, Length, ID, Flags, TTL, Protocol=17, Checksum   |\n|   Source IP, Dest IP                                                        |\n+-----------------------------------------------------------------------------+\n| UDP Header (8 bytes)                                                        |\n|   Source Port (entropy) | Dest Port = 4791 | Length | Checksum             |\n+-----------------------------------------------------------------------------+\n| BTH - Base Transport Header (12 bytes)                                      |\n|   Opcode | Flags | P-Key | Dest QP | A | PSN                               |\n+-----------------------------------------------------------------------------+\n| Extended Headers (optional, operation-dependent)                            |\n|   RETH (16) | AETH (4) | AtomicETH (28) | ImmDt (4)                        |\n+-----------------------------------------------------------------------------+\n| Payload (0 - MTU bytes)                                                     |\n+-----------------------------------------------------------------------------+\n| ICRC (4 bytes)                                                              |\n+-----------------------------------------------------------------------------+\n```\n\n### Header Sizes\n\n| Component | Size | Notes |\n|-----------|------|-------|\n| Ethernet II | 14 bytes | + 4 bytes if VLAN tagged |\n| IPv4 | 20 bytes | + options if present |\n| IPv6 | 40 bytes | + extension headers |\n| UDP | 8 bytes | Fixed |\n| BTH | 12 bytes | Always present |\n| RETH | 16 bytes | RDMA Read/Write |\n| AETH | 4 bytes | ACK/Response |\n| AtomicETH | 28 bytes | Atomic operations |\n| ImmDt | 4 bytes | Immediate data |\n| ICRC | 4 bytes | Always present |\n\n---\n\n## 3. Base Transport Header (BTH, 12 bytes)\n\n**Datamodel**: `datamodel/protocols/roce/transport/bth.ksy`  \n**Related Formats**: All RoCEv2 packets\n\nThe BTH is present in all RoCEv2 packets and follows the UDP header.\n\n### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     | opcode| flags |     p_key     | rsvd  |      dest_qp        →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11\n     +-------+-------+-------+-------+\n   → |A| rsvd |        psn          |\n     +-------+-------+-------+-------+\n\nByte 1 (flags) Detail:\n  Bit:  7 6 5 4 3 2 1 0\n       |S|M|pad| tver  |\n       |E| |cnt|       |\n```\n\n### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| opcode | 8 | 0 | Operation code | See tables below |\n| flags.SE | 1 | 1[7] | Solicited Event | Request completion notification |\n| flags.M | 1 | 1[6] | Migration state | MigReq flag |\n| flags.pad | 2 | 1[5:4] | Pad count | 0-3 bytes padding |\n| flags.tver | 4 | 1[3:0] | Transport version | Must be 0 |\n| p_key | 16 | 2-3 | Partition key | Bit 15 = membership type |\n| rsvd | 8 | 4 | Reserved | Must be 0 |\n| dest_qp | 24 | 5-7 | Destination QP | Target queue pair |\n| ack_req | 1 | 8[7] | ACK request | Request ACK (reliable only) |\n| rsvd | 7 | 8[6:0] | Reserved | Must be 0 |\n| psn | 24 | 9-11 | Packet Sequence Number | 24-bit, wraps |\n\n### Opcode Encoding\n\nThe opcode byte encodes both transport type and operation:\n\n```\nOpcode = (Transport Type << 5) | Operation\n```\n\n### Transport Types (Opcode bits [7:5])\n\n| Value | Type | Description |\n|-------|------|-------------|\n| 0x00 | RC | Reliable Connection |\n| 0x20 | UC | Unreliable Connection |\n| 0x40 | RD | Reliable Datagram |\n| 0x60 | UD | Unreliable Datagram |\n\n### Operations (Opcode bits [4:0])\n\n| Value | Operation | Extended Headers |\n|-------|-----------|------------------|\n| 0x00 | SEND_FIRST | None |\n| 0x01 | SEND_MIDDLE | None |\n| 0x02 | SEND_LAST | None |\n| 0x03 | SEND_LAST_IMM | ImmDt |\n| 0x04 | SEND_ONLY | None |\n| 0x05 | SEND_ONLY_IMM | ImmDt |\n| 0x06 | RDMA_WRITE_FIRST | RETH |\n| 0x07 | RDMA_WRITE_MIDDLE | None |\n| 0x08 | RDMA_WRITE_LAST | None |\n| 0x09 | RDMA_WRITE_LAST_IMM | ImmDt |\n| 0x0A | RDMA_WRITE_ONLY | RETH |\n| 0x0B | RDMA_WRITE_ONLY_IMM | RETH + ImmDt |\n| 0x0C | RDMA_READ_REQUEST | RETH |\n| 0x0D | RDMA_READ_RESPONSE_FIRST | AETH |\n| 0x0E | RDMA_READ_RESPONSE_MIDDLE | None |\n| 0x0F | RDMA_READ_RESPONSE_LAST | AETH |\n| 0x10 | RDMA_READ_RESPONSE_ONLY | AETH |\n| 0x11 | ACK | AETH |\n| 0x12 | ATOMIC_ACK | AETH + AtomicAckETH |\n| 0x13 | CMP_SWAP | AtomicETH |\n| 0x14 | FETCH_ADD | AtomicETH |\n\n### Protocol Behavior\n\n**Reliable Transports (RC, RD)**:\n- PSN used for ordering and duplicate detection\n- ACK request triggers acknowledgment\n- Retransmission on timeout or NAK\n\n**Unreliable Transports (UC, UD)**:\n- No acknowledgments\n- No retransmission\n- PSN for duplicate detection only\n\n**Reference**: InfiniBand Architecture Specification Vol 1, Section 9.2\n\n---\n\n## 4. Extended Transport Headers\n\n### 4.1 RETH (RDMA Extended Transport Header, 16 bytes)\n\n**Datamodel**: `datamodel/protocols/roce/transport/reth.ksy`  \n**Related Formats**: [BTH (3)](#3-base-transport-header-bth-12-bytes)\n\nPresent in RDMA READ Request and RDMA WRITE First/Only packets.\n\n#### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |                    virtual_address [63:0]                     |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |          r_key [31:0]         |       dma_length [31:0]       |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n#### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| virtual_address | 64 | 0-7 | Remote virtual address | Target memory location |\n| r_key | 32 | 8-11 | Remote key | Memory region authorization |\n| dma_length | 32 | 12-15 | DMA length | Total bytes to transfer |\n\n#### Protocol Behavior\n\n**RDMA Write**:\n- RETH specifies where to write data in remote memory\n- Present in FIRST and ONLY packets\n- Subsequent packets (MIDDLE, LAST) continue from computed offset\n\n**RDMA Read**:\n- RETH specifies where to read data from remote memory\n- Response packets carry the requested data\n\n**Reference**: InfiniBand Architecture Specification Vol 1, Section 9.3\n\n---\n\n### 4.2 AETH (ACK Extended Transport Header, 4 bytes)\n\n**Datamodel**: `datamodel/protocols/roce/transport/aeth.ksy`  \n**Related Formats**: [BTH (3)](#3-base-transport-header-bth-12-bytes)\n\nPresent in ACK, RDMA READ Response, and Atomic ACK packets.\n\n#### Wire Format\n\n```\nByte:    0       1       2       3\n     +-------+-------+-------+-------+\n     |syndrome|        msn          |\n     +-------+-------+-------+-------+\n\nByte 0 (syndrome) Detail:\n  Bit:  7 6 5 4 3 2 1 0\n       |type | value     |\n       |(2b) | (6 bits)  |\n```\n\n#### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| syndrome | 8 | 0 | ACK type + value | See below |\n| msn | 24 | 1-3 | Message Sequence Number | Message being ACK'd |\n\n#### Syndrome Encoding\n\n| Bits [7:6] | Type | Bits [5:0] Meaning |\n|------------|------|-------------------|\n| 00 | ACK | Credit count (0-31) |\n| 01 | RNR NAK | RNR timeout value |\n| 10 | Reserved | - |\n| 11 | NAK | NAK error code |\n\n#### NAK Error Codes\n\n| Code | Name | Description |\n|------|------|-------------|\n| 0x00 | PSN_SEQ_ERROR | PSN sequence error |\n| 0x01 | INVALID_REQUEST | Invalid request |\n| 0x02 | REMOTE_ACCESS_ERROR | Remote access error |\n| 0x03 | REMOTE_OP_ERROR | Remote operation error |\n| 0x04 | INVALID_RD_REQUEST | Invalid RD request |\n\n#### RNR Timeout Values\n\n| Code | Timeout |\n|------|---------|\n| 0x00 | 655.36 ms |\n| 0x01 | 0.01 ms |\n| 0x02 | 0.02 ms |\n| ... | ... |\n| 0x1F | 491.52 ms |\n\n#### Protocol Behavior\n\n**Positive ACK**:\n- Acknowledges successful receipt\n- Credit count indicates receiver capacity\n\n**RNR NAK**:\n- Receiver Not Ready\n- Sender should retry after timeout\n\n**NAK**:\n- Error condition\n- Sender should handle error\n\n**Reference**: InfiniBand Architecture Specification Vol 1, Section 9.4\n\n---\n\n### 4.3 AtomicETH (Atomic Extended Transport Header, 28 bytes)\n\n**Datamodel**: `datamodel/protocols/roce/transport/atomiceth.ksy`  \n**Related Formats**: [BTH (3)](#3-base-transport-header-bth-12-bytes) | [AETH (4.2)](#42-aeth-ack-extended-transport-header-4-bytes)\n\nPresent in atomic operation request packets (CMP_SWAP, FETCH_ADD).\n\n#### Wire Format\n\n```\nByte:    0       1       2       3       4       5       6       7\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |                    virtual_address [63:0]                     |\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n         8       9      10      11      12      13      14      15\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n     |          r_key [31:0]         |     swap_or_add_data [63:0]  →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        16      17      18      19      20      21      22      23\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n   → |  (swap_or_add cont'd)         |       compare_data [63:0]    →\n     +-------+-------+-------+-------+-------+-------+-------+-------+\n        24      25      26      27\n     +-------+-------+-------+-------+\n   → |  (compare_data cont'd)        |\n     +-------+-------+-------+-------+\n```\n\n#### Field Definitions\n\n| Field | Bits | Offset | Description | Constraints |\n|-------|------|--------|-------------|-------------|\n| virtual_address | 64 | 0-7 | Remote virtual address | Must be 8-byte aligned |\n| r_key | 32 | 8-11 | Remote key | Memory region authorization |\n| swap_or_add_data | 64 | 12-19 | Swap/Add operand | See below |\n| compare_data | 64 | 20-27 | Compare operand | CMP_SWAP only |\n\n#### Operation Semantics\n\n**Compare and Swap (CMP_SWAP)**:\n```\nif (*virtual_address == compare_data) {\n    original = *virtual_address;\n    *virtual_address = swap_or_add_data;\n    return original;\n}\n```\n\n**Fetch and Add (FETCH_ADD)**:\n```\noriginal = *virtual_address;\n*virtual_address = original + swap_or_add_data;\nreturn original;\n```\n\n#### Protocol Behavior\n\n**Atomic Constraints**:\n- Operations are always 8 bytes (64-bit)\n- Address must be 8-byte aligned\n- compare_data must be 0 for FETCH_ADD\n\n**Response**:\n- ATOMIC_ACK with AtomicAckETH containing original value\n\n**Reference**: InfiniBand Architecture Specification Vol 1, Section 9.8\n\n---\n\n### 4.4 Other Headers\n\n| Header | File | Size | Description |\n|--------|------|------|-------------|\n| AtomicAckETH | `atomicacketh.ksy` | 8 bytes | Original value from atomic op |\n| DETH | `deth.ksy` | 8 bytes | Datagram Extended (UD) |\n| ImmDt | `immdt.ksy` | 4 bytes | Immediate Data |\n| ICRC | `icrc.ksy` | 4 bytes | Invariant CRC |\n\n---\n\n## 5. Packet Composition\n\n### Common Packet Formats\n\n```\nRoCEv2 Packet Composition:\n┌─────────────────────────────────────────────────────────────────┐\n│                                                                 │\n│  SEND:        BTH + [Payload] + ICRC                            │\n│  SEND_IMM:    BTH + ImmDt + [Payload] + ICRC                    │\n│                                                                 │\n│  RDMA Write:  BTH + RETH + [Payload] + ICRC (first/only)        │\n│               BTH + [Payload] + ICRC (middle/last)              │\n│                                                                 │\n│  RDMA Read:   BTH + RETH + ICRC (request)                       │\n│               BTH + AETH + [Payload] + ICRC (response)          │\n│                                                                 │\n│  Atomic:      BTH + AtomicETH + ICRC (request)                  │\n│               BTH + AETH + AtomicAckETH + ICRC (response)       │\n│                                                                 │\n│  ACK/NAK:     BTH + AETH + ICRC                                 │\n│                                                                 │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n### Header Size Summary by Operation\n\n| Operation | BTH | Extended | Payload | ICRC | Min Total |\n|-----------|-----|----------|---------|------|-----------|\n| SEND_ONLY | 12 | 0 | 0+ | 4 | 16 |\n| SEND_ONLY_IMM | 12 | 4 | 0+ | 4 | 20 |\n| RDMA_WRITE_ONLY | 12 | 16 | 0+ | 4 | 32 |\n| RDMA_READ_REQUEST | 12 | 16 | 0 | 4 | 32 |\n| RDMA_READ_RESPONSE | 12 | 4 | 0+ | 4 | 20 |\n| CMP_SWAP | 12 | 28 | 0 | 4 | 44 |\n| FETCH_ADD | 12 | 28 | 0 | 4 | 44 |\n| ACK | 12 | 4 | 0 | 4 | 20 |\n| ATOMIC_ACK | 12 | 12 | 0 | 4 | 28 |\n\n---\n\n## 6. Cross-References\n\n### Related Documents\n\n| Document | Content |\n|----------|---------|\n| [packet_taxonomy.md](packet_taxonomy.md) | Master index |\n| [packet_taxonomy_ue_pds.md](packet_taxonomy_ue_pds.md) | UE+ PDS (alternative transport) |\n\n### Datamodel Files\n\n| File | Description |\n|------|-------------|\n| `bth.ksy` | Base Transport Header (12 bytes) |\n| `reth.ksy` | RDMA Extended Transport Header (16 bytes) |\n| `aeth.ksy` | ACK Extended Transport Header (4 bytes) |\n| `atomiceth.ksy` | Atomic Extended Transport Header (28 bytes) |\n| `atomicacketh.ksy` | Atomic ACK ETH (8 bytes) |\n| `deth.ksy` | Datagram Extended Transport Header (8 bytes) |\n| `immdt.ksy` | Immediate Data (4 bytes) |\n| `icrc.ksy` | Invariant CRC (4 bytes) |\n\n---\n\n## 7. References\n\n- InfiniBand Architecture Specification Volume 1, Release 1.4\n- RoCEv2 Annex A17 (IBTA)\n- RFC 4391 (Transmission of IP Datagrams over InfiniBand)\n"
            },
            "output": "Wrote file successfully.",
            "title": "home/matkins/CN7000/analysis/packet_taxonomy_rocev2.md",
            "metadata": {
              "diagnostics": {},
              "filepath": "/home/matkins/CN7000/analysis/packet_taxonomy_rocev2.md",
              "exists": false,
              "truncated": false
            },
            "time": {
              "start": 1769125666922,
              "end": 1769125667039
            }
          }
        },
        {
          "id": "prt_be81b60e10016yp0jodbs4X3Bk",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81a308d001whS7eqbeQcICsg",
          "type": "step-finish",
          "reason": "tool-calls",
          "cost": 0,
          "tokens": {
            "input": 108167,
            "output": 0,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be81b6149001vEdY2DmdERsKQR",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769125667145,
          "completed": 1769125669124
        },
        "parentID": "msg_be80bfd40001700UtaNDuhl2uY",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 108175,
          "output": 103,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "stop"
      },
      "parts": [
        {
          "id": "prt_be81b66b100121UDOdvTlfLpP2",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81b6149001vEdY2DmdERsKQR",
          "type": "step-start"
        },
        {
          "id": "prt_be81b68d8001inp99suFZA0gUs",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81b6149001vEdY2DmdERsKQR",
          "type": "text",
          "text": "{\n  \"type\": \"error\",\n  \"error_type\": \"BadRequestError\",\n  \"message\": \"Error code: 400 - {'type': 'error', 'error': {'type': 'invalid_request_error', 'message': 'prompt is too long: 204667 tokens > 200000 maximum'}, 'request_id': 'req_011CXPJvPdRvt9xyueW3QqXj'}\",\n  \"timestamp\": \"2026-01-22T23:47:49.047347\"\n}",
          "time": {
            "start": 1769125669112,
            "end": 1769125669112
          }
        },
        {
          "id": "prt_be81b68f9001hEwy03d83PrdDJ",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81b6149001vEdY2DmdERsKQR",
          "type": "step-finish",
          "reason": "stop",
          "cost": 0,
          "tokens": {
            "input": 108175,
            "output": 103,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be81b71df0017EOahrUAWqEg0w",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "user",
        "time": {
          "created": 1769125671391
        },
        "summary": {
          "title": "Todo list continuation: complete remaining tasks",
          "diffs": []
        },
        "agent": "Sisyphus",
        "model": {
          "providerID": "cornelis",
          "modelID": "developer-opus"
        }
      },
      "parts": [
        {
          "id": "prt_be81b71df0025xvevz83ilx0L3",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81b71df0017EOahrUAWqEg0w",
          "type": "text",
          "text": "[SYSTEM REMINDER - TODO CONTINUATION]\n\nIncomplete tasks remain in your todo list. Continue working on the next pending task.\n\n- Proceed without asking for permission\n- Mark each task complete when finished\n- Do not stop until all tasks are done\n\n[Status: 2/15 completed, 13 remaining]"
        }
      ]
    },
    {
      "info": {
        "id": "msg_be81b723000143uzPiu9S07LUA",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769125671472,
          "completed": 1769125673945
        },
        "parentID": "msg_be81b71df0017EOahrUAWqEg0w",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 108373,
          "output": 103,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "stop"
      },
      "parts": [
        {
          "id": "prt_be81b77840010PfAoxj6XBIFtW",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81b723000143uzPiu9S07LUA",
          "type": "step-start"
        },
        {
          "id": "prt_be81b7bc0001vch2MlKl07KNpJ",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81b723000143uzPiu9S07LUA",
          "type": "text",
          "text": "{\n  \"type\": \"error\",\n  \"error_type\": \"BadRequestError\",\n  \"message\": \"Error code: 400 - {'type': 'error', 'error': {'type': 'invalid_request_error', 'message': 'prompt is too long: 204880 tokens > 200000 maximum'}, 'request_id': 'req_011CXPJvjjQwwRyosSHv1FbH'}\",\n  \"timestamp\": \"2026-01-22T23:47:53.866920\"\n}",
          "time": {
            "start": 1769125673935,
            "end": 1769125673935
          }
        },
        {
          "id": "prt_be81b7bd0001EUW9p3eYPvHR27",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81b723000143uzPiu9S07LUA",
          "type": "step-finish",
          "reason": "stop",
          "cost": 0,
          "tokens": {
            "input": 108373,
            "output": 103,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    },
    {
      "info": {
        "id": "msg_be81d0ae8001dhuqOlKKa6Fl4E",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "user",
        "time": {
          "created": 1769125776111
        },
        "summary": {
          "title": "Phase 2 execution continuation",
          "diffs": []
        },
        "agent": "Sisyphus",
        "model": {
          "providerID": "cornelis",
          "modelID": "developer-opus"
        }
      },
      "parts": [
        {
          "id": "prt_be81d0ae8002mw37aUHqIJBapq",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81d0ae8001dhuqOlKKa6Fl4E",
          "type": "text",
          "text": "please continue executing phase 2"
        }
      ]
    },
    {
      "info": {
        "id": "msg_be81d0b50001Enmb91r1h4KDNC",
        "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
        "role": "assistant",
        "time": {
          "created": 1769125776208,
          "completed": 1769125778181
        },
        "parentID": "msg_be81d0ae8001dhuqOlKKa6Fl4E",
        "modelID": "developer-opus",
        "providerID": "cornelis",
        "mode": "Sisyphus",
        "agent": "Sisyphus",
        "path": {
          "cwd": "/home/matkins/CN7000",
          "root": "/"
        },
        "cost": 0,
        "tokens": {
          "input": 108486,
          "output": 103,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "finish": "stop"
      },
      "parts": [
        {
          "id": "prt_be81d1111001CHq5PFzUOp06rW",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81d0b50001Enmb91r1h4KDNC",
          "type": "step-start"
        },
        {
          "id": "prt_be81d12db001n4JNXkkE6QPTtM",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81d0b50001Enmb91r1h4KDNC",
          "type": "text",
          "text": "{\n  \"type\": \"error\",\n  \"error_type\": \"BadRequestError\",\n  \"message\": \"Error code: 400 - {'type': 'error', 'error': {'type': 'invalid_request_error', 'message': 'prompt is too long: 205029 tokens > 200000 maximum'}, 'request_id': 'req_011CXPK4SGuFzeyCi4iGdSXV'}\",\n  \"timestamp\": \"2026-01-22T23:49:38.104317\"\n}",
          "time": {
            "start": 1769125778169,
            "end": 1769125778169
          }
        },
        {
          "id": "prt_be81d12fa001COZ8d405uf0fgp",
          "sessionID": "ses_418d5f96bffe2u3WH0M9GpO9zL",
          "messageID": "msg_be81d0b50001Enmb91r1h4KDNC",
          "type": "step-finish",
          "reason": "stop",
          "cost": 0,
          "tokens": {
            "input": 108486,
            "output": 103,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 0
            }
          }
        }
      ]
    }
  ]
}
