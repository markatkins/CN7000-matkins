# Word Document Generation Rules

Rules for generating DOCX output from markdown.

## Template Requirements

- **Template**: `Standard_Tech Doc Word Template.dotx`
- Title page is preserved from template
- Document properties are set automatically by post-processor

## Build Configuration

From `build.sh`:
```bash
pandoc --to docx \
    --reference-doc="Standard_Tech Doc Word Template.dotx" \
    --lua-filter=docx-format.lua \
    --toc \
    --toc-depth=3 \
    --shift-heading-level-by=-1 \
    -M title="CN7000 Solution and Feature Matrices"
```

Post-processing: `docx-postprocess.py`

## Document Properties

Set by `docx-postprocess.py`:

| Property | Value | Location |
|----------|-------|----------|
| Item Description | From H1 title | Custom Properties |
| Doc Type | "Requirements" | Custom Properties |
| Classification | "Confidential" | Custom Properties |
| Title | From H1 title | Core Properties |

## Table Formatting

Applied by `docx-postprocess.py`:

### Borders
- Style: single line
- Width: 4 (thin)
- Color: 000000 (black)
- Applied to: top, left, bottom, right, insideH, insideV

### Header Row
- First row of each table: **bold**

### Cell Indentation
- All cell margins: 0
- Paragraph indent: 0 (left, right, firstLine)

## Table Captions

### Style
- Word style: "Caption"

### Format
```
Table {STYLEREF 1 \s}-{SEQ Table \* ARABIC \s 1}: <caption text>
```

- `STYLEREF 1 \s`: Chapter/section number
- `SEQ Table \* ARABIC \s 1`: Auto-incrementing table number
- Caption text extracted from markdown

### Position
- Above the table
- Detected by: style="Caption" or text starting with "Table " or containing keywords

## Document Structure

Order of elements in final document:

1. **Title Page** (from template)
2. **Page Break**
3. **Table of Contents** (auto-generated by pandoc `--toc`)
4. **Page Break**
5. **Table of Tables** (TOC field: `TOC \h \z \c "Table"`)
6. **Page Break**
7. **Content Sections**

### Title Page Handling
- Pandoc-generated Title paragraph is removed
- Template's title page content is preserved
- DOCPROPERTY fields in template display document properties

## Lua Filter (docx-format.lua)

Handles:
1. Removes first H1 (moved to metadata)
2. Assigns table captions with sequential numbering

## Post-Processor (docx-postprocess.py)

Handles:
1. Table border formatting
2. Header row bold
3. Cell indent removal
4. Caption field code conversion
5. Table of Tables insertion
6. Page break insertion
7. Document property updates
8. Title paragraph removal
